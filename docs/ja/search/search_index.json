{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u672c\u7ae0\u3067\u306fPG-Strom\u306e\u6982\u8981\u3001\u304a\u3088\u3073\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 PG-Strom\u3068\u306f? PG-Strom\u306fPostgreSQL v9.6\u304a\u3088\u3073\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5411\u3051\u306b\u8a2d\u8a08\u3055\u308c\u305f\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3001\u30c1\u30c3\u30d7\u3042\u305f\u308a\u6570\u5343\u500b\u306e\u30b3\u30a2\u3092\u6301\u3064GPU(Graphic Processor Unit)\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5bfe\u3059\u308b\u96c6\u8a08\u30fb\u89e3\u6790\u51e6\u7406\u3084\u30d0\u30c3\u30c1\u51e6\u7406\u5411\u3051\u306eSQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002 PG-Strom\u306e\u4e2d\u6838\u3068\u306a\u308b\u6a5f\u80fd\u306f\u3001SQL\u547d\u4ee4\u304b\u3089\u81ea\u52d5\u7684\u306bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u751f\u6210\u3059\u308b\u30b3\u30fc\u30c9\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3068\u3001SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u4e0a\u3067\u975e\u540c\u671f\u304b\u3064\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\u73fe\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fSCAN\uff08WHERE\u53e5\u306e\u8a55\u4fa1\uff09\u3001JOIN\u304a\u3088\u3073GROUP BY\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001GPU\u51e6\u7406\u306b\u30a2\u30c9\u30d0\u30f3\u30c6\u30fc\u30b8\u304c\u3042\u308b\u5834\u5408\u306b\u306fPostgreSQL\u6a19\u6e96\u306e\u5b9f\u88c5\u3092\u7f6e\u304d\u63db\u3048\u308b\u4e8b\u3067\u3001\u30e6\u30fc\u30b6\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306f\u900f\u904e\u7684\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002 \u307e\u305f\u3001PG-Strom\u306f\u3044\u304f\u3064\u304b\u306eDWH\u5c02\u7528\u30b7\u30b9\u30c6\u30e0\u3068\u306f\u7570\u306a\u308a\u3001\u884c\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308bPostgreSQL\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u5fc5\u305a\u3057\u3082\u96c6\u8a08\u30fb\u89e3\u6790\u7cfb\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u6700\u9069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4e00\u65b9\u3067\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7cfb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u79fb\u52d5\u3059\u308b\u3053\u3068\u306a\u304f\u96c6\u8a08\u51e6\u7406\u3092\u5b9f\u884c\u3067\u304d\u308b\u3068\u3044\u3046\u30a2\u30c9\u30d0\u30f3\u30c6\u30fc\u30b8\u3067\u3082\u3042\u308a\u307e\u3059\u3002 PG-Strom v2.0\u3067\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u8aad\u51fa\u3057\u80fd\u529b\u304c\u5f37\u5316\u3055\u308c\u307e\u3057\u305f\u3002SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u69cb\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\uff08NVME-SSD\uff09\u304b\u3089GPU\u3078\u76f4\u63a5\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u3001\u30af\u30a8\u30ea\u3092\u51e6\u7406\u3059\u308bGPU\u3078\u9ad8\u901f\u306b\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002 \u4e00\u65b9\u3001\u9ad8\u5ea6\u306a\u7d71\u8a08\u89e3\u6790\u3084\u6a5f\u68b0\u5b66\u7fd2\u3068\u3044\u3063\u305f\u6975\u3081\u3066\u8a08\u7b97\u96c6\u7d04\u5ea6\u306e\u9ad8\u3044\u554f\u984c\u306b\u5bfe\u3057\u3066\u3082\u3001PL/CUDA\u3084gstore_fdw\u3068\u3044\u3063\u305f\u6a5f\u80fd\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u4e0a\u3067\u8a08\u7b97\u51e6\u7406\u3092\u884c\u3044\u3001\u7d50\u679c\u3060\u3051\u3092\u30e6\u30fc\u30b6\u3078\u8fd4\u3059\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3092\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30e9\u30a4\u30bb\u30f3\u30b9\u3068\u8457\u4f5c\u6a29 PG-Strom\u306fGPL(GNU Public License)v2\u306b\u57fa\u3065\u3044\u3066\u516c\u958b\u30fb\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u3059\u3002 \u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u8a73\u7d30\u306f LICENSE \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 PG-Strom\u306e\u8457\u4f5c\u6a29\u306fPG-Strom Development Team\u304c\u6709\u3057\u3066\u3044\u307e\u3059\u3002PG-Strom Development Team\u306f\u6cd5\u7684\u306a\u4e3b\u4f53\u3067\u306f\u306a\u304f\u3001\u56fd\u7c4d\u3092\u554f\u308f\u305a\u3001PG-Strom\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ca2\u732e\u3057\u305f\u500b\u3005\u306e\u958b\u767a\u8005\u3084\u4f01\u696d\u306e\u7dcf\u79f0\u3067\u3059\u3002 \u30b3\u30df\u30e5\u30cb\u30c6\u30a3 \u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306eML\u304c PG-Strom community ML \u306b\u6e96\u5099\u3055\u308c\u3066\u3044\u307e\u3059\u3002 PG-Strom\u306b\u95a2\u9023\u3057\u305f\u8cea\u554f\u3001\u8981\u671b\u3001\u969c\u5bb3\u5831\u544a\u306a\u3069\u306f\u3053\u3061\u3089\u306b\u30dd\u30b9\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u672cML\u306f\u4e16\u754c\u4e2d\u306b\u516c\u958b\u3055\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30af\u306eML\u3067\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3064\u307e\u308a\u3001\u81ea\u5df1\u8cac\u4efb\u306e\u4e0b\u3001\u79d8\u5bc6\u60c5\u5831\u304c\u8aa4\u3063\u3066\u6295\u7a3f\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u672cML\u306e\u512a\u5148\u8a00\u8a9e\u306f\u82f1\u8a9e\u3067\u3059\u3002\u305f\u3060\u4e00\u65b9\u3067\u3001\u6b74\u53f2\u7684\u7d4c\u7def\u306b\u3088\u308aPG-Strom\u30e6\u30fc\u30b6\u306e\u591a\u304f\u306e\u5272\u5408\u304c\u65e5\u672c\u4eba\u3067\u3042\u308b\u4e8b\u306f\u627f\u77e5\u3057\u3066\u304a\u308a\u3001ML\u4e0a\u3067\u65e5\u672c\u8a9e\u3092\u5229\u7528\u3057\u305f\u8b70\u8ad6\u304c\u884c\u308f\u308c\u308b\u3053\u3068\u3082\u53ef\u80fd\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u3001Subject(\u4ef6\u540d)\u306b (JP) \u3068\u3044\u3046\u63a5\u982d\u53e5\u3092\u4ed8\u3051\u308b\u4e8b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u975e\u65e5\u672c\u8a9e\u8a71\u8005\u304c\u4e0d\u8981\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u98db\u3070\u3059\u305f\u3081\u306b\u6709\u7528\u3067\u3059\u3002 \u30d0\u30b0\u3084\u969c\u5bb3\u306e\u5831\u544a \u7d50\u679c\u4e0d\u6b63\u3084\u30b7\u30b9\u30c6\u30e0\u30af\u30e9\u30c3\u30b7\u30e5/\u30ed\u30c3\u30af\u30a2\u30c3\u30d7\u3001\u305d\u306e\u4ed6\u306e\u7591\u308f\u3057\u3044\u52d5\u4f5c\u3092\u767a\u898b\u3057\u305f\u5834\u5408\u306f\u3001 PG-Strom Issue Tracker \u3067\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u3092\u30aa\u30fc\u30d7\u30f3\u3057 bug \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002 \u30d0\u30b0\u30ec\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\u306b\u969b\u3057\u3066\u306f\u3001\u4e0b\u8a18\u306e\u70b9\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 - \u540c\u3058\u554f\u984c\u3092\u6700\u65b0\u7248\u3067\u518d\u73fe\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u304b\u3069\u3046\u304b? - PG-Strom\u306e\u6700\u65b0\u7248\u3060\u3051\u3067\u306a\u304f\u3001OS\u3001CUDA\u3001PostgreSQL\u304a\u3088\u3073\u95a2\u9023\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u6700\u65b0\u7248\u3067\u30c6\u30b9\u30c8\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 - PG-Strom\u304c\u7121\u52b9\u5316\u3055\u308c\u305f\u72b6\u614b\u3067\u3082\u540c\u3058\u554f\u984c\u3092\u518d\u73fe\u3067\u304d\u308b\u304b\u3069\u3046\u304b? - GUC\u30d1\u30e9\u30e1\u30fc\u30bf pg_strom.enabled \u306b\u3088\u3063\u3066PG-Strom\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 - \u540c\u3058\u65e2\u77e5\u554f\u984c\u304c\u65e2\u306bGitHub\u306e\u30a4\u30b7\u30e5\u30fc\u30c8\u30e9\u30c3\u30ab\u30fc\u306b\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\uff1f - close \u72b6\u614b\u306e\u30a4\u30b7\u30e5\u30fc\u3092\u691c\u7d22\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u60c5\u5831\u306f\u30d0\u30b0\u5831\u544a\u306b\u304a\u3044\u3066\u6709\u7528\u3067\u3059\u3002 \u554f\u984c\u30af\u30a8\u30ea\u306e EXPLAIN VERBOSE \u51fa\u529b \u95a2\u9023\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u69cb\u9020\uff08 psql \u4e0a\u3067 \\d+ <table name> \u3092\u5b9f\u884c\u3057\u3066\u5f97\u3089\u308c\u308b\uff09 \u51fa\u529b\u3055\u308c\u305f\u30ed\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\uff08verbose\u51fa\u529b\u304c\u671b\u307e\u3057\u3044\uff09 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308bGUC\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5024 \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u8a2d\u5b9a\uff08\u7279\u306bGPU\u306e\u578b\u756a\u3068RAM\u5bb9\u91cf\uff09 \u3042\u306a\u305f\u306e\u74b0\u5883\u3067\u767a\u751f\u3057\u305f\u7591\u308f\u3057\u3044\u52d5\u4f5c\u304c\u30d0\u30b0\u304b\u3069\u3046\u304b\u5b9a\u304b\u3067\u306f\u306a\u3044\u5834\u5408\u3001\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u306e\u30c1\u30b1\u30c3\u30c8\u3092\u30aa\u30fc\u30d7\u30f3\u3059\u308b\u524d\u306b\u30e1\u30fc\u30ea\u30f3\u30b0\u30ea\u30b9\u30c8\u3078\u5831\u544a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u8ffd\u52a0\u7684\u306a\u60c5\u5831\u63a1\u53d6\u306e\u4f9d\u983c\u306a\u3069\u3001\u958b\u767a\u8005\u306f\u6b21\u306b\u53d6\u308b\u3079\u304d\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u63d0\u6848\u3057\u3066\u304f\u308c\u308b\u3067\u3057\u3087\u3046\u3002 \u65b0\u6a5f\u80fd\u306e\u63d0\u6848 \u4f55\u304b\u65b0\u6a5f\u80fd\u306e\u30a2\u30a4\u30c7\u30a2\u304c\u3042\u308b\u5834\u5408\u3001 PG-Strom Issue Tracker \u3067\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u3092\u30aa\u30fc\u30d7\u30f3\u3057 feature \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002\u7d9a\u3044\u3066\u3001\u4ed6\u306e\u958b\u767a\u8005\u3068\u8b70\u8ad6\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002 \u671b\u307e\u3057\u3044\u65b0\u6a5f\u80fd\u63d0\u6848\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8981\u7d20\u3092\u542b\u3093\u3067\u3044\u307e\u3059\u3002 \u3042\u306a\u305f\u306f\u3069\u306e\u3088\u3046\u306a\u554f\u984c\u3092\u89e3\u6c7a/\u6539\u5584\u3057\u305f\u3044\u306e\u304b\uff1f \u3042\u306a\u305f\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9/\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u3068\u3063\u3066\u3069\u306e\u7a0b\u5ea6\u6df1\u523b\u306a\u306e\u304b\uff1f \u3069\u306e\u3088\u3046\u306b\u305d\u308c\u3092\u5b9f\u88c5\u3059\u308b\u306e\u304b\uff1f \uff08\u3082\u3057\u3042\u308c\u3070\uff09\u4e88\u60f3\u3055\u308c\u308b\u6b20\u70b9\u30fb\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5 \u958b\u767a\u8005\u306e\u9593\u3067\u305d\u306e\u5fc5\u8981\u6027\u306b\u95a2\u3057\u3066\u30b3\u30f3\u30bb\u30f3\u30b5\u30b9\u304c\u5f97\u3089\u308c\u308b\u3068\u3001\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30fc\u306f\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b accepted \u30bf\u30b0\u3092\u4ed8\u3051\u3001\u305d\u306e\u30c1\u30b1\u30c3\u30c8\u306f\u305d\u306e\u5f8c\u306e\u958b\u767a\u4f5c\u696d\u306e\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u306e\u305f\u3081\u306b\u5229\u7528\u3055\u308c\u307e\u3059\u3002\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u3001\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b\u306f rejected \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u30af\u30ed\u30fc\u30ba\u3055\u308c\u307e\u3059\u3002 \u4e00\u5ea6\u30d7\u30ed\u30dd\u30fc\u30b6\u30eb\u304c\u5374\u4e0b\u3055\u308c\u305f\u3068\u3057\u3066\u3082\u3001\u5c06\u6765\u306b\u304a\u3044\u3066\u307e\u305f\u7570\u306a\u3063\u305f\u6c7a\u5b9a\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u5468\u8fba\u72b6\u6cc1\u304c\u5909\u308f\u3063\u305f\u5834\u5408\u3001\u65b0\u6a5f\u80fd\u306e\u518d\u63d0\u6848\u3092\u8e8a\u8e87\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u958b\u767a\u6bb5\u968e\u3067\u306f\u3001\u30d1\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b\u6dfb\u4ed8\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002pull-request\u306f\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002 \u30b5\u30dd\u30fc\u30c8\u30dd\u30ea\u30b7\u30fc PG-Strom development team\u306fHeteroDB Software Distribution Center\u304b\u3089\u914d\u5e03\u3055\u308c\u305f\u6700\u65b0\u7248\u306e\u307f\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 \u30c8\u30e9\u30d6\u30eb\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u307e\u305a\u305d\u306e\u554f\u984c\u306f\u6700\u65b0\u7248\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u518d\u73fe\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002 \u307e\u305f\u3001\u3053\u308c\u306f\u30dc\u30e9\u30f3\u30c6\u30a3\u30a2\u30d9\u30fc\u30b9\u306e\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30b5\u30dd\u30fc\u30c8\u306e\u30dd\u30ea\u30b7\u30fc\u3067\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3064\u307e\u308a\u3001\u30b5\u30dd\u30fc\u30c8\u306f\u30d9\u30b9\u30c8\u30a8\u30d5\u30a9\u30fc\u30c8\u3067\u304b\u3064\u3001SLA\u306e\u5b9a\u7fa9\u3082\u3042\u308a\u307e\u305b\u3093\u3002 \u3082\u3057\u5546\u7528\u306e\u30b5\u30dd\u30fc\u30c8\u304c\u5fc5\u8981\u3067\u3042\u308b\u5834\u5408\u3001HeteroDB\u793e\uff08contact@heterodbcom\uff09\u306b\u30b3\u30f3\u30bf\u30af\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30d0\u30fc\u30b8\u30e7\u30f3\u30dd\u30ea\u30b7\u30fc PG-Strom\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f <major>.<minor> \u3068\u3044\u30462\u3064\u306e\u8981\u7d20\u304b\u3089\u6210\u308a\u307e\u3059\u3002 \u30de\u30a4\u30ca\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f\u5404\u30ea\u30ea\u30fc\u30b9\u6bce\u306b\u5897\u52a0\u3057\u3001\u30d0\u30b0\u4fee\u6b63\u3068\u65b0\u6a5f\u80fd\u306e\u8ffd\u52a0\u3092\u542b\u307f\u307e\u3059\u3002 \u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u5408\u306b\u5897\u52a0\u3057\u307e\u3059\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308bPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u3046\u3061\u3001\u3044\u304f\u3064\u304b\u304c\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3068\u306a\u3063\u305f\u5834\u5408\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308bGPU\u30c7\u30d0\u30a4\u30b9\u306e\u3046\u3061\u3001\u3044\u304f\u3064\u304b\u304c\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3068\u306a\u3063\u305f\u5834\u5408\u3002 \u30a8\u30dd\u30c3\u30af\u30e1\u30a4\u30ad\u30f3\u30b0\u306a\u65b0\u6a5f\u80fd\u304c\u8ffd\u52a0\u3068\u306a\u3063\u305f\u5834\u5408\u3002","title":"\u306f\u3058\u3081\u306b"},{"location":"#pg-strom","text":"PG-Strom\u306fPostgreSQL v9.6\u304a\u3088\u3073\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5411\u3051\u306b\u8a2d\u8a08\u3055\u308c\u305f\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3001\u30c1\u30c3\u30d7\u3042\u305f\u308a\u6570\u5343\u500b\u306e\u30b3\u30a2\u3092\u6301\u3064GPU(Graphic Processor Unit)\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5bfe\u3059\u308b\u96c6\u8a08\u30fb\u89e3\u6790\u51e6\u7406\u3084\u30d0\u30c3\u30c1\u51e6\u7406\u5411\u3051\u306eSQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002 PG-Strom\u306e\u4e2d\u6838\u3068\u306a\u308b\u6a5f\u80fd\u306f\u3001SQL\u547d\u4ee4\u304b\u3089\u81ea\u52d5\u7684\u306bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u751f\u6210\u3059\u308b\u30b3\u30fc\u30c9\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3068\u3001SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u4e0a\u3067\u975e\u540c\u671f\u304b\u3064\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\u73fe\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fSCAN\uff08WHERE\u53e5\u306e\u8a55\u4fa1\uff09\u3001JOIN\u304a\u3088\u3073GROUP BY\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001GPU\u51e6\u7406\u306b\u30a2\u30c9\u30d0\u30f3\u30c6\u30fc\u30b8\u304c\u3042\u308b\u5834\u5408\u306b\u306fPostgreSQL\u6a19\u6e96\u306e\u5b9f\u88c5\u3092\u7f6e\u304d\u63db\u3048\u308b\u4e8b\u3067\u3001\u30e6\u30fc\u30b6\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306f\u900f\u904e\u7684\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002 \u307e\u305f\u3001PG-Strom\u306f\u3044\u304f\u3064\u304b\u306eDWH\u5c02\u7528\u30b7\u30b9\u30c6\u30e0\u3068\u306f\u7570\u306a\u308a\u3001\u884c\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308bPostgreSQL\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u5fc5\u305a\u3057\u3082\u96c6\u8a08\u30fb\u89e3\u6790\u7cfb\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u6700\u9069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4e00\u65b9\u3067\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7cfb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u79fb\u52d5\u3059\u308b\u3053\u3068\u306a\u304f\u96c6\u8a08\u51e6\u7406\u3092\u5b9f\u884c\u3067\u304d\u308b\u3068\u3044\u3046\u30a2\u30c9\u30d0\u30f3\u30c6\u30fc\u30b8\u3067\u3082\u3042\u308a\u307e\u3059\u3002 PG-Strom v2.0\u3067\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u8aad\u51fa\u3057\u80fd\u529b\u304c\u5f37\u5316\u3055\u308c\u307e\u3057\u305f\u3002SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u69cb\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\uff08NVME-SSD\uff09\u304b\u3089GPU\u3078\u76f4\u63a5\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u3001\u30af\u30a8\u30ea\u3092\u51e6\u7406\u3059\u308bGPU\u3078\u9ad8\u901f\u306b\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002 \u4e00\u65b9\u3001\u9ad8\u5ea6\u306a\u7d71\u8a08\u89e3\u6790\u3084\u6a5f\u68b0\u5b66\u7fd2\u3068\u3044\u3063\u305f\u6975\u3081\u3066\u8a08\u7b97\u96c6\u7d04\u5ea6\u306e\u9ad8\u3044\u554f\u984c\u306b\u5bfe\u3057\u3066\u3082\u3001PL/CUDA\u3084gstore_fdw\u3068\u3044\u3063\u305f\u6a5f\u80fd\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u4e0a\u3067\u8a08\u7b97\u51e6\u7406\u3092\u884c\u3044\u3001\u7d50\u679c\u3060\u3051\u3092\u30e6\u30fc\u30b6\u3078\u8fd4\u3059\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3092\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002","title":"PG-Strom\u3068\u306f?"},{"location":"#_1","text":"PG-Strom\u306fGPL(GNU Public License)v2\u306b\u57fa\u3065\u3044\u3066\u516c\u958b\u30fb\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u3059\u3002 \u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u8a73\u7d30\u306f LICENSE \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 PG-Strom\u306e\u8457\u4f5c\u6a29\u306fPG-Strom Development Team\u304c\u6709\u3057\u3066\u3044\u307e\u3059\u3002PG-Strom Development Team\u306f\u6cd5\u7684\u306a\u4e3b\u4f53\u3067\u306f\u306a\u304f\u3001\u56fd\u7c4d\u3092\u554f\u308f\u305a\u3001PG-Strom\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ca2\u732e\u3057\u305f\u500b\u3005\u306e\u958b\u767a\u8005\u3084\u4f01\u696d\u306e\u7dcf\u79f0\u3067\u3059\u3002","title":"\u30e9\u30a4\u30bb\u30f3\u30b9\u3068\u8457\u4f5c\u6a29"},{"location":"#_2","text":"\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306eML\u304c PG-Strom community ML \u306b\u6e96\u5099\u3055\u308c\u3066\u3044\u307e\u3059\u3002 PG-Strom\u306b\u95a2\u9023\u3057\u305f\u8cea\u554f\u3001\u8981\u671b\u3001\u969c\u5bb3\u5831\u544a\u306a\u3069\u306f\u3053\u3061\u3089\u306b\u30dd\u30b9\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u672cML\u306f\u4e16\u754c\u4e2d\u306b\u516c\u958b\u3055\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30af\u306eML\u3067\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3064\u307e\u308a\u3001\u81ea\u5df1\u8cac\u4efb\u306e\u4e0b\u3001\u79d8\u5bc6\u60c5\u5831\u304c\u8aa4\u3063\u3066\u6295\u7a3f\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u672cML\u306e\u512a\u5148\u8a00\u8a9e\u306f\u82f1\u8a9e\u3067\u3059\u3002\u305f\u3060\u4e00\u65b9\u3067\u3001\u6b74\u53f2\u7684\u7d4c\u7def\u306b\u3088\u308aPG-Strom\u30e6\u30fc\u30b6\u306e\u591a\u304f\u306e\u5272\u5408\u304c\u65e5\u672c\u4eba\u3067\u3042\u308b\u4e8b\u306f\u627f\u77e5\u3057\u3066\u304a\u308a\u3001ML\u4e0a\u3067\u65e5\u672c\u8a9e\u3092\u5229\u7528\u3057\u305f\u8b70\u8ad6\u304c\u884c\u308f\u308c\u308b\u3053\u3068\u3082\u53ef\u80fd\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u3001Subject(\u4ef6\u540d)\u306b (JP) \u3068\u3044\u3046\u63a5\u982d\u53e5\u3092\u4ed8\u3051\u308b\u4e8b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u975e\u65e5\u672c\u8a9e\u8a71\u8005\u304c\u4e0d\u8981\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u98db\u3070\u3059\u305f\u3081\u306b\u6709\u7528\u3067\u3059\u3002","title":"\u30b3\u30df\u30e5\u30cb\u30c6\u30a3"},{"location":"#_3","text":"\u7d50\u679c\u4e0d\u6b63\u3084\u30b7\u30b9\u30c6\u30e0\u30af\u30e9\u30c3\u30b7\u30e5/\u30ed\u30c3\u30af\u30a2\u30c3\u30d7\u3001\u305d\u306e\u4ed6\u306e\u7591\u308f\u3057\u3044\u52d5\u4f5c\u3092\u767a\u898b\u3057\u305f\u5834\u5408\u306f\u3001 PG-Strom Issue Tracker \u3067\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u3092\u30aa\u30fc\u30d7\u30f3\u3057 bug \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002 \u30d0\u30b0\u30ec\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\u306b\u969b\u3057\u3066\u306f\u3001\u4e0b\u8a18\u306e\u70b9\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 - \u540c\u3058\u554f\u984c\u3092\u6700\u65b0\u7248\u3067\u518d\u73fe\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u304b\u3069\u3046\u304b? - PG-Strom\u306e\u6700\u65b0\u7248\u3060\u3051\u3067\u306a\u304f\u3001OS\u3001CUDA\u3001PostgreSQL\u304a\u3088\u3073\u95a2\u9023\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u6700\u65b0\u7248\u3067\u30c6\u30b9\u30c8\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 - PG-Strom\u304c\u7121\u52b9\u5316\u3055\u308c\u305f\u72b6\u614b\u3067\u3082\u540c\u3058\u554f\u984c\u3092\u518d\u73fe\u3067\u304d\u308b\u304b\u3069\u3046\u304b? - GUC\u30d1\u30e9\u30e1\u30fc\u30bf pg_strom.enabled \u306b\u3088\u3063\u3066PG-Strom\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 - \u540c\u3058\u65e2\u77e5\u554f\u984c\u304c\u65e2\u306bGitHub\u306e\u30a4\u30b7\u30e5\u30fc\u30c8\u30e9\u30c3\u30ab\u30fc\u306b\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\uff1f - close \u72b6\u614b\u306e\u30a4\u30b7\u30e5\u30fc\u3092\u691c\u7d22\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u60c5\u5831\u306f\u30d0\u30b0\u5831\u544a\u306b\u304a\u3044\u3066\u6709\u7528\u3067\u3059\u3002 \u554f\u984c\u30af\u30a8\u30ea\u306e EXPLAIN VERBOSE \u51fa\u529b \u95a2\u9023\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u69cb\u9020\uff08 psql \u4e0a\u3067 \\d+ <table name> \u3092\u5b9f\u884c\u3057\u3066\u5f97\u3089\u308c\u308b\uff09 \u51fa\u529b\u3055\u308c\u305f\u30ed\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\uff08verbose\u51fa\u529b\u304c\u671b\u307e\u3057\u3044\uff09 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308bGUC\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5024 \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u8a2d\u5b9a\uff08\u7279\u306bGPU\u306e\u578b\u756a\u3068RAM\u5bb9\u91cf\uff09 \u3042\u306a\u305f\u306e\u74b0\u5883\u3067\u767a\u751f\u3057\u305f\u7591\u308f\u3057\u3044\u52d5\u4f5c\u304c\u30d0\u30b0\u304b\u3069\u3046\u304b\u5b9a\u304b\u3067\u306f\u306a\u3044\u5834\u5408\u3001\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u306e\u30c1\u30b1\u30c3\u30c8\u3092\u30aa\u30fc\u30d7\u30f3\u3059\u308b\u524d\u306b\u30e1\u30fc\u30ea\u30f3\u30b0\u30ea\u30b9\u30c8\u3078\u5831\u544a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u8ffd\u52a0\u7684\u306a\u60c5\u5831\u63a1\u53d6\u306e\u4f9d\u983c\u306a\u3069\u3001\u958b\u767a\u8005\u306f\u6b21\u306b\u53d6\u308b\u3079\u304d\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u63d0\u6848\u3057\u3066\u304f\u308c\u308b\u3067\u3057\u3087\u3046\u3002","title":"\u30d0\u30b0\u3084\u969c\u5bb3\u306e\u5831\u544a"},{"location":"#_4","text":"\u4f55\u304b\u65b0\u6a5f\u80fd\u306e\u30a2\u30a4\u30c7\u30a2\u304c\u3042\u308b\u5834\u5408\u3001 PG-Strom Issue Tracker \u3067\u65b0\u3057\u3044\u30a4\u30b7\u30e5\u30fc\u3092\u30aa\u30fc\u30d7\u30f3\u3057 feature \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002\u7d9a\u3044\u3066\u3001\u4ed6\u306e\u958b\u767a\u8005\u3068\u8b70\u8ad6\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002 \u671b\u307e\u3057\u3044\u65b0\u6a5f\u80fd\u63d0\u6848\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8981\u7d20\u3092\u542b\u3093\u3067\u3044\u307e\u3059\u3002 \u3042\u306a\u305f\u306f\u3069\u306e\u3088\u3046\u306a\u554f\u984c\u3092\u89e3\u6c7a/\u6539\u5584\u3057\u305f\u3044\u306e\u304b\uff1f \u3042\u306a\u305f\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9/\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u3068\u3063\u3066\u3069\u306e\u7a0b\u5ea6\u6df1\u523b\u306a\u306e\u304b\uff1f \u3069\u306e\u3088\u3046\u306b\u305d\u308c\u3092\u5b9f\u88c5\u3059\u308b\u306e\u304b\uff1f \uff08\u3082\u3057\u3042\u308c\u3070\uff09\u4e88\u60f3\u3055\u308c\u308b\u6b20\u70b9\u30fb\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5 \u958b\u767a\u8005\u306e\u9593\u3067\u305d\u306e\u5fc5\u8981\u6027\u306b\u95a2\u3057\u3066\u30b3\u30f3\u30bb\u30f3\u30b5\u30b9\u304c\u5f97\u3089\u308c\u308b\u3068\u3001\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30fc\u306f\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b accepted \u30bf\u30b0\u3092\u4ed8\u3051\u3001\u305d\u306e\u30c1\u30b1\u30c3\u30c8\u306f\u305d\u306e\u5f8c\u306e\u958b\u767a\u4f5c\u696d\u306e\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u306e\u305f\u3081\u306b\u5229\u7528\u3055\u308c\u307e\u3059\u3002\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u3001\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b\u306f rejected \u30bf\u30b0\u3092\u4ed8\u3051\u3066\u30af\u30ed\u30fc\u30ba\u3055\u308c\u307e\u3059\u3002 \u4e00\u5ea6\u30d7\u30ed\u30dd\u30fc\u30b6\u30eb\u304c\u5374\u4e0b\u3055\u308c\u305f\u3068\u3057\u3066\u3082\u3001\u5c06\u6765\u306b\u304a\u3044\u3066\u307e\u305f\u7570\u306a\u3063\u305f\u6c7a\u5b9a\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u5468\u8fba\u72b6\u6cc1\u304c\u5909\u308f\u3063\u305f\u5834\u5408\u3001\u65b0\u6a5f\u80fd\u306e\u518d\u63d0\u6848\u3092\u8e8a\u8e87\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u958b\u767a\u6bb5\u968e\u3067\u306f\u3001\u30d1\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30b7\u30e5\u30fc\u30c1\u30b1\u30c3\u30c8\u306b\u6dfb\u4ed8\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002pull-request\u306f\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002","title":"\u65b0\u6a5f\u80fd\u306e\u63d0\u6848"},{"location":"#_5","text":"PG-Strom development team\u306fHeteroDB Software Distribution Center\u304b\u3089\u914d\u5e03\u3055\u308c\u305f\u6700\u65b0\u7248\u306e\u307f\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 \u30c8\u30e9\u30d6\u30eb\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u307e\u305a\u305d\u306e\u554f\u984c\u306f\u6700\u65b0\u7248\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u518d\u73fe\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002 \u307e\u305f\u3001\u3053\u308c\u306f\u30dc\u30e9\u30f3\u30c6\u30a3\u30a2\u30d9\u30fc\u30b9\u306e\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30b5\u30dd\u30fc\u30c8\u306e\u30dd\u30ea\u30b7\u30fc\u3067\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3064\u307e\u308a\u3001\u30b5\u30dd\u30fc\u30c8\u306f\u30d9\u30b9\u30c8\u30a8\u30d5\u30a9\u30fc\u30c8\u3067\u304b\u3064\u3001SLA\u306e\u5b9a\u7fa9\u3082\u3042\u308a\u307e\u305b\u3093\u3002 \u3082\u3057\u5546\u7528\u306e\u30b5\u30dd\u30fc\u30c8\u304c\u5fc5\u8981\u3067\u3042\u308b\u5834\u5408\u3001HeteroDB\u793e\uff08contact@heterodbcom\uff09\u306b\u30b3\u30f3\u30bf\u30af\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"\u30b5\u30dd\u30fc\u30c8\u30dd\u30ea\u30b7\u30fc"},{"location":"#_6","text":"PG-Strom\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f <major>.<minor> \u3068\u3044\u30462\u3064\u306e\u8981\u7d20\u304b\u3089\u6210\u308a\u307e\u3059\u3002 \u30de\u30a4\u30ca\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f\u5404\u30ea\u30ea\u30fc\u30b9\u6bce\u306b\u5897\u52a0\u3057\u3001\u30d0\u30b0\u4fee\u6b63\u3068\u65b0\u6a5f\u80fd\u306e\u8ffd\u52a0\u3092\u542b\u307f\u307e\u3059\u3002 \u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u5408\u306b\u5897\u52a0\u3057\u307e\u3059\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308bPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u3046\u3061\u3001\u3044\u304f\u3064\u304b\u304c\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3068\u306a\u3063\u305f\u5834\u5408\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308bGPU\u30c7\u30d0\u30a4\u30b9\u306e\u3046\u3061\u3001\u3044\u304f\u3064\u304b\u304c\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3068\u306a\u3063\u305f\u5834\u5408\u3002 \u30a8\u30dd\u30c3\u30af\u30e1\u30a4\u30ad\u30f3\u30b0\u306a\u65b0\u6a5f\u80fd\u304c\u8ffd\u52a0\u3068\u306a\u3063\u305f\u5834\u5408\u3002","title":"\u30d0\u30fc\u30b8\u30e7\u30f3\u30dd\u30ea\u30b7\u30fc"},{"location":"arrow_fdw/","text":"\u5217\u6307\u5411\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2 (Arrow_Fdw) \u6982\u8981 PostgreSQL\u306e\u30c6\u30fc\u30d6\u30eb\u306f\u5185\u90e8\u7684\u306b8KB\u306e\u30d6\u30ed\u30c3\u30af 1 \u3068\u547c\u3070\u308c\u308b\u5358\u4f4d\u3067\u7de8\u6210\u3055\u308c\u3001\u30d6\u30ed\u30c3\u30af\u306f\u5168\u3066\u306e\u5c5e\u6027\u53ca\u3073\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u542b\u3080\u30bf\u30d7\u30eb\u3068\u547c\u3070\u308c\u308b\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u884c\u5358\u4f4d\u3067\u683c\u7d0d\u3057\u307e\u3059\u3002\u884c\u3092\u69cb\u6210\u3059\u308b\u30c7\u30fc\u30bf\u304c\u8fd1\u508d\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3001\u3053\u308c\u306fINSERT\u3084UPDATE\u306e\u591a\u3044\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u6709\u52b9\u3067\u3059\u304c\u3001\u4e00\u65b9\u3067\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u30fb\u89e3\u6790\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u306f\u4e0d\u5411\u304d\u3067\u3042\u308b\u3068\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u901a\u5e38\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u306b\u304a\u3044\u3066\u306f\u30c6\u30fc\u30d6\u30eb\u5185\u306e\u5168\u3066\u306e\u5217\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u73cd\u3057\u304f\u3001\u591a\u304f\u306e\u5834\u5408\u306b\u306f\u4e00\u90e8\u306e\u5217\u3060\u3051\u3092\u53c2\u7167\u3059\u308b\u3068\u3044\u3063\u305f\u51e6\u7406\u306b\u306a\u308a\u304c\u3061\u3067\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u5b9f\u969b\u306b\u306f\u53c2\u7167\u3055\u308c\u306a\u3044\u5217\u306e\u30c7\u30fc\u30bf\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306b\u6d88\u8cbb\u3055\u308c\u308bI/O\u306e\u5e2f\u57df\u306f\u5168\u304f\u7121\u99c4\u3067\u3059\u304c\u3001\u884c\u5358\u4f4d\u3067\u7de8\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u7279\u5b9a\u306e\u5217\u3060\u3051\u3092\u53d6\u308a\u51fa\u3059\u3068\u3044\u3046\u64cd\u4f5c\u306f\u56f0\u96e3\u3067\u3059\u3002 \u9006\u306b\u5217\u5358\u4f4d\u3067\u30c7\u30fc\u30bf\u3092\u7de8\u6210\u3057\u305f\u5834\u5408\u3001INSERT\u3084UPDATE\u306e\u591a\u3044\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u306f\u6975\u7aef\u306b\u4e0d\u5229\u3067\u3059\u304c\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u30fb\u89e3\u6790\u3092\u884c\u3046\u969b\u306b\u306f\u88ab\u53c2\u7167\u5217\u3060\u3051\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001I/O\u306e\u5e2f\u57df\u3092\u6700\u5927\u9650\u306b\u6d3b\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u307e\u305f\u30d7\u30ed\u30bb\u30c3\u30b5\u306e\u51e6\u7406\u52b9\u7387\u306e\u89b3\u70b9\u304b\u3089\u3082\u3001\u5217\u5358\u4f4d\u306b\u7de8\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u5358\u7d14\u306a\u914d\u5217\u3067\u3042\u308b\u304b\u306e\u3088\u3046\u306b\u898b\u3048\u308b\u305f\u3081\u3001GPU\u306b\u3068\u3063\u3066\u306fCoalesced Memory Access\u3068\u3044\u3046\u30e1\u30e2\u30ea\u30d0\u30b9\u306e\u6027\u80fd\u3092\u6700\u5927\u9650\u306b\u5f15\u304d\u51fa\u3059\u30a2\u30af\u30bb\u30b9\u30d1\u30bf\u30fc\u30f3\u3068\u306a\u308b\u4e8b\u304c\u671f\u5f85\u3067\u304d\u307e\u3059\u3002 Apache Arrow\u3068\u306f Apache Arrow\u3068\u306f\u3001\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3092\u5217\u5f62\u5f0f\u3067\u8a18\u9332\u3001\u4ea4\u63db\u3059\u308b\u305f\u3081\u306e\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u3059\u3002 \u4e3b\u306b\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u305f\u3081\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u307b\u304b\u3001C\u3084C++\u3001Python\u306a\u3069\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u5411\u3051\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6574\u5099\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u81ea\u4f5c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089Apache Arrow\u5f62\u5f0f\u3092\u6271\u3046\u3088\u3046\u8a2d\u8a08\u3059\u308b\u4e8b\u3082\u5bb9\u6613\u3067\u3059\u3002 Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u306b\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5b9a\u7fa9\u3059\u308b\u30b9\u30ad\u30fc\u30de\uff08Schema\uff09\u90e8\u5206\u3068\u3001\u30b9\u30ad\u30fc\u30de\u306b\u57fa\u3065\u3044\u3066\u5217\u30c7\u30fc\u30bf\u3092\u8a18\u9332\u3059\u308b1\u500b\u4ee5\u4e0a\u306e\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\uff08RecordBatch\uff09\u90e8\u5206\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u578b\u3068\u3057\u3066\u306f\u3001\u6574\u6570\u3084\u6587\u5b57\u5217\uff08\u53ef\u5909\u9577\uff09\u3001\u65e5\u4ed8\u6642\u523b\u578b\u306a\u3069\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u500b\u3005\u306e\u5217\u30c7\u30fc\u30bf\u306f\u3053\u308c\u3089\u30c7\u30fc\u30bf\u578b\u306b\u5fdc\u3058\u305f\u5185\u90e8\u8868\u73fe\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 Apache Arrow\u5f62\u5f0f\u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u8868\u73fe\u306f\u3001\u5fc5\u305a\u3057\u3082\u5168\u3066\u306e\u5834\u5408\u3067PostgreSQL\u306e\u30c7\u30fc\u30bf\u8868\u73fe\u3068\u4e00\u81f4\u3057\u3066\u3044\u308b\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001Arrow\u5f62\u5f0f\u3067\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u578b\u306e\u30a8\u30dd\u30c3\u30af\u306f 1970-01-01 \u3067\u8907\u6570\u306e\u7cbe\u5ea6\u3092\u6301\u3064\u4e8b\u304c\u3067\u304d\u307e\u3059\u304c\u3001PostgreSQL\u306e\u30a8\u30dd\u30c3\u30af\u306f 2001-01-01 \u3067\u30de\u30a4\u30af\u30ed\u79d2\u306e\u7cbe\u5ea6\u3092\u6301\u3061\u307e\u3059\u3002 Arrow_Fdw\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u3044\u3066Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092PostgreSQL\u4e0a\u3067\u8aad\u307f\u51fa\u3059\u4e8b\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5217\u3054\u3068\u306b100\u4e07\u4ef6\u306e\u5217\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\u30928\u500b\u5185\u5305\u3059\u308bArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092Arrow_Fdw\u3092\u7528\u3044\u3066\u30de\u30c3\u30d7\u3057\u305f\u5834\u5408\u3001\u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u4ecb\u3057\u3066Arrow\u30d5\u30a1\u30a4\u30eb\u4e0a\u306e800\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u904b\u7528 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9 \u901a\u5e38\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e3\u30b9\u30c6\u30c3\u30d7\u304c\u5fc5\u8981\u3067\u3059\u3002 CREATE FOREIGN DATA WRAPPER \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30c7\u30fc\u30bf\u30e9\u30c3\u30d1\u3092\u5b9a\u7fa9\u3059\u308b CREATE SERVER \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30b5\u30fc\u30d0\u3092\u5b9a\u7fa9\u3059\u308b CREATE FOREIGN TABLE \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3059\u308b \u3053\u306e\u3046\u3061\u3001\u6700\u521d\u306e2\u30b9\u30c6\u30c3\u30d7\u306f CREATE EXTENSION pg_strom \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306b\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u500b\u5225\u306b\u5b9f\u884c\u304c\u5fc5\u8981\u306a\u306e\u306f\u6700\u5f8c\u306e CREATE FOREIGN TABLE \u306e\u307f\u3067\u3059\u3002 CREATE FOREIGN TABLE flogdata ( ts timestamp, sensor_id int, signal1 smallint, signal2 smallint, signal3 smallint, signal4 smallint, ) SERVER arrow_fdw OPTIONS (file '/path/to/logdata.arrow'); CREATE FOREIGN TABLE \u69cb\u6587\u3067\u6307\u5b9a\u3057\u305f\u5217\u306e\u30c7\u30fc\u30bf\u578b\u306f\u3001\u30de\u30c3\u30d7\u3059\u308bArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3068\u53b3\u5bc6\u306b\u4e00\u81f4\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u3053\u308c\u4ee5\u5916\u306b\u3082\u3001Arrow_Fdw\u306f IMPORT FOREIGN SCHEMA \u69cb\u6587\u3092\u7528\u3044\u305f\u4fbf\u5229\u306a\u65b9\u6cd5\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u6301\u3064\u30b9\u30ad\u30fc\u30de\u60c5\u5831\u3092\u5229\u7528\u3057\u3066\u3001\u81ea\u52d5\u7684\u306b\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u751f\u6210\u3059\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u540d\u3068\u30a4\u30f3\u30dd\u30fc\u30c8\u5148\u306e\u30b9\u30ad\u30fc\u30de\u3001\u304a\u3088\u3073OPTION\u53e5\u3067Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306b\u306f\u3001\u5217\u3054\u3068\u306e\u30c7\u30fc\u30bf\u578b\u3068\u5217\u540d\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 IMPORT FOREIGN SCHEMA flogdata FROM SERVER arrow_fdw INTO public OPTIONS (file '/path/to/logdata.arrow'); \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3 Arrow_Fdw\u306f\u4ee5\u4e0b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u73fe\u72b6\u3001\u5168\u3066\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u6307\u5b9a\u3059\u308b\u3082\u306e\u3067\u3059\u3002 \u5bfe\u8c61 \u30aa\u30d7\u30b7\u30e7\u30f3 \u8aac\u660e \u5916\u90e8\u30c6\u30fc\u30d6\u30eb file \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3059\u308bArrow\u30d5\u30a1\u30a4\u30eb\u30921\u500b\u6307\u5b9a\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb files \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3059\u308bArrow\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30f3\u30de(,\uff09\u533a\u5207\u308a\u3067\u8907\u6570\u6307\u5b9a\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb dir \u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb suffix dir \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\u6642\u3001\u4f8b\u3048\u3070 .arrow \u306a\u3069\u3001\u7279\u5b9a\u306e\u63a5\u5c3e\u53e5\u3092\u6301\u3064\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3092\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb parallel_workers \u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u4e26\u5217\u30b9\u30ad\u30e3\u30f3\u306b\u4f7f\u7528\u3059\u308b\u4e26\u5217\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u30c6\u30fc\u30d6\u30eb\u306b\u304a\u3051\u308b parallel_workers \u30b9\u30c8\u30ec\u30fc\u30b8\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u540c\u7b49\u306e\u610f\u5473\u3092\u6301\u3061\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb writable \u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b INSERT \u6587\u306e\u5b9f\u884c\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\u8a73\u7d30\u306f\u300e\u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw\u300f\u306e\u7bc0\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc Arrow\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u578b\u3068\u3001PostgreSQL\u306e\u30c7\u30fc\u30bf\u578b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 Arrow\u30c7\u30fc\u30bf\u578b PostgreSQL\u30c7\u30fc\u30bf\u578b \u5099\u8003 Int int2,int4,int8 is_signed \u5c5e\u6027\u306f\u7121\u8996\u3002 bitWidth \u5c5e\u6027\u306f16\u300132\u307e\u305f\u306f64\u306e\u307f\u5bfe\u5fdc\u3002 FloatingPoint float2,float4,float8 float2 \u306fPG-Strom\u306b\u3088\u308b\u72ec\u81ea\u62e1\u5f35 Binary bytea Utf8 text Decimal numeric Date date unitsz=Day \u76f8\u5f53\u306b\u88dc\u6b63 Time time unitsz=MicroSecond \u76f8\u5f53\u306b\u88dc\u6b63 Timestamp timestamp unitsz=MicroSecond \u76f8\u5f53\u306b\u88dc\u6b63 Interval interval List \u914d\u5217\u578b 1\u6b21\u5143\u914d\u5217\u306e\u307f\u5bfe\u5fdc\uff08\u4e88\u5b9a\uff09 Struct \u8907\u5408\u578b \u5bfe\u5fdc\u3059\u308b\u8907\u5408\u578b\u3092\u4e88\u3081\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3053\u3068\u3002 Union -------- FixedSizeBinary char(n) FixedSizeList -------- Map -------- EXPLAIN\u51fa\u529b\u306e\u8aad\u307f\u65b9 EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u3001Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u51fa\u3057\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u7d04309GB\u306e\u5927\u304d\u3055\u3092\u6301\u3064Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30c3\u30d7\u3057\u305fflineorder\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u542b\u3080\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u306e\u51fa\u529b\u3067\u3059\u3002 =# EXPLAIN SELECT sum(lo_extendedprice*lo_discount) as revenue FROM flineorder,date1 WHERE lo_orderdate = d_datekey AND d_year = 1993 AND lo_discount between 1 and 3 AND lo_quantity < 25; QUERY PLAN ----------------------------------------------------------------------------------------------------- Aggregate (cost=12632759.02..12632759.03 rows=1 width=32) -> Custom Scan (GpuPreAgg) (cost=12632754.43..12632757.49 rows=204 width=8) Reduction: NoGroup Combined GpuJoin: enabled GPU Preference: GPU0 (Tesla V100-PCIE-16GB) -> Custom Scan (GpuJoin) on flineorder (cost=9952.15..12638126.98 rows=572635 width=12) Outer Scan: flineorder (cost=9877.70..12649677.69 rows=4010017 width=16) Outer Scan Filter: ((lo_discount >= 1) AND (lo_discount <= 3) AND (lo_quantity < 25)) Depth 1: GpuHashJoin (nrows 4010017...572635) HashKeys: flineorder.lo_orderdate JoinQuals: (flineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 66.06KB) GPU Preference: GPU0 (Tesla V100-PCIE-16GB) NVMe-Strom: enabled referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/nvme/lineorder_s401.arrow (size: 309.23GB) -> Seq Scan on date1 (cost=0.00..78.95 rows=365 width=4) Filter: (d_year = 1993) (18 rows) \u3053\u308c\u3092\u898b\u308b\u3068Custom Scan (GpuJoin)\u304c flineorder \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 file0 \u306b\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u80cc\u5f8c\u306b\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u540d /opt/nvme/lineorder_s401.arrow \u3068\u305d\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u30de\u30c3\u30d7\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u306f\u3001 file1 \u3001 file2 \u3001... \u3068\u5404\u30d5\u30a1\u30a4\u30eb\u6bce\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002 referenced \u306b\u306f\u5b9f\u969b\u306b\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u5217\u306e\u4e00\u89a7\u304c\u5217\u6319\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u306e\u30af\u30a8\u30ea\u306b\u304a\u3044\u3066\u306f lo_orderdate \u3001 lo_quantity \u3001 lo_extendedprice \u304a\u3088\u3073 lo_discount \u5217\u304c\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 \u307e\u305f\u3001 GPU Preference: GPU0 (Tesla V100-PCIE-16GB) \u304a\u3088\u3073 NVMe-Strom: enabled \u306e\u8868\u793a\u304c\u3042\u308b\u4e8b\u304b\u3089\u3001 flineorder \u306e\u30b9\u30ad\u30e3\u30f3\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u69cb\u304c\u7528\u3044\u3089\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002 VERBOSE\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u4e8b\u3067\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002 =# EXPLAIN VERBOSE SELECT sum(lo_extendedprice*lo_discount) as revenue FROM flineorder,date1 WHERE lo_orderdate = d_datekey AND d_year = 1993 AND lo_discount between 1 and 3 AND lo_quantity < 25; QUERY PLAN -------------------------------------------------------------------------------- Aggregate (cost=12632759.02..12632759.03 rows=1 width=32) Output: sum((pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount)))) -> Custom Scan (GpuPreAgg) (cost=12632754.43..12632757.49 rows=204 width=8) Output: (pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount))) Reduction: NoGroup GPU Projection: flineorder.lo_extendedprice, flineorder.lo_discount, pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount)) Combined GpuJoin: enabled GPU Preference: GPU0 (Tesla V100-PCIE-16GB) -> Custom Scan (GpuJoin) on public.flineorder (cost=9952.15..12638126.98 rows=572635 width=12) Output: flineorder.lo_extendedprice, flineorder.lo_discount GPU Projection: flineorder.lo_extendedprice::bigint, flineorder.lo_discount::integer Outer Scan: public.flineorder (cost=9877.70..12649677.69 rows=4010017 width=16) Outer Scan Filter: ((flineorder.lo_discount >= 1) AND (flineorder.lo_discount <= 3) AND (flineorder.lo_quantity < 25)) Depth 1: GpuHashJoin (nrows 4010017...572635) HashKeys: flineorder.lo_orderdate JoinQuals: (flineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 66.06KB) GPU Preference: GPU0 (Tesla V100-PCIE-16GB) NVMe-Strom: enabled referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/nvme/lineorder_s401.arrow (size: 309.23GB) lo_orderpriority: 33.61GB lo_extendedprice: 17.93GB lo_ordertotalprice: 17.93GB lo_revenue: 17.93GB -> Seq Scan on public.date1 (cost=0.00..78.95 rows=365 width=4) Output: date1.d_datekey Filter: (date1.d_year = 1993) (28 rows) \u88ab\u53c2\u7167\u5217\u3092\u30ed\u30fc\u30c9\u3059\u308b\u969b\u306b\u8aad\u307f\u51fa\u3059\u3079\u304d\u5217\u30c7\u30fc\u30bf\u306e\u5927\u304d\u3055\u3092\u3001\u5217\u3054\u3068\u306b\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002 lo_orderdate \u3001 lo_quantity \u3001 lo_extendedprice \u304a\u3088\u3073 lo_discount \u5217\u306e\u30ed\u30fc\u30c9\u306b\u306f\u5408\u8a08\u306787.4GB\u306e\u8aad\u307f\u51fa\u3057\u304c\u5fc5\u8981\u3067\u3001\u3053\u308c\u306f\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba309.2GB\u306e28.3%\u306b\u76f8\u5f53\u3057\u307e\u3059\u3002 Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u65b9\u6cd5 \u672c\u7bc0\u3067\u306f\u3001\u65e2\u306bPostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092Apache Arrow\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002 PyArrow+Pandas Arrow\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304c\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u308b PyArrow \u30e2\u30b8\u30e5\u30fc\u30eb\u3068Pandas\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306e\u7d44\u5408\u305b\u3092\u7528\u3044\u3066\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u30c6\u30fc\u30d6\u30ebt0\u306b\u683c\u7d0d\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u5168\u3066\u8aad\u8fbc\u307f\u3001\u30d5\u30a1\u30a4\u30eb/tmp/t0.arrow\u3078\u3068\u66f8\u304d\u51fa\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 import pyarrow as pa import pandas as pd X = pd.read_sql(sql=\"SELECT * FROM t0\", con=\"postgresql://localhost/postgres\") Y = pa.Table.from_pandas(X) f = pa.RecordBatchFileWriter('/tmp/t0.arrow', Y.schema) f.write_table(Y,1000000) # RecordBatch for each million rows f.close() \u305f\u3060\u3057\u4e0a\u8a18\u306e\u65b9\u6cd5\u306f\u3001SQL\u3092\u4ecb\u3057\u3066PostgreSQL\u304b\u3089\u8aad\u307f\u51fa\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092\u4e00\u5ea6\u30e1\u30e2\u30ea\u306b\u4fdd\u6301\u3059\u308b\u305f\u3081\u3001\u5927\u91cf\u306e\u884c\u3092\u4e00\u5ea6\u306b\u5909\u63db\u3059\u308b\u5834\u5408\u306b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002 Pg2Arrow \u4e00\u65b9\u3001PG-Strom Development Team\u304c\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u308b pg2arrow \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u3053\u306e\u30c4\u30fc\u30eb\u306f\u6bd4\u8f03\u7684\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3092NVME-SSD\u306a\u3069\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u66f8\u304d\u51fa\u3059\u4e8b\u3092\u5ff5\u982d\u306b\u8a2d\u8a08\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089 -s|--segment-size \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3059\u305f\u3073\u306b\u3001Arrow\u5f62\u5f0f\u306e\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\uff08Record Batch\uff09\u3068\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306f\u6bd4\u8f03\u7684\u30ea\u30fc\u30ba\u30ca\u30d6\u30eb\u306a\u5024\u3068\u306a\u308a\u307e\u3059\u3002 pg2arrow \u30b3\u30de\u30f3\u30c9\u306fPG-Strom\u306b\u540c\u68b1\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL\u95a2\u9023\u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002 $ ./pg2arrow --help Usage: pg2arrow [OPTION]... [DBNAME [USERNAME]] General options: -d, --dbname=DBNAME database name to connect to -c, --command=COMMAND SQL command to run -f, --file=FILENAME SQL command from file (-c and -f are exclusive, either of them must be specified) -o, --output=FILENAME result file in Apache Arrow format --append=FILENAME result file to be appended --output and --append are exclusive to use at the same time. If neither of them are specified, it creates a temporary file.) Arrow format options: -s, --segment-size=SIZE size of record batch for each (default: 256MB) Connection options: -h, --host=HOSTNAME database server host -p, --port=PORT database server port -U, --username=USERNAME database user name -w, --no-password never prompt for password -W, --password force password prompt Other options: --dump=FILENAME dump information of arrow file --progress shows progress of the job --set=NAME:VALUE GUC option to set before SQL execution Report bugs to <pgstrom@heterodbcom>. PostgreSQL\u3078\u306e\u63a5\u7d9a\u30d1\u30e9\u30e1\u30fc\u30bf\u306fpsql\u3084pg_dump\u3068\u540c\u69d8\u306b\u3001 -h \u3084 -U \u306a\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u3001 -c|--command \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305fSQL\u3092PostgreSQL\u4e0a\u3067\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092 -o|--output \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3078Arrow\u5f62\u5f0f\u3067\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002 -o|--output \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u4ee3\u308f\u308a\u306b --append \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u3001\u3053\u308c\u306f\u65e2\u5b58\u306eApache Arrow\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u8ffd\u8a18\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u8ffd\u8a18\u3055\u308c\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306f\u6307\u5b9a\u3057\u305fSQL\u306e\u5b9f\u884c\u7d50\u679c\u3068\u5b8c\u5168\u306b\u4e00\u81f4\u3059\u308b\u30b9\u30ad\u30fc\u30de\u69cb\u9020\u3092\u6301\u305f\u306d\u3070\u306a\u308a\u307e\u305b\u3093\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u30c6\u30fc\u30d6\u30eb t0 \u306b\u683c\u7d0d\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u5168\u3066\u8aad\u8fbc\u307f\u3001\u30d5\u30a1\u30a4\u30eb /tmp/t0.arrow \u3078\u3068\u66f8\u304d\u51fa\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 $ pg2arrow -U kaigai -d postgres -c \"SELECT * FROM t0\" -o /tmp/t0.arrow \u958b\u767a\u8005\u5411\u3051\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001 --dump <filename> \u3067Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3084\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\u306e\u4f4d\u7f6e\u3068\u30b5\u30a4\u30ba\u3092\u53ef\u8aad\u306a\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u3059\u3002 --progress \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u51e6\u7406\u306e\u9014\u4e2d\u7d4c\u904e\u3092\u8868\u793a\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u306f\u5de8\u5927\u306a\u30c6\u30fc\u30d6\u30eb\u3092Apache Arrow\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u969b\u306b\u6709\u7528\u3067\u3059\u3002 \u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw writable \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u305fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306f\u3001 INSERT \u69cb\u6587\u306b\u3088\u308a\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u307e\u305f\u3001 pgstrom.arrow_fdw_truncate() \u95a2\u6570\u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5168\u4f53\u3001\u3059\u306a\u308f\u3061\u305d\u306e\u80cc\u5f8c\u306b\u3042\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u6d88\u53bb\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u4e00\u65b9\u3001 UPDATE \u304a\u3088\u3073 DELETE \u69cb\u6587\u306b\u95a2\u3057\u3066\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b writable \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u5834\u5408\u3001 file \u307e\u305f\u306f files \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u30d1\u30b9\u540d\u306f1\u500b\u3060\u3051\u304c\u8a31\u5bb9\u3055\u308c\u307e\u3059\u3002\u8907\u6570\u500b\u306e\u30d1\u30b9\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u307e\u305f\u3001 dir \u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u4f75\u7528\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u305b\u3093\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u6642\u70b9\u3067\u3001\u6307\u5b9a\u3057\u305f\u30d1\u30b9\u306b\u5b9f\u969b\u306bApache Arrow\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u305d\u306e\u5834\u5408\u3001PostgreSQL\u306f\u5f53\u8a72\u30d1\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002 \u4e0a\u306e\u56f3\u306f Apache Arrow \u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u793a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u30d8\u30c3\u30c0\u3084\u30d5\u30c3\u30bf\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307b\u304b\u3001\u8f9e\u66f8\u5727\u7e2e\u7528\u306e\u8f9e\u66f8\u60c5\u5831\u3067\u3042\u308bDictionaryBatch\u3084\u3001\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308bRecordBatch\u3068\u547c\u3070\u308c\u308b\u9818\u57df\u3092\u8907\u6570\u500b\u6301\u3064\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 RecordBatch\u3068\u306f\u3001\u3042\u308b\u4e00\u5b9a\u306e\u884c\u6570\u3054\u3068\u306b\u5217\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u305f\u8a18\u9332\u5358\u4f4d\u3067\u3059\u3002\u4f8b\u3048\u3070\u3001 x \u3001 y \u3001 z \u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6301\u3064Apache Arrow\u30d5\u30a1\u30a4\u30eb\u306b\u304a\u3044\u3066\u3001RecordBatch[0]\u304c2,500\u884c\u3092\u542b\u3093\u3067\u3044\u308b\u5834\u5408\u3001RecordBatch[0]\u306b\u306f\u305d\u308c\u305e\u308c2,500\u500b\u306e x \u3001 y \u3001 z \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304c\u5217\u5f62\u5f0f\u3067\u683c\u7d0d\u3055\u308c\u3001\u7d9a\u3044\u3066RecordBatch[1]\u304c4,000\u884c\u3092\u542b\u3093\u3067\u3044\u308b\u5834\u5408\u3001\u540c\u69d8\u306bRecordBatch[1]\u306b\u306f4,000\u884c\u5206\u306e x \u3001 y \u3001 z \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304c\u5217\u5f62\u5f0f\u3067\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001Apache Arrow\u30d5\u30a1\u30a4\u30eb\u306b\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u3068\u3044\u3046\u4e8b\u306f\u3001RecordBatch\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3044\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u3067\u3001Dictionary Batch\u3084Record Batch\u306b\u5bfe\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30aa\u30d5\u30bb\u30c3\u30c8\u60c5\u5831\u306f\u3001\u6700\u5f8c\u306eRecord Batch\u306e\u6b21\u306e\u9818\u57df\u3067\u3042\u308b\u30d5\u30c3\u30bf\u9818\u57df\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001 INSERT \u69cb\u6587\u3067\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u6642\u306b\u306f(k+1)\u756a\u76ee\u306eRecord Batch\u3067\u73fe\u5728\u306e\u30d5\u30c3\u30bf\u9818\u57df\u3092\u4e0a\u66f8\u304d\u3057\u3001\u305d\u306e\u5f8c\u3001\u65b0\u305f\u306b\u30d5\u30c3\u30bf\u9818\u57df\u3092\u518d\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u624b\u9806\u3092\u8e0f\u307f\u307e\u3059\u3002 \u3053\u306e\u3088\u3046\u306a\u69cb\u9020\u3092\u6301\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u65b0\u305f\u306b\u8ffd\u52a0\u3059\u308bRecord Batch\u306f\u4e00\u5ea6\u306e INSERT \u30b3\u30de\u30f3\u30c9\u3067\u633f\u5165\u3055\u308c\u305f\u884c\u6570\u3092\u6301\u3061\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001 INSERT \u3067\u6570\u884c\u3060\u3051\u633f\u5165\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3067\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5229\u7528\u52b9\u7387\u306f\u6700\u60aa\u3068\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002Arrow_Fdw\u306b\u30c7\u30fc\u30bf\u3092\u633f\u5165\u3059\u308b\u969b\u306f\u3001\u4e00\u56de\u306e INSERT \u30b3\u30de\u30f3\u30c9\u3067\u53ef\u80fd\u306a\u9650\u308a\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u6295\u5165\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306fPostgreSQL\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\u306b\u5f93\u3044\u307e\u3059\u3002\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304ccommit\u3055\u308c\u308b\u307e\u3067\u306f\u3001\u4ed6\u306e\u4e26\u884c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089\u8ffd\u8a18\u3057\u305f\u5185\u5bb9\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u3067\u304d\u305a\u3001\u307e\u305f\u672a\u30b3\u30df\u30c3\u30c8\u306e\u8ffd\u8a18\u30c7\u30fc\u30bf\u306frollback\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u5b9f\u88c5\u4e0a\u306e\u7406\u7531\u306b\u3088\u308a\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f ShareRowExclusiveLock \u3092\u7372\u5f97\u3057\u307e\u3059\uff08\u901a\u5e38\u306ePostgreSQL\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b INSERT \u3084 UPDATE \u304c\u7372\u5f97\u3059\u308b\u306e\u306f RowExclusiveLock \uff09\u3002\u3053\u308c\u306f\u3001\u7279\u5b9a\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u308b\u306e\u306f\u3001\u540c\u6642\u306b1\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u307f\u3067\u3042\u308b\u4e8b\u3092\u610f\u5473\u3057\u307e\u3059\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u671f\u5f85\u3059\u308b\u66f8\u304d\u8fbc\u307f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306f\u30d0\u30eb\u30af\u30ed\u30fc\u30c9\u304c\u4e2d\u5fc3\u3067\u3042\u308b\u305f\u3081\u3001\u901a\u5e38\u3053\u308c\u306f\u5927\u304d\u306a\u554f\u984c\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u591a\u6570\u306e\u4e26\u884c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089Arrow_Fdw\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306e\u5229\u7528\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 postgres=# CREATE FOREIGN TABLE ftest (x int) SERVER arrow_fdw OPTIONS (file '/dev/shm/ftest.arrow', writable 'true'); CREATE FOREIGN TABLE postgres=# INSERT INTO ftest (SELECT * FROM generate_series(1,100)); INSERT 0 100 postgres=# BEGIN; BEGIN postgres=# INSERT INTO ftest (SELECT * FROM generate_series(1,50)); INSERT 0 50 postgres=# SELECT count(*) FROM ftest; count ------- 150 (1 row) -- \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3059\u308b\u3068\u3001\u4e0a\u8a18\u306e\u8ffd\u8a18\u306f\u53d6\u308a\u6d88\u3055\u308c\u307e\u3059\u3002 postgres=# ROLLBACK; ROLLBACK postgres=# SELECT count(*) FROM ftest; count ------- 100 (1 row) \u73fe\u5728\u306e\u3068\u3053\u308d\u3001PostgreSQL\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b TRUNCATE \u6587\u306e\u5b9f\u884c\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002 \u305d\u306e\u4ee3\u66ff\u3068\u3057\u3066Arrow_Fdw\u306b\u306f pgstrom.arrow_fdw_truncate(regclass) \u95a2\u6570\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3092\u7528\u3044\u3066Arrow_Fdw\u306e\u80cc\u5f8c\u306b\u5b58\u5728\u3059\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u6d88\u53bb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 postgres=# SELECT count(*) FROM ftest; count ------- 100 (1 row) postgres=# SELECT pgstrom.arrow_fdw_truncate('ftest'); arrow_fdw_truncate -------------------- (1 row) postgres=# SELECT count(*) FROM ftest; count ------- 0 (1 row) \u5148\u9032\u7684\u306a\u4f7f\u3044\u65b9 SSDtoGPU\u30c0\u30a4\u30ec\u30af\u30c8SQL Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3055\u308c\u305f\u5168\u3066\u306eArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u304c\u4ee5\u4e0b\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3059\u5834\u5408\u306b\u306f\u3001\u5217\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u306bSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u304cNVME-SSD\u533a\u753b\u4e0a\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002 NVME-SSD\u533a\u753b\u306fExt4\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u3002 Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u7dcf\u8a08\u304c pg_strom.nvme_strom_threshold \u8a2d\u5b9a\u3092\u4e0a\u56de\u3063\u3066\u3044\u308b\u3002 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8a2d\u5b9a Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4e00\u90e8\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u901a\u5e38\u306ePostgreSQL\u30c6\u30fc\u30d6\u30eb\u3068\u6df7\u5728\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306f\u66f8\u304d\u8fbc\u307f\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e8b\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u307e\u305f\u3001\u30de\u30c3\u30d7\u3055\u308c\u305fArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306b\u542b\u307e\u308c\u308b\u30c7\u30fc\u30bf\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u5883\u754c\u6761\u4ef6\u3068\u77db\u76fe\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u8005\u306e\u8cac\u4efb\u3067\u3059\u3002 \u5178\u578b\u7684\u306a\u5229\u7528\u30b7\u30fc\u30f3\u306f\u3001\u9577\u671f\u9593\u306b\u308f\u305f\u308a\u84c4\u7a4d\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u3067\u3059\u3002 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u3068\u7570\u306a\u308a\u3001\u4e00\u822c\u7684\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u4e00\u5ea6\u8a18\u9332\u3055\u308c\u305f\u3089\u305d\u306e\u5f8c\u66f4\u65b0\u524a\u9664\u3055\u308c\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\u4e00\u5b9a\u671f\u9593\u304c\u7d4c\u904e\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u3001\u8aad\u307f\u51fa\u3057\u5c02\u7528\u3067\u306f\u3042\u308b\u3082\u306e\u306e\u96c6\u8a08\u51e6\u7406\u304c\u9ad8\u901f\u306aArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u96c6\u8a08\u30fb\u89e3\u6790\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u51e6\u7406\u52b9\u7387\u3092\u5f15\u304d\u4e0a\u3052\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306b\u306f\u307b\u307c\u9593\u9055\u3044\u306a\u304f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u4e8b\u304b\u3089\u3001\u6708\u5358\u4f4d\u3001\u9031\u5358\u4f4d\u306a\u3069\u3001\u4e00\u5b9a\u671f\u9593\u3054\u3068\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001PostgreSQL\u30c6\u30fc\u30d6\u30eb\u3068Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u6df7\u5728\u3055\u305b\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u66f8\u304d\u8fbc\u307f\u304c\u53ef\u80fd\u306aPostgreSQL\u30c6\u30fc\u30d6\u30eb\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u304a\u304f 2 \u4e8b\u3067\u3001\u4e00\u5b9a\u671f\u9593\u306e\u7d4c\u904e\u5f8c\u3001DB\u904b\u7528\u3092\u7d99\u7d9a\u3057\u306a\u304c\u3089\u904e\u53bb\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u3060\u3051\u3092Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u79fb\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 CREATE TABLE lineorder ( lo_orderkey numeric, lo_linenumber integer, lo_custkey numeric, lo_partkey integer, lo_suppkey numeric, lo_orderdate integer, lo_orderpriority character(15), lo_shippriority character(1), lo_quantity numeric, lo_extendedprice numeric, lo_ordertotalprice numeric, lo_discount numeric, lo_revenue numeric, lo_supplycost numeric, lo_tax numeric, lo_commit_date character(8), lo_shipmode character(10) ) PARTITION BY RANGE (lo_orderdate); CREATE TABLE lineorder__now PARTITION OF lineorder default; CREATE FOREIGN TABLE lineorder__1993 PARTITION OF lineorder FOR VALUES FROM (19930101) TO (19940101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1993.arrow'); CREATE FOREIGN TABLE lineorder__1994 PARTITION OF lineorder FOR VALUES FROM (19940101) TO (19950101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1994.arrow'); CREATE FOREIGN TABLE lineorder__1995 PARTITION OF lineorder FOR VALUES FROM (19950101) TO (19960101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1995.arrow'); CREATE FOREIGN TABLE lineorder__1996 PARTITION OF lineorder FOR VALUES FROM (19960101) TO (19970101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1996.arrow'); \u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u554f\u3044\u5408\u308f\u305b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u691c\u7d22\u6761\u4ef6 lo_orderdate between 19950701 and 19960630 \u304c\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u5883\u754c\u6761\u4ef6\u3092\u542b\u3093\u3067\u3044\u308b\u4e8b\u304b\u3089\u3001\u5b50\u30c6\u30fc\u30d6\u30eb lineorder__1993 \u3068 lineorder__1994 \u306f\u691c\u7d22\u5bfe\u8c61\u304b\u3089\u6392\u9664\u3055\u308c\u3001\u4ed6\u306e\u30c6\u30fc\u30d6\u30eb\u3060\u3051\u3092\u8aad\u307f\u51fa\u3059\u3088\u3046\u5b9f\u884c\u8a08\u753b\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002 =# EXPLAIN SELECT sum(lo_extendedprice*lo_discount) as revenue FROM lineorder,date1 WHERE lo_orderdate = d_datekey AND lo_orderdate between 19950701 and 19960630 AND lo_discount between 1 and 3 ABD lo_quantity < 25; QUERY PLAN -------------------------------------------------------------------------------- Aggregate (cost=172088.90..172088.91 rows=1 width=32) -> Hash Join (cost=10548.86..172088.51 rows=77 width=64) Hash Cond: (lineorder__1995.lo_orderdate = date1.d_datekey) -> Append (cost=10444.35..171983.80 rows=77 width=67) -> Custom Scan (GpuScan) on lineorder__1995 (cost=10444.35..33671.87 rows=38 width=68) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/tmp/lineorder_1995.arrow (size: 892.57MB) -> Custom Scan (GpuScan) on lineorder__1996 (cost=10444.62..33849.21 rows=38 width=68) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/tmp/lineorder_1996.arrow (size: 897.87MB) -> Custom Scan (GpuScan) on lineorder__now (cost=11561.33..104462.33 rows=1 width=18) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) -> Hash (cost=72.56..72.56 rows=2556 width=4) -> Seq Scan on date1 (cost=0.00..72.56 rows=2556 width=4) (16 rows) \u3053\u306e\u5f8c\u3001 lineorder__now \u30c6\u30fc\u30d6\u30eb\u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3057\u3001\u3053\u308c\u3092Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5074\u306b\u79fb\u3059\u306b\u306f\u4ee5\u4e0b\u306e\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059 $ pg2arrow -d sample -o /opt/tmp/lineorder_1997.arrow \\ -c \"SELECT * FROM lineorder WHERE lo_orderdate between 19970101 and 19971231\" pg2arrow \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001 lineorder \u30c6\u30fc\u30d6\u30eb\u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3060\u3051\u3092\u629c\u304d\u51fa\u3057\u3066\u3001\u65b0\u3057\u3044Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002 BEGIN; -- -- remove rows in 1997 from the read-writable table -- DELETE FROM lineorder WHERE lo_orderdate BETWEEN 19970101 AND 19971231; -- -- define a new partition leaf which maps log-data in 1997 -- CREATE FOREIGN TABLE lineorder__1997 PARTITION OF lineorder FOR VALUES FROM (19970101) TO (19980101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1997.arrow'); COMMIT; \u3053\u306e\u64cd\u4f5c\u306b\u3088\u308a\u3001PostgreSQL\u30c6\u30fc\u30d6\u30eb\u3067\u3042\u308b lineorder__now \u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3001\u4ee3\u308f\u308a\u306b\u540c\u4e00\u5185\u5bb9\u306eArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb /opt/tmp/lineorder_1997.arrow \u3092\u5916\u90e8\u30c6\u30fc\u30d6\u30eb lineorder__1997 \u3068\u3057\u3066\u30de\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002 \u6b63\u78ba\u306b\u306f\u30014KB\uff5e32KB\u306e\u7bc4\u56f2\u3067\u30d3\u30eb\u30c9\u6642\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059 \u21a9 PostgreSQL v11\u4ee5\u964d\u3067\u5bfe\u5fdc \u21a9","title":"Arrow_fdw"},{"location":"arrow_fdw/#_1","text":"PostgreSQL\u306e\u30c6\u30fc\u30d6\u30eb\u306f\u5185\u90e8\u7684\u306b8KB\u306e\u30d6\u30ed\u30c3\u30af 1 \u3068\u547c\u3070\u308c\u308b\u5358\u4f4d\u3067\u7de8\u6210\u3055\u308c\u3001\u30d6\u30ed\u30c3\u30af\u306f\u5168\u3066\u306e\u5c5e\u6027\u53ca\u3073\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u542b\u3080\u30bf\u30d7\u30eb\u3068\u547c\u3070\u308c\u308b\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u884c\u5358\u4f4d\u3067\u683c\u7d0d\u3057\u307e\u3059\u3002\u884c\u3092\u69cb\u6210\u3059\u308b\u30c7\u30fc\u30bf\u304c\u8fd1\u508d\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3001\u3053\u308c\u306fINSERT\u3084UPDATE\u306e\u591a\u3044\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u6709\u52b9\u3067\u3059\u304c\u3001\u4e00\u65b9\u3067\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u30fb\u89e3\u6790\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u306f\u4e0d\u5411\u304d\u3067\u3042\u308b\u3068\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u901a\u5e38\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u306b\u304a\u3044\u3066\u306f\u30c6\u30fc\u30d6\u30eb\u5185\u306e\u5168\u3066\u306e\u5217\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u73cd\u3057\u304f\u3001\u591a\u304f\u306e\u5834\u5408\u306b\u306f\u4e00\u90e8\u306e\u5217\u3060\u3051\u3092\u53c2\u7167\u3059\u308b\u3068\u3044\u3063\u305f\u51e6\u7406\u306b\u306a\u308a\u304c\u3061\u3067\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u5b9f\u969b\u306b\u306f\u53c2\u7167\u3055\u308c\u306a\u3044\u5217\u306e\u30c7\u30fc\u30bf\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306b\u6d88\u8cbb\u3055\u308c\u308bI/O\u306e\u5e2f\u57df\u306f\u5168\u304f\u7121\u99c4\u3067\u3059\u304c\u3001\u884c\u5358\u4f4d\u3067\u7de8\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u7279\u5b9a\u306e\u5217\u3060\u3051\u3092\u53d6\u308a\u51fa\u3059\u3068\u3044\u3046\u64cd\u4f5c\u306f\u56f0\u96e3\u3067\u3059\u3002 \u9006\u306b\u5217\u5358\u4f4d\u3067\u30c7\u30fc\u30bf\u3092\u7de8\u6210\u3057\u305f\u5834\u5408\u3001INSERT\u3084UPDATE\u306e\u591a\u3044\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u306f\u6975\u7aef\u306b\u4e0d\u5229\u3067\u3059\u304c\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e\u96c6\u8a08\u30fb\u89e3\u6790\u3092\u884c\u3046\u969b\u306b\u306f\u88ab\u53c2\u7167\u5217\u3060\u3051\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001I/O\u306e\u5e2f\u57df\u3092\u6700\u5927\u9650\u306b\u6d3b\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u307e\u305f\u30d7\u30ed\u30bb\u30c3\u30b5\u306e\u51e6\u7406\u52b9\u7387\u306e\u89b3\u70b9\u304b\u3089\u3082\u3001\u5217\u5358\u4f4d\u306b\u7de8\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u5358\u7d14\u306a\u914d\u5217\u3067\u3042\u308b\u304b\u306e\u3088\u3046\u306b\u898b\u3048\u308b\u305f\u3081\u3001GPU\u306b\u3068\u3063\u3066\u306fCoalesced Memory Access\u3068\u3044\u3046\u30e1\u30e2\u30ea\u30d0\u30b9\u306e\u6027\u80fd\u3092\u6700\u5927\u9650\u306b\u5f15\u304d\u51fa\u3059\u30a2\u30af\u30bb\u30b9\u30d1\u30bf\u30fc\u30f3\u3068\u306a\u308b\u4e8b\u304c\u671f\u5f85\u3067\u304d\u307e\u3059\u3002","title":"\u6982\u8981"},{"location":"arrow_fdw/#apache-arrow","text":"Apache Arrow\u3068\u306f\u3001\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3092\u5217\u5f62\u5f0f\u3067\u8a18\u9332\u3001\u4ea4\u63db\u3059\u308b\u305f\u3081\u306e\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u3059\u3002 \u4e3b\u306b\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u305f\u3081\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u307b\u304b\u3001C\u3084C++\u3001Python\u306a\u3069\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u5411\u3051\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6574\u5099\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u81ea\u4f5c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089Apache Arrow\u5f62\u5f0f\u3092\u6271\u3046\u3088\u3046\u8a2d\u8a08\u3059\u308b\u4e8b\u3082\u5bb9\u6613\u3067\u3059\u3002 Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u306b\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5b9a\u7fa9\u3059\u308b\u30b9\u30ad\u30fc\u30de\uff08Schema\uff09\u90e8\u5206\u3068\u3001\u30b9\u30ad\u30fc\u30de\u306b\u57fa\u3065\u3044\u3066\u5217\u30c7\u30fc\u30bf\u3092\u8a18\u9332\u3059\u308b1\u500b\u4ee5\u4e0a\u306e\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\uff08RecordBatch\uff09\u90e8\u5206\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u578b\u3068\u3057\u3066\u306f\u3001\u6574\u6570\u3084\u6587\u5b57\u5217\uff08\u53ef\u5909\u9577\uff09\u3001\u65e5\u4ed8\u6642\u523b\u578b\u306a\u3069\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u500b\u3005\u306e\u5217\u30c7\u30fc\u30bf\u306f\u3053\u308c\u3089\u30c7\u30fc\u30bf\u578b\u306b\u5fdc\u3058\u305f\u5185\u90e8\u8868\u73fe\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 Apache Arrow\u5f62\u5f0f\u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u8868\u73fe\u306f\u3001\u5fc5\u305a\u3057\u3082\u5168\u3066\u306e\u5834\u5408\u3067PostgreSQL\u306e\u30c7\u30fc\u30bf\u8868\u73fe\u3068\u4e00\u81f4\u3057\u3066\u3044\u308b\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001Arrow\u5f62\u5f0f\u3067\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u578b\u306e\u30a8\u30dd\u30c3\u30af\u306f 1970-01-01 \u3067\u8907\u6570\u306e\u7cbe\u5ea6\u3092\u6301\u3064\u4e8b\u304c\u3067\u304d\u307e\u3059\u304c\u3001PostgreSQL\u306e\u30a8\u30dd\u30c3\u30af\u306f 2001-01-01 \u3067\u30de\u30a4\u30af\u30ed\u79d2\u306e\u7cbe\u5ea6\u3092\u6301\u3061\u307e\u3059\u3002 Arrow_Fdw\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u3044\u3066Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092PostgreSQL\u4e0a\u3067\u8aad\u307f\u51fa\u3059\u4e8b\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5217\u3054\u3068\u306b100\u4e07\u4ef6\u306e\u5217\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\u30928\u500b\u5185\u5305\u3059\u308bArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092Arrow_Fdw\u3092\u7528\u3044\u3066\u30de\u30c3\u30d7\u3057\u305f\u5834\u5408\u3001\u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u4ecb\u3057\u3066Arrow\u30d5\u30a1\u30a4\u30eb\u4e0a\u306e800\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002","title":"Apache Arrow\u3068\u306f"},{"location":"arrow_fdw/#_2","text":"","title":"\u904b\u7528"},{"location":"arrow_fdw/#_3","text":"\u901a\u5e38\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e3\u30b9\u30c6\u30c3\u30d7\u304c\u5fc5\u8981\u3067\u3059\u3002 CREATE FOREIGN DATA WRAPPER \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30c7\u30fc\u30bf\u30e9\u30c3\u30d1\u3092\u5b9a\u7fa9\u3059\u308b CREATE SERVER \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30b5\u30fc\u30d0\u3092\u5b9a\u7fa9\u3059\u308b CREATE FOREIGN TABLE \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3059\u308b \u3053\u306e\u3046\u3061\u3001\u6700\u521d\u306e2\u30b9\u30c6\u30c3\u30d7\u306f CREATE EXTENSION pg_strom \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306b\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u500b\u5225\u306b\u5b9f\u884c\u304c\u5fc5\u8981\u306a\u306e\u306f\u6700\u5f8c\u306e CREATE FOREIGN TABLE \u306e\u307f\u3067\u3059\u3002 CREATE FOREIGN TABLE flogdata ( ts timestamp, sensor_id int, signal1 smallint, signal2 smallint, signal3 smallint, signal4 smallint, ) SERVER arrow_fdw OPTIONS (file '/path/to/logdata.arrow'); CREATE FOREIGN TABLE \u69cb\u6587\u3067\u6307\u5b9a\u3057\u305f\u5217\u306e\u30c7\u30fc\u30bf\u578b\u306f\u3001\u30de\u30c3\u30d7\u3059\u308bArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3068\u53b3\u5bc6\u306b\u4e00\u81f4\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u3053\u308c\u4ee5\u5916\u306b\u3082\u3001Arrow_Fdw\u306f IMPORT FOREIGN SCHEMA \u69cb\u6587\u3092\u7528\u3044\u305f\u4fbf\u5229\u306a\u65b9\u6cd5\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u6301\u3064\u30b9\u30ad\u30fc\u30de\u60c5\u5831\u3092\u5229\u7528\u3057\u3066\u3001\u81ea\u52d5\u7684\u306b\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u751f\u6210\u3059\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u540d\u3068\u30a4\u30f3\u30dd\u30fc\u30c8\u5148\u306e\u30b9\u30ad\u30fc\u30de\u3001\u304a\u3088\u3073OPTION\u53e5\u3067Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306b\u306f\u3001\u5217\u3054\u3068\u306e\u30c7\u30fc\u30bf\u578b\u3068\u5217\u540d\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 IMPORT FOREIGN SCHEMA flogdata FROM SERVER arrow_fdw INTO public OPTIONS (file '/path/to/logdata.arrow');","title":"\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9"},{"location":"arrow_fdw/#_4","text":"Arrow_Fdw\u306f\u4ee5\u4e0b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u73fe\u72b6\u3001\u5168\u3066\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u6307\u5b9a\u3059\u308b\u3082\u306e\u3067\u3059\u3002 \u5bfe\u8c61 \u30aa\u30d7\u30b7\u30e7\u30f3 \u8aac\u660e \u5916\u90e8\u30c6\u30fc\u30d6\u30eb file \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3059\u308bArrow\u30d5\u30a1\u30a4\u30eb\u30921\u500b\u6307\u5b9a\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb files \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3059\u308bArrow\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30f3\u30de(,\uff09\u533a\u5207\u308a\u3067\u8907\u6570\u6307\u5b9a\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb dir \u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb suffix dir \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\u6642\u3001\u4f8b\u3048\u3070 .arrow \u306a\u3069\u3001\u7279\u5b9a\u306e\u63a5\u5c3e\u53e5\u3092\u6301\u3064\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3092\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb parallel_workers \u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u4e26\u5217\u30b9\u30ad\u30e3\u30f3\u306b\u4f7f\u7528\u3059\u308b\u4e26\u5217\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u30c6\u30fc\u30d6\u30eb\u306b\u304a\u3051\u308b parallel_workers \u30b9\u30c8\u30ec\u30fc\u30b8\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u540c\u7b49\u306e\u610f\u5473\u3092\u6301\u3061\u307e\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb writable \u3053\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b INSERT \u6587\u306e\u5b9f\u884c\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\u8a73\u7d30\u306f\u300e\u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw\u300f\u306e\u7bc0\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3"},{"location":"arrow_fdw/#_5","text":"Arrow\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u578b\u3068\u3001PostgreSQL\u306e\u30c7\u30fc\u30bf\u578b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 Arrow\u30c7\u30fc\u30bf\u578b PostgreSQL\u30c7\u30fc\u30bf\u578b \u5099\u8003 Int int2,int4,int8 is_signed \u5c5e\u6027\u306f\u7121\u8996\u3002 bitWidth \u5c5e\u6027\u306f16\u300132\u307e\u305f\u306f64\u306e\u307f\u5bfe\u5fdc\u3002 FloatingPoint float2,float4,float8 float2 \u306fPG-Strom\u306b\u3088\u308b\u72ec\u81ea\u62e1\u5f35 Binary bytea Utf8 text Decimal numeric Date date unitsz=Day \u76f8\u5f53\u306b\u88dc\u6b63 Time time unitsz=MicroSecond \u76f8\u5f53\u306b\u88dc\u6b63 Timestamp timestamp unitsz=MicroSecond \u76f8\u5f53\u306b\u88dc\u6b63 Interval interval List \u914d\u5217\u578b 1\u6b21\u5143\u914d\u5217\u306e\u307f\u5bfe\u5fdc\uff08\u4e88\u5b9a\uff09 Struct \u8907\u5408\u578b \u5bfe\u5fdc\u3059\u308b\u8907\u5408\u578b\u3092\u4e88\u3081\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3053\u3068\u3002 Union -------- FixedSizeBinary char(n) FixedSizeList -------- Map --------","title":"\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc"},{"location":"arrow_fdw/#explain","text":"EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u3001Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u51fa\u3057\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u7d04309GB\u306e\u5927\u304d\u3055\u3092\u6301\u3064Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30c3\u30d7\u3057\u305fflineorder\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u542b\u3080\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u306e\u51fa\u529b\u3067\u3059\u3002 =# EXPLAIN SELECT sum(lo_extendedprice*lo_discount) as revenue FROM flineorder,date1 WHERE lo_orderdate = d_datekey AND d_year = 1993 AND lo_discount between 1 and 3 AND lo_quantity < 25; QUERY PLAN ----------------------------------------------------------------------------------------------------- Aggregate (cost=12632759.02..12632759.03 rows=1 width=32) -> Custom Scan (GpuPreAgg) (cost=12632754.43..12632757.49 rows=204 width=8) Reduction: NoGroup Combined GpuJoin: enabled GPU Preference: GPU0 (Tesla V100-PCIE-16GB) -> Custom Scan (GpuJoin) on flineorder (cost=9952.15..12638126.98 rows=572635 width=12) Outer Scan: flineorder (cost=9877.70..12649677.69 rows=4010017 width=16) Outer Scan Filter: ((lo_discount >= 1) AND (lo_discount <= 3) AND (lo_quantity < 25)) Depth 1: GpuHashJoin (nrows 4010017...572635) HashKeys: flineorder.lo_orderdate JoinQuals: (flineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 66.06KB) GPU Preference: GPU0 (Tesla V100-PCIE-16GB) NVMe-Strom: enabled referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/nvme/lineorder_s401.arrow (size: 309.23GB) -> Seq Scan on date1 (cost=0.00..78.95 rows=365 width=4) Filter: (d_year = 1993) (18 rows) \u3053\u308c\u3092\u898b\u308b\u3068Custom Scan (GpuJoin)\u304c flineorder \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 file0 \u306b\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u80cc\u5f8c\u306b\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u540d /opt/nvme/lineorder_s401.arrow \u3068\u305d\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u30de\u30c3\u30d7\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u306f\u3001 file1 \u3001 file2 \u3001... \u3068\u5404\u30d5\u30a1\u30a4\u30eb\u6bce\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002 referenced \u306b\u306f\u5b9f\u969b\u306b\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u5217\u306e\u4e00\u89a7\u304c\u5217\u6319\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u306e\u30af\u30a8\u30ea\u306b\u304a\u3044\u3066\u306f lo_orderdate \u3001 lo_quantity \u3001 lo_extendedprice \u304a\u3088\u3073 lo_discount \u5217\u304c\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 \u307e\u305f\u3001 GPU Preference: GPU0 (Tesla V100-PCIE-16GB) \u304a\u3088\u3073 NVMe-Strom: enabled \u306e\u8868\u793a\u304c\u3042\u308b\u4e8b\u304b\u3089\u3001 flineorder \u306e\u30b9\u30ad\u30e3\u30f3\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u69cb\u304c\u7528\u3044\u3089\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002 VERBOSE\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u4e8b\u3067\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002 =# EXPLAIN VERBOSE SELECT sum(lo_extendedprice*lo_discount) as revenue FROM flineorder,date1 WHERE lo_orderdate = d_datekey AND d_year = 1993 AND lo_discount between 1 and 3 AND lo_quantity < 25; QUERY PLAN -------------------------------------------------------------------------------- Aggregate (cost=12632759.02..12632759.03 rows=1 width=32) Output: sum((pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount)))) -> Custom Scan (GpuPreAgg) (cost=12632754.43..12632757.49 rows=204 width=8) Output: (pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount))) Reduction: NoGroup GPU Projection: flineorder.lo_extendedprice, flineorder.lo_discount, pgstrom.psum((flineorder.lo_extendedprice * flineorder.lo_discount)) Combined GpuJoin: enabled GPU Preference: GPU0 (Tesla V100-PCIE-16GB) -> Custom Scan (GpuJoin) on public.flineorder (cost=9952.15..12638126.98 rows=572635 width=12) Output: flineorder.lo_extendedprice, flineorder.lo_discount GPU Projection: flineorder.lo_extendedprice::bigint, flineorder.lo_discount::integer Outer Scan: public.flineorder (cost=9877.70..12649677.69 rows=4010017 width=16) Outer Scan Filter: ((flineorder.lo_discount >= 1) AND (flineorder.lo_discount <= 3) AND (flineorder.lo_quantity < 25)) Depth 1: GpuHashJoin (nrows 4010017...572635) HashKeys: flineorder.lo_orderdate JoinQuals: (flineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 66.06KB) GPU Preference: GPU0 (Tesla V100-PCIE-16GB) NVMe-Strom: enabled referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/nvme/lineorder_s401.arrow (size: 309.23GB) lo_orderpriority: 33.61GB lo_extendedprice: 17.93GB lo_ordertotalprice: 17.93GB lo_revenue: 17.93GB -> Seq Scan on public.date1 (cost=0.00..78.95 rows=365 width=4) Output: date1.d_datekey Filter: (date1.d_year = 1993) (28 rows) \u88ab\u53c2\u7167\u5217\u3092\u30ed\u30fc\u30c9\u3059\u308b\u969b\u306b\u8aad\u307f\u51fa\u3059\u3079\u304d\u5217\u30c7\u30fc\u30bf\u306e\u5927\u304d\u3055\u3092\u3001\u5217\u3054\u3068\u306b\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002 lo_orderdate \u3001 lo_quantity \u3001 lo_extendedprice \u304a\u3088\u3073 lo_discount \u5217\u306e\u30ed\u30fc\u30c9\u306b\u306f\u5408\u8a08\u306787.4GB\u306e\u8aad\u307f\u51fa\u3057\u304c\u5fc5\u8981\u3067\u3001\u3053\u308c\u306f\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba309.2GB\u306e28.3%\u306b\u76f8\u5f53\u3057\u307e\u3059\u3002","title":"EXPLAIN\u51fa\u529b\u306e\u8aad\u307f\u65b9"},{"location":"arrow_fdw/#arrow","text":"\u672c\u7bc0\u3067\u306f\u3001\u65e2\u306bPostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092Apache Arrow\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002","title":"Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u65b9\u6cd5"},{"location":"arrow_fdw/#pyarrowpandas","text":"Arrow\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304c\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u308b PyArrow \u30e2\u30b8\u30e5\u30fc\u30eb\u3068Pandas\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306e\u7d44\u5408\u305b\u3092\u7528\u3044\u3066\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u30c6\u30fc\u30d6\u30ebt0\u306b\u683c\u7d0d\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u5168\u3066\u8aad\u8fbc\u307f\u3001\u30d5\u30a1\u30a4\u30eb/tmp/t0.arrow\u3078\u3068\u66f8\u304d\u51fa\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 import pyarrow as pa import pandas as pd X = pd.read_sql(sql=\"SELECT * FROM t0\", con=\"postgresql://localhost/postgres\") Y = pa.Table.from_pandas(X) f = pa.RecordBatchFileWriter('/tmp/t0.arrow', Y.schema) f.write_table(Y,1000000) # RecordBatch for each million rows f.close() \u305f\u3060\u3057\u4e0a\u8a18\u306e\u65b9\u6cd5\u306f\u3001SQL\u3092\u4ecb\u3057\u3066PostgreSQL\u304b\u3089\u8aad\u307f\u51fa\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092\u4e00\u5ea6\u30e1\u30e2\u30ea\u306b\u4fdd\u6301\u3059\u308b\u305f\u3081\u3001\u5927\u91cf\u306e\u884c\u3092\u4e00\u5ea6\u306b\u5909\u63db\u3059\u308b\u5834\u5408\u306b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002","title":"PyArrow+Pandas"},{"location":"arrow_fdw/#pg2arrow","text":"\u4e00\u65b9\u3001PG-Strom Development Team\u304c\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u308b pg2arrow \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u3053\u306e\u30c4\u30fc\u30eb\u306f\u6bd4\u8f03\u7684\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3092NVME-SSD\u306a\u3069\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u66f8\u304d\u51fa\u3059\u4e8b\u3092\u5ff5\u982d\u306b\u8a2d\u8a08\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089 -s|--segment-size \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3059\u305f\u3073\u306b\u3001Arrow\u5f62\u5f0f\u306e\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\uff08Record Batch\uff09\u3068\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306f\u6bd4\u8f03\u7684\u30ea\u30fc\u30ba\u30ca\u30d6\u30eb\u306a\u5024\u3068\u306a\u308a\u307e\u3059\u3002 pg2arrow \u30b3\u30de\u30f3\u30c9\u306fPG-Strom\u306b\u540c\u68b1\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL\u95a2\u9023\u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002 $ ./pg2arrow --help Usage: pg2arrow [OPTION]... [DBNAME [USERNAME]] General options: -d, --dbname=DBNAME database name to connect to -c, --command=COMMAND SQL command to run -f, --file=FILENAME SQL command from file (-c and -f are exclusive, either of them must be specified) -o, --output=FILENAME result file in Apache Arrow format --append=FILENAME result file to be appended --output and --append are exclusive to use at the same time. If neither of them are specified, it creates a temporary file.) Arrow format options: -s, --segment-size=SIZE size of record batch for each (default: 256MB) Connection options: -h, --host=HOSTNAME database server host -p, --port=PORT database server port -U, --username=USERNAME database user name -w, --no-password never prompt for password -W, --password force password prompt Other options: --dump=FILENAME dump information of arrow file --progress shows progress of the job --set=NAME:VALUE GUC option to set before SQL execution Report bugs to <pgstrom@heterodbcom>. PostgreSQL\u3078\u306e\u63a5\u7d9a\u30d1\u30e9\u30e1\u30fc\u30bf\u306fpsql\u3084pg_dump\u3068\u540c\u69d8\u306b\u3001 -h \u3084 -U \u306a\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u3001 -c|--command \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305fSQL\u3092PostgreSQL\u4e0a\u3067\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092 -o|--output \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3078Arrow\u5f62\u5f0f\u3067\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002 -o|--output \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u4ee3\u308f\u308a\u306b --append \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u3001\u3053\u308c\u306f\u65e2\u5b58\u306eApache Arrow\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u8ffd\u8a18\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u8ffd\u8a18\u3055\u308c\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306f\u6307\u5b9a\u3057\u305fSQL\u306e\u5b9f\u884c\u7d50\u679c\u3068\u5b8c\u5168\u306b\u4e00\u81f4\u3059\u308b\u30b9\u30ad\u30fc\u30de\u69cb\u9020\u3092\u6301\u305f\u306d\u3070\u306a\u308a\u307e\u305b\u3093\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u30c6\u30fc\u30d6\u30eb t0 \u306b\u683c\u7d0d\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u5168\u3066\u8aad\u8fbc\u307f\u3001\u30d5\u30a1\u30a4\u30eb /tmp/t0.arrow \u3078\u3068\u66f8\u304d\u51fa\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 $ pg2arrow -U kaigai -d postgres -c \"SELECT * FROM t0\" -o /tmp/t0.arrow \u958b\u767a\u8005\u5411\u3051\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001 --dump <filename> \u3067Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3084\u30ec\u30b3\u30fc\u30c9\u30d0\u30c3\u30c1\u306e\u4f4d\u7f6e\u3068\u30b5\u30a4\u30ba\u3092\u53ef\u8aad\u306a\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u3059\u3002 --progress \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u51e6\u7406\u306e\u9014\u4e2d\u7d4c\u904e\u3092\u8868\u793a\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u306f\u5de8\u5927\u306a\u30c6\u30fc\u30d6\u30eb\u3092Apache Arrow\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u969b\u306b\u6709\u7528\u3067\u3059\u3002","title":"Pg2Arrow"},{"location":"arrow_fdw/#arrow_fdw","text":"writable \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u305fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306f\u3001 INSERT \u69cb\u6587\u306b\u3088\u308a\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u307e\u305f\u3001 pgstrom.arrow_fdw_truncate() \u95a2\u6570\u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5168\u4f53\u3001\u3059\u306a\u308f\u3061\u305d\u306e\u80cc\u5f8c\u306b\u3042\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u6d88\u53bb\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u4e00\u65b9\u3001 UPDATE \u304a\u3088\u3073 DELETE \u69cb\u6587\u306b\u95a2\u3057\u3066\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b writable \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u5834\u5408\u3001 file \u307e\u305f\u306f files \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u30d1\u30b9\u540d\u306f1\u500b\u3060\u3051\u304c\u8a31\u5bb9\u3055\u308c\u307e\u3059\u3002\u8907\u6570\u500b\u306e\u30d1\u30b9\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u307e\u305f\u3001 dir \u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u4f75\u7528\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u305b\u3093\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u6642\u70b9\u3067\u3001\u6307\u5b9a\u3057\u305f\u30d1\u30b9\u306b\u5b9f\u969b\u306bApache Arrow\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u305d\u306e\u5834\u5408\u3001PostgreSQL\u306f\u5f53\u8a72\u30d1\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002 \u4e0a\u306e\u56f3\u306f Apache Arrow \u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u793a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u30d8\u30c3\u30c0\u3084\u30d5\u30c3\u30bf\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307b\u304b\u3001\u8f9e\u66f8\u5727\u7e2e\u7528\u306e\u8f9e\u66f8\u60c5\u5831\u3067\u3042\u308bDictionaryBatch\u3084\u3001\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308bRecordBatch\u3068\u547c\u3070\u308c\u308b\u9818\u57df\u3092\u8907\u6570\u500b\u6301\u3064\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 RecordBatch\u3068\u306f\u3001\u3042\u308b\u4e00\u5b9a\u306e\u884c\u6570\u3054\u3068\u306b\u5217\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u305f\u8a18\u9332\u5358\u4f4d\u3067\u3059\u3002\u4f8b\u3048\u3070\u3001 x \u3001 y \u3001 z \u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6301\u3064Apache Arrow\u30d5\u30a1\u30a4\u30eb\u306b\u304a\u3044\u3066\u3001RecordBatch[0]\u304c2,500\u884c\u3092\u542b\u3093\u3067\u3044\u308b\u5834\u5408\u3001RecordBatch[0]\u306b\u306f\u305d\u308c\u305e\u308c2,500\u500b\u306e x \u3001 y \u3001 z \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304c\u5217\u5f62\u5f0f\u3067\u683c\u7d0d\u3055\u308c\u3001\u7d9a\u3044\u3066RecordBatch[1]\u304c4,000\u884c\u3092\u542b\u3093\u3067\u3044\u308b\u5834\u5408\u3001\u540c\u69d8\u306bRecordBatch[1]\u306b\u306f4,000\u884c\u5206\u306e x \u3001 y \u3001 z \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304c\u5217\u5f62\u5f0f\u3067\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001Apache Arrow\u30d5\u30a1\u30a4\u30eb\u306b\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u3068\u3044\u3046\u4e8b\u306f\u3001RecordBatch\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3044\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u90e8\u3067\u3001Dictionary Batch\u3084Record Batch\u306b\u5bfe\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30aa\u30d5\u30bb\u30c3\u30c8\u60c5\u5831\u306f\u3001\u6700\u5f8c\u306eRecord Batch\u306e\u6b21\u306e\u9818\u57df\u3067\u3042\u308b\u30d5\u30c3\u30bf\u9818\u57df\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001 INSERT \u69cb\u6587\u3067\u30c7\u30fc\u30bf\u3092\u8ffd\u8a18\u3059\u308b\u6642\u306b\u306f(k+1)\u756a\u76ee\u306eRecord Batch\u3067\u73fe\u5728\u306e\u30d5\u30c3\u30bf\u9818\u57df\u3092\u4e0a\u66f8\u304d\u3057\u3001\u305d\u306e\u5f8c\u3001\u65b0\u305f\u306b\u30d5\u30c3\u30bf\u9818\u57df\u3092\u518d\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u624b\u9806\u3092\u8e0f\u307f\u307e\u3059\u3002 \u3053\u306e\u3088\u3046\u306a\u69cb\u9020\u3092\u6301\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u65b0\u305f\u306b\u8ffd\u52a0\u3059\u308bRecord Batch\u306f\u4e00\u5ea6\u306e INSERT \u30b3\u30de\u30f3\u30c9\u3067\u633f\u5165\u3055\u308c\u305f\u884c\u6570\u3092\u6301\u3061\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001 INSERT \u3067\u6570\u884c\u3060\u3051\u633f\u5165\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3067\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5229\u7528\u52b9\u7387\u306f\u6700\u60aa\u3068\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002Arrow_Fdw\u306b\u30c7\u30fc\u30bf\u3092\u633f\u5165\u3059\u308b\u969b\u306f\u3001\u4e00\u56de\u306e INSERT \u30b3\u30de\u30f3\u30c9\u3067\u53ef\u80fd\u306a\u9650\u308a\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u6295\u5165\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306fPostgreSQL\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\u306b\u5f93\u3044\u307e\u3059\u3002\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304ccommit\u3055\u308c\u308b\u307e\u3067\u306f\u3001\u4ed6\u306e\u4e26\u884c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089\u8ffd\u8a18\u3057\u305f\u5185\u5bb9\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u3067\u304d\u305a\u3001\u307e\u305f\u672a\u30b3\u30df\u30c3\u30c8\u306e\u8ffd\u8a18\u30c7\u30fc\u30bf\u306frollback\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u5b9f\u88c5\u4e0a\u306e\u7406\u7531\u306b\u3088\u308a\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f ShareRowExclusiveLock \u3092\u7372\u5f97\u3057\u307e\u3059\uff08\u901a\u5e38\u306ePostgreSQL\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b INSERT \u3084 UPDATE \u304c\u7372\u5f97\u3059\u308b\u306e\u306f RowExclusiveLock \uff09\u3002\u3053\u308c\u306f\u3001\u7279\u5b9a\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u308b\u306e\u306f\u3001\u540c\u6642\u306b1\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u307f\u3067\u3042\u308b\u4e8b\u3092\u610f\u5473\u3057\u307e\u3059\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u671f\u5f85\u3059\u308b\u66f8\u304d\u8fbc\u307f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306f\u30d0\u30eb\u30af\u30ed\u30fc\u30c9\u304c\u4e2d\u5fc3\u3067\u3042\u308b\u305f\u3081\u3001\u901a\u5e38\u3053\u308c\u306f\u5927\u304d\u306a\u554f\u984c\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u591a\u6570\u306e\u4e26\u884c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089Arrow_Fdw\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f8\u304d\u8fbc\u307f\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306e\u5229\u7528\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 postgres=# CREATE FOREIGN TABLE ftest (x int) SERVER arrow_fdw OPTIONS (file '/dev/shm/ftest.arrow', writable 'true'); CREATE FOREIGN TABLE postgres=# INSERT INTO ftest (SELECT * FROM generate_series(1,100)); INSERT 0 100 postgres=# BEGIN; BEGIN postgres=# INSERT INTO ftest (SELECT * FROM generate_series(1,50)); INSERT 0 50 postgres=# SELECT count(*) FROM ftest; count ------- 150 (1 row) -- \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3059\u308b\u3068\u3001\u4e0a\u8a18\u306e\u8ffd\u8a18\u306f\u53d6\u308a\u6d88\u3055\u308c\u307e\u3059\u3002 postgres=# ROLLBACK; ROLLBACK postgres=# SELECT count(*) FROM ftest; count ------- 100 (1 row) \u73fe\u5728\u306e\u3068\u3053\u308d\u3001PostgreSQL\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b TRUNCATE \u6587\u306e\u5b9f\u884c\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002 \u305d\u306e\u4ee3\u66ff\u3068\u3057\u3066Arrow_Fdw\u306b\u306f pgstrom.arrow_fdw_truncate(regclass) \u95a2\u6570\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3092\u7528\u3044\u3066Arrow_Fdw\u306e\u80cc\u5f8c\u306b\u5b58\u5728\u3059\u308bApache Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u6d88\u53bb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 postgres=# SELECT count(*) FROM ftest; count ------- 100 (1 row) postgres=# SELECT pgstrom.arrow_fdw_truncate('ftest'); arrow_fdw_truncate -------------------- (1 row) postgres=# SELECT count(*) FROM ftest; count ------- 0 (1 row)","title":"\u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw"},{"location":"arrow_fdw/#_6","text":"","title":"\u5148\u9032\u7684\u306a\u4f7f\u3044\u65b9"},{"location":"arrow_fdw/#ssdtogpusql","text":"Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u30de\u30c3\u30d7\u3055\u308c\u305f\u5168\u3066\u306eArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u304c\u4ee5\u4e0b\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3059\u5834\u5408\u306b\u306f\u3001\u5217\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u306bSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u304cNVME-SSD\u533a\u753b\u4e0a\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002 NVME-SSD\u533a\u753b\u306fExt4\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u3002 Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u7dcf\u8a08\u304c pg_strom.nvme_strom_threshold \u8a2d\u5b9a\u3092\u4e0a\u56de\u3063\u3066\u3044\u308b\u3002","title":"SSDtoGPU\u30c0\u30a4\u30ec\u30af\u30c8SQL"},{"location":"arrow_fdw/#_7","text":"Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4e00\u90e8\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u901a\u5e38\u306ePostgreSQL\u30c6\u30fc\u30d6\u30eb\u3068\u6df7\u5728\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306f\u66f8\u304d\u8fbc\u307f\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e8b\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u307e\u305f\u3001\u30de\u30c3\u30d7\u3055\u308c\u305fArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306b\u542b\u307e\u308c\u308b\u30c7\u30fc\u30bf\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u5883\u754c\u6761\u4ef6\u3068\u77db\u76fe\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u8005\u306e\u8cac\u4efb\u3067\u3059\u3002 \u5178\u578b\u7684\u306a\u5229\u7528\u30b7\u30fc\u30f3\u306f\u3001\u9577\u671f\u9593\u306b\u308f\u305f\u308a\u84c4\u7a4d\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u3067\u3059\u3002 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u3068\u7570\u306a\u308a\u3001\u4e00\u822c\u7684\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u4e00\u5ea6\u8a18\u9332\u3055\u308c\u305f\u3089\u305d\u306e\u5f8c\u66f4\u65b0\u524a\u9664\u3055\u308c\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\u4e00\u5b9a\u671f\u9593\u304c\u7d4c\u904e\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u3001\u8aad\u307f\u51fa\u3057\u5c02\u7528\u3067\u306f\u3042\u308b\u3082\u306e\u306e\u96c6\u8a08\u51e6\u7406\u304c\u9ad8\u901f\u306aArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u96c6\u8a08\u30fb\u89e3\u6790\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u51e6\u7406\u52b9\u7387\u3092\u5f15\u304d\u4e0a\u3052\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306b\u306f\u307b\u307c\u9593\u9055\u3044\u306a\u304f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u4e8b\u304b\u3089\u3001\u6708\u5358\u4f4d\u3001\u9031\u5358\u4f4d\u306a\u3069\u3001\u4e00\u5b9a\u671f\u9593\u3054\u3068\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001PostgreSQL\u30c6\u30fc\u30d6\u30eb\u3068Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3092\u6df7\u5728\u3055\u305b\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u66f8\u304d\u8fbc\u307f\u304c\u53ef\u80fd\u306aPostgreSQL\u30c6\u30fc\u30d6\u30eb\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u304a\u304f 2 \u4e8b\u3067\u3001\u4e00\u5b9a\u671f\u9593\u306e\u7d4c\u904e\u5f8c\u3001DB\u904b\u7528\u3092\u7d99\u7d9a\u3057\u306a\u304c\u3089\u904e\u53bb\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u3060\u3051\u3092Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u79fb\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 CREATE TABLE lineorder ( lo_orderkey numeric, lo_linenumber integer, lo_custkey numeric, lo_partkey integer, lo_suppkey numeric, lo_orderdate integer, lo_orderpriority character(15), lo_shippriority character(1), lo_quantity numeric, lo_extendedprice numeric, lo_ordertotalprice numeric, lo_discount numeric, lo_revenue numeric, lo_supplycost numeric, lo_tax numeric, lo_commit_date character(8), lo_shipmode character(10) ) PARTITION BY RANGE (lo_orderdate); CREATE TABLE lineorder__now PARTITION OF lineorder default; CREATE FOREIGN TABLE lineorder__1993 PARTITION OF lineorder FOR VALUES FROM (19930101) TO (19940101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1993.arrow'); CREATE FOREIGN TABLE lineorder__1994 PARTITION OF lineorder FOR VALUES FROM (19940101) TO (19950101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1994.arrow'); CREATE FOREIGN TABLE lineorder__1995 PARTITION OF lineorder FOR VALUES FROM (19950101) TO (19960101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1995.arrow'); CREATE FOREIGN TABLE lineorder__1996 PARTITION OF lineorder FOR VALUES FROM (19960101) TO (19970101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1996.arrow'); \u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u554f\u3044\u5408\u308f\u305b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u691c\u7d22\u6761\u4ef6 lo_orderdate between 19950701 and 19960630 \u304c\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u5883\u754c\u6761\u4ef6\u3092\u542b\u3093\u3067\u3044\u308b\u4e8b\u304b\u3089\u3001\u5b50\u30c6\u30fc\u30d6\u30eb lineorder__1993 \u3068 lineorder__1994 \u306f\u691c\u7d22\u5bfe\u8c61\u304b\u3089\u6392\u9664\u3055\u308c\u3001\u4ed6\u306e\u30c6\u30fc\u30d6\u30eb\u3060\u3051\u3092\u8aad\u307f\u51fa\u3059\u3088\u3046\u5b9f\u884c\u8a08\u753b\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002 =# EXPLAIN SELECT sum(lo_extendedprice*lo_discount) as revenue FROM lineorder,date1 WHERE lo_orderdate = d_datekey AND lo_orderdate between 19950701 and 19960630 AND lo_discount between 1 and 3 ABD lo_quantity < 25; QUERY PLAN -------------------------------------------------------------------------------- Aggregate (cost=172088.90..172088.91 rows=1 width=32) -> Hash Join (cost=10548.86..172088.51 rows=77 width=64) Hash Cond: (lineorder__1995.lo_orderdate = date1.d_datekey) -> Append (cost=10444.35..171983.80 rows=77 width=67) -> Custom Scan (GpuScan) on lineorder__1995 (cost=10444.35..33671.87 rows=38 width=68) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/tmp/lineorder_1995.arrow (size: 892.57MB) -> Custom Scan (GpuScan) on lineorder__1996 (cost=10444.62..33849.21 rows=38 width=68) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) referenced: lo_orderdate, lo_quantity, lo_extendedprice, lo_discount files0: /opt/tmp/lineorder_1996.arrow (size: 897.87MB) -> Custom Scan (GpuScan) on lineorder__now (cost=11561.33..104462.33 rows=1 width=18) GPU Filter: ((lo_orderdate >= 19950701) AND (lo_orderdate <= 19960630) AND (lo_discount >= '1'::numeric) AND (lo_discount <= '3'::numeric) AND (lo_quantity < '25'::numeric)) -> Hash (cost=72.56..72.56 rows=2556 width=4) -> Seq Scan on date1 (cost=0.00..72.56 rows=2556 width=4) (16 rows) \u3053\u306e\u5f8c\u3001 lineorder__now \u30c6\u30fc\u30d6\u30eb\u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3057\u3001\u3053\u308c\u3092Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5074\u306b\u79fb\u3059\u306b\u306f\u4ee5\u4e0b\u306e\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059 $ pg2arrow -d sample -o /opt/tmp/lineorder_1997.arrow \\ -c \"SELECT * FROM lineorder WHERE lo_orderdate between 19970101 and 19971231\" pg2arrow \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001 lineorder \u30c6\u30fc\u30d6\u30eb\u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3060\u3051\u3092\u629c\u304d\u51fa\u3057\u3066\u3001\u65b0\u3057\u3044Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u3078\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002 BEGIN; -- -- remove rows in 1997 from the read-writable table -- DELETE FROM lineorder WHERE lo_orderdate BETWEEN 19970101 AND 19971231; -- -- define a new partition leaf which maps log-data in 1997 -- CREATE FOREIGN TABLE lineorder__1997 PARTITION OF lineorder FOR VALUES FROM (19970101) TO (19980101) SERVER arrow_fdw OPTIONS (file '/opt/tmp/lineorder_1997.arrow'); COMMIT; \u3053\u306e\u64cd\u4f5c\u306b\u3088\u308a\u3001PostgreSQL\u30c6\u30fc\u30d6\u30eb\u3067\u3042\u308b lineorder__now \u304b\u30891997\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3001\u4ee3\u308f\u308a\u306b\u540c\u4e00\u5185\u5bb9\u306eArrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb /opt/tmp/lineorder_1997.arrow \u3092\u5916\u90e8\u30c6\u30fc\u30d6\u30eb lineorder__1997 \u3068\u3057\u3066\u30de\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002 \u6b63\u78ba\u306b\u306f\u30014KB\uff5e32KB\u306e\u7bc4\u56f2\u3067\u30d3\u30eb\u30c9\u6642\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059 \u21a9 PostgreSQL v11\u4ee5\u964d\u3067\u5bfe\u5fdc \u21a9","title":"\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8a2d\u5b9a"},{"location":"brin/","text":"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5bfe\u5fdc \u6982\u8981 PostgreSQL\u306f\u4f55\u7a2e\u985e\u304b\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5f62\u5f0f\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u308bB-tree\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306f\u7279\u5b9a\u306e\u5024\u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u691c\u7d22\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u4ee5\u5916\u306b\u3082\u3001Hash\u3001BRIN\u3001GiST\u3001GIN\u306a\u3069\u7279\u6027\u306e\u7570\u306a\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5f62\u5f0f\u304c\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001\u73fe\u5728\u306e\u3068\u3053\u308dPG-Strom\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306f\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u306b\u304a\u3051\u308b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u5024\u306a\u3069\u3001\u7269\u7406\u7684\u306b\u8fd1\u508d\u306b\u4f4d\u7f6e\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u540c\u58eb\u304c\u8fd1\u3057\u3044\u5024\u3092\u6301\u3063\u3066\u3044\u308b\u4e8b\u304c\u671f\u5f85\u3067\u304d\u308b\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u6709\u52b9\u306b\u4f5c\u7528\u3057\u307e\u3059\u3002\u672c\u6765\u306f\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u306a\u64cd\u4f5c\u3067\u3042\u3063\u3066\u3082\u3001\u660e\u3089\u304b\u306b\u6761\u4ef6\u53e5\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u9818\u57df\u3092\u8aad\u307f\u98db\u3070\u3057\u3001\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u306b\u4f34\u3046I/O\u91cf\u3092\u524a\u6e1b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 PG-Strom\u306b\u304a\u3044\u3066\u3082BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u7279\u6027\u3092\u6d3b\u7528\u3057\u3001GPU\u306b\u30ed\u30fc\u30c9\u3059\u3079\u304d\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u3046\u3061\u660e\u3089\u304b\u306b\u4e0d\u8981\u3067\u3042\u308b\u3082\u306e\u3092\u8aad\u307f\u98db\u3070\u3059\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u8a2d\u5b9a BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u7279\u5225\u306a\u8a2d\u5b9a\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002 CREATE INDEX\u69cb\u6587\u3092\u7528\u3044\u3066\u5bfe\u8c61\u5217\u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001\u304b\u3064\u3001\u691c\u7d22\u6761\u4ef6\u304cBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u9069\u5408\u3059\u308b\u3082\u306e\u3067\u3042\u308c\u3070\u81ea\u52d5\u7684\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002 BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u81ea\u4f53\u306e\u8aac\u660e\u306f\u3001 PostgreSQL\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u4ee5\u4e0b\u306eGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308a\u3001PG-Strom\u304cBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30d0\u30c3\u30b0\u3084\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5834\u5408\u3092\u9664\u304d\u3001\u901a\u5e38\u306f\u521d\u671f\u8a2d\u5b9a\u306e\u307e\u307e\u3067\u69cb\u3044\u307e\u305b\u3093\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enable_brin bool on BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 \u64cd\u4f5c EXPLAIN \u69cb\u6587\u306b\u3088\u308aBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 postgres=# EXPLAIN ANALYZE SELECT * FROM dt WHERE ymd BETWEEN '2018-01-01' AND '2018-12-31' AND cat LIKE '%aaa%'; QUERY PLAN -------------------------------------------------------------------------------- Custom Scan (GpuScan) on dt (cost=94810.93..176275.00 rows=169992 width=44) (actual time=1777.819..1901.537 rows=175277 loops=1) GPU Filter: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date) AND (cat ~~ '%aaa%'::text)) Rows Removed by GPU Filter: 4385491 BRIN cond: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) BRIN skipped: 424704 Planning time: 0.529 ms Execution time: 2323.063 ms (7 rows) \u4e0a\u8a18\u306e\u4f8b\u3067\u306f ymd \u5217\u306bBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001 BRIN cond \u306e\u8868\u793a\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u3001 BRIN skipped \u306e\u8868\u793a\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308a\u5b9f\u969b\u306b\u8aad\u307f\u98db\u3070\u3055\u308c\u305f\u30d6\u30ed\u30c3\u30af\u306e\u6570\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u306e\u4f8b\u3067\u306f424704\u30d6\u30ed\u30c3\u30af\u304c\u8aad\u307f\u98db\u3070\u3055\u308c\u3001\u3055\u3089\u306b\u3001\u8aad\u307f\u8fbc\u3093\u3060\u30d6\u30ed\u30c3\u30af\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u306e\u3046\u30614385491\u884c\u304c\u6761\u4ef6\u53e5\u306b\u3088\u3063\u3066\u30d5\u30a3\u30eb\u30bf\u3055\u308c\u305f\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 \u30c7\u30fc\u30bf\u8ee2\u9001\u306e\u30ed\u30b9\u3092\u6e1b\u3089\u3059\u305f\u3081\u3001GpuJoin\u3084GpuPreAgg\u304c\u76f4\u4e0b\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u5f15\u304d\u4e0a\u3052\u3001\u81ea\u3089\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u3092\u884c\u3046\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3067\u3082\u3001BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u5229\u7528\u53ef\u80fd\u3067\u3042\u308c\u3070\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u3092\u884c\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001GROUP BY\u3092\u542b\u3080\u51e6\u7406\u3067BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3067\u3059\u3002 postgres=# EXPLAIN ANALYZE SELECT cat,count(*) FROM dt WHERE ymd BETWEEN '2018-01-01' AND '2018-12-31' GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=6149.78..6151.86 rows=26 width=12) (actual time=427.482..427.499 rows=26 loops=1) Group Key: cat -> Sort (cost=6149.78..6150.24 rows=182 width=12) (actual time=427.465..427.467 rows=26 loops=1) Sort Key: cat Sort Method: quicksort Memory: 26kB -> Custom Scan (GpuPreAgg) on dt (cost=6140.68..6142.95 rows=182 width=12) (actual time=427.331..427.339 rows=26 loops=1) Reduction: Local Outer Scan: dt (cost=4000.00..4011.99 rows=4541187 width=4) (actual time=78.573..415.961 rows=4560768 loops=1) Outer Scan Filter: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) Rows Removed by Outer Scan Filter: 15564 BRIN cond: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) BRIN skipped: 424704 Planning time: 30.992 ms Execution time: 818.994 ms (14 rows)","title":"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5bfe\u5fdc"},{"location":"brin/#_1","text":"PostgreSQL\u306f\u4f55\u7a2e\u985e\u304b\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5f62\u5f0f\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u308bB-tree\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306f\u7279\u5b9a\u306e\u5024\u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u691c\u7d22\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u4ee5\u5916\u306b\u3082\u3001Hash\u3001BRIN\u3001GiST\u3001GIN\u306a\u3069\u7279\u6027\u306e\u7570\u306a\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5f62\u5f0f\u304c\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001\u73fe\u5728\u306e\u3068\u3053\u308dPG-Strom\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306f\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u306b\u304a\u3051\u308b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u5024\u306a\u3069\u3001\u7269\u7406\u7684\u306b\u8fd1\u508d\u306b\u4f4d\u7f6e\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u540c\u58eb\u304c\u8fd1\u3057\u3044\u5024\u3092\u6301\u3063\u3066\u3044\u308b\u4e8b\u304c\u671f\u5f85\u3067\u304d\u308b\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u6709\u52b9\u306b\u4f5c\u7528\u3057\u307e\u3059\u3002\u672c\u6765\u306f\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u306a\u64cd\u4f5c\u3067\u3042\u3063\u3066\u3082\u3001\u660e\u3089\u304b\u306b\u6761\u4ef6\u53e5\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u9818\u57df\u3092\u8aad\u307f\u98db\u3070\u3057\u3001\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u306b\u4f34\u3046I/O\u91cf\u3092\u524a\u6e1b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 PG-Strom\u306b\u304a\u3044\u3066\u3082BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u7279\u6027\u3092\u6d3b\u7528\u3057\u3001GPU\u306b\u30ed\u30fc\u30c9\u3059\u3079\u304d\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u3046\u3061\u660e\u3089\u304b\u306b\u4e0d\u8981\u3067\u3042\u308b\u3082\u306e\u3092\u8aad\u307f\u98db\u3070\u3059\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002","title":"\u6982\u8981"},{"location":"brin/#_2","text":"BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u7279\u5225\u306a\u8a2d\u5b9a\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002 CREATE INDEX\u69cb\u6587\u3092\u7528\u3044\u3066\u5bfe\u8c61\u5217\u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001\u304b\u3064\u3001\u691c\u7d22\u6761\u4ef6\u304cBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u9069\u5408\u3059\u308b\u3082\u306e\u3067\u3042\u308c\u3070\u81ea\u52d5\u7684\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002 BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u81ea\u4f53\u306e\u8aac\u660e\u306f\u3001 PostgreSQL\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u4ee5\u4e0b\u306eGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308a\u3001PG-Strom\u304cBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30d0\u30c3\u30b0\u3084\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5834\u5408\u3092\u9664\u304d\u3001\u901a\u5e38\u306f\u521d\u671f\u8a2d\u5b9a\u306e\u307e\u307e\u3067\u69cb\u3044\u307e\u305b\u3093\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enable_brin bool on BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002","title":"\u8a2d\u5b9a"},{"location":"brin/#_3","text":"EXPLAIN \u69cb\u6587\u306b\u3088\u308aBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 postgres=# EXPLAIN ANALYZE SELECT * FROM dt WHERE ymd BETWEEN '2018-01-01' AND '2018-12-31' AND cat LIKE '%aaa%'; QUERY PLAN -------------------------------------------------------------------------------- Custom Scan (GpuScan) on dt (cost=94810.93..176275.00 rows=169992 width=44) (actual time=1777.819..1901.537 rows=175277 loops=1) GPU Filter: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date) AND (cat ~~ '%aaa%'::text)) Rows Removed by GPU Filter: 4385491 BRIN cond: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) BRIN skipped: 424704 Planning time: 0.529 ms Execution time: 2323.063 ms (7 rows) \u4e0a\u8a18\u306e\u4f8b\u3067\u306f ymd \u5217\u306bBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001 BRIN cond \u306e\u8868\u793a\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u3001 BRIN skipped \u306e\u8868\u793a\u306fBRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308a\u5b9f\u969b\u306b\u8aad\u307f\u98db\u3070\u3055\u308c\u305f\u30d6\u30ed\u30c3\u30af\u306e\u6570\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u306e\u4f8b\u3067\u306f424704\u30d6\u30ed\u30c3\u30af\u304c\u8aad\u307f\u98db\u3070\u3055\u308c\u3001\u3055\u3089\u306b\u3001\u8aad\u307f\u8fbc\u3093\u3060\u30d6\u30ed\u30c3\u30af\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u306e\u3046\u30614385491\u884c\u304c\u6761\u4ef6\u53e5\u306b\u3088\u3063\u3066\u30d5\u30a3\u30eb\u30bf\u3055\u308c\u305f\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 \u30c7\u30fc\u30bf\u8ee2\u9001\u306e\u30ed\u30b9\u3092\u6e1b\u3089\u3059\u305f\u3081\u3001GpuJoin\u3084GpuPreAgg\u304c\u76f4\u4e0b\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u5f15\u304d\u4e0a\u3052\u3001\u81ea\u3089\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u3092\u884c\u3046\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3067\u3082\u3001BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u5229\u7528\u53ef\u80fd\u3067\u3042\u308c\u3070\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u3092\u884c\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001GROUP BY\u3092\u542b\u3080\u51e6\u7406\u3067BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3067\u3059\u3002 postgres=# EXPLAIN ANALYZE SELECT cat,count(*) FROM dt WHERE ymd BETWEEN '2018-01-01' AND '2018-12-31' GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=6149.78..6151.86 rows=26 width=12) (actual time=427.482..427.499 rows=26 loops=1) Group Key: cat -> Sort (cost=6149.78..6150.24 rows=182 width=12) (actual time=427.465..427.467 rows=26 loops=1) Sort Key: cat Sort Method: quicksort Memory: 26kB -> Custom Scan (GpuPreAgg) on dt (cost=6140.68..6142.95 rows=182 width=12) (actual time=427.331..427.339 rows=26 loops=1) Reduction: Local Outer Scan: dt (cost=4000.00..4011.99 rows=4541187 width=4) (actual time=78.573..415.961 rows=4560768 loops=1) Outer Scan Filter: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) Rows Removed by Outer Scan Filter: 15564 BRIN cond: ((ymd >= '2018-01-01'::date) AND (ymd <= '2018-12-31'::date)) BRIN skipped: 424704 Planning time: 30.992 ms Execution time: 818.994 ms (14 rows)","title":"\u64cd\u4f5c"},{"location":"install/","text":"\u672c\u7ae0\u3067\u306fPG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8 \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u3092\u52d5\u4f5c\u53ef\u80fd\u306a x86_64 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u304c\u5fc5\u8981\u3067\u3059\u3002 CPU\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u304a\u3088\u3073\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u306f\u7279\u5225\u306a\u8981\u4ef6\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001 note002:HW Validation List \u306f\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9078\u5b9a\u306e\u4e0a\u3067\u53c2\u8003\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u5229\u7528\u3059\u308b\u306b\u306fNVMe\u898f\u683c\u306b\u5bfe\u5fdc\u3057\u305fSSD\u304c\u5fc5\u8981\u3067\u3001GPU\u3068\u540c\u4e00\u306ePCIe Root Complex\u914d\u4e0b\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 GPU\u30c7\u30d0\u30a4\u30b9 PG-Strom\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u5c11\u306a\u304f\u3068\u3082\u4e00\u500b\u306eGPU\u30c7\u30d0\u30a4\u30b9\u304c\u30b7\u30b9\u30c6\u30e0\u4e0a\u306b\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u3089\u306fCUDA Toolkit\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u304a\u308a\u3001computing capability \u304c6.0\u4ee5\u964d\u306e\u30e2\u30c7\u30eb\uff08Pascal\u4e16\u4ee3\u4ee5\u964d\uff09\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 note001:GPU Availability Matrix \u306b\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5bfe\u5fdc\u72b6\u6cc1\u306b\u95a2\u3057\u3066\u3082\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Operating System PG-Strom\u306e\u5b9f\u884c\u306b\u306f\u3001CUDA Toolkit\u306b\u3088\u308a\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308bx86_64\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5411\u3051\u306eLinux OS\u304c\u5fc5\u8981\u3067\u3059\u3002\u63a8\u5968\u74b0\u5883\u306fRed Hat Enterprise Linux\u307e\u305f\u306fCentOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f37.x\u30b7\u30ea\u30fc\u30ba\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001Red Hat Enterprise Linux \u307e\u305f\u306f CentOS \u306e\u30d0\u30fc\u30b8\u30e7\u30f37.3\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002 PostgreSQL PG-Strom\u306e\u5b9f\u884c\u306b\u306fPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f39.6\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u306f\u3001Custom Scan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304cCPU\u4e26\u5217\u5b9f\u884c\u3084GROUP BY\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u5237\u65b0\u3055\u308c\u3001\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u63d0\u4f9b\u3059\u308b\u30ab\u30b9\u30bf\u30e0\u5b9f\u884c\u8a08\u753b\u3092\u81ea\u7136\u306a\u5f62\u3067\u7d71\u5408\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u305f\u3081\u3067\u3059\u3002 CUDA Toolkit PG-Strom\u306e\u5b9f\u884c\u306b\u306fCUDA Toolkit \u30d0\u30fc\u30b8\u30e7\u30f39.2\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002 PG-Strom\u304c\u5185\u90e8\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u308bAPI\u306e\u4e2d\u306b\u306f\u3001\u3053\u308c\u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u3082\u306e\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002 OS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3057\u3001\u500b\u3005\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d7\u30ed\u30bb\u30b9\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306f\u3001 NVIDIA DEVELOPER ZONE \u306b\u304a\u3044\u3066\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Red Hat Enterprise Linux 7.x\u7cfb\u5217\u3001\u307e\u305f\u306fCentOS 7.x\u7cfb\u5217\u306e\u5834\u5408\u3001\u30d9\u30fc\u30b9\u74b0\u5883\u3068\u3057\u3066\u300c\u6700\u5c0f\u9650\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3092\u9078\u629e\u3057\u3001\u3055\u3089\u306b\u4ee5\u4e0b\u306e\u30a2\u30c9\u30aa\u30f3\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30c7\u30d0\u30c3\u30b0\u30c4\u30fc\u30eb \u958b\u767a\u30c4\u30fc\u30eb OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u8a2d\u5b9a \u30b7\u30b9\u30c6\u30e0\u3078\u306eOS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u5f8c\u306e\u30b9\u30c6\u30c3\u30d7\u3067GPU\u30c9\u30e9\u30a4\u30d0\u3068NVMe-Strom\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u3001\u3044\u304f\u3064\u304b\u306e\u8ffd\u52a0\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002 EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a PG-Strom\u306e\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u3044\u304f\u3064\u304b\u306f\u3001EPEL(Extra Packages for Enterprise Linux)\u306e\u4e00\u90e8\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306bEPEL\u30d1\u30c3\u30b1\u30fc\u30b8\u7fa4\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u3092yum\u30b7\u30b9\u30c6\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u5165\u624b\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e00\u3064\u304cDKMS(Dynamic Kernel Module Support)\u3067\u3059\u3002\u3053\u308c\u306f\u52d5\u4f5c\u4e2d\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u9069\u5408\u3057\u305fLinux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3001NVIDIA\u306eGPU\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3084\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb(nvme_strom)\u304c\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 Linux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001Linux\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306b\u8ffd\u5f93\u3057\u3066\u518d\u30d3\u30eb\u30c9\u304c\u5fc5\u8981\u3067\u3042\u308b\u305f\u3081\u3001DKMS\u306a\u3057\u3067\u306e\u30b7\u30b9\u30c6\u30e0\u904b\u7528\u306f\u73fe\u5b9f\u7684\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u306f epel-release \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308a\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3002 \u3053\u308c\u306fFedora Project\u306e\u30d1\u30d6\u30ea\u30c3\u30afFTP\u30b5\u30a4\u30c8\u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3001 epel-release-<distribution version>.noarch.rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u3053\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002 epel-release \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u304cyum\u30b7\u30b9\u30c6\u30e0\u3078\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002 Fedora Project Public FTP Site https://dl.fedoraproject.org/pub/epel/7/x86_64/ Tip \u4e0a\u8a18URL\u304b\u3089 Packages \u2192 e \u3078\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u3092\u4e0b\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bepel-release\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: epel-release noarch 7-11 /epel-release-7-11.noarch 24 k Transaction Summary ================================================================================ Install 1 Package : Installed: epel-release.noarch 0:7-11 Complete! HeteroDB-SWDC\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb PG-Strom\u307b\u304b\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306f HeteroDB Software Distribution Center \u304b\u3089\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306b\u3001HeteroDB-SWDC\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u3092yum\u30b7\u30b9\u30c6\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 HeteroDB-SWDC\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u306fheterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308a\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3002 Web\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u3067 HeteroDB Software Distribution Center \u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30da\u30fc\u30b8\u306e\u5148\u982d\u306b\u30ea\u30f3\u30af\u306e\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b heterodb-swdc-1.0-1.el7.noarch.rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002 heterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001HeteroDB-SWDC\u304b\u3089\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306eyum\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u8a2d\u5b9a\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bheterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install https://heterodb.github.io/swdc/yum/rhel7-x86_64/heterodb-swdc-1.0-1.el7.noarch.rpm : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: heterodb-swdc noarch 1.0-1.el7 /heterodb-swdc-1.0-1.el7.noarch 2.4 k Transaction Summary ================================================================================ Install 1 Package : Installed: heterodb-swdc.noarch 0:1.0-1.el7 Complete! CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u672c\u7bc0\u3067\u306fCUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u65e2\u306b\u6700\u65b0\u306eCUDA Toolkit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u672c\u7bc0\u306e\u5185\u5bb9\u306f\u8aad\u307f\u98db\u3070\u3057\u3066\u69cb\u3044\u307e\u305b\u3093 NVIDIA\u306fCUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\uff12\u901a\u308a\u306e\u65b9\u6cd5\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u4e00\u3064\u306f\u81ea\u5df1\u5b9f\u884c\u578b\u30a2\u30fc\u30ab\u30a4\u30d6\uff08runfile\u3068\u547c\u3070\u308c\u308b\uff09\u306b\u3088\u308b\u3082\u306e\u3002\u3082\u3046\u4e00\u3064\u306fRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308b\u3082\u306e\u3067\u3059\u3002 \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u66f4\u65b0\u304c\u5bb9\u6613\u3067\u3042\u308b\u4e8b\u304b\u3089\u3001\u5f8c\u8005\u306eRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u63a8\u5968\u3067\u3059\u3002 CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u306fNVIDIA DEVELOPER ZONE\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u9069\u5207\u306aOS\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3001\u300erpm(network)\u300f\u7248\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u300erpm(network)\u300f\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306fCUDA Toolkit\u3092\u914d\u5e03\u3059\u308byum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\u3053\u308c\u306f OS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u306b\u304a\u3044\u3066\u30b7\u30b9\u30c6\u30e0\u306bEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3057\u305f\u306e\u3068\u540c\u69d8\u306e\u65b9\u6cd5\u3067\u3059\u3002 \u3057\u305f\u304c\u3063\u3066\u3001cuda\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\u3057\u305f\u5f8c\u3001\u95a2\u9023\u3057\u305fRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ sudo rpm -i cuda-repo-<distribution>-<version>.x86_64.rpm $ sudo yum clean all $ sudo yum install cuda --enablerepo=rhel-7-server-e4s-optional-rpms or $ sudo yum install cuda \u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001 /usr/local/cuda \u914d\u4e0b\u306bCUDA Toolkit\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Tip RHEL7\u306e\u5834\u5408\u3001CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u8981\u306a vulkan-filesystem \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u914d\u5e03\u3059\u308b rhel-7-server-e4s-optional-rpms \u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002CUDA Toolkit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u969b\u306b\u306f\u3001 /etc/yum.repos.d/redhat.repo \u3092\u7de8\u96c6\u3057\u3066\u5f53\u8a72\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\u3059\u308b\u304b\u3001yum\u30b3\u30de\u30f3\u30c9\u306e --enablerepo \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7528\u3044\u3066\u5f53\u8a72\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4e00\u6642\u7684\u306b\u6709\u52b9\u5316\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ ls /usr/local/cuda bin include libnsight nvml samples tools doc jre libnvvp nvvm share version.txt extras lib64 nsightee_plugins pkgconfig src \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001GPU\u304c\u6b63\u3057\u304f\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 nvidia-smi \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u51fa\u529b\u4f8b\u306e\u3088\u3046\u306b\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u642d\u8f09\u3055\u308c\u3066\u3044\u308bGPU\u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002 $ nvidia-smi Wed Feb 14 09:43:48 2018 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 387.26 Driver Version: 387.26 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 Tesla V100-PCIE... Off | 00000000:02:00.0 Off | 0 | | N/A 41C P0 37W / 250W | 0MiB / 16152MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | No running processes found | +-----------------------------------------------------------------------------+ Tip nvidia\u30c9\u30e9\u30a4\u30d0\u3068\u7af6\u5408\u3059\u308bnouveau\u30c9\u30e9\u30a4\u30d0\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u76f4\u3061\u306bnvidia\u30c9\u30e9\u30a4\u30d0\u3092\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002 \u3053\u306e\u5834\u5408\u306f\u3001nouveau\u30c9\u30e9\u30a4\u30d0\u306e\u7121\u52b9\u5316\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u4e0a\u3067\u30b7\u30b9\u30c6\u30e0\u3092\u4e00\u5ea6\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 runfile\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u3001CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304cnouveau\u30c9\u30e9\u30a4\u30d0\u306e\u7121\u52b9\u5316\u8a2d\u5b9a\u3082\u884c\u3044\u307e\u3059\u3002RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002 nouveau\u30c9\u30e9\u30a4\u30d0\u3092\u7121\u52b9\u5316\u3059\u308b\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092 /etc/modprobe.d/disable-nouveau.conf \u3068\u3044\u3046\u540d\u524d\u3067\u4fdd\u5b58\u3057\u3001 dracut \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066Linux kernel\u306e\u30d6\u30fc\u30c8\u30a4\u30e1\u30fc\u30b8\u306b\u53cd\u6620\u3057\u307e\u3059\u3002 # cat > /etc/modprobe.d/disable-nouveau.conf <<EOF blacklist nouveau options nouveau modeset=0 EOF # dracut -f PostgreSQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u672c\u7bc0\u3067\u306fRPM\u306b\u3088\u308bPostgreSQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u307e\u3059\u3002 \u30bd\u30fc\u30b9\u304b\u3089\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u95a2\u3057\u3066\u306f\u65e2\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u6570\u591a\u304f\u5b58\u5728\u3057\u3001 ./configure \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u591a\u5c90\u306b\u308f\u305f\u308b\u4e8b\u304b\u3089\u3001\u3053\u3053\u3067\u306f\u7d39\u4ecb\u3057\u307e\u305b\u3093\u3002 Linux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u914d\u5e03\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3082PostgreSQL\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5fc5\u305a\u3057\u3082\u6700\u65b0\u3067\u306f\u306a\u304f\u3001PG-Strom\u306e\u5bfe\u5fdc\u30d0\u30fc\u30b8\u30e7\u30f3\u3088\u308a\u3082\u53e4\u3044\u3082\u306e\u3067\u3042\u308b\u4e8b\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001Red Hat Enterprise Linux 7.x\u3084CentOS 7.x\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308bPostgreSQL\u306fv9.2.x\u3067\u3059\u304c\u3001\u3053\u308c\u306fPostgreSQL\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u3057\u3066\u65e2\u306bEOL\u3068\u306a\u3063\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u3002 PostgreSQL Global Development Group\u306f\u3001\u6700\u65b0\u306ePostgreSQL\u304a\u3088\u3073\u95a2\u9023\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u914d\u5e03\u306e\u305f\u3081\u306byum\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 EPEL\u306e\u8a2d\u5b9a\u306e\u3088\u3046\u306b\u3001yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3060\u3051\u306e\u5c0f\u3055\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u305d\u306e\u5f8c\u3001PostgreSQL\u3084\u305d\u306e\u4ed6\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 yum\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u306e\u4e00\u89a7\u306f http://yum.postgresql.org/repopackages.php \u3067\u3059\u3002 PostgreSQL\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3068Linux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u591a\u304f\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u306a\u305f\u306eLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u5411\u3051\u306ePostgreSQL 9.6\u4ee5\u964d\u306e\u3082\u306e\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u6b21\u3044\u3067\u3001PostgreSQL\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002 PostgreSQL v10\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001PG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002 postgresql10-devel postgresql10-server $ sudo yum install -y https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-redhat10-10-2.noarch.rpm $ sudo yum install -y postgresql10-server postgresql10-devel : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: postgresql10-devel x86_64 10.2-1PGDG.rhel7 pgdg10 2.0 M postgresql10-server x86_64 10.2-1PGDG.rhel7 pgdg10 4.4 M Installing for dependencies: postgresql10 x86_64 10.2-1PGDG.rhel7 pgdg10 1.5 M postgresql10-libs x86_64 10.2-1PGDG.rhel7 pgdg10 354 k Transaction Summary ================================================================================ Install 2 Packages (+2 Dependent packages) : Installed: postgresql10-devel.x86_64 0:10.2-1PGDG.rhel7 postgresql10-server.x86_64 0:10.2-1PGDG.rhel7 Dependency Installed: postgresql10.x86_64 0:10.2-1PGDG.rhel7 postgresql10-libs.x86_64 0:10.2-1PGDG.rhel7 Complete! PostgreSQL Global Development Group\u306e\u63d0\u4f9b\u3059\u308bRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306f /usr/pgsql-<version> \u3068\u3044\u3046\u5c11\u3005\u5909\u5247\u7684\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u3001 psql \u7b49\u306e\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u306f\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u6ce8\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 postgresql-alternatives \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3068\u3001\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092 /usr/local/bin \u4ee5\u4e0b\u306b\u4f5c\u6210\u3059\u308b\u305f\u3081\u5404\u7a2e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u4fbf\u5229\u3067\u3059\u3002\u307e\u305f\u3001\u8907\u6570\u30d0\u30fc\u30b8\u30e7\u30f3\u306ePostgreSQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u3001 alternatives \u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u30bf\u30fc\u30b2\u30c3\u30c8\u3068\u306a\u308bPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 $ sudo yum install postgresql-alternatives : Resolving Dependencies --> Running transaction check ---> Package postgresql-alternatives.noarch 0:1.0-1.el7 will be installed --> Finished Dependency Resolution Dependencies Resolved : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: postgresql-alternatives noarch 1.0-1.el7 heterodb 9.2 k Transaction Summary ================================================================================ : Installed: postgresql-alternatives.noarch 0:1.0-1.el7 Complete! PG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u672c\u7bc0\u3067\u306fPG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u63a8\u5968\u306fRPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u304c\u3001\u958b\u767a\u8005\u5411\u3051\u306b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3082\u7d39\u4ecb\u3057\u307e\u3059\u3002 RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb PG-Strom\u304a\u3088\u3073\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306f HeteroDB Software Distribution Center \u3088\u308a\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u65e2\u306byum\u30b7\u30b9\u30c6\u30e0\u3078\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u307b\u3069\u4f5c\u696d\u306f\u591a\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u57fa\u76e4\u3068\u306a\u308bPostgreSQL\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3054\u3068\u306b\u5225\u500b\u306ePG-Strom\u306eRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u6e96\u5099\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL v9.6\u7528\u3067\u3042\u308c\u3070 pg_strom-PG96 \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001PostgreSQL v10\u7528\u3067\u3042\u308c\u3070 pg_strom-PG10 \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install pg_strom-PG10 : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: pg_strom-PG10 x86_64 1.9-180301.el7 heterodb 320 k Transaction Summary ================================================================================ : Installed: pg_strom-PG10.x86_64 0:1.9-180301.el7 Complete! \u4ee5\u4e0a\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002 \u30bd\u30fc\u30b9\u304b\u3089\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u958b\u767a\u8005\u5411\u3051\u306b\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089PG-Strom\u3092\u30d3\u30eb\u30c9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3082\u7d39\u4ecb\u3057\u307e\u3059\u3002 \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5165\u624b RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u540c\u69d8\u306b\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306etarball\u3092 HeteroDB Software Distribution Center \u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u305f\u3060\u3001tarball\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u306f\u3042\u308b\u7a0b\u5ea6\u306e\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u751f\u3058\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u6700\u65b0\u306e\u958b\u767a\u7248\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306b\u306f PG-Strom\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea \u306e master \u30d6\u30e9\u30f3\u30c1\u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3059\u308b\u65b9\u6cd5\u306e\u65b9\u304c\u597d\u307e\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 $ git clone https://github.com/heterodb/pg-strom.git Cloning into 'pg-strom'... remote: Counting objects: 13797, done. remote: Compressing objects: 100% (215/215), done. remote: Total 13797 (delta 208), reused 339 (delta 167), pack-reused 13400 Receiving objects: 100% (13797/13797), 11.81 MiB | 1.76 MiB/s, done. Resolving deltas: 100% (10504/10504), done. PG-Strom\u306e\u30d3\u30eb\u30c9 PG-Strom\u3092\u30d3\u30eb\u30c9\u3059\u308b\u6642\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306ePostgreSQL\u3068\u53b3\u5bc6\u306b\u4e00\u81f4\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001\u540c\u3058\u69cb\u9020\u4f53\u304c\u30d3\u30eb\u30c9\u6642\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306b\u3088\u308aPostgreSQL\u3068PG-Strom\u3067\u7570\u306a\u3063\u305f\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6301\u3063\u3066\u3057\u307e\u3063\u305f\u3068\u3059\u308c\u3070\u3001\u975e\u5e38\u306b\u767a\u898b\u306e\u96e3\u3057\u3044\u30d0\u30b0\u3092\u751f\u307f\u51fa\u3057\u3066\u3057\u307e\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\uff08\u4e00\u8cab\u6027\u306e\u306a\u3044\u72b6\u614b\u3092\u907f\u3051\u308b\u305f\u3081\uff09PG-Strom\u306f\u72ec\u81ea\u306bconfigure\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8d70\u3089\u305b\u305f\u308a\u306f\u305b\u305a\u3001 pg_config \u3092\u4f7f\u3063\u3066PostgreSQL\u306e\u30d3\u30eb\u30c9\u6642\u8a2d\u5b9a\u3092\u53c2\u7167\u3057\u307e\u3059\u3002 pg_config \u306b\u30d1\u30b9\u304c\u901a\u3063\u3066\u304a\u308a\u3001\u305d\u308c\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306ePostgreSQL\u306e\u3082\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u307e\u307e make \u3001 make install \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 \u76f4\u63a5\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001 make \u30b3\u30de\u30f3\u30c9\u306b PG_CONFIG=... \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e0e\u3048\u3001 pg_config \u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6e21\u3057\u307e\u3059\u3002 $ cd pg-strom $ make PG_CONFIG=/usr/pgsql-10/bin/pg_config $ sudo make install PG_CONFIG=/usr/pgsql-10/bin/pg_config \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u8a2d\u5b9a \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u304c\u6e08\u3093\u3067\u3044\u306a\u3044\u5834\u5408\u306f\u3001 initdb \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066PostgreSQL\u306e\u521d\u671f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u304a\u3051\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u30d1\u30b9\u306f /var/lib/pgsql/<version number>/data \u3067\u3059\u3002 postgresql-alternatives \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001PostgreSQL\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u62e0\u3089\u305a /var/lib/pgdata \u3067\u53c2\u7167\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo su - postgres $ initdb -D /var/lib/pgdata/ The files belonging to this database system will be owned by user \"postgres\". This user must also own the server process. The database cluster will be initialized with locale \"en_US.UTF-8\". The default database encoding has accordingly been set to \"UTF8\". The default text search configuration will be set to \"english\". Data page checksums are disabled. fixing permissions on existing directory /var/lib/pgdata ... ok creating subdirectories ... ok selecting default max_connections ... 100 selecting default shared_buffers ... 128MB selecting dynamic shared memory implementation ... posix creating configuration files ... ok running bootstrap script ... ok performing post-bootstrap initialization ... ok syncing data to disk ... ok WARNING: enabling \"trust\" authentication for local connections You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb. Success. You can now start the database server using: pg_ctl -D /var/lib/pgdata/ -l logfile start postgresql.conf\u306e\u7de8\u96c6 \u7d9a\u3044\u3066\u3001PostgreSQL\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b postgresql.conf \u3092\u7de8\u96c6\u3057\u307e\u3059\u3002 PG-Strom\u3092\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u3001\u6700\u4f4e\u9650\u3001\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002 \u3053\u308c\u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u3082\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u7528\u9014\u3084\u60f3\u5b9a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u8e0f\u307e\u3048\u3066\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 shared_preload_libraries PG-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306f shared_preload_libraries \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308apostmaster\u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\u6642\u306b\u30ed\u30fc\u30c9\u3055\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\u306f\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3067\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u9805\u76ee\u306f\u5fc5\u9808\u3067\u3059\u3002 shared_preload_libraries = '$libdir/pg_strom' max_worker_processes PG-Strom\u306f\u6570\u500b\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u3092\u5185\u90e8\u7684\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3067\u3042\u308b 8 \u3067\u306f\u3001\u305d\u308c\u4ee5\u5916\u306e\u51e6\u7406\u306b\u5229\u7528\u3067\u304d\u308b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u6570\u304c\u3042\u307e\u308a\u306b\u3082\u5c11\u306a\u3059\u304e\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 max_worker_processes = 100 shared_buffers \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u3088\u308a\u307e\u3059\u304c\u3001 shared_buffers \u306e\u521d\u671f\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u5c0f\u3055\u3044\u305f\u3081\u3001PG-Strom\u304c\u6709\u52b9\u306b\u6a5f\u80fd\u3059\u308b\u6c34\u6e96\u306e\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306b\u5bfe\u3057\u3066\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u8aad\u307f\u66f8\u304d\u304c\u5f8b\u901f\u8981\u56e0\u3068\u306a\u3063\u3066\u3057\u307e\u3044\u3001GPU\u306e\u4e26\u5217\u8a08\u7b97\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u5229\u7528\u3067\u304d\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 shared_buffers = 10GB \u660e\u3089\u304b\u306b\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u3088\u308a\u3082\u5927\u304d\u306a\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5229\u7528\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 work_mem \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u3088\u308a\u307e\u3059\u304c\u3001 work_mem \u306e\u521d\u671f\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u5c0f\u3055\u3044\u305f\u3081\u3001\u89e3\u6790\u7cfb\u30af\u30a8\u30ea\u3067\u6700\u9069\u306a\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u304c\u9078\u629e\u3055\u308c\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u5178\u578b\u7684\u306a\u4f8b\u306f\u3001\u30bd\u30fc\u30c8\u51e6\u7406\u306b\u30aa\u30f3\u30e1\u30e2\u30ea\u306e\u30af\u30a4\u30c3\u30af\u30bd\u30fc\u30c8\u3067\u306f\u306a\u304f\u3001\u30c7\u30a3\u30b9\u30af\u30d9\u30fc\u30b9\u306e\u30de\u30fc\u30b8\u30bd\u30fc\u30c8\u3092\u9078\u629e\u3059\u308b\u3068\u3044\u3063\u305f\u3082\u306e\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 work_mem = 1GB OS\u306e\u30ea\u30bd\u30fc\u30b9\u5236\u9650\u306e\u62e1\u5f35 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u7279\u306b\u3001\u540c\u6642\u306b\u5927\u91cf\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3059\u308b\u4e8b\u304c\u3042\u308b\u305f\u3081\u3001\u30d7\u30ed\u30bb\u30b9\u3042\u305f\u308a\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u6570\u306e\u4e0a\u9650\u3092\u62e1\u5927\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u307e\u305f\u3001PostgreSQL\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u6642\u306b\u78ba\u5b9f\u306b\u30b3\u30a2\u30c0\u30f3\u30d7\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u3001\u30b3\u30a2\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u4e0a\u9650\u3092\u5236\u9650\u3057\u306a\u3044\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\u3002 PostgreSQL\u3092systemd\u7d4c\u7531\u3067\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u30ea\u30bd\u30fc\u30b9\u5236\u9650\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u306f /etc/systemd/system/postgresql-XX.service.d/pg_strom.conf \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002 RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002 \u74b0\u5883\u5909\u6570 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u304c\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u958b\u767a\u8005\u5411\u3051\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u3053\u308c\u3092\u6709\u52b9\u306b\u3057\u3066\u8d77\u52d5\u3059\u308b\u3068\u3001GPU\u5074\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306bGPU\u306e\u30b3\u30a2\u30c0\u30f3\u30d7\u3092\u751f\u6210\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u8a73\u3057\u304f\u306f CUDA-GDB:GPU core dump support \u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002 [Service] LimitNOFILE=65536 LimitCORE=infinity #Environment=CUDA_ENABLE_COREDUMP_ON_EXCEPTION=1 PostgreSQL\u306e\u8d77\u52d5 PostgreSQL\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002 \u6b63\u5e38\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308c\u3070\u3001\u30ed\u30b0\u306bPG-Strom\u304cGPU\u3092\u8a8d\u8b58\u3057\u305f\u4e8b\u3092\u793a\u3059\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001Tesla V100(PCIe; 16GB\u7248)\u3092\u8a8d\u8b58\u3057\u3066\u3044\u307e\u3059\u3002 # systemctl start postgresql-10 # systemctl status -l postgresql-10 * postgresql-10.service - PostgreSQL 10 database server Loaded: loaded (/usr/lib/systemd/system/postgresql-10.service; disabled; vendor preset: disabled) Active: active (running) since Sat 2018-03-03 15:45:23 JST; 2min 21s ago Docs: https://www.postgresql.org/docs/10/static/ Process: 24851 ExecStartPre=/usr/pgsql-10/bin/postgresql-10-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS) Main PID: 24858 (postmaster) CGroup: /system.slice/postgresql-10.service |-24858 /usr/pgsql-10/bin/postmaster -D /var/lib/pgsql/10/data/ |-24890 postgres: logger process |-24892 postgres: bgworker: PG-Strom GPU memory keeper |-24896 postgres: checkpointer process |-24897 postgres: writer process |-24898 postgres: wal writer process |-24899 postgres: autovacuum launcher process |-24900 postgres: stats collector process |-24901 postgres: bgworker: PG-Strom ccache-builder2 |-24902 postgres: bgworker: PG-Strom ccache-builder1 `-24903 postgres: bgworker: logical replication launcher Mar 03 15:45:19 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:19.195 JST [24858] HINT: Run 'nvidia-cuda-mps-control -d', then start server process. Check 'man nvidia-cuda-mps-control' for more details. Mar 03 15:45:20 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:20.509 JST [24858] LOG: PG-Strom: GPU0 Tesla V100-PCIE-16GB (5120 CUDA cores; 1380MHz, L2 6144kB), RAM 15.78GB (4096bits, 856MHz), CC 7.0 Mar 03 15:45:20 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:20.510 JST [24858] LOG: NVRTC - CUDA Runtime Compilation vertion 9.1 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.378 JST [24858] LOG: listening on IPv6 address \"::1\", port 5432 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.378 JST [24858] LOG: listening on IPv4 address \"127.0.0.1\", port 5432 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.442 JST [24858] LOG: listening on Unix socket \"/var/run/postgresql/.s.PGSQL.5432\" Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.492 JST [24858] LOG: listening on Unix socket \"/tmp/.s.PGSQL.5432\" Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.527 JST [24858] LOG: redirecting log output to logging collector process Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.527 JST [24858] HINT: Future log output will appear in directory \"log\". Mar 03 15:45:23 saba.heterodb.com systemd[1]: Started PostgreSQL 10 database server. PG-Strom\u95a2\u9023\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210 \u6700\u5f8c\u306b\u3001PG-Strom\u306b\u95a2\u9023\u3059\u308bSQL\u95a2\u6570\u306a\u3069\u306eDB\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u3053\u306e\u624b\u9806\u306fPostgreSQL\u306eEXTENSION\u6a5f\u80fd\u3092\u7528\u3044\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u3066\u304a\u308a\u3001SQL\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 CREATE EXTENSION \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\u3002 \u306a\u304a\u3001\u3053\u306e\u624b\u9806\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u305f\u3073\u306b\u5fc5\u8981\u306b\u306a\u308b\u4e8b\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u305f\u6642\u70b9\u3067\u65e2\u306bPG-Strom\u95a2\u9023\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u3066\u307b\u3057\u3044\u5834\u5408\u306f\u3001\u4e88\u3081 template1 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067PG-Strom\u30a8\u30af\u30b9\u30c6\u30f3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u3066\u304a\u3051\u3070\u3001 CREATE DATABASE \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u306b\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u8a2d\u5b9a\u304c\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002 $ psql postgres -U postgres psql (10.2) Type \"help\" for help. postgres=# CREATE EXTENSION pg_strom ; CREATE EXTENSION \u4ee5\u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb PG-Strom\u3068\u306f\u72ec\u7acb\u3057\u305f\u5225\u500b\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306a\u3069\u3001PG-Strom\u306e\u4e2d\u6838\u6a5f\u80fd\u3068\u5bc6\u63a5\u306b\u95a2\u4fc2\u3057\u3066\u3044\u308bNVME-Strom\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3064\u3044\u3066\u3082\u672c\u7bc0\u3067\u8aac\u660e\u3057\u307e\u3059\u3002 \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5165\u624b\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u4ed6\u306ePG-Strom\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u540c\u69d8\u3001NVME-Strom\u306f(https://heterodb.github.io/swdc/)[HeteroDB Software Distribution Center]\u304b\u3089\u30d5\u30ea\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3059\u306a\u308f\u3061\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 heterodb-swdc \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u6e08\u307f\u3067\u3042\u308c\u3070\u3001 yum install \u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo yum install nvme_strom Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: mirrors.cat.net * epel: ftp.iij.ad.jp * extras: mirrors.cat.net * ius: mirrors.kernel.org * updates: mirrors.cat.net Resolving Dependencies --> Running transaction check ---> Package nvme_strom.x86_64 0:1.3-1.el7 will be installed --> Finished Dependency Resolution Dependencies Resolved ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: nvme_strom x86_64 1.3-1.el7 heterodb 273 k Transaction Summary ================================================================================ Install 1 Package Total download size: 273 k Installed size: 1.5 M Is this ok [y/d/N]: y Downloading packages: No Presto metadata available for heterodb nvme_strom-1.3-1.el7.x86_64.rpm | 273 kB 00:00 Running transaction check Running transaction test Transaction test succeeded Running transaction Installing : nvme_strom-1.3-1.el7.x86_64 1/1 : <snip> : DKMS: install completed. Verifying : nvme_strom-1.3-1.el7.x86_64 1/1 Installed: nvme_strom.x86_64 0:1.3-1.el7 Complete! \u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5168\u3066\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001HeteroDB\u793e\u304c\u63d0\u4f9b\u3059\u308b\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316\u304c\u5fc5\u8981\u3067\u3059\u3002\u30e9\u30a4\u30bb\u30f3\u30b9\u306a\u3057\u3067\u904b\u7528\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u305d\u306e\u5834\u5408\u3001\u4e0b\u8a18\u306e\u6a5f\u80fd\u304c\u5236\u9650\u3092\u53d7\u3051\u307e\u3059\u3002 \u8907\u6570\u500b\u306eGPU\u306e\u5229\u7528 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u304a\u3051\u308b\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0(md-raid0)\u5bfe\u5fdc \u30e9\u30a4\u30bb\u30f3\u30b9\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067HeteroDB\u793e\u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 IAgIVdKxhe+BSer3Y67jQW0+uTzYh00K6WOSH7xQ26Qcw8aeUNYqJB9YcKJTJb+QQhjmUeQpUnboNxVwLCd3HFuLXeBWMKp11/BgG0FSrkUWu/ZCtDtw0F1hEIUY7m767zAGV8y+i7BuNXGJFvRlAkxdVO3/K47ocIgoVkuzBfLvN/h9LffOydUnHPzrFHfLc0r3nNNgtyTrfvoZiXegkGM9GBTAKyq8uWu/OGonh9ybzVKOgofhDLk0rVbLohOXDhMlwDl2oMGIr83tIpCWG+BGE+TDwsJ4n71Sv6n4bi/ZBXBS498qShNHDGrbz6cNcDVBa+EuZc6HzZoF6UrljEcl= ---- VERSION:2 SERIAL_NR:HDB-TRIAL ISSUED_AT:2019-05-09 EXPIRED_AT:2019-06-08 GPU_UUID:GPU-a137b1df-53c9-197f-2801-f2dccaf9d42f \u3053\u308c\u3092 /etc/heterodb.license \u306b\u30b3\u30d4\u30fc\u3057\u3001PostgreSQL\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bPostgreSQL\u306e\u8d77\u52d5\u30ed\u30b0\u306b\u30e9\u30a4\u30bb\u30f3\u30b9\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u3001\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316\u304c\u884c\u308f\u308c\u305f\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 $ pg_ctl restart : LOG: PG-Strom version 2.2 built for PostgreSQL 11 LOG: PG-Strom: GPU0 Tesla P40 (3840 CUDA cores; 1531MHz, L2 3072kB), RAM 22.38GB (384bits, 3.45GHz), CC 6.1 : LOG: HeteroDB License: { \"version\" : 2, \"serial_nr\" : \"HDB-TRIAL\", \"issued_at\" : \"9-May-2019\", \"expired_at\" : \"8-Jun-2019\", \"gpus\" : [ { \"uuid\" : \"GPU-a137b1df-53c9-197f-2801-f2dccaf9d42f\", \"pci_id\" : \"0000:02:00.0\" } ] } LOG: listening on IPv6 address \"::1\", port 5432 LOG: listening on IPv4 address \"127.0.0.1\", port 5432 : \u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf NVME-Strom\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3042\u308a\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e verbose int 0 \u8a73\u7d30\u306a\u30c7\u30d0\u30c3\u30b0\u51fa\u529b\u3092\u884c\u3044\u307e\u3059\u3002 fast_ssd_mode int 0 \u9ad8\u901f\u306aNVME-SSD\u306b\u9069\u3057\u305f\u52d5\u4f5c\u30e2\u30fc\u30c9\u3067\u3059\u3002 p2p_dma_max_depth int 1024 NVME\u30c7\u30d0\u30a4\u30b9\u306eI/O\u30ad\u30e5\u30fc\u306b\u540c\u6642\u306b\u9001\u51fa\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b\u975e\u540c\u671fDMA\u8981\u6c42\u306e\u6700\u5927\u6570\u3067\u3059\u3002 p2p_dma_max_unitsz int 256 P2P DMA\u8981\u6c42\u3067\u4e00\u5ea6\u306b\u8aad\u307f\u51fa\u3059\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u6700\u5927\u9577\uff08kB\u5358\u4f4d\uff09\u3067\u3059\u3002 fast_ssd_mode \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u306e\u88dc\u8db3\u8aac\u660e\u3092\u4ed8\u8a18\u3057\u307e\u3059\u3002 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u304cSSD-to-GPU\u9593\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u306e\u8981\u6c42\u3092\u53d7\u3051\u53d6\u308b\u3068\u3001\u307e\u305a\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u304cOS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u8f09\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u307e\u3059\u3002 fast_ssd_mode \u304c 0 \u306e\u5834\u5408\u3001\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u304c\u65e2\u306b\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u8f09\u3063\u3066\u3044\u308c\u3070\u3001\u305d\u306e\u5185\u5bb9\u3092\u547c\u3073\u51fa\u3057\u5143\u306e\u30e6\u30fc\u30b6\u7a7a\u9593\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306bCUDA API\u3092\u7528\u3044\u305fHost->Device\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3046\u3088\u3046\u4fc3\u3057\u307e\u3059\u3002\u3053\u308c\u306fPCIe x4\u63a5\u7d9a\u306eNVME-SSD\u306a\u3069\u6bd4\u8f03\u7684\u4f4e\u901f\u306a\u30c7\u30d0\u30a4\u30b9\u5411\u304d\u306e\u52d5\u4f5c\u3067\u3059\u3002 \u4e00\u65b9\u3001PCIe x8\u63a5\u7d9a\u306e\u9ad8\u901fSSD\u3092\u4f7f\u7528\u3057\u305f\u308a\u3001\u8907\u6570\u306eSSD\u3092\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u69cb\u6210\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30d0\u30c3\u30d5\u30a1\u9593\u30b3\u30d4\u30fc\u306e\u5f8c\u3067\u6539\u3081\u3066Host->Device\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3046\u3088\u308a\u3082\u3001SSD-to-GPU\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3063\u305f\u65b9\u304c\u52b9\u7387\u7684\u3067\u3042\u308b\u4e8b\u3082\u3042\u308a\u307e\u3059\u3002 fast_ssd_mode \u304c 0 \u4ee5\u5916\u306e\u5834\u5408\u3001NVME-Strom\u30c9\u30e9\u30a4\u30d0\u306fOS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u72b6\u614b\u306b\u95a2\u308f\u3089\u305a\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3044\u307e\u3059\u3002 \u305f\u3060\u3057\u3001\u3044\u304b\u306a\u308b\u5834\u5408\u306b\u304a\u3044\u3066\u3082OS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u304c dirty \u3067\u3042\u308b\u5834\u5408\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002 p2p_dma_max_depth \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u95a2\u3059\u308b\u88dc\u8db3\u8aac\u660e\u3092\u4ed8\u8a18\u3057\u307e\u3059\u3002 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001SSD-to-GPU\u9593\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u306eDMA\u8981\u6c42\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u3092NVME\u30c7\u30d0\u30a4\u30b9\u306eI/O\u30ad\u30e5\u30fc\u306b\u9001\u51fa\u3057\u307e\u3059\u3002 NVME\u30c7\u30d0\u30a4\u30b9\u306e\u80fd\u529b\u3092\u8d8a\u3048\u308b\u30da\u30fc\u30b9\u3067\u975e\u540c\u671fDMA\u8981\u6c42\u304c\u6295\u5165\u3055\u308c\u308b\u3068\u3001NVME-SSD\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306fDMA\u8981\u6c42\u3092\u9806\u306b\u51e6\u7406\u3059\u308b\u4e8b\u306b\u306a\u308b\u305f\u3081\u3001DMA\u8981\u6c42\u306e\u30ec\u30a4\u30c6\u30f3\u30b7\u306f\u6975\u3081\u3066\u60aa\u5316\u3057\u307e\u3059\u3002\uff08\u4e00\u65b9\u3001NVME-SSD\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u306f\u5207\u308c\u76ee\u306a\u304fDMA\u8981\u6c42\u304c\u6765\u308b\u305f\u3081\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306f\u6700\u5927\u306b\u306a\u308a\u307e\u3059\uff09 DMA\u8981\u6c42\u306e\u767a\u884c\u304b\u3089\u51e6\u7406\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304f\u308b\u307e\u3067\u306e\u6642\u9593\u304c\u3042\u307e\u308a\u306b\u3082\u9577\u3044\u3068\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u3001\u3053\u308c\u304c\u4f55\u3089\u304b\u306e\u30a8\u30e9\u30fc\u3068\u8aa4\u8a8d\u3055\u308c\u3001I/O\u8981\u6c42\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3068\u30a8\u30e9\u30fc\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001NVME\u30c7\u30d0\u30a4\u30b9\u304c\u904a\u3070\u306a\u3044\u7a0b\u5ea6\u306bDMA\u8981\u6c42\u3092I/O\u30ad\u30e5\u30fc\u306b\u8a70\u3081\u3066\u304a\u3051\u3070\u3001\u305d\u308c\u4ee5\u4e0a\u306eDMA\u8981\u6c42\u3092\u4e00\u5ea6\u306b\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u306e\u306f\u6709\u5bb3\u7121\u76ca\u3068\u3044\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 p2p_dma_max_depth \u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001NVME\u30c7\u30d0\u30a4\u30b9\u6bce\u306b\u3001\u4e00\u5ea6\u306bI/O\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b\u975e\u540c\u671fP2P DMA\u8981\u6c42\u306e\u6570\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002\u8a2d\u5b9a\u5024\u4ee5\u4e0a\u306eDMA\u8981\u6c42\u3092\u6295\u5165\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u30b9\u30ec\u30c3\u30c9\u306f\u73fe\u5728\u5b9f\u884c\u4e2d\u306eDMA\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3001\u305d\u308c\u306b\u3088\u3063\u3066NVME\u30c7\u30d0\u30a4\u30b9\u306e\u9ad8\u8ca0\u8377\u3092\u907f\u3051\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002","title":"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#_1","text":"\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u3092\u52d5\u4f5c\u53ef\u80fd\u306a x86_64 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u304c\u5fc5\u8981\u3067\u3059\u3002 CPU\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u304a\u3088\u3073\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u306f\u7279\u5225\u306a\u8981\u4ef6\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001 note002:HW Validation List \u306f\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9078\u5b9a\u306e\u4e0a\u3067\u53c2\u8003\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u5229\u7528\u3059\u308b\u306b\u306fNVMe\u898f\u683c\u306b\u5bfe\u5fdc\u3057\u305fSSD\u304c\u5fc5\u8981\u3067\u3001GPU\u3068\u540c\u4e00\u306ePCIe Root Complex\u914d\u4e0b\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 GPU\u30c7\u30d0\u30a4\u30b9 PG-Strom\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u5c11\u306a\u304f\u3068\u3082\u4e00\u500b\u306eGPU\u30c7\u30d0\u30a4\u30b9\u304c\u30b7\u30b9\u30c6\u30e0\u4e0a\u306b\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u3089\u306fCUDA Toolkit\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u304a\u308a\u3001computing capability \u304c6.0\u4ee5\u964d\u306e\u30e2\u30c7\u30eb\uff08Pascal\u4e16\u4ee3\u4ee5\u964d\uff09\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 note001:GPU Availability Matrix \u306b\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5bfe\u5fdc\u72b6\u6cc1\u306b\u95a2\u3057\u3066\u3082\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Operating System PG-Strom\u306e\u5b9f\u884c\u306b\u306f\u3001CUDA Toolkit\u306b\u3088\u308a\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308bx86_64\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5411\u3051\u306eLinux OS\u304c\u5fc5\u8981\u3067\u3059\u3002\u63a8\u5968\u74b0\u5883\u306fRed Hat Enterprise Linux\u307e\u305f\u306fCentOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f37.x\u30b7\u30ea\u30fc\u30ba\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001Red Hat Enterprise Linux \u307e\u305f\u306f CentOS \u306e\u30d0\u30fc\u30b8\u30e7\u30f37.3\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002 PostgreSQL PG-Strom\u306e\u5b9f\u884c\u306b\u306fPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f39.6\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u306f\u3001Custom Scan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304cCPU\u4e26\u5217\u5b9f\u884c\u3084GROUP BY\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u5237\u65b0\u3055\u308c\u3001\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u63d0\u4f9b\u3059\u308b\u30ab\u30b9\u30bf\u30e0\u5b9f\u884c\u8a08\u753b\u3092\u81ea\u7136\u306a\u5f62\u3067\u7d71\u5408\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u305f\u3081\u3067\u3059\u3002 CUDA Toolkit PG-Strom\u306e\u5b9f\u884c\u306b\u306fCUDA Toolkit \u30d0\u30fc\u30b8\u30e7\u30f39.2\u4ee5\u964d\u304c\u5fc5\u8981\u3067\u3059\u3002 PG-Strom\u304c\u5185\u90e8\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u308bAPI\u306e\u4e2d\u306b\u306f\u3001\u3053\u308c\u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u3082\u306e\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002","title":"\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8"},{"location":"install/#os","text":"CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3057\u3001\u500b\u3005\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d7\u30ed\u30bb\u30b9\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306f\u3001 NVIDIA DEVELOPER ZONE \u306b\u304a\u3044\u3066\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Red Hat Enterprise Linux 7.x\u7cfb\u5217\u3001\u307e\u305f\u306fCentOS 7.x\u7cfb\u5217\u306e\u5834\u5408\u3001\u30d9\u30fc\u30b9\u74b0\u5883\u3068\u3057\u3066\u300c\u6700\u5c0f\u9650\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3092\u9078\u629e\u3057\u3001\u3055\u3089\u306b\u4ee5\u4e0b\u306e\u30a2\u30c9\u30aa\u30f3\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30c7\u30d0\u30c3\u30b0\u30c4\u30fc\u30eb \u958b\u767a\u30c4\u30fc\u30eb","title":"OS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#os_1","text":"\u30b7\u30b9\u30c6\u30e0\u3078\u306eOS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u5f8c\u306e\u30b9\u30c6\u30c3\u30d7\u3067GPU\u30c9\u30e9\u30a4\u30d0\u3068NVMe-Strom\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u3001\u3044\u304f\u3064\u304b\u306e\u8ffd\u52a0\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002","title":"OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u8a2d\u5b9a"},{"location":"install/#epel","text":"PG-Strom\u306e\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u3044\u304f\u3064\u304b\u306f\u3001EPEL(Extra Packages for Enterprise Linux)\u306e\u4e00\u90e8\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306bEPEL\u30d1\u30c3\u30b1\u30fc\u30b8\u7fa4\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u3092yum\u30b7\u30b9\u30c6\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u5165\u624b\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e00\u3064\u304cDKMS(Dynamic Kernel Module Support)\u3067\u3059\u3002\u3053\u308c\u306f\u52d5\u4f5c\u4e2d\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u9069\u5408\u3057\u305fLinux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3001NVIDIA\u306eGPU\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3084\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb(nvme_strom)\u304c\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 Linux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001Linux\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306b\u8ffd\u5f93\u3057\u3066\u518d\u30d3\u30eb\u30c9\u304c\u5fc5\u8981\u3067\u3042\u308b\u305f\u3081\u3001DKMS\u306a\u3057\u3067\u306e\u30b7\u30b9\u30c6\u30e0\u904b\u7528\u306f\u73fe\u5b9f\u7684\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u306f epel-release \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308a\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3002 \u3053\u308c\u306fFedora Project\u306e\u30d1\u30d6\u30ea\u30c3\u30afFTP\u30b5\u30a4\u30c8\u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3001 epel-release-<distribution version>.noarch.rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u3053\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002 epel-release \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u304cyum\u30b7\u30b9\u30c6\u30e0\u3078\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002 Fedora Project Public FTP Site https://dl.fedoraproject.org/pub/epel/7/x86_64/ Tip \u4e0a\u8a18URL\u304b\u3089 Packages \u2192 e \u3078\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u3092\u4e0b\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bepel-release\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: epel-release noarch 7-11 /epel-release-7-11.noarch 24 k Transaction Summary ================================================================================ Install 1 Package : Installed: epel-release.noarch 0:7-11 Complete!","title":"EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a"},{"location":"install/#heterodb-swdc","text":"PG-Strom\u307b\u304b\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306f HeteroDB Software Distribution Center \u304b\u3089\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306b\u3001HeteroDB-SWDC\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u3092yum\u30b7\u30b9\u30c6\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 HeteroDB-SWDC\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u306fheterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308a\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3002 Web\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u3067 HeteroDB Software Distribution Center \u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30da\u30fc\u30b8\u306e\u5148\u982d\u306b\u30ea\u30f3\u30af\u306e\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b heterodb-swdc-1.0-1.el7.noarch.rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002 heterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001HeteroDB-SWDC\u304b\u3089\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5165\u624b\u3059\u308b\u305f\u3081\u306eyum\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u8a2d\u5b9a\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bheterodb-swdc\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install https://heterodb.github.io/swdc/yum/rhel7-x86_64/heterodb-swdc-1.0-1.el7.noarch.rpm : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: heterodb-swdc noarch 1.0-1.el7 /heterodb-swdc-1.0-1.el7.noarch 2.4 k Transaction Summary ================================================================================ Install 1 Package : Installed: heterodb-swdc.noarch 0:1.0-1.el7 Complete!","title":"HeteroDB-SWDC\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#cuda-toolkit","text":"\u672c\u7bc0\u3067\u306fCUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u65e2\u306b\u6700\u65b0\u306eCUDA Toolkit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u672c\u7bc0\u306e\u5185\u5bb9\u306f\u8aad\u307f\u98db\u3070\u3057\u3066\u69cb\u3044\u307e\u305b\u3093 NVIDIA\u306fCUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\uff12\u901a\u308a\u306e\u65b9\u6cd5\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u4e00\u3064\u306f\u81ea\u5df1\u5b9f\u884c\u578b\u30a2\u30fc\u30ab\u30a4\u30d6\uff08runfile\u3068\u547c\u3070\u308c\u308b\uff09\u306b\u3088\u308b\u3082\u306e\u3002\u3082\u3046\u4e00\u3064\u306fRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308b\u3082\u306e\u3067\u3059\u3002 \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u66f4\u65b0\u304c\u5bb9\u6613\u3067\u3042\u308b\u4e8b\u304b\u3089\u3001\u5f8c\u8005\u306eRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u63a8\u5968\u3067\u3059\u3002 CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u306fNVIDIA DEVELOPER ZONE\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u9069\u5207\u306aOS\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3001\u300erpm(network)\u300f\u7248\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u300erpm(network)\u300f\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306fCUDA Toolkit\u3092\u914d\u5e03\u3059\u308byum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\u3053\u308c\u306f OS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u306b\u304a\u3044\u3066\u30b7\u30b9\u30c6\u30e0\u306bEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3057\u305f\u306e\u3068\u540c\u69d8\u306e\u65b9\u6cd5\u3067\u3059\u3002 \u3057\u305f\u304c\u3063\u3066\u3001cuda\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\u3057\u305f\u5f8c\u3001\u95a2\u9023\u3057\u305fRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ sudo rpm -i cuda-repo-<distribution>-<version>.x86_64.rpm $ sudo yum clean all $ sudo yum install cuda --enablerepo=rhel-7-server-e4s-optional-rpms or $ sudo yum install cuda \u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001 /usr/local/cuda \u914d\u4e0b\u306bCUDA Toolkit\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Tip RHEL7\u306e\u5834\u5408\u3001CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u8981\u306a vulkan-filesystem \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u914d\u5e03\u3059\u308b rhel-7-server-e4s-optional-rpms \u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002CUDA Toolkit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u969b\u306b\u306f\u3001 /etc/yum.repos.d/redhat.repo \u3092\u7de8\u96c6\u3057\u3066\u5f53\u8a72\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\u3059\u308b\u304b\u3001yum\u30b3\u30de\u30f3\u30c9\u306e --enablerepo \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7528\u3044\u3066\u5f53\u8a72\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4e00\u6642\u7684\u306b\u6709\u52b9\u5316\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ ls /usr/local/cuda bin include libnsight nvml samples tools doc jre libnvvp nvvm share version.txt extras lib64 nsightee_plugins pkgconfig src \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001GPU\u304c\u6b63\u3057\u304f\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 nvidia-smi \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u51fa\u529b\u4f8b\u306e\u3088\u3046\u306b\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u642d\u8f09\u3055\u308c\u3066\u3044\u308bGPU\u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002 $ nvidia-smi Wed Feb 14 09:43:48 2018 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 387.26 Driver Version: 387.26 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 Tesla V100-PCIE... Off | 00000000:02:00.0 Off | 0 | | N/A 41C P0 37W / 250W | 0MiB / 16152MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | No running processes found | +-----------------------------------------------------------------------------+ Tip nvidia\u30c9\u30e9\u30a4\u30d0\u3068\u7af6\u5408\u3059\u308bnouveau\u30c9\u30e9\u30a4\u30d0\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u76f4\u3061\u306bnvidia\u30c9\u30e9\u30a4\u30d0\u3092\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002 \u3053\u306e\u5834\u5408\u306f\u3001nouveau\u30c9\u30e9\u30a4\u30d0\u306e\u7121\u52b9\u5316\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u4e0a\u3067\u30b7\u30b9\u30c6\u30e0\u3092\u4e00\u5ea6\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 runfile\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u3001CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304cnouveau\u30c9\u30e9\u30a4\u30d0\u306e\u7121\u52b9\u5316\u8a2d\u5b9a\u3082\u884c\u3044\u307e\u3059\u3002RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002 nouveau\u30c9\u30e9\u30a4\u30d0\u3092\u7121\u52b9\u5316\u3059\u308b\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092 /etc/modprobe.d/disable-nouveau.conf \u3068\u3044\u3046\u540d\u524d\u3067\u4fdd\u5b58\u3057\u3001 dracut \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066Linux kernel\u306e\u30d6\u30fc\u30c8\u30a4\u30e1\u30fc\u30b8\u306b\u53cd\u6620\u3057\u307e\u3059\u3002 # cat > /etc/modprobe.d/disable-nouveau.conf <<EOF blacklist nouveau options nouveau modeset=0 EOF # dracut -f","title":"CUDA Toolkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#postgresql","text":"\u672c\u7bc0\u3067\u306fRPM\u306b\u3088\u308bPostgreSQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u307e\u3059\u3002 \u30bd\u30fc\u30b9\u304b\u3089\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u95a2\u3057\u3066\u306f\u65e2\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u6570\u591a\u304f\u5b58\u5728\u3057\u3001 ./configure \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u591a\u5c90\u306b\u308f\u305f\u308b\u4e8b\u304b\u3089\u3001\u3053\u3053\u3067\u306f\u7d39\u4ecb\u3057\u307e\u305b\u3093\u3002 Linux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u914d\u5e03\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3082PostgreSQL\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5fc5\u305a\u3057\u3082\u6700\u65b0\u3067\u306f\u306a\u304f\u3001PG-Strom\u306e\u5bfe\u5fdc\u30d0\u30fc\u30b8\u30e7\u30f3\u3088\u308a\u3082\u53e4\u3044\u3082\u306e\u3067\u3042\u308b\u4e8b\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001Red Hat Enterprise Linux 7.x\u3084CentOS 7.x\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308bPostgreSQL\u306fv9.2.x\u3067\u3059\u304c\u3001\u3053\u308c\u306fPostgreSQL\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u3057\u3066\u65e2\u306bEOL\u3068\u306a\u3063\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u3002 PostgreSQL Global Development Group\u306f\u3001\u6700\u65b0\u306ePostgreSQL\u304a\u3088\u3073\u95a2\u9023\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u914d\u5e03\u306e\u305f\u3081\u306byum\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 EPEL\u306e\u8a2d\u5b9a\u306e\u3088\u3046\u306b\u3001yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3060\u3051\u306e\u5c0f\u3055\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u305d\u306e\u5f8c\u3001PostgreSQL\u3084\u305d\u306e\u4ed6\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 yum\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u306e\u4e00\u89a7\u306f http://yum.postgresql.org/repopackages.php \u3067\u3059\u3002 PostgreSQL\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3068Linux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u591a\u304f\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9a\u7fa9\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u306a\u305f\u306eLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u5411\u3051\u306ePostgreSQL 9.6\u4ee5\u964d\u306e\u3082\u306e\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b9a\u7fa9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u6b21\u3044\u3067\u3001PostgreSQL\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002 PostgreSQL v10\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001PG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002 postgresql10-devel postgresql10-server $ sudo yum install -y https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-redhat10-10-2.noarch.rpm $ sudo yum install -y postgresql10-server postgresql10-devel : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: postgresql10-devel x86_64 10.2-1PGDG.rhel7 pgdg10 2.0 M postgresql10-server x86_64 10.2-1PGDG.rhel7 pgdg10 4.4 M Installing for dependencies: postgresql10 x86_64 10.2-1PGDG.rhel7 pgdg10 1.5 M postgresql10-libs x86_64 10.2-1PGDG.rhel7 pgdg10 354 k Transaction Summary ================================================================================ Install 2 Packages (+2 Dependent packages) : Installed: postgresql10-devel.x86_64 0:10.2-1PGDG.rhel7 postgresql10-server.x86_64 0:10.2-1PGDG.rhel7 Dependency Installed: postgresql10.x86_64 0:10.2-1PGDG.rhel7 postgresql10-libs.x86_64 0:10.2-1PGDG.rhel7 Complete! PostgreSQL Global Development Group\u306e\u63d0\u4f9b\u3059\u308bRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u306f /usr/pgsql-<version> \u3068\u3044\u3046\u5c11\u3005\u5909\u5247\u7684\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u3001 psql \u7b49\u306e\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u306f\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u6ce8\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 postgresql-alternatives \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3068\u3001\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092 /usr/local/bin \u4ee5\u4e0b\u306b\u4f5c\u6210\u3059\u308b\u305f\u3081\u5404\u7a2e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u4fbf\u5229\u3067\u3059\u3002\u307e\u305f\u3001\u8907\u6570\u30d0\u30fc\u30b8\u30e7\u30f3\u306ePostgreSQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u3001 alternatives \u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u30bf\u30fc\u30b2\u30c3\u30c8\u3068\u306a\u308bPostgreSQL\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 $ sudo yum install postgresql-alternatives : Resolving Dependencies --> Running transaction check ---> Package postgresql-alternatives.noarch 0:1.0-1.el7 will be installed --> Finished Dependency Resolution Dependencies Resolved : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: postgresql-alternatives noarch 1.0-1.el7 heterodb 9.2 k Transaction Summary ================================================================================ : Installed: postgresql-alternatives.noarch 0:1.0-1.el7 Complete!","title":"PostgreSQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#pg-strom","text":"\u672c\u7bc0\u3067\u306fPG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u63a8\u5968\u306fRPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u304c\u3001\u958b\u767a\u8005\u5411\u3051\u306b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3082\u7d39\u4ecb\u3057\u307e\u3059\u3002","title":"PG-Strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#rpm","text":"PG-Strom\u304a\u3088\u3073\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306f HeteroDB Software Distribution Center \u3088\u308a\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u65e2\u306byum\u30b7\u30b9\u30c6\u30e0\u3078\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u307b\u3069\u4f5c\u696d\u306f\u591a\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u57fa\u76e4\u3068\u306a\u308bPostgreSQL\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3054\u3068\u306b\u5225\u500b\u306ePG-Strom\u306eRPM\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u6e96\u5099\u3055\u308c\u3066\u304a\u308a\u3001PostgreSQL v9.6\u7528\u3067\u3042\u308c\u3070 pg_strom-PG96 \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001PostgreSQL v10\u7528\u3067\u3042\u308c\u3070 pg_strom-PG10 \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002 $ sudo yum install pg_strom-PG10 : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: pg_strom-PG10 x86_64 1.9-180301.el7 heterodb 320 k Transaction Summary ================================================================================ : Installed: pg_strom-PG10.x86_64 0:1.9-180301.el7 Complete! \u4ee5\u4e0a\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002","title":"RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#_2","text":"\u958b\u767a\u8005\u5411\u3051\u306b\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089PG-Strom\u3092\u30d3\u30eb\u30c9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3082\u7d39\u4ecb\u3057\u307e\u3059\u3002","title":"\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#_3","text":"RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u540c\u69d8\u306b\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306etarball\u3092 HeteroDB Software Distribution Center \u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u305f\u3060\u3001tarball\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u306f\u3042\u308b\u7a0b\u5ea6\u306e\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u751f\u3058\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u6700\u65b0\u306e\u958b\u767a\u7248\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306b\u306f PG-Strom\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea \u306e master \u30d6\u30e9\u30f3\u30c1\u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3059\u308b\u65b9\u6cd5\u306e\u65b9\u304c\u597d\u307e\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 $ git clone https://github.com/heterodb/pg-strom.git Cloning into 'pg-strom'... remote: Counting objects: 13797, done. remote: Compressing objects: 100% (215/215), done. remote: Total 13797 (delta 208), reused 339 (delta 167), pack-reused 13400 Receiving objects: 100% (13797/13797), 11.81 MiB | 1.76 MiB/s, done. Resolving deltas: 100% (10504/10504), done.","title":"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5165\u624b"},{"location":"install/#pg-strom_1","text":"PG-Strom\u3092\u30d3\u30eb\u30c9\u3059\u308b\u6642\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306ePostgreSQL\u3068\u53b3\u5bc6\u306b\u4e00\u81f4\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001\u540c\u3058\u69cb\u9020\u4f53\u304c\u30d3\u30eb\u30c9\u6642\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306b\u3088\u308aPostgreSQL\u3068PG-Strom\u3067\u7570\u306a\u3063\u305f\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6301\u3063\u3066\u3057\u307e\u3063\u305f\u3068\u3059\u308c\u3070\u3001\u975e\u5e38\u306b\u767a\u898b\u306e\u96e3\u3057\u3044\u30d0\u30b0\u3092\u751f\u307f\u51fa\u3057\u3066\u3057\u307e\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\uff08\u4e00\u8cab\u6027\u306e\u306a\u3044\u72b6\u614b\u3092\u907f\u3051\u308b\u305f\u3081\uff09PG-Strom\u306f\u72ec\u81ea\u306bconfigure\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8d70\u3089\u305b\u305f\u308a\u306f\u305b\u305a\u3001 pg_config \u3092\u4f7f\u3063\u3066PostgreSQL\u306e\u30d3\u30eb\u30c9\u6642\u8a2d\u5b9a\u3092\u53c2\u7167\u3057\u307e\u3059\u3002 pg_config \u306b\u30d1\u30b9\u304c\u901a\u3063\u3066\u304a\u308a\u3001\u305d\u308c\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306ePostgreSQL\u306e\u3082\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u307e\u307e make \u3001 make install \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 \u76f4\u63a5\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001 make \u30b3\u30de\u30f3\u30c9\u306b PG_CONFIG=... \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e0e\u3048\u3001 pg_config \u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6e21\u3057\u307e\u3059\u3002 $ cd pg-strom $ make PG_CONFIG=/usr/pgsql-10/bin/pg_config $ sudo make install PG_CONFIG=/usr/pgsql-10/bin/pg_config","title":"PG-Strom\u306e\u30d3\u30eb\u30c9"},{"location":"install/#_4","text":"","title":"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u8a2d\u5b9a"},{"location":"install/#_5","text":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u304c\u6e08\u3093\u3067\u3044\u306a\u3044\u5834\u5408\u306f\u3001 initdb \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066PostgreSQL\u306e\u521d\u671f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u304a\u3051\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u30d1\u30b9\u306f /var/lib/pgsql/<version number>/data \u3067\u3059\u3002 postgresql-alternatives \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001PostgreSQL\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u62e0\u3089\u305a /var/lib/pgdata \u3067\u53c2\u7167\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo su - postgres $ initdb -D /var/lib/pgdata/ The files belonging to this database system will be owned by user \"postgres\". This user must also own the server process. The database cluster will be initialized with locale \"en_US.UTF-8\". The default database encoding has accordingly been set to \"UTF8\". The default text search configuration will be set to \"english\". Data page checksums are disabled. fixing permissions on existing directory /var/lib/pgdata ... ok creating subdirectories ... ok selecting default max_connections ... 100 selecting default shared_buffers ... 128MB selecting dynamic shared memory implementation ... posix creating configuration files ... ok running bootstrap script ... ok performing post-bootstrap initialization ... ok syncing data to disk ... ok WARNING: enabling \"trust\" authentication for local connections You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb. Success. You can now start the database server using: pg_ctl -D /var/lib/pgdata/ -l logfile start","title":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210"},{"location":"install/#postgresqlconf","text":"\u7d9a\u3044\u3066\u3001PostgreSQL\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b postgresql.conf \u3092\u7de8\u96c6\u3057\u307e\u3059\u3002 PG-Strom\u3092\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u3001\u6700\u4f4e\u9650\u3001\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002 \u3053\u308c\u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u3082\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u7528\u9014\u3084\u60f3\u5b9a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u8e0f\u307e\u3048\u3066\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 shared_preload_libraries PG-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306f shared_preload_libraries \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308apostmaster\u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\u6642\u306b\u30ed\u30fc\u30c9\u3055\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\u306f\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3067\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u9805\u76ee\u306f\u5fc5\u9808\u3067\u3059\u3002 shared_preload_libraries = '$libdir/pg_strom' max_worker_processes PG-Strom\u306f\u6570\u500b\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u3092\u5185\u90e8\u7684\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3067\u3042\u308b 8 \u3067\u306f\u3001\u305d\u308c\u4ee5\u5916\u306e\u51e6\u7406\u306b\u5229\u7528\u3067\u304d\u308b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u6570\u304c\u3042\u307e\u308a\u306b\u3082\u5c11\u306a\u3059\u304e\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 max_worker_processes = 100 shared_buffers \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u3088\u308a\u307e\u3059\u304c\u3001 shared_buffers \u306e\u521d\u671f\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u5c0f\u3055\u3044\u305f\u3081\u3001PG-Strom\u304c\u6709\u52b9\u306b\u6a5f\u80fd\u3059\u308b\u6c34\u6e96\u306e\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306b\u5bfe\u3057\u3066\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u8aad\u307f\u66f8\u304d\u304c\u5f8b\u901f\u8981\u56e0\u3068\u306a\u3063\u3066\u3057\u307e\u3044\u3001GPU\u306e\u4e26\u5217\u8a08\u7b97\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u5229\u7528\u3067\u304d\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 shared_buffers = 10GB \u660e\u3089\u304b\u306b\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u3088\u308a\u3082\u5927\u304d\u306a\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5229\u7528\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 work_mem \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u3088\u308a\u307e\u3059\u304c\u3001 work_mem \u306e\u521d\u671f\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u5c0f\u3055\u3044\u305f\u3081\u3001\u89e3\u6790\u7cfb\u30af\u30a8\u30ea\u3067\u6700\u9069\u306a\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u304c\u9078\u629e\u3055\u308c\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u5178\u578b\u7684\u306a\u4f8b\u306f\u3001\u30bd\u30fc\u30c8\u51e6\u7406\u306b\u30aa\u30f3\u30e1\u30e2\u30ea\u306e\u30af\u30a4\u30c3\u30af\u30bd\u30fc\u30c8\u3067\u306f\u306a\u304f\u3001\u30c7\u30a3\u30b9\u30af\u30d9\u30fc\u30b9\u306e\u30de\u30fc\u30b8\u30bd\u30fc\u30c8\u3092\u9078\u629e\u3059\u308b\u3068\u3044\u3063\u305f\u3082\u306e\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001\u3042\u308b\u7a0b\u5ea6\u306e\u4f59\u88d5\u3092\u6301\u3063\u305f\u5024\u3092\u8a2d\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002 work_mem = 1GB","title":"postgresql.conf\u306e\u7de8\u96c6"},{"location":"install/#os_2","text":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u7279\u306b\u3001\u540c\u6642\u306b\u5927\u91cf\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3059\u308b\u4e8b\u304c\u3042\u308b\u305f\u3081\u3001\u30d7\u30ed\u30bb\u30b9\u3042\u305f\u308a\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u6570\u306e\u4e0a\u9650\u3092\u62e1\u5927\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u307e\u305f\u3001PostgreSQL\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u6642\u306b\u78ba\u5b9f\u306b\u30b3\u30a2\u30c0\u30f3\u30d7\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u3001\u30b3\u30a2\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u4e0a\u9650\u3092\u5236\u9650\u3057\u306a\u3044\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\u3002 PostgreSQL\u3092systemd\u7d4c\u7531\u3067\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u30ea\u30bd\u30fc\u30b9\u5236\u9650\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u306f /etc/systemd/system/postgresql-XX.service.d/pg_strom.conf \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002 RPM\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002 \u74b0\u5883\u5909\u6570 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u304c\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u958b\u767a\u8005\u5411\u3051\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u3053\u308c\u3092\u6709\u52b9\u306b\u3057\u3066\u8d77\u52d5\u3059\u308b\u3068\u3001GPU\u5074\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306bGPU\u306e\u30b3\u30a2\u30c0\u30f3\u30d7\u3092\u751f\u6210\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u8a73\u3057\u304f\u306f CUDA-GDB:GPU core dump support \u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002 [Service] LimitNOFILE=65536 LimitCORE=infinity #Environment=CUDA_ENABLE_COREDUMP_ON_EXCEPTION=1","title":"OS\u306e\u30ea\u30bd\u30fc\u30b9\u5236\u9650\u306e\u62e1\u5f35"},{"location":"install/#postgresql_1","text":"PostgreSQL\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002 \u6b63\u5e38\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308c\u3070\u3001\u30ed\u30b0\u306bPG-Strom\u304cGPU\u3092\u8a8d\u8b58\u3057\u305f\u4e8b\u3092\u793a\u3059\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001Tesla V100(PCIe; 16GB\u7248)\u3092\u8a8d\u8b58\u3057\u3066\u3044\u307e\u3059\u3002 # systemctl start postgresql-10 # systemctl status -l postgresql-10 * postgresql-10.service - PostgreSQL 10 database server Loaded: loaded (/usr/lib/systemd/system/postgresql-10.service; disabled; vendor preset: disabled) Active: active (running) since Sat 2018-03-03 15:45:23 JST; 2min 21s ago Docs: https://www.postgresql.org/docs/10/static/ Process: 24851 ExecStartPre=/usr/pgsql-10/bin/postgresql-10-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS) Main PID: 24858 (postmaster) CGroup: /system.slice/postgresql-10.service |-24858 /usr/pgsql-10/bin/postmaster -D /var/lib/pgsql/10/data/ |-24890 postgres: logger process |-24892 postgres: bgworker: PG-Strom GPU memory keeper |-24896 postgres: checkpointer process |-24897 postgres: writer process |-24898 postgres: wal writer process |-24899 postgres: autovacuum launcher process |-24900 postgres: stats collector process |-24901 postgres: bgworker: PG-Strom ccache-builder2 |-24902 postgres: bgworker: PG-Strom ccache-builder1 `-24903 postgres: bgworker: logical replication launcher Mar 03 15:45:19 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:19.195 JST [24858] HINT: Run 'nvidia-cuda-mps-control -d', then start server process. Check 'man nvidia-cuda-mps-control' for more details. Mar 03 15:45:20 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:20.509 JST [24858] LOG: PG-Strom: GPU0 Tesla V100-PCIE-16GB (5120 CUDA cores; 1380MHz, L2 6144kB), RAM 15.78GB (4096bits, 856MHz), CC 7.0 Mar 03 15:45:20 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:20.510 JST [24858] LOG: NVRTC - CUDA Runtime Compilation vertion 9.1 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.378 JST [24858] LOG: listening on IPv6 address \"::1\", port 5432 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.378 JST [24858] LOG: listening on IPv4 address \"127.0.0.1\", port 5432 Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.442 JST [24858] LOG: listening on Unix socket \"/var/run/postgresql/.s.PGSQL.5432\" Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.492 JST [24858] LOG: listening on Unix socket \"/tmp/.s.PGSQL.5432\" Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.527 JST [24858] LOG: redirecting log output to logging collector process Mar 03 15:45:23 saba.heterodb.com postmaster[24858]: 2018-03-03 15:45:23.527 JST [24858] HINT: Future log output will appear in directory \"log\". Mar 03 15:45:23 saba.heterodb.com systemd[1]: Started PostgreSQL 10 database server.","title":"PostgreSQL\u306e\u8d77\u52d5"},{"location":"install/#pg-strom_2","text":"\u6700\u5f8c\u306b\u3001PG-Strom\u306b\u95a2\u9023\u3059\u308bSQL\u95a2\u6570\u306a\u3069\u306eDB\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u3053\u306e\u624b\u9806\u306fPostgreSQL\u306eEXTENSION\u6a5f\u80fd\u3092\u7528\u3044\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u3066\u304a\u308a\u3001SQL\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 CREATE EXTENSION \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\u3002 \u306a\u304a\u3001\u3053\u306e\u624b\u9806\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u305f\u3073\u306b\u5fc5\u8981\u306b\u306a\u308b\u4e8b\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u305f\u6642\u70b9\u3067\u65e2\u306bPG-Strom\u95a2\u9023\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u3066\u307b\u3057\u3044\u5834\u5408\u306f\u3001\u4e88\u3081 template1 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067PG-Strom\u30a8\u30af\u30b9\u30c6\u30f3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u3066\u304a\u3051\u3070\u3001 CREATE DATABASE \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u306b\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u8a2d\u5b9a\u304c\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002 $ psql postgres -U postgres psql (10.2) Type \"help\" for help. postgres=# CREATE EXTENSION pg_strom ; CREATE EXTENSION \u4ee5\u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002","title":"PG-Strom\u95a2\u9023\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210"},{"location":"install/#nvme-strom","text":"PG-Strom\u3068\u306f\u72ec\u7acb\u3057\u305f\u5225\u500b\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306a\u3069\u3001PG-Strom\u306e\u4e2d\u6838\u6a5f\u80fd\u3068\u5bc6\u63a5\u306b\u95a2\u4fc2\u3057\u3066\u3044\u308bNVME-Strom\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3064\u3044\u3066\u3082\u672c\u7bc0\u3067\u8aac\u660e\u3057\u307e\u3059\u3002","title":"NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb"},{"location":"install/#_6","text":"\u4ed6\u306ePG-Strom\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u540c\u69d8\u3001NVME-Strom\u306f(https://heterodb.github.io/swdc/)[HeteroDB Software Distribution Center]\u304b\u3089\u30d5\u30ea\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3059\u306a\u308f\u3061\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 heterodb-swdc \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u6e08\u307f\u3067\u3042\u308c\u3070\u3001 yum install \u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo yum install nvme_strom Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: mirrors.cat.net * epel: ftp.iij.ad.jp * extras: mirrors.cat.net * ius: mirrors.kernel.org * updates: mirrors.cat.net Resolving Dependencies --> Running transaction check ---> Package nvme_strom.x86_64 0:1.3-1.el7 will be installed --> Finished Dependency Resolution Dependencies Resolved ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: nvme_strom x86_64 1.3-1.el7 heterodb 273 k Transaction Summary ================================================================================ Install 1 Package Total download size: 273 k Installed size: 1.5 M Is this ok [y/d/N]: y Downloading packages: No Presto metadata available for heterodb nvme_strom-1.3-1.el7.x86_64.rpm | 273 kB 00:00 Running transaction check Running transaction test Transaction test succeeded Running transaction Installing : nvme_strom-1.3-1.el7.x86_64 1/1 : <snip> : DKMS: install completed. Verifying : nvme_strom-1.3-1.el7.x86_64 1/1 Installed: nvme_strom.x86_64 0:1.3-1.el7 Complete!","title":"\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5165\u624b\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"install/#_7","text":"NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5168\u3066\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001HeteroDB\u793e\u304c\u63d0\u4f9b\u3059\u308b\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316\u304c\u5fc5\u8981\u3067\u3059\u3002\u30e9\u30a4\u30bb\u30f3\u30b9\u306a\u3057\u3067\u904b\u7528\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u305d\u306e\u5834\u5408\u3001\u4e0b\u8a18\u306e\u6a5f\u80fd\u304c\u5236\u9650\u3092\u53d7\u3051\u307e\u3059\u3002 \u8907\u6570\u500b\u306eGPU\u306e\u5229\u7528 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u304a\u3051\u308b\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0(md-raid0)\u5bfe\u5fdc \u30e9\u30a4\u30bb\u30f3\u30b9\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067HeteroDB\u793e\u304b\u3089\u5165\u624b\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 IAgIVdKxhe+BSer3Y67jQW0+uTzYh00K6WOSH7xQ26Qcw8aeUNYqJB9YcKJTJb+QQhjmUeQpUnboNxVwLCd3HFuLXeBWMKp11/BgG0FSrkUWu/ZCtDtw0F1hEIUY7m767zAGV8y+i7BuNXGJFvRlAkxdVO3/K47ocIgoVkuzBfLvN/h9LffOydUnHPzrFHfLc0r3nNNgtyTrfvoZiXegkGM9GBTAKyq8uWu/OGonh9ybzVKOgofhDLk0rVbLohOXDhMlwDl2oMGIr83tIpCWG+BGE+TDwsJ4n71Sv6n4bi/ZBXBS498qShNHDGrbz6cNcDVBa+EuZc6HzZoF6UrljEcl= ---- VERSION:2 SERIAL_NR:HDB-TRIAL ISSUED_AT:2019-05-09 EXPIRED_AT:2019-06-08 GPU_UUID:GPU-a137b1df-53c9-197f-2801-f2dccaf9d42f \u3053\u308c\u3092 /etc/heterodb.license \u306b\u30b3\u30d4\u30fc\u3057\u3001PostgreSQL\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306bPostgreSQL\u306e\u8d77\u52d5\u30ed\u30b0\u306b\u30e9\u30a4\u30bb\u30f3\u30b9\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u3001\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316\u304c\u884c\u308f\u308c\u305f\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 $ pg_ctl restart : LOG: PG-Strom version 2.2 built for PostgreSQL 11 LOG: PG-Strom: GPU0 Tesla P40 (3840 CUDA cores; 1531MHz, L2 3072kB), RAM 22.38GB (384bits, 3.45GHz), CC 6.1 : LOG: HeteroDB License: { \"version\" : 2, \"serial_nr\" : \"HDB-TRIAL\", \"issued_at\" : \"9-May-2019\", \"expired_at\" : \"8-Jun-2019\", \"gpus\" : [ { \"uuid\" : \"GPU-a137b1df-53c9-197f-2801-f2dccaf9d42f\", \"pci_id\" : \"0000:02:00.0\" } ] } LOG: listening on IPv6 address \"::1\", port 5432 LOG: listening on IPv4 address \"127.0.0.1\", port 5432 :","title":"\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u6709\u52b9\u5316"},{"location":"install/#_8","text":"NVME-Strom\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3042\u308a\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e verbose int 0 \u8a73\u7d30\u306a\u30c7\u30d0\u30c3\u30b0\u51fa\u529b\u3092\u884c\u3044\u307e\u3059\u3002 fast_ssd_mode int 0 \u9ad8\u901f\u306aNVME-SSD\u306b\u9069\u3057\u305f\u52d5\u4f5c\u30e2\u30fc\u30c9\u3067\u3059\u3002 p2p_dma_max_depth int 1024 NVME\u30c7\u30d0\u30a4\u30b9\u306eI/O\u30ad\u30e5\u30fc\u306b\u540c\u6642\u306b\u9001\u51fa\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b\u975e\u540c\u671fDMA\u8981\u6c42\u306e\u6700\u5927\u6570\u3067\u3059\u3002 p2p_dma_max_unitsz int 256 P2P DMA\u8981\u6c42\u3067\u4e00\u5ea6\u306b\u8aad\u307f\u51fa\u3059\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u6700\u5927\u9577\uff08kB\u5358\u4f4d\uff09\u3067\u3059\u3002 fast_ssd_mode \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u306e\u88dc\u8db3\u8aac\u660e\u3092\u4ed8\u8a18\u3057\u307e\u3059\u3002 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u304cSSD-to-GPU\u9593\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u306e\u8981\u6c42\u3092\u53d7\u3051\u53d6\u308b\u3068\u3001\u307e\u305a\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u304cOS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u8f09\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u307e\u3059\u3002 fast_ssd_mode \u304c 0 \u306e\u5834\u5408\u3001\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u304c\u65e2\u306b\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u8f09\u3063\u3066\u3044\u308c\u3070\u3001\u305d\u306e\u5185\u5bb9\u3092\u547c\u3073\u51fa\u3057\u5143\u306e\u30e6\u30fc\u30b6\u7a7a\u9593\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306bCUDA API\u3092\u7528\u3044\u305fHost->Device\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3046\u3088\u3046\u4fc3\u3057\u307e\u3059\u3002\u3053\u308c\u306fPCIe x4\u63a5\u7d9a\u306eNVME-SSD\u306a\u3069\u6bd4\u8f03\u7684\u4f4e\u901f\u306a\u30c7\u30d0\u30a4\u30b9\u5411\u304d\u306e\u52d5\u4f5c\u3067\u3059\u3002 \u4e00\u65b9\u3001PCIe x8\u63a5\u7d9a\u306e\u9ad8\u901fSSD\u3092\u4f7f\u7528\u3057\u305f\u308a\u3001\u8907\u6570\u306eSSD\u3092\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u69cb\u6210\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30d0\u30c3\u30d5\u30a1\u9593\u30b3\u30d4\u30fc\u306e\u5f8c\u3067\u6539\u3081\u3066Host->Device\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3046\u3088\u308a\u3082\u3001SSD-to-GPU\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3063\u305f\u65b9\u304c\u52b9\u7387\u7684\u3067\u3042\u308b\u4e8b\u3082\u3042\u308a\u307e\u3059\u3002 fast_ssd_mode \u304c 0 \u4ee5\u5916\u306e\u5834\u5408\u3001NVME-Strom\u30c9\u30e9\u30a4\u30d0\u306fOS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u72b6\u614b\u306b\u95a2\u308f\u3089\u305a\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u884c\u3044\u307e\u3059\u3002 \u305f\u3060\u3057\u3001\u3044\u304b\u306a\u308b\u5834\u5408\u306b\u304a\u3044\u3066\u3082OS\u306e\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u304c dirty \u3067\u3042\u308b\u5834\u5408\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002 p2p_dma_max_depth \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u95a2\u3059\u308b\u88dc\u8db3\u8aac\u660e\u3092\u4ed8\u8a18\u3057\u307e\u3059\u3002 NVME-Strom\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001SSD-to-GPU\u9593\u306e\u30c0\u30a4\u30ec\u30af\u30c8\u30c7\u30fc\u30bf\u8ee2\u9001\u306eDMA\u8981\u6c42\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u3092NVME\u30c7\u30d0\u30a4\u30b9\u306eI/O\u30ad\u30e5\u30fc\u306b\u9001\u51fa\u3057\u307e\u3059\u3002 NVME\u30c7\u30d0\u30a4\u30b9\u306e\u80fd\u529b\u3092\u8d8a\u3048\u308b\u30da\u30fc\u30b9\u3067\u975e\u540c\u671fDMA\u8981\u6c42\u304c\u6295\u5165\u3055\u308c\u308b\u3068\u3001NVME-SSD\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306fDMA\u8981\u6c42\u3092\u9806\u306b\u51e6\u7406\u3059\u308b\u4e8b\u306b\u306a\u308b\u305f\u3081\u3001DMA\u8981\u6c42\u306e\u30ec\u30a4\u30c6\u30f3\u30b7\u306f\u6975\u3081\u3066\u60aa\u5316\u3057\u307e\u3059\u3002\uff08\u4e00\u65b9\u3001NVME-SSD\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u306f\u5207\u308c\u76ee\u306a\u304fDMA\u8981\u6c42\u304c\u6765\u308b\u305f\u3081\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306f\u6700\u5927\u306b\u306a\u308a\u307e\u3059\uff09 DMA\u8981\u6c42\u306e\u767a\u884c\u304b\u3089\u51e6\u7406\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304f\u308b\u307e\u3067\u306e\u6642\u9593\u304c\u3042\u307e\u308a\u306b\u3082\u9577\u3044\u3068\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u3001\u3053\u308c\u304c\u4f55\u3089\u304b\u306e\u30a8\u30e9\u30fc\u3068\u8aa4\u8a8d\u3055\u308c\u3001I/O\u8981\u6c42\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3068\u30a8\u30e9\u30fc\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001NVME\u30c7\u30d0\u30a4\u30b9\u304c\u904a\u3070\u306a\u3044\u7a0b\u5ea6\u306bDMA\u8981\u6c42\u3092I/O\u30ad\u30e5\u30fc\u306b\u8a70\u3081\u3066\u304a\u3051\u3070\u3001\u305d\u308c\u4ee5\u4e0a\u306eDMA\u8981\u6c42\u3092\u4e00\u5ea6\u306b\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u306e\u306f\u6709\u5bb3\u7121\u76ca\u3068\u3044\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 p2p_dma_max_depth \u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001NVME\u30c7\u30d0\u30a4\u30b9\u6bce\u306b\u3001\u4e00\u5ea6\u306bI/O\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b\u975e\u540c\u671fP2P DMA\u8981\u6c42\u306e\u6570\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002\u8a2d\u5b9a\u5024\u4ee5\u4e0a\u306eDMA\u8981\u6c42\u3092\u6295\u5165\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u30b9\u30ec\u30c3\u30c9\u306f\u73fe\u5728\u5b9f\u884c\u4e2d\u306eDMA\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3001\u305d\u308c\u306b\u3088\u3063\u3066NVME\u30c7\u30d0\u30a4\u30b9\u306e\u9ad8\u8ca0\u8377\u3092\u907f\u3051\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002","title":"\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf"},{"location":"operations/","text":"\u57fa\u672c\u7684\u306a\u64cd\u4f5c GPU\u30aa\u30d5\u30ed\u30fc\u30c9\u306e\u78ba\u8a8d \u30af\u30a8\u30ea\u304cGPU\u3067\u5b9f\u884c\u3055\u308c\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 SQL\u51e6\u7406\u306f\u5185\u90e8\u7684\u306b\u3044\u304f\u3064\u304b\u306e\u8981\u7d20\u306b\u5206\u89e3\u3055\u308c\u51e6\u7406\u3055\u308c\u307e\u3059\u304c\u3001PG-Strom\u304cGPU\u3092\u9069\u7528\u3057\u3066\u4e26\u5217\u51e6\u7406\u3092\u884c\u3046\u306e\u306fSCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3059\u3002\u6a19\u6e96\u3067PostgreSQL\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u5404\u51e6\u7406\u306e\u4ee3\u308f\u308a\u306b\u3001GpuScan\u3001GpuJoin\u3001GpuPreAgg\u304c\u8868\u793a\u3055\u308c\u305f\u5834\u5408\u3001\u305d\u306e\u30af\u30a8\u30ea\u306fGPU\u306b\u3088\u3063\u3066\u51e6\u7406\u3055\u308c\u308b\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306f EXPLAIN \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u4f8b\u3067\u3059\u3002 postgres=# EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 NATURAL JOIN t2 GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=989186.82..989190.94 rows=27 width=20) Group Key: t0.cat -> Sort (cost=989186.82..989187.29 rows=189 width=44) Sort Key: t0.cat -> Custom Scan (GpuPreAgg) (cost=989175.89..989179.67 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on t0 (cost=14744.40..875804.46 rows=99996736 width=12) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=0.00..1833360.36 rows=99996736 width=12) Depth 1: GpuHashJoin (nrows 99996736...99996736) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) Depth 2: GpuHashJoin (nrows 99996736...99996736) HashKeys: t0.bid JoinQuals: (t0.bid = t2.bid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) -> Seq Scan on t2 (cost=0.00..1935.00 rows=100000 width=4) (21 rows) \u5b9f\u884c\u8a08\u753b\u306e\u4e2d\u306b\u898b\u6163\u308c\u306a\u3044\u51e6\u7406\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u4e8b\u306b\u6c17\u304c\u4ed8\u304b\u308c\u305f\u3067\u3057\u3087\u3046\u3002 CustomScan\u6a5f\u69cb\u3092\u7528\u3044\u3066GpuJoin\u304a\u3088\u3073GpuPreAgg\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067GpuJoin\u306f t0 \u3068 t1 \u3001\u304a\u3088\u3073 t2 \u3068\u306eJOIN\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308bGpuPreAgg\u306f\u5217 cat \u306b\u3088\u308bGROUP BY\u51e6\u7406\u3092GPU\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002 PostgreSQL\u304c\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u3092\u69cb\u7bc9\u3059\u308b\u904e\u7a0b\u3067PG-Strom\u306f\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u4ecb\u5165\u3057\u3001SCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u3067\u5b9f\u884c\u53ef\u80fd\u3067\u3042\u308b\u5834\u5408\u3001\u305d\u306e\u30b3\u30b9\u30c8\u3092\u7b97\u51fa\u3057\u3066PostgreSQL\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u5b9f\u884c\u8a08\u753b\u306e\u5019\u88dc\u3092\u63d0\u793a\u3057\u307e\u3059\u3002 \u63a8\u5b9a\u3055\u308c\u305f\u30b3\u30b9\u30c8\u5024\u304cCPU\u3067\u5b9f\u884c\u3059\u308b\u4ed6\u306e\u5b9f\u884c\u8a08\u753b\u3088\u308a\u3082\u5c0f\u3055\u306a\u5024\u3067\u3042\u308b\u5834\u5408\u3001GPU\u3092\u7528\u3044\u305f\u4ee3\u66ff\u306e\u5b9f\u884c\u8a08\u753b\u304c\u63a1\u7528\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u5c11\u306a\u304f\u3068\u3082\u6f14\u7b97\u5f0f\u307e\u305f\u306f\u95a2\u6570\u3001\u304a\u3088\u3073\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u578b\u304cPG-Strom\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 int \u3084 float \u3068\u3044\u3063\u305f\u6570\u5024\u578b\u3001 date \u3084 timestamp \u3068\u3044\u3063\u305f\u65e5\u4ed8\u6642\u523b\u578b\u3001 text \u306e\u3088\u3046\u306a\u6587\u5b57\u5217\u578b\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u304a\u308a\u3001\u307e\u305f\u3001\u56db\u5247\u6f14\u7b97\u3084\u5927\u5c0f\u6bd4\u8f03\u3068\u3044\u3063\u305f\u6570\u591a\u304f\u306e\u30d3\u30eb\u30c8\u30a4\u30f3\u6f14\u7b97\u5b50\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u8a73\u7d30\u306a\u4e00\u89a7\u306b\u95a2\u3057\u3066\u306f \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217 PG-Strom\u306fPostgreSQL\u306eCPU\u4e26\u5217\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 PostgreSQL\u306eCPU\u4e26\u5217\u5b9f\u884c\u306f\u3001Gather\u30ce\u30fc\u30c9\u304c\u3044\u304f\u3064\u304b\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3001\u5404\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u304c\"\u90e8\u5206\u7684\u306b\"\u5b9f\u884c\u3057\u305f\u30af\u30a8\u30ea\u306e\u7d50\u679c\u3092\u5f8c\u3067\u7d50\u5408\u3059\u308b\u5f62\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002 GpuJoin\u3084GpuPreAgg\u3068\u3044\u3063\u305fPG-Strom\u306e\u51e6\u7406\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u5074\u3067\u306e\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u500b\u3005\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u4e92\u3044\u306bGPU\u3092\u4f7f\u7528\u3057\u3066\u51e6\u7406\u3092\u9032\u3081\u307e\u3059\u3002\u901a\u5e38\u3001GPU\u3078\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u305f\u3081\u306b\u500b\u3005\u306eCPU\u30b3\u30a2\u304c\u30d0\u30c3\u30d5\u30a1\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u51e6\u7406\u901f\u5ea6\u306f\u3001GPU\u3067\u306eSQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u51e6\u7406\u901f\u5ea6\u306b\u6bd4\u3079\u3066\u305a\u3063\u3068\u9045\u3044\u305f\u3081\u3001CPU\u4e26\u5217\u3068GPU\u4e26\u5217\u3092\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u3067\u5229\u7528\u3059\u308b\u4e8b\u3067\u51e6\u7406\u901f\u5ea6\u306e\u5411\u4e0a\u304c\u671f\u5f85\u3067\u304d\u307e\u3059\u3002 \u305f\u3060\u3057\u3001GPU\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCUDA\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u5404\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b\u4f5c\u6210\u3055\u308c\u3001CUDA\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u305f\u3073\u306b\u3042\u308b\u7a0b\u5ea6\u306eGPU\u30ea\u30bd\u30fc\u30b9\u304c\u6d88\u8cbb\u3055\u308c\u308b\u305f\u3081\u3001\u5e38\u306bCPU\u4e26\u5217\u5ea6\u304c\u9ad8\u3051\u308c\u3070\u826f\u3044\u3068\u3044\u3046\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002 Gather\u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u304c\u5b9f\u884c\u53ef\u80fd\u306a\u3082\u306e\u3067\u3059\u30021\u5104\u884c\u3092\u4fdd\u6301\u3059\u308b t0 \u30c6\u30fc\u30d6\u30eb\u30924\u30d7\u30ed\u30bb\u30b9\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u3068\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30d7\u30ed\u30bb\u30b9\u3067\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u305f\u3081\u3001\u30d7\u30ed\u30bb\u30b9\u3042\u305f\u308a2000\u4e07\u884c\u3092GpuJoin\u304a\u3088\u3073GpuPreAgg\u3067\u51e6\u7406\u3057\u3001\u305d\u306e\u7d50\u679c\u3092Gather\u30ce\u30fc\u30c9\u3067\u7d50\u5408\u3057\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 GROUP by cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=955705.47..955720.93 rows=27 width=20) Group Key: t0.cat -> Sort (cost=955705.47..955707.36 rows=756 width=44) Sort Key: t0.cat -> Gather (cost=955589.95..955669.33 rows=756 width=44) Workers Planned: 4 -> Parallel Custom Scan (GpuPreAgg) (cost=954589.95..954593.73 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on t0 (cost=27682.82..841218.52 rows=99996736 width=12) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=0.00..1083384.84 rows=24999184 width=8) Depth 1: GpuHashJoin (nrows 24999184...99996736) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (18 rows) \u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052 PG-Strom\u306fSCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u51e6\u7406\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u3053\u308c\u306b\u5bfe\u5fdc\u3059\u308bPostgreSQL\u6a19\u6e96\u306e\u51e6\u7406\u3092\u5358\u7d14\u306b\u7f6e\u304d\u63db\u3048\u305f\u3060\u3051\u3067\u306f\u56f0\u3063\u305f\u4e8b\u614b\u304c\u767a\u751f\u3057\u307e\u3059\u3002 SCAN\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306e\u30c7\u30fc\u30bf\u3092\u3044\u3063\u305f\u3093\u30db\u30b9\u30c8\u5074\u306e\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u3001\u6b21\u306b\u305d\u308c\u3092JOIN\u3059\u308b\u305f\u3081\u306b\u518d\u3073GPU\u3078\u3068\u30b3\u30d4\u30fc\u3057\u3001\u3055\u3089\u306bGROUP BY\u3092\u5b9f\u884c\u3059\u308b\u524d\u306b\u518d\u3073\u30db\u30b9\u30c8\u5074\u306e\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u30fb\u30fb\u30fb\u3068\u3044\u3063\u305f\u5f62\u3067\u3001CPU\u3068GPU\u306e\u9593\u3067\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3059\u3002 \u3053\u308c\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001PG-Strom\u306f\u4e0b\u4f4d\u30d7\u30e9\u30f3\u3092\u5f15\u304d\u4e0a\u3052\u3066\u4e00\u5ea6\u306eGPU Kernel\u306e\u5b9f\u884c\u3067\u51e6\u7406\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u30e2\u30fc\u30c9\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 SCAN + JOIN SCAN + GROUP BY SCAN + JOIN + GROUP BY \u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u3001\u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052\u3092\u5168\u304f\u884c\u308f\u306a\u3044\u30b1\u30fc\u30b9\u3067\u3059\u3002 GpuScan\u306e\u5b9f\u884c\u7d50\u679c\u3092GpuJoin\u304c\u53d7\u53d6\u308a\u3001\u3055\u3089\u306b\u305d\u306e\u5b9f\u884c\u7d50\u679c\u3092GpuPreAgg\u304c\u53d7\u3051\u53d6\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u751f\u6210\u3059\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 WHERE aid < bid GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=1239991.03..1239995.15 rows=27 width=20) Group Key: t0.cat -> Sort (cost=1239991.03..1239991.50 rows=189 width=44) Sort Key: t0.cat -> Custom Scan (GpuPreAgg) (cost=1239980.10..1239983.88 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) -> Custom Scan (GpuJoin) (cost=50776.43..1199522.96 rows=33332245 width=12) GPU Projection: t0.cat, t1.ax Depth 1: GpuHashJoin (nrows 33332245...33332245) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) -> Custom Scan (GpuScan) on t0 (cost=12634.49..1187710.85 rows=33332245 width=8) GPU Projection: cat, aid GPU Filter: (aid < bid) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (18 rows) \u3053\u306e\u5834\u5408\u3001\u5404\u5b9f\u884c\u30b9\u30c6\u30fc\u30b8\u306b\u304a\u3044\u3066GPU\u3068\u30db\u30b9\u30c8\u30d0\u30c3\u30d5\u30a1\u306e\u9593\u3067\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u304c\u767a\u751f\u3059\u308b\u305f\u3081\u3001\u5b9f\u884c\u52b9\u7387\u306f\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u4e00\u65b9\u3001\u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u3001\u4e0b\u4f4d\u30ce\u30fc\u30c9\u306e\u5f15\u304d\u4e0a\u3052\u3092\u884c\u3063\u305f\u3082\u306e\u3067\u3059\u3002 # EXPLAIN ANALYZE SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 WHERE aid < bid GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=903669.50..903673.62 rows=27 width=20) (actual time=7761.630..7761.644 rows=27 loops=1) Group Key: t0.cat -> Sort (cost=903669.50..903669.97 rows=189 width=44) (actual time=7761.621..7761.626 rows=27 loops=1) Sort Key: t0.cat Sort Method: quicksort Memory: 28kB -> Custom Scan (GpuPreAgg) (cost=903658.57..903662.35 rows=189 width=44) (actual time=7761.531..7761.540 rows=27 loops=1) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on t0 (cost=12483.41..863201.43 rows=33332245 width=12) (never executed) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=12634.49..1187710.85 rows=33332245 width=8) (actual time=59.623..5557.052 rows=100000000 loops=1) Outer Scan Filter: (aid < bid) Rows Removed by Outer Scan Filter: 50002874 Depth 1: GpuHashJoin (plan nrows: 33332245...33332245, actual nrows: 49997126...49997126) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size plan: 10.39MB, exec: 64.00MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (actual time=0.013..15.303 rows=100000 loops=1) Planning time: 0.506 ms Execution time: 8495.391 ms (21 rows) \u307e\u305a\u3001\u30c6\u30fc\u30d6\u30eb t0 \u3078\u306e\u30b9\u30ad\u30e3\u30f3\u304cGpuJoin\u306e\u5b9f\u884c\u8a08\u753b\u306b\u57cb\u3081\u8fbc\u307e\u308c\u3001GpuScan\u304c\u6d88\u3048\u3066\u3044\u308b\u4e8b\u306b\u304a\u6c17\u4ed8\u304d\u3067\u3057\u3087\u3046\u3002 \u3053\u308c\u306fGpuJoin\u304c\u914d\u4e0b\u306eGpuScan\u3092\u5f15\u304d\u4e0a\u3052\u3001\u4e00\u4f53\u5316\u3057\u305fGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3067WHERE\u53e5\u306e\u51e6\u7406\u3082\u884c\u3063\u305f\u4e8b\u3092\u610f\u5473\u3057\u3066\u3044\u307e\u3059\u3002 \u52a0\u3048\u3066\u5947\u5999\u306a\u3053\u3068\u306b\u3001 EXPLAIN ANALYZE \u306e\u7d50\u679c\u306b\u306fGpuJoin\u304c(never executed)\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306fGpuPreAgg\u304c\u914d\u4e0b\u306eGpuJoin\u3092\u5f15\u304d\u4e0a\u3052\u3001\u4e00\u4f53\u5316\u3057\u305fGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3067JOIN\u3068GROUP BY\u3092\u5b9f\u884c\u3057\u305f\u4e8b\u3092\u610f\u5473\u3057\u3066\u3044\u307e\u3059\u3002 SCAN\u51e6\u7406\u306e\u5f15\u304d\u4e0a\u3052\u306f pg_strom.pullup_outer_scan \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u307e\u305f\u3001JOIN\u51e6\u7406\u306e\u5f15\u304d\u4e0a\u3052\u306f pg_strom.pullup_outer_join \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u3044\u305a\u308c\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f on \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001\u901a\u5e38\u306f\u3053\u308c\u3092\u7121\u52b9\u5316\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30c8\u30e9\u30d6\u30eb\u6642\u306e\u554f\u984c\u5207\u308a\u5206\u3051\u624b\u6bb5\u306e\u4e00\u3064\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002","title":"\u57fa\u672c\u7684\u306a\u64cd\u4f5c"},{"location":"operations/#gpu","text":"\u30af\u30a8\u30ea\u304cGPU\u3067\u5b9f\u884c\u3055\u308c\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 SQL\u51e6\u7406\u306f\u5185\u90e8\u7684\u306b\u3044\u304f\u3064\u304b\u306e\u8981\u7d20\u306b\u5206\u89e3\u3055\u308c\u51e6\u7406\u3055\u308c\u307e\u3059\u304c\u3001PG-Strom\u304cGPU\u3092\u9069\u7528\u3057\u3066\u4e26\u5217\u51e6\u7406\u3092\u884c\u3046\u306e\u306fSCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3059\u3002\u6a19\u6e96\u3067PostgreSQL\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u5404\u51e6\u7406\u306e\u4ee3\u308f\u308a\u306b\u3001GpuScan\u3001GpuJoin\u3001GpuPreAgg\u304c\u8868\u793a\u3055\u308c\u305f\u5834\u5408\u3001\u305d\u306e\u30af\u30a8\u30ea\u306fGPU\u306b\u3088\u3063\u3066\u51e6\u7406\u3055\u308c\u308b\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306f EXPLAIN \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u4f8b\u3067\u3059\u3002 postgres=# EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 NATURAL JOIN t2 GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=989186.82..989190.94 rows=27 width=20) Group Key: t0.cat -> Sort (cost=989186.82..989187.29 rows=189 width=44) Sort Key: t0.cat -> Custom Scan (GpuPreAgg) (cost=989175.89..989179.67 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on t0 (cost=14744.40..875804.46 rows=99996736 width=12) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=0.00..1833360.36 rows=99996736 width=12) Depth 1: GpuHashJoin (nrows 99996736...99996736) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) Depth 2: GpuHashJoin (nrows 99996736...99996736) HashKeys: t0.bid JoinQuals: (t0.bid = t2.bid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) -> Seq Scan on t2 (cost=0.00..1935.00 rows=100000 width=4) (21 rows) \u5b9f\u884c\u8a08\u753b\u306e\u4e2d\u306b\u898b\u6163\u308c\u306a\u3044\u51e6\u7406\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u4e8b\u306b\u6c17\u304c\u4ed8\u304b\u308c\u305f\u3067\u3057\u3087\u3046\u3002 CustomScan\u6a5f\u69cb\u3092\u7528\u3044\u3066GpuJoin\u304a\u3088\u3073GpuPreAgg\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067GpuJoin\u306f t0 \u3068 t1 \u3001\u304a\u3088\u3073 t2 \u3068\u306eJOIN\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308bGpuPreAgg\u306f\u5217 cat \u306b\u3088\u308bGROUP BY\u51e6\u7406\u3092GPU\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002 PostgreSQL\u304c\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u3092\u69cb\u7bc9\u3059\u308b\u904e\u7a0b\u3067PG-Strom\u306f\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u4ecb\u5165\u3057\u3001SCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u3067\u5b9f\u884c\u53ef\u80fd\u3067\u3042\u308b\u5834\u5408\u3001\u305d\u306e\u30b3\u30b9\u30c8\u3092\u7b97\u51fa\u3057\u3066PostgreSQL\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u5b9f\u884c\u8a08\u753b\u306e\u5019\u88dc\u3092\u63d0\u793a\u3057\u307e\u3059\u3002 \u63a8\u5b9a\u3055\u308c\u305f\u30b3\u30b9\u30c8\u5024\u304cCPU\u3067\u5b9f\u884c\u3059\u308b\u4ed6\u306e\u5b9f\u884c\u8a08\u753b\u3088\u308a\u3082\u5c0f\u3055\u306a\u5024\u3067\u3042\u308b\u5834\u5408\u3001GPU\u3092\u7528\u3044\u305f\u4ee3\u66ff\u306e\u5b9f\u884c\u8a08\u753b\u304c\u63a1\u7528\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u5c11\u306a\u304f\u3068\u3082\u6f14\u7b97\u5f0f\u307e\u305f\u306f\u95a2\u6570\u3001\u304a\u3088\u3073\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u578b\u304cPG-Strom\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 int \u3084 float \u3068\u3044\u3063\u305f\u6570\u5024\u578b\u3001 date \u3084 timestamp \u3068\u3044\u3063\u305f\u65e5\u4ed8\u6642\u523b\u578b\u3001 text \u306e\u3088\u3046\u306a\u6587\u5b57\u5217\u578b\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u304a\u308a\u3001\u307e\u305f\u3001\u56db\u5247\u6f14\u7b97\u3084\u5927\u5c0f\u6bd4\u8f03\u3068\u3044\u3063\u305f\u6570\u591a\u304f\u306e\u30d3\u30eb\u30c8\u30a4\u30f3\u6f14\u7b97\u5b50\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u8a73\u7d30\u306a\u4e00\u89a7\u306b\u95a2\u3057\u3066\u306f \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"GPU\u30aa\u30d5\u30ed\u30fc\u30c9\u306e\u78ba\u8a8d"},{"location":"operations/#cpugpu","text":"PG-Strom\u306fPostgreSQL\u306eCPU\u4e26\u5217\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 PostgreSQL\u306eCPU\u4e26\u5217\u5b9f\u884c\u306f\u3001Gather\u30ce\u30fc\u30c9\u304c\u3044\u304f\u3064\u304b\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3001\u5404\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u304c\"\u90e8\u5206\u7684\u306b\"\u5b9f\u884c\u3057\u305f\u30af\u30a8\u30ea\u306e\u7d50\u679c\u3092\u5f8c\u3067\u7d50\u5408\u3059\u308b\u5f62\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002 GpuJoin\u3084GpuPreAgg\u3068\u3044\u3063\u305fPG-Strom\u306e\u51e6\u7406\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u5074\u3067\u306e\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u500b\u3005\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u4e92\u3044\u306bGPU\u3092\u4f7f\u7528\u3057\u3066\u51e6\u7406\u3092\u9032\u3081\u307e\u3059\u3002\u901a\u5e38\u3001GPU\u3078\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u305f\u3081\u306b\u500b\u3005\u306eCPU\u30b3\u30a2\u304c\u30d0\u30c3\u30d5\u30a1\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u51e6\u7406\u901f\u5ea6\u306f\u3001GPU\u3067\u306eSQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u51e6\u7406\u901f\u5ea6\u306b\u6bd4\u3079\u3066\u305a\u3063\u3068\u9045\u3044\u305f\u3081\u3001CPU\u4e26\u5217\u3068GPU\u4e26\u5217\u3092\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u3067\u5229\u7528\u3059\u308b\u4e8b\u3067\u51e6\u7406\u901f\u5ea6\u306e\u5411\u4e0a\u304c\u671f\u5f85\u3067\u304d\u307e\u3059\u3002 \u305f\u3060\u3057\u3001GPU\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCUDA\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u5404\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b\u4f5c\u6210\u3055\u308c\u3001CUDA\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u305f\u3073\u306b\u3042\u308b\u7a0b\u5ea6\u306eGPU\u30ea\u30bd\u30fc\u30b9\u304c\u6d88\u8cbb\u3055\u308c\u308b\u305f\u3081\u3001\u5e38\u306bCPU\u4e26\u5217\u5ea6\u304c\u9ad8\u3051\u308c\u3070\u826f\u3044\u3068\u3044\u3046\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002 Gather\u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u304c\u5b9f\u884c\u53ef\u80fd\u306a\u3082\u306e\u3067\u3059\u30021\u5104\u884c\u3092\u4fdd\u6301\u3059\u308b t0 \u30c6\u30fc\u30d6\u30eb\u30924\u30d7\u30ed\u30bb\u30b9\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u3068\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30d7\u30ed\u30bb\u30b9\u3067\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u305f\u3081\u3001\u30d7\u30ed\u30bb\u30b9\u3042\u305f\u308a2000\u4e07\u884c\u3092GpuJoin\u304a\u3088\u3073GpuPreAgg\u3067\u51e6\u7406\u3057\u3001\u305d\u306e\u7d50\u679c\u3092Gather\u30ce\u30fc\u30c9\u3067\u7d50\u5408\u3057\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 GROUP by cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=955705.47..955720.93 rows=27 width=20) Group Key: t0.cat -> Sort (cost=955705.47..955707.36 rows=756 width=44) Sort Key: t0.cat -> Gather (cost=955589.95..955669.33 rows=756 width=44) Workers Planned: 4 -> Parallel Custom Scan (GpuPreAgg) (cost=954589.95..954593.73 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on t0 (cost=27682.82..841218.52 rows=99996736 width=12) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=0.00..1083384.84 rows=24999184 width=8) Depth 1: GpuHashJoin (nrows 24999184...99996736) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (18 rows)","title":"CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217"},{"location":"operations/#_1","text":"PG-Strom\u306fSCAN\u3001JOIN\u3001GROUP BY\u306e\u5404\u51e6\u7406\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u3053\u308c\u306b\u5bfe\u5fdc\u3059\u308bPostgreSQL\u6a19\u6e96\u306e\u51e6\u7406\u3092\u5358\u7d14\u306b\u7f6e\u304d\u63db\u3048\u305f\u3060\u3051\u3067\u306f\u56f0\u3063\u305f\u4e8b\u614b\u304c\u767a\u751f\u3057\u307e\u3059\u3002 SCAN\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306e\u30c7\u30fc\u30bf\u3092\u3044\u3063\u305f\u3093\u30db\u30b9\u30c8\u5074\u306e\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u3001\u6b21\u306b\u305d\u308c\u3092JOIN\u3059\u308b\u305f\u3081\u306b\u518d\u3073GPU\u3078\u3068\u30b3\u30d4\u30fc\u3057\u3001\u3055\u3089\u306bGROUP BY\u3092\u5b9f\u884c\u3059\u308b\u524d\u306b\u518d\u3073\u30db\u30b9\u30c8\u5074\u306e\u30d0\u30c3\u30d5\u30a1\u306b\u66f8\u304d\u623b\u3057\u30fb\u30fb\u30fb\u3068\u3044\u3063\u305f\u5f62\u3067\u3001CPU\u3068GPU\u306e\u9593\u3067\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3059\u3002 \u3053\u308c\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001PG-Strom\u306f\u4e0b\u4f4d\u30d7\u30e9\u30f3\u3092\u5f15\u304d\u4e0a\u3052\u3066\u4e00\u5ea6\u306eGPU Kernel\u306e\u5b9f\u884c\u3067\u51e6\u7406\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u30e2\u30fc\u30c9\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 SCAN + JOIN SCAN + GROUP BY SCAN + JOIN + GROUP BY \u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u3001\u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052\u3092\u5168\u304f\u884c\u308f\u306a\u3044\u30b1\u30fc\u30b9\u3067\u3059\u3002 GpuScan\u306e\u5b9f\u884c\u7d50\u679c\u3092GpuJoin\u304c\u53d7\u53d6\u308a\u3001\u3055\u3089\u306b\u305d\u306e\u5b9f\u884c\u7d50\u679c\u3092GpuPreAgg\u304c\u53d7\u3051\u53d6\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u751f\u6210\u3059\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 WHERE aid < bid GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=1239991.03..1239995.15 rows=27 width=20) Group Key: t0.cat -> Sort (cost=1239991.03..1239991.50 rows=189 width=44) Sort Key: t0.cat -> Custom Scan (GpuPreAgg) (cost=1239980.10..1239983.88 rows=189 width=44) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) -> Custom Scan (GpuJoin) (cost=50776.43..1199522.96 rows=33332245 width=12) GPU Projection: t0.cat, t1.ax Depth 1: GpuHashJoin (nrows 33332245...33332245) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size: 10.39MB) -> Custom Scan (GpuScan) on t0 (cost=12634.49..1187710.85 rows=33332245 width=8) GPU Projection: cat, aid GPU Filter: (aid < bid) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (18 rows) \u3053\u306e\u5834\u5408\u3001\u5404\u5b9f\u884c\u30b9\u30c6\u30fc\u30b8\u306b\u304a\u3044\u3066GPU\u3068\u30db\u30b9\u30c8\u30d0\u30c3\u30d5\u30a1\u306e\u9593\u3067\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u304c\u767a\u751f\u3059\u308b\u305f\u3081\u3001\u5b9f\u884c\u52b9\u7387\u306f\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u4e00\u65b9\u3001\u4ee5\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u306f\u3001\u4e0b\u4f4d\u30ce\u30fc\u30c9\u306e\u5f15\u304d\u4e0a\u3052\u3092\u884c\u3063\u305f\u3082\u306e\u3067\u3059\u3002 # EXPLAIN ANALYZE SELECT cat,count(*),avg(ax) FROM t0 NATURAL JOIN t1 WHERE aid < bid GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- GroupAggregate (cost=903669.50..903673.62 rows=27 width=20) (actual time=7761.630..7761.644 rows=27 loops=1) Group Key: t0.cat -> Sort (cost=903669.50..903669.97 rows=189 width=44) (actual time=7761.621..7761.626 rows=27 loops=1) Sort Key: t0.cat Sort Method: quicksort Memory: 28kB -> Custom Scan (GpuPreAgg) (cost=903658.57..903662.35 rows=189 width=44) (actual time=7761.531..7761.540 rows=27 loops=1) Reduction: Local GPU Projection: cat, pgstrom.nrows(), pgstrom.nrows((ax IS NOT NULL)), pgstrom.psum(ax) Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on t0 (cost=12483.41..863201.43 rows=33332245 width=12) (never executed) GPU Projection: t0.cat, t1.ax Outer Scan: t0 (cost=12634.49..1187710.85 rows=33332245 width=8) (actual time=59.623..5557.052 rows=100000000 loops=1) Outer Scan Filter: (aid < bid) Rows Removed by Outer Scan Filter: 50002874 Depth 1: GpuHashJoin (plan nrows: 33332245...33332245, actual nrows: 49997126...49997126) HashKeys: t0.aid JoinQuals: (t0.aid = t1.aid) KDS-Hash (size plan: 10.39MB, exec: 64.00MB) -> Seq Scan on t1 (cost=0.00..1972.85 rows=103785 width=12) (actual time=0.013..15.303 rows=100000 loops=1) Planning time: 0.506 ms Execution time: 8495.391 ms (21 rows) \u307e\u305a\u3001\u30c6\u30fc\u30d6\u30eb t0 \u3078\u306e\u30b9\u30ad\u30e3\u30f3\u304cGpuJoin\u306e\u5b9f\u884c\u8a08\u753b\u306b\u57cb\u3081\u8fbc\u307e\u308c\u3001GpuScan\u304c\u6d88\u3048\u3066\u3044\u308b\u4e8b\u306b\u304a\u6c17\u4ed8\u304d\u3067\u3057\u3087\u3046\u3002 \u3053\u308c\u306fGpuJoin\u304c\u914d\u4e0b\u306eGpuScan\u3092\u5f15\u304d\u4e0a\u3052\u3001\u4e00\u4f53\u5316\u3057\u305fGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3067WHERE\u53e5\u306e\u51e6\u7406\u3082\u884c\u3063\u305f\u4e8b\u3092\u610f\u5473\u3057\u3066\u3044\u307e\u3059\u3002 \u52a0\u3048\u3066\u5947\u5999\u306a\u3053\u3068\u306b\u3001 EXPLAIN ANALYZE \u306e\u7d50\u679c\u306b\u306fGpuJoin\u304c(never executed)\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306fGpuPreAgg\u304c\u914d\u4e0b\u306eGpuJoin\u3092\u5f15\u304d\u4e0a\u3052\u3001\u4e00\u4f53\u5316\u3057\u305fGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3067JOIN\u3068GROUP BY\u3092\u5b9f\u884c\u3057\u305f\u4e8b\u3092\u610f\u5473\u3057\u3066\u3044\u307e\u3059\u3002 SCAN\u51e6\u7406\u306e\u5f15\u304d\u4e0a\u3052\u306f pg_strom.pullup_outer_scan \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u307e\u305f\u3001JOIN\u51e6\u7406\u306e\u5f15\u304d\u4e0a\u3052\u306f pg_strom.pullup_outer_join \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u3044\u305a\u308c\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f on \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001\u901a\u5e38\u306f\u3053\u308c\u3092\u7121\u52b9\u5316\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30c8\u30e9\u30d6\u30eb\u6642\u306e\u554f\u984c\u5207\u308a\u5206\u3051\u624b\u6bb5\u306e\u4e00\u3064\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002","title":"\u4e0b\u4f4d\u30d7\u30e9\u30f3\u306e\u5f15\u304d\u4e0a\u3052"},{"location":"partition/","text":"\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0 \u672c\u7ae0\u3067\u306fPostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u6a5f\u80fd\u3068PG-Strom\u3092\u4f75\u7528\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u306a\u304a\u3001\u672c\u7ae0\u306e\u5185\u5bb9\u306f PostgreSQL v11\u4ee5\u964d \u3067PG-Strom\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306b\u306e\u307f\u6709\u52b9\u3067\u3059\u3002 PostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u6a5f\u80fd\u306b\u3064\u3044\u3066\u3001\u8a73\u3057\u304f\u306f PostgreSQL\u6587\u66f8\uff1a\u30c6\u30fc\u30d6\u30eb\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u6982\u8981 PostgreSQL v10\u306b\u304a\u3044\u3066\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u6a5f\u80fd\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f\u3002 \u3053\u308c\u306f\u3001\u8ad6\u7406\u7684\u306b\u306f\u4e00\u500b\u306e\u5927\u304d\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3042\u308b\u3082\u306e\u3092\u7269\u7406\u7684\u306b\u3088\u308a\u5c0f\u3055\u306a\u30c6\u30fc\u30d6\u30eb\u306b\u5206\u5272\u3057\u3066\u683c\u7d0d\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3001\u691c\u7d22\u6761\u4ef6\u3088\u308a\u660e\u3089\u304b\u306b\u30b9\u30ad\u30e3\u30f3\u306e\u5fc5\u8981\u304c\u306a\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u305f\u308a\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u7269\u7406\u7684\u306b\u5206\u6563\u3055\u305b\u308b\u4e8b\u3067\u3088\u308a\u5e83\u3044I/O\u5e2f\u57df\u3092\u78ba\u4fdd\u3059\u308b\u306a\u3069\u306e\u5229\u70b9\u304c\u3042\u308a\u307e\u3059\u3002 PostgreSQL v10\u3067\u306f\u7bc4\u56f2\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3001\u30ea\u30b9\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u306e2\u7a2e\u985e\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3001\u3055\u3089\u306bPostgreSQL v11\u3067\u306f\u30cf\u30c3\u30b7\u30e5\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u306b\u52a0\u3048\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u540c\u58eb\u306eJOIN\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u56f3\u306f\u3001\u65e5\u4ed8\u578b\uff08DATE\u578b\uff09\u306e\u30ad\u30fc\u5024\u3092\u7528\u3044\u305f\u7bc4\u56f2\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002 \u30ad\u30fc\u5024 2018-05-30 \u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb tbl_2018 \u306b\u632f\u308a\u5206\u3051\u3089\u308c\u3001\u540c\u69d8\u306b\u3001\u30ad\u30fc\u5024 2014-03-21 \u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb tbl_2014 \u306b\u632f\u308a\u5206\u3051\u3089\u308c\u308b\u30fb\u30fb\u30fb\u3068\u3044\u3063\u305f\u5177\u5408\u3067\u3059\u3002 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u6642\u3001\u4f8b\u3048\u3070 WHERE ymd > '2016-07-01'::date \u3068\u3044\u3046\u6761\u4ef6\u53e5\u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u308b\u3068\u3001 tbl_2014 \u304a\u3088\u3073 tbl_2015 \u306b\u8a72\u5f53\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u306a\u3044\u4e8b\u306f\u81ea\u660e\u3067\u3059\u306e\u3067\u3001PostgreSQL\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306f tbl_2016 \u3001 tbl_2017 \u3001 tbl_2018 \u3060\u3051\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3001\u305d\u306e\u7d50\u679c\u3092\u7d50\u5408\u3059\u308b Append \u30ce\u30fc\u30c9\u3092\u631f\u3080\u4e8b\u3067\u3001\u3042\u305f\u304b\u3082\u5358\u4e00\u306e\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u30ec\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u51fa\u3057\u305f\u304b\u306e\u3088\u3046\u306b\u632f\u821e\u3046\u5b9f\u884c\u8a08\u753b\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 PostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3068PG-Strom\u3092\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u307e\u305a\u3001\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u3067\u3042\u308b\u3068\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u304c\u5224\u65ad\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u5bfe\u3057\u3001\u500b\u3005\u306b\u5b9f\u884c\u30b3\u30b9\u30c8\u3092\u63a8\u5b9a\u3057\u305f\u4e0a\u3067 GpuScan \u304c\u9078\u629e\u3055\u308c\u308b\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001 GpuScan \u306e\u5b9f\u884c\u7d50\u679c\u3092 Append \u30ce\u30fc\u30c9\u3067\u675f\u306d\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u305f\u3060\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u7d9a\u304d\u3001JOIN\u3084GROUP BY\u306a\u3069PG-Strom\u3067\u9ad8\u901f\u5316\u304c\u53ef\u80fd\u306a\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u6700\u9069\u5316\u306e\u89b3\u70b9\u304b\u3089\u691c\u8a0e\u304c\u5fc5\u8981\u3067\u3059\u3002 \u4f8b\u3048\u3070\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u3066\u3044\u306a\u3044\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u5225\u306e\u30c6\u30fc\u30d6\u30eb\u3068JOIN\u3057\u3001GROUP BY\u306b\u3088\u308b\u96c6\u8a08\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u5834\u5408\u3001\u6761\u4ef6\u304c\u63c3\u3048\u3070\u3001\u5404\u30b9\u30c6\u30c3\u30d7\u9593\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u306fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u3067\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306fGPU\u3068CPU\u306e\u9593\u306e\u30c7\u30fc\u30bf\u79fb\u52d5\u3092\u6700\u5c0f\u5316\u3059\u308b\u3068\u3044\u3046\u89b3\u70b9\u304b\u3089\u3001\u6700\u3082PG-Strom\u304c\u5f97\u610f\u3068\u3059\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3059\u3002 \u4e00\u65b9\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u540c\u69d8\u306e\u51e6\u7406\u3092\u884c\u3046\u5834\u5408\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u3068JOIN\u3084GROUP BY\u306e\u9593\u306b Append \u51e6\u7406\u304c\u631f\u307e\u3063\u3066\u3057\u307e\u3046\u306e\u304c\u8ab2\u984c\u3067\u3059\u3002\u3053\u306e\u5b9f\u884c\u8a08\u753b\u306e\u4e0b\u3067\u306f\u3001GpuScan\u304c\u51e6\u7406\u3057\u305f\u30c7\u30fc\u30bf\u3092\u4e00\u5ea6\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u3078\u8ee2\u9001\u3057\u3001 Append \u51e6\u7406\u3092\u884c\u3063\u305f\u4e0a\u3067\u3001\u305d\u306e\u5f8c\u306eGpuJoin\u3084GpuPreAgg\u51e6\u7406\u3092\u884c\u3046\u305f\u3081\u306b\u518d\u3073\u30c7\u30fc\u30bf\u3092GPU\u3078\u8ee2\u9001\u3059\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u6c7a\u3057\u3066\u52b9\u7387\u306e\u826f\u3044\u51e6\u7406\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u306e\u3088\u3046\u306aCPU-GPU\u9593\u306e\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u3092\u907f\u3051\u308b\u305f\u3081\u3001PG-Strom\u306f\u53ef\u80fd\u306a\u9650\u308aJOIN\u3084GROUP BY\u3092 Append \u3088\u308a\u3082\u5148\u306b\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3092\u8a66\u307f\u307e\u3059\u3002 \u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u304c\u6210\u529f\u308c\u3070\u3001\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u52b9\u7387\u5316\u3067\u304d\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u7279\u306bGROUP BY\u51e6\u7406\u306b\u3088\u3063\u3066\u884c\u6570\u3092\u5927\u5e45\u306b\u524a\u6e1b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308b\u305f\u3081\u3001 Append \u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u306e\u8ca0\u8377\u3092\u9855\u8457\u306b\u6e1b\u3089\u3059\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u65e5\u4ed8\u578b\uff08date\u578b\uff09\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 ymd \u3092\u30ad\u30fc\u3068\u3057\u3066\u5e74\u5358\u4f4d\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b pt \u306b\u5bfe\u3057\u3066\u3001JOIN\u3068GROUP BY\u3092\u542b\u3080\u30af\u30a8\u30ea\u3092\u6295\u5165\u3057\u305f\u6642\u306e\u5b9f\u884c\u8a08\u753b\u3067\u3059\u3002 \u691c\u7d22\u6761\u4ef6\u306b\u3088\u308a2016\u5e74\u4ee5\u524d\u306e\u30c7\u30fc\u30bf\u3092\u542b\u3080\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306f\u81ea\u660e\u306b\u6392\u9664\u3055\u308c\u3001\u3055\u3089\u306b pt_2017 \u3001 pt_2018 \u3001 pt_2019 \u5404\u30c6\u30fc\u30d6\u30eb\u306eJOIN\u3068GROUP BY\u51e6\u7406\u304c\u4e00\u4f53\u3068\u306a\u3063\u3066 Append \u306e\u524d\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM pt NATURAL JOIN t1 WHERE ymd > '2017-01-01'::date GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- HashAggregate (cost=196410.07..196412.57 rows=200 width=48) Group Key: pt_2017.cat -> Gather (cost=66085.69..196389.07 rows=1200 width=72) Workers Planned: 2 -> Parallel Append (cost=65085.69..195269.07 rows=600 width=72) -> Parallel Custom Scan (GpuPreAgg) (cost=65085.69..65089.69 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2017 (cost=32296.64..74474.20 rows=1050772 width=40) Outer Scan: pt_2017 (cost=28540.80..66891.11 rows=1050772 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050772...2521854) HashKeys: pt_2017.aid JoinQuals: (pt_2017.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) -> Parallel Custom Scan (GpuPreAgg) (cost=65078.35..65082.35 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2018 (cost=32296.65..74465.75 rows=1050649 width=40) Outer Scan: pt_2018 (cost=28540.81..66883.43 rows=1050649 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050649...2521557) HashKeys: pt_2018.aid JoinQuals: (pt_2018.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) -> Parallel Custom Scan (GpuPreAgg) (cost=65093.03..65097.03 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2019 (cost=32296.65..74482.64 rows=1050896 width=40) Outer Scan: pt_2019 (cost=28540.80..66898.79 rows=1050896 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050896...2522151) HashKeys: pt_2019.aid JoinQuals: (pt_2019.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) (38 rows) \u8a2d\u5b9a\u3068\u904b\u7528 \u4ee5\u4e0b\u306eGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308a\u3001PG-Strom\u306fJOIN\u3084GROUP BY\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enable_partitionwise_gpujoin bool on GpuJoin\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.enable_partitionwise_gpupreagg bool on GpuPreAgg\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 \u3053\u308c\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u521d\u671f\u5024\u306f on \u3067\u3059\u304c\u3001\u3053\u308c\u3092 off \u306b\u3057\u305f\u5834\u5408\u3001\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u51e6\u7406\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002 EXPLAIN\u30b3\u30de\u30f3\u30c9\u3067\u524d\u7bc0\u306e\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3057\u305f\u3068\u3053\u308d\u3001\u5b9f\u884c\u8a08\u753b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u5316\u3057\u3066\u3044\u307e\u3059\u3002 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u306f GpuScan \u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u51e6\u7406\u7d50\u679c\u306f\u4e00\u5ea6\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u306b\u8fd4\u3055\u308c\u3001 Append \u306b\u3088\u3063\u3066\u7d50\u5408\u3055\u308c\u305f\u5f8c\u3001\u518d\u3073 GpuJoin \u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306bGPU\u3078\u3068\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002 postgres=# set pg_strom.enable_partitionwise_gpujoin = off; SET postgres=# set pg_strom.enable_partitionwise_gpupreagg = off; SET postgres=# EXPLAIN SELECT cat,count(*),avg(ax) FROM pt NATURAL JOIN t1 WHERE ymd > '2017-01-01'::date group by cat; QUERY PLAN -------------------------------------------------------------------------------------------------------------------------------- Finalize GroupAggregate (cost=341392.92..341399.42 rows=200 width=48) Group Key: pt.cat -> Sort (cost=341392.92..341393.92 rows=400 width=72) Sort Key: pt.cat -> Gather (cost=341333.63..341375.63 rows=400 width=72) Workers Planned: 2 -> Partial HashAggregate (cost=340333.63..340335.63 rows=200 width=72) Group Key: pt.cat -> Parallel Custom Scan (GpuJoin) (cost=283591.92..283591.92 rows=7565562 width=40) Depth 1: GpuHashJoin (nrows 3152318...7565562) HashKeys: pt.aid JoinQuals: (pt.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Append (cost=28540.80..200673.34 rows=3152318 width=36) -> Parallel Custom Scan (GpuScan) on pt_2017 (cost=28540.80..66891.11 rows=1050772 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Parallel Custom Scan (GpuScan) on pt_2018 (cost=28540.81..66883.43 rows=1050649 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Parallel Custom Scan (GpuScan) on pt_2019 (cost=28540.80..66898.79 rows=1050896 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) (21 rows) SSD\u3068GPU\u306e\u914d\u7f6e\u306b\u95a2\u3059\u308b\u8003\u616e PostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3068SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u304c\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u4fdd\u5b58\u3059\u308bNVMe-SSD\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u7269\u7406\u7684\u306a\u914d\u7f6e\u306b\u306f\u7279\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002 \u5236\u9650\u4e8b\u9805 \u5b9f\u9a13\u7684\u6a5f\u80fd GpuJoin\u3068GpuPreAgg\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u306f\u3001\u73fe\u6642\u70b9\u3067\u306f\u5b9f\u9a13\u7684\u306a\u6a5f\u80fd\u3067\u3042\u308a\u3001\u4e88\u671f\u305b\u306c\u4e0d\u5177\u5408\u3084\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u305d\u306e\u5834\u5408\u306f pg_strom.enable_partitionwise_gpujoin \u3084 pg_strom.enable_partitionwise_gpupreagg \u3092\u7528\u3044\u3066\u5f53\u8a72\u6a5f\u80fd\u3092\u7121\u52b9\u5316\u3059\u308b\u3068\u5171\u306b\u3001 PG-Strom Issues \u3078\u969c\u5bb3\u30ec\u30dd\u30fc\u30c8\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002","title":"\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3"},{"location":"partition/#_1","text":"PostgreSQL v10\u306b\u304a\u3044\u3066\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u6a5f\u80fd\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f\u3002 \u3053\u308c\u306f\u3001\u8ad6\u7406\u7684\u306b\u306f\u4e00\u500b\u306e\u5927\u304d\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3042\u308b\u3082\u306e\u3092\u7269\u7406\u7684\u306b\u3088\u308a\u5c0f\u3055\u306a\u30c6\u30fc\u30d6\u30eb\u306b\u5206\u5272\u3057\u3066\u683c\u7d0d\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3001\u691c\u7d22\u6761\u4ef6\u3088\u308a\u660e\u3089\u304b\u306b\u30b9\u30ad\u30e3\u30f3\u306e\u5fc5\u8981\u304c\u306a\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u305f\u308a\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u7269\u7406\u7684\u306b\u5206\u6563\u3055\u305b\u308b\u4e8b\u3067\u3088\u308a\u5e83\u3044I/O\u5e2f\u57df\u3092\u78ba\u4fdd\u3059\u308b\u306a\u3069\u306e\u5229\u70b9\u304c\u3042\u308a\u307e\u3059\u3002 PostgreSQL v10\u3067\u306f\u7bc4\u56f2\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3001\u30ea\u30b9\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u306e2\u7a2e\u985e\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3001\u3055\u3089\u306bPostgreSQL v11\u3067\u306f\u30cf\u30c3\u30b7\u30e5\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u306b\u52a0\u3048\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u540c\u58eb\u306eJOIN\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u56f3\u306f\u3001\u65e5\u4ed8\u578b\uff08DATE\u578b\uff09\u306e\u30ad\u30fc\u5024\u3092\u7528\u3044\u305f\u7bc4\u56f2\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002 \u30ad\u30fc\u5024 2018-05-30 \u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb tbl_2018 \u306b\u632f\u308a\u5206\u3051\u3089\u308c\u3001\u540c\u69d8\u306b\u3001\u30ad\u30fc\u5024 2014-03-21 \u3092\u6301\u3064\u30ec\u30b3\u30fc\u30c9\u306f\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb tbl_2014 \u306b\u632f\u308a\u5206\u3051\u3089\u308c\u308b\u30fb\u30fb\u30fb\u3068\u3044\u3063\u305f\u5177\u5408\u3067\u3059\u3002 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u6642\u3001\u4f8b\u3048\u3070 WHERE ymd > '2016-07-01'::date \u3068\u3044\u3046\u6761\u4ef6\u53e5\u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u308b\u3068\u3001 tbl_2014 \u304a\u3088\u3073 tbl_2015 \u306b\u8a72\u5f53\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u306a\u3044\u4e8b\u306f\u81ea\u660e\u3067\u3059\u306e\u3067\u3001PostgreSQL\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306f tbl_2016 \u3001 tbl_2017 \u3001 tbl_2018 \u3060\u3051\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3001\u305d\u306e\u7d50\u679c\u3092\u7d50\u5408\u3059\u308b Append \u30ce\u30fc\u30c9\u3092\u631f\u3080\u4e8b\u3067\u3001\u3042\u305f\u304b\u3082\u5358\u4e00\u306e\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u30ec\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u51fa\u3057\u305f\u304b\u306e\u3088\u3046\u306b\u632f\u821e\u3046\u5b9f\u884c\u8a08\u753b\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 PostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3068PG-Strom\u3092\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u307e\u305a\u3001\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u3067\u3042\u308b\u3068\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u304c\u5224\u65ad\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u5bfe\u3057\u3001\u500b\u3005\u306b\u5b9f\u884c\u30b3\u30b9\u30c8\u3092\u63a8\u5b9a\u3057\u305f\u4e0a\u3067 GpuScan \u304c\u9078\u629e\u3055\u308c\u308b\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001 GpuScan \u306e\u5b9f\u884c\u7d50\u679c\u3092 Append \u30ce\u30fc\u30c9\u3067\u675f\u306d\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u305f\u3060\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u7d9a\u304d\u3001JOIN\u3084GROUP BY\u306a\u3069PG-Strom\u3067\u9ad8\u901f\u5316\u304c\u53ef\u80fd\u306a\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u6700\u9069\u5316\u306e\u89b3\u70b9\u304b\u3089\u691c\u8a0e\u304c\u5fc5\u8981\u3067\u3059\u3002 \u4f8b\u3048\u3070\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u3066\u3044\u306a\u3044\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u5225\u306e\u30c6\u30fc\u30d6\u30eb\u3068JOIN\u3057\u3001GROUP BY\u306b\u3088\u308b\u96c6\u8a08\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u5834\u5408\u3001\u6761\u4ef6\u304c\u63c3\u3048\u3070\u3001\u5404\u30b9\u30c6\u30c3\u30d7\u9593\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u306fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u3067\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306fGPU\u3068CPU\u306e\u9593\u306e\u30c7\u30fc\u30bf\u79fb\u52d5\u3092\u6700\u5c0f\u5316\u3059\u308b\u3068\u3044\u3046\u89b3\u70b9\u304b\u3089\u3001\u6700\u3082PG-Strom\u304c\u5f97\u610f\u3068\u3059\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3059\u3002 \u4e00\u65b9\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u540c\u69d8\u306e\u51e6\u7406\u3092\u884c\u3046\u5834\u5408\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u3068JOIN\u3084GROUP BY\u306e\u9593\u306b Append \u51e6\u7406\u304c\u631f\u307e\u3063\u3066\u3057\u307e\u3046\u306e\u304c\u8ab2\u984c\u3067\u3059\u3002\u3053\u306e\u5b9f\u884c\u8a08\u753b\u306e\u4e0b\u3067\u306f\u3001GpuScan\u304c\u51e6\u7406\u3057\u305f\u30c7\u30fc\u30bf\u3092\u4e00\u5ea6\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u3078\u8ee2\u9001\u3057\u3001 Append \u51e6\u7406\u3092\u884c\u3063\u305f\u4e0a\u3067\u3001\u305d\u306e\u5f8c\u306eGpuJoin\u3084GpuPreAgg\u51e6\u7406\u3092\u884c\u3046\u305f\u3081\u306b\u518d\u3073\u30c7\u30fc\u30bf\u3092GPU\u3078\u8ee2\u9001\u3059\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u6c7a\u3057\u3066\u52b9\u7387\u306e\u826f\u3044\u51e6\u7406\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u306e\u3088\u3046\u306aCPU-GPU\u9593\u306e\u30c7\u30fc\u30bf\u306e\u30d4\u30f3\u30dd\u30f3\u3092\u907f\u3051\u308b\u305f\u3081\u3001PG-Strom\u306f\u53ef\u80fd\u306a\u9650\u308aJOIN\u3084GROUP BY\u3092 Append \u3088\u308a\u3082\u5148\u306b\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3092\u8a66\u307f\u307e\u3059\u3002 \u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u304c\u6210\u529f\u308c\u3070\u3001\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u52b9\u7387\u5316\u3067\u304d\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u7279\u306bGROUP BY\u51e6\u7406\u306b\u3088\u3063\u3066\u884c\u6570\u3092\u5927\u5e45\u306b\u524a\u6e1b\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308b\u305f\u3081\u3001 Append \u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u306e\u8ca0\u8377\u3092\u9855\u8457\u306b\u6e1b\u3089\u3059\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f\u3001\u65e5\u4ed8\u578b\uff08date\u578b\uff09\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 ymd \u3092\u30ad\u30fc\u3068\u3057\u3066\u5e74\u5358\u4f4d\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b pt \u306b\u5bfe\u3057\u3066\u3001JOIN\u3068GROUP BY\u3092\u542b\u3080\u30af\u30a8\u30ea\u3092\u6295\u5165\u3057\u305f\u6642\u306e\u5b9f\u884c\u8a08\u753b\u3067\u3059\u3002 \u691c\u7d22\u6761\u4ef6\u306b\u3088\u308a2016\u5e74\u4ee5\u524d\u306e\u30c7\u30fc\u30bf\u3092\u542b\u3080\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306f\u81ea\u660e\u306b\u6392\u9664\u3055\u308c\u3001\u3055\u3089\u306b pt_2017 \u3001 pt_2018 \u3001 pt_2019 \u5404\u30c6\u30fc\u30d6\u30eb\u306eJOIN\u3068GROUP BY\u51e6\u7406\u304c\u4e00\u4f53\u3068\u306a\u3063\u3066 Append \u306e\u524d\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 # EXPLAIN SELECT cat,count(*),avg(ax) FROM pt NATURAL JOIN t1 WHERE ymd > '2017-01-01'::date GROUP BY cat; QUERY PLAN -------------------------------------------------------------------------------- HashAggregate (cost=196410.07..196412.57 rows=200 width=48) Group Key: pt_2017.cat -> Gather (cost=66085.69..196389.07 rows=1200 width=72) Workers Planned: 2 -> Parallel Append (cost=65085.69..195269.07 rows=600 width=72) -> Parallel Custom Scan (GpuPreAgg) (cost=65085.69..65089.69 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2017 (cost=32296.64..74474.20 rows=1050772 width=40) Outer Scan: pt_2017 (cost=28540.80..66891.11 rows=1050772 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050772...2521854) HashKeys: pt_2017.aid JoinQuals: (pt_2017.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) -> Parallel Custom Scan (GpuPreAgg) (cost=65078.35..65082.35 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2018 (cost=32296.65..74465.75 rows=1050649 width=40) Outer Scan: pt_2018 (cost=28540.81..66883.43 rows=1050649 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050649...2521557) HashKeys: pt_2018.aid JoinQuals: (pt_2018.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) -> Parallel Custom Scan (GpuPreAgg) (cost=65093.03..65097.03 rows=200 width=72) Reduction: Local Combined GpuJoin: enabled -> Parallel Custom Scan (GpuJoin) on pt_2019 (cost=32296.65..74482.64 rows=1050896 width=40) Outer Scan: pt_2019 (cost=28540.80..66898.79 rows=1050896 width=36) Outer Scan Filter: (ymd > '2017-01-01'::date) Depth 1: GpuHashJoin (nrows 1050896...2522151) HashKeys: pt_2019.aid JoinQuals: (pt_2019.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) (38 rows)","title":"\u6982\u8981"},{"location":"partition/#_2","text":"\u4ee5\u4e0b\u306eGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308a\u3001PG-Strom\u306fJOIN\u3084GROUP BY\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enable_partitionwise_gpujoin bool on GpuJoin\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.enable_partitionwise_gpupreagg bool on GpuPreAgg\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 \u3053\u308c\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u521d\u671f\u5024\u306f on \u3067\u3059\u304c\u3001\u3053\u308c\u3092 off \u306b\u3057\u305f\u5834\u5408\u3001\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u51e6\u7406\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002 EXPLAIN\u30b3\u30de\u30f3\u30c9\u3067\u524d\u7bc0\u306e\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3057\u305f\u3068\u3053\u308d\u3001\u5b9f\u884c\u8a08\u753b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u5316\u3057\u3066\u3044\u307e\u3059\u3002 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u306f GpuScan \u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u51e6\u7406\u7d50\u679c\u306f\u4e00\u5ea6\u30db\u30b9\u30c8\u30b7\u30b9\u30c6\u30e0\u306b\u8fd4\u3055\u308c\u3001 Append \u306b\u3088\u3063\u3066\u7d50\u5408\u3055\u308c\u305f\u5f8c\u3001\u518d\u3073 GpuJoin \u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306bGPU\u3078\u3068\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002 postgres=# set pg_strom.enable_partitionwise_gpujoin = off; SET postgres=# set pg_strom.enable_partitionwise_gpupreagg = off; SET postgres=# EXPLAIN SELECT cat,count(*),avg(ax) FROM pt NATURAL JOIN t1 WHERE ymd > '2017-01-01'::date group by cat; QUERY PLAN -------------------------------------------------------------------------------------------------------------------------------- Finalize GroupAggregate (cost=341392.92..341399.42 rows=200 width=48) Group Key: pt.cat -> Sort (cost=341392.92..341393.92 rows=400 width=72) Sort Key: pt.cat -> Gather (cost=341333.63..341375.63 rows=400 width=72) Workers Planned: 2 -> Partial HashAggregate (cost=340333.63..340335.63 rows=200 width=72) Group Key: pt.cat -> Parallel Custom Scan (GpuJoin) (cost=283591.92..283591.92 rows=7565562 width=40) Depth 1: GpuHashJoin (nrows 3152318...7565562) HashKeys: pt.aid JoinQuals: (pt.aid = t1.aid) KDS-Hash (size: 10.78MB) -> Append (cost=28540.80..200673.34 rows=3152318 width=36) -> Parallel Custom Scan (GpuScan) on pt_2017 (cost=28540.80..66891.11 rows=1050772 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Parallel Custom Scan (GpuScan) on pt_2018 (cost=28540.81..66883.43 rows=1050649 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Parallel Custom Scan (GpuScan) on pt_2019 (cost=28540.80..66898.79 rows=1050896 width=36) GPU Filter: (ymd > '2017-01-01'::date) -> Seq Scan on t1 (cost=0.00..1935.00 rows=100000 width=12) (21 rows)","title":"\u8a2d\u5b9a\u3068\u904b\u7528"},{"location":"partition/#ssdgpu","text":"PostgreSQL\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3068SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u304c\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u4fdd\u5b58\u3059\u308bNVMe-SSD\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u7269\u7406\u7684\u306a\u914d\u7f6e\u306b\u306f\u7279\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002","title":"SSD\u3068GPU\u306e\u914d\u7f6e\u306b\u95a2\u3059\u308b\u8003\u616e"},{"location":"partition/#_3","text":"\u5b9f\u9a13\u7684\u6a5f\u80fd GpuJoin\u3068GpuPreAgg\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u306f\u3001\u73fe\u6642\u70b9\u3067\u306f\u5b9f\u9a13\u7684\u306a\u6a5f\u80fd\u3067\u3042\u308a\u3001\u4e88\u671f\u305b\u306c\u4e0d\u5177\u5408\u3084\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u305d\u306e\u5834\u5408\u306f pg_strom.enable_partitionwise_gpujoin \u3084 pg_strom.enable_partitionwise_gpupreagg \u3092\u7528\u3044\u3066\u5f53\u8a72\u6a5f\u80fd\u3092\u7121\u52b9\u5316\u3059\u308b\u3068\u5171\u306b\u3001 PG-Strom Issues \u3078\u969c\u5bb3\u30ec\u30dd\u30fc\u30c8\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002","title":"\u5236\u9650\u4e8b\u9805"},{"location":"python/","text":"\u672c\u7ae0\u3067\u306f\u3001\u5171\u901a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068Python\u30b9\u30af\u30ea\u30d7\u30c8\uff08PL/Python\u3092\u542b\u3080\uff09\u3092\u7528\u3044\u3066\u3001\u6a5f\u68b0\u5b66\u7fd2\u3084\u7d71\u8a08\u89e3\u6790\u30a8\u30f3\u30b8\u30f3\u3068PostgreSQL\u3092\u63a5\u7d9a\u3059\u308b\u3001\u3042\u308b\u3044\u306f\u3053\u308c\u3089\u306e\u30a8\u30f3\u30b8\u30f3\u3092 In-database \u3067\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u80cc\u666f \u904e\u53bb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306ePG-Strom\u306b\u304a\u3044\u3066\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u6a5f\u68b0\u5b66\u7fd2\u30fb\u7d71\u8a08\u89e3\u6790\u30a8\u30f3\u30b8\u30f3\u306e\u9023\u643a\u306e\u305f\u3081\u306bPL/CUDA\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001SQL\u306e\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3068\u3057\u3066CUDA C\u306e\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u3001\u8a08\u7b97\u96c6\u4e2d\u7684\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u306e\u6301\u3064\u6570\u5343\u30b3\u30a2\u306e\u30d7\u30ed\u30bb\u30c3\u30b5\u3067\u51e6\u7406\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u306b\u3059\u308b\u3082\u306e\u3067\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306fCPU\u306e\u767e\u500d\u4ee5\u4e0a\u306e\u51e6\u7406\u901f\u5ea6\u3092\u5b9f\u73fe\u3059\u308b\u4e8b\u3082\u3042\u308a\u307e\u3057\u305f\u3002 \u3057\u304b\u3057\u4e00\u65b9\u3067\u3001\u6a5f\u68b0\u5b66\u7fd2\u3084\u7d71\u8a08\u89e3\u6790\u306e\u9818\u57df\u3067\u306f\u591a\u304f\u306e\u5834\u5408Python\u8a00\u8a9e\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u306a\u6d41\u308c\u3068\u306a\u308a\u3001\u500b\u3005\u306e\u30c7\u30fc\u30bf\u30b5\u30a4\u30a8\u30f3\u30c6\u30a3\u30b9\u30c8\u304cCUDA C\u8a00\u8a9e\u3067\u4e26\u5217\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8a18\u8ff0\u3059\u308b\u3068\u3044\u3046\u30b1\u30fc\u30b9\u306f\u7a00\u3067\u3057\u305f\u3002 PG-Strom v2.3\u4ee5\u964d\u3067\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Python\u5411\u3051\u6a5f\u68b0\u5b66\u7fd2\u30fb\u7d71\u8a08\u89e3\u6790\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u5171\u901a\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u3057\u3066\u4ea4\u63db\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3001\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\u4e8b\u306a\u304fGPU\u306e\u8a08\u7b97\u80fd\u529b\u3092\u5229\u7528\u3059\u308b\u3068\u3044\u3046PL/CUDA\u306e\u7279\u5fb4\u3092\u5f15\u304d\u7d99\u304e\u3064\u3064\u3001Python\u8a00\u8a9e\u306b\u3088\u308b\u9ad8\u3044\u751f\u7523\u6027\u3092\u4e21\u7acb\u3057\u3066\u3044\u307e\u3059\u3002 \u672c\u7ae0\u3067\u8aac\u660e\u3059\u308b\u6a5f\u80fd\u306f\u3001\u57fa\u672c\u7684\u306b\u306f\u30aa\u30f3\u30e1\u30e2\u30ea\u51e6\u7406\u304c\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u91cf\u3092\u5bfe\u8c61\u3068\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\u30c6\u30e9\u30d0\u30a4\u30c8\u3092\u8d8a\u3048\u308b\u3088\u3046\u306a\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u3092Python\u304b\u3089\u53c2\u7167\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u3057\u3066\u898b\u305b\u308b\u305f\u3081\u306b\u4f7f\u7528\u3059\u3079\u304d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u308c\u306f\u4f8b\u3048\u3070\u3001\u5927\u898f\u6a21\u306a\u751f\u30ed\u30b0\u30c7\u30fc\u30bf\u306fSSD-to-GPU Direct SQL\u3092\u7528\u3044\u3066\u524d\u51e6\u7406\u3057\u3001\u6b21\u306b\u3053\u308c\u3092\u5171\u901a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3092\u4ecb\u3057\u3066Python\u4e0a\u306e\u6a5f\u68b0\u5b66\u7fd2\u30a8\u30f3\u30b8\u30f3\u306b\u5165\u529b\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002 cuPy\u3092\u7528\u3044\u305f\u30c7\u30fc\u30bf\u4ea4\u63db cuPy \u3068\u306f\u3001Python\u74b0\u5883\u306b\u304a\u3044\u3066\u884c\u5217\u6f14\u7b97\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u5e83\u304f\u4f7f\u308f\u308c\u3066\u3044\u308bnumPy\u3068\u5171\u901a\u306eAPI\u7fa4\u3092\u3082\u3061\u3001\u305d\u306e\u6f14\u7b97\u3092GPU\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002 cuPy\u304c\u8a08\u7b97\u306b\u5229\u7528\u3059\u308b\u884c\u5217\u30c7\u30fc\u30bf\u306fGPU\u4e0a\u306b\u914d\u7f6e\u3055\u308c\u3001 cupy.ndarray \u578b\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30b9\u30af\u30ea\u30d7\u30c8\u4e0a\u304b\u3089\u64cd\u4f5c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002cuPy\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084API\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306a\u3069\u306f\u3001 \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002 PG-Strom\u306fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u4fdd\u6301\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092GPU\u4e0a\u306b\u5c55\u958b\u3057\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u74b0\u5883\u306b\u5f53\u8a72\u30e1\u30e2\u30ea\u9818\u57df\u3092\u30de\u30c3\u30d7\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\u4e8b\u306a\u304f\u30b9\u30de\u30fc\u30c8\u306b\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 PG-Strom\u306eSQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy() \u306fGPU\u30c7\u30d0\u30a4\u30b9\u3092\u5272\u308a\u5f53\u3066\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306e\u95a2\u6570\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3001\u30ed\u30fc\u30c9\u3059\u3079\u304d\u5217\u540d\u3001\u304a\u3088\u3073\u30bf\u30fc\u30b2\u30c3\u30c8\u306eGPU\u30c7\u30d0\u30a4\u30b9ID\uff08\u7701\u7565\u53ef\uff09\u3092\u5f15\u6570\u306b\u53d6\u308a\u3001\u5f53\u8a72GPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50\u3092 text \u3067\u8fd4\u3057\u307e\u3059\u3002 Python\u30b9\u30af\u30ea\u30d7\u30c8\u5074\u3067\u306f cupy_strom.ipc_import() \u306b\u3053\u306e\u8b58\u5225\u5b50\u3092\u4e0e\u3048\u3066\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u306b\u5c55\u958b\u6e08\u307f\u306e cupy.ndarray \u3092\u30aa\u30fc\u30d7\u30f3\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u5b9f\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002 PostgresSQL\u5074\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3 =# CREATE FOREIGN TABLE ft ( id int, x real, y real, z real ) SERVER arrow_fdw OPTIONS (file '/dev/shm/ftest.arrow', writable 'true'); =# INSERT INTO ft (SELECT x, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,1,10000)::float/100.0 FROM generate_series(1,5) x); =# SELECT * FROM ft; id | x | y | z ----+-------+-------+------- 1 | 51.61 | 73.23 | 7.53 2 | 49.73 | 29.75 | 37.31 3 | 61.15 | 55.15 | 36.07 4 | 23.76 | 40.76 | 51.74 5 | 61.43 | 86.87 | 47.64 (5 rows) Python\u5074\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3 import psycopg2 import cupy import cupy_strom conn = psycopg2.connect(\"host=localhost dbname=postgres\") curr = conn.cursor() curr.execute(\"select pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])\") row = curr.fetchone() X = cupy_strom.ipc_import(row[0]) print(X) conn.close() \u5b9f\u884c\u7d50\u679c $ python ftest.py [[51.61 49.73 61.15 23.76 61.43] [73.23 29.75 55.15 40.76 86.87] [ 7.53 37.31 36.07 51.74 47.64]] \u4e0a\u8a18\u306e\u4f8b\u306f\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089PostgreSQL\u3078\u63a5\u7d9a\u3057\u3001SQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy \u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb ft \u306e\u5217 x \u3001 y \u304a\u3088\u3073 z \u306e3\u5217\u304b\u3089\u6210\u308b cupy.ndarray \u7528\u306eGPU\u30d0\u30c3\u30d5\u30a1\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\u7d9a\u3044\u3066\u3001\u305d\u306e\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3067\u3042\u308b\u8b58\u5225\u5b50\u3092 cupy_strom.ipc_import \u95a2\u6570\u306b\u6e21\u3059\u4e8b\u3067\u3001Python\u304b\u3089\u5229\u7528\u53ef\u80fd\u306a cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u3044\u307e\u3059\u3002 \u3044\u3063\u305f\u3093 cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u751f\u6210\u3055\u308c\u305f\u5f8c\u306f\u3001\u65e2\u5b58\u306e cuPy \u306eAPI\u7fa4\u3092\u7528\u3044\u3066\u3053\u306eGPU\u30d0\u30c3\u30d5\u30a1\u3092\u64cd\u4f5c\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u50c5\u304b5\u884cx3\u5217\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u304c10\u5104\u884c\u306e\u30c7\u30fc\u30bf\u306b\u306a\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u540c\u69d8\u306bPostgreSQL\u3068Python\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u9593\u3067\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u5272\u308a\u5f53\u3066\u305fGPU\u30d0\u30c3\u30d5\u30a1\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306b\u89e3\u653e\u3055\u308c\u307e\u3059\u3002\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u5f8c\u3082GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4fdd\u6301\u3057\u7d9a\u3051\u305f\u3044\u5834\u5408\u306f\u3001\u4ee3\u308f\u308a\u306b pgstrom.arrow_fdw_export_cupy_pinned \u3092\u4f7f\u7528\u3057\u3066GPU\u30d0\u30c3\u30d5\u30a1\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u660e\u793a\u7684\u306b pgstrom.arrow_fdw_unpin_gpu_buffer \u3092\u547c\u3073\u51fa\u3057\u3066\u30d4\u30f3\u30cb\u30f3\u30b0\u72b6\u614b\u3092\u89e3\u9664\u3059\u308b\u307e\u3067\u306f\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3092\u5360\u6709\u3057\u7d9a\u3051\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 cupy_strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u524d\u8ff0\u306e\u64cd\u4f5c\u306b\u5fc5\u8981\u306a cupy_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3001 setup.py \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo pip3 install --upgrade numpy cupy cython $ git clone https://github.com/heterodb/pg-strom.git $ cd pg-strom/python $ python3 setup.py cuPy\u3092\u7528\u3044\u305f\u30ab\u30b9\u30bf\u30e0GPU\u30ab\u30fc\u30cd\u30eb\u306e\u5b9f\u884c cuPy\u306f\u8c4a\u5bcc\u306a\u884c\u5217\u6f14\u7b97API\u3092\u6301\u3063\u3066\u304a\u308a\u3001\u3053\u308c\u3089\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067CUDA C\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306a\u3057\u306bGPU\u306e\u8a08\u7b97\u80fd\u529b\u3092\u5f15\u304d\u51fa\u3059\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u30e6\u30fc\u30b6\u304c\u4f5c\u6210\u3057\u305f\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3001\u5b9f\u884c\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f cupy.RawKernel \u3092\u4f7f\u7528\u3057\u3066\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u3082\u306e\u3067\u3001\u5165\u529b\u5024('X')\u306e\u5404\u5217\u3054\u3068\u306b\u305d\u306e\u5e73\u5747\u5024\u3092\u5c0e\u51fa\u3059\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 cupy.RawKernel \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\u306b\u306f\u3001CUDA C\u3067\u8a18\u8ff0\u3055\u308c\u305fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3068\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u95a2\u6570\u540d\u304c\u5fc5\u8981\u3067\u3001\u3053\u308c\u306f __call__ \u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u51fa\u3057\u6642\u306b\u5b9f\u884c\u6642\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u884c\u308f\u308c\u307e\u3059\u3002\uff08\u30d3\u30eb\u30c9\u6e08\u307f\u30d0\u30a4\u30ca\u30ea\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u898b\u3064\u304b\u3089\u306a\u3051\u308c\u3070\uff09 __call__ \u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u306f\u9806\u306b\u30b0\u30ea\u30c3\u30c9\u306e\u5927\u304d\u3055\u3001\u30d6\u30ed\u30c3\u30af\u306e\u5927\u304d\u3055\u3001\u304a\u3088\u3073GPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3078\u306e\u5f15\u6570\u3067\u3059\u3002\u8a73\u7d30\u306a\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\u304c\u3001\u5165\u529b\u5024 X \u30922048\u500b\u306e\u8981\u7d20\u3054\u3068\u306b\u9818\u57df\u5206\u5272\u3057\u30011024\u500b\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u76f8\u4e92\u306b\u5354\u8abf\u52d5\u4f5c\u3092\u884c\u3044\u300111\u56de\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u5404\u30d6\u30ed\u30c3\u30af\u306e\u7dcf\u548c\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u3053\u308c\u304c\u5404\u30d6\u30ed\u30c3\u30af\u6bce\u306b\u4e26\u5217\u306b\u5b9f\u884c\u3055\u308c\u3001\u6700\u7d42\u7684\u306b\u51fa\u529b\u30d0\u30c3\u30d5\u30a1 Y \u306b\u306f\u5217\u3054\u3068\u306e\u7dcf\u548c\u304c\u683c\u7d0d\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 import psycopg2 import cupy import cupy_strom // connect to PostgreSQL, and get identifier of GPU buffer conn = psycopg2.connect(\"host=localhost dbname=postgres\") curr = conn.cursor() curr.execute(\"select pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])\") row = curr.fetchone() // import GPU buffer using the identifier string X = cupy_strom.ipc_import(row[0]) nattrs = X.shape[0] nitems = X.shape[1] gridSz = (nitems + 2047) >> 11; Y = cupy.zeros((nattrs)) // source code of the custom GPU kernel source=''' extern \"C\" __global__ __launch_bounds__(1024) void kern_gpu_sum(double *y, const float *x, int nitems) { __shared__ float lvalues[2048]; int gridSz = (nitems + 2047) / 2048; int colIdx = blockIdx.x / gridSz; int rowBase = (blockIdx.x % gridSz) * 2048; int localId = 2 * threadIdx.x; int i, k; // Load values to local shared buffer x += colIdx * nitems; for (i=threadIdx.x; i < 2048; i+=blockDim.x) lvalues[i] = (rowBase + i < nitems ? x[rowBase + i] : 0.0); __syncthreads(); // Run reduction operations for (k=0; k < 11; k++) { int mask = ((1 << k) - 1); if ((threadIdx.x & mask) == 0) lvalues[localId] += lvalues[localId + (1<<k)]; __syncthreads(); } // Write back the total sum if (threadIdx.x == 0) atomicAdd(&y[colIdx], lvalues[0]); } ''' kern = cupy.RawKernel(source, 'kern_gpu_sum') kern.__call__((gridSz * nattrs,1,1), (1024,1,1), (Y,X,nitems)) print(Y / nitems) conn.close() \u5b9f\u884c\u7d50\u679c =# SELECT pgstrom.arrow_fdw_truncate('ft'); =# INSERT INTO ft (SELECT x, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,-7500,2500)::float/100.0, pgstrom.random_int(0,5000,15000)::float/100.0 FROM generate_series(1,1000000) x); =# SELECT avg(x), avg(y), avg(z) FROM ft; avg | avg | avg ------------------+-------------------+------------------ 50.0225953391276 | -24.9964806686448 | 100.037490822002 (1 row) $ python ftest.py [ 50.02259536 -24.99648063 100.03749086] \u610f\u56f3\u7684\u306b\u5404\u5217\u306e\u5206\u5e03\u3092\u305a\u3089\u3057\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306b\u3088\u308b\u5e73\u5747\u5024\u306e\u8a08\u7b97\u3067\u3059\u304c\u3001GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4ecb\u3057\u3066cuPy\u3068\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3044\u3001\u30ab\u30b9\u30bf\u30e0GPU\u30ab\u30fc\u30cd\u30eb\u3067\u8a08\u7b97\u3057\u305f\u5e73\u5747\u5024\u3068\u3001SQL\u3067\u306e\u8a08\u7b97\u7d50\u679c\u304c\u4e00\u81f4\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u304b\u3089\u306e\u5229\u7528 PostgreSQL\u3067\u306fPython\u8a00\u8a9e\u306b\u3088\u308b\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u8a18\u8ff0\u304c\u53ef\u80fd\u3067\u3001\u6a19\u6e96\u3067\u540c\u68b1\u3055\u308c\u3066\u3044\u308b PL/Python \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u305d\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 CREATE FUNCTION \u69cb\u6587\u306e LANGUAGE \u53e5\u306b plpython3u \u3068\u6307\u5b9a\u3059\u308b\u4e8b\u3067\u3001\u305d\u306e\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306fPython\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u793a\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306bPL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\u5e73\u5747\u5024\u3092\u6c42\u3081\u308bGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u306b\u306f\u3082\u3046\u4e00\u5ea6\u767b\u5834\u3057\u3066\u3082\u3089\u3046\u4e8b\u306b\u3057\u307e\u3059\u3002 PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u5f15\u6570\u306f\u3001\u9069\u5207\u306aPython\u30c7\u30fc\u30bf\u578b\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001SQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy \u306e\u8fd4\u5374\u3059\u308bGPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50(text)\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u3001\u3053\u308c\u3092Python\u5074\u3067\u306f cupy.ndarray \u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u53c2\u7167\u3057\u307e\u3059\u3002\u30b7\u30a7\u30eb\u4e0a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u3068\u5927\u304d\u306a\u9055\u3044\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u305f\u3060\u4e00\u70b9\u3060\u3051\u3001GPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9f\u884c\u3057\u3066 X \u306e\u5217\u3054\u3068\u306e\u7dcf\u548c\u3092 Y \u306b\u683c\u7d0d\u3057\u305f\u5f8c\u3001 X \u306b0\u3092\u4ee3\u5165\u3057\u3066\u660e\u793a\u7684\u306b cupy.ndarray \u3092\u89e3\u653e\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306f\u3001PL/Python\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306b X \u306b\u683c\u7d0d\u3057\u305f cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u751f\u304d\u7d9a\u3051\u3066\u3057\u307e\u3044\u3001\u8b58\u5225\u5b50\u3067\u53c2\u7167\u3057\u305fGPU\u30d0\u30c3\u30d5\u30a1\u304c\u30de\u30c3\u30d7\u3055\u308c\u7d9a\u3051\u3066\u3057\u307e\u3046\u305f\u3081\u306e\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3067\u3059\u3002 PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u4f8b CREATE OR REPLACE FUNCTION custom_average(x_ident text) RETURNS float[] AS $$ import cupy import cupy_strom X = cupy_strom.ipc_import(x_ident) nattrs = X.shape[0] nitems = X.shape[1] gridSz = (nitems + 2047) >> 11; Y = cupy.zeros((nattrs)) source=''' extern \"C\" __global__ __launch_bounds__(1024) void kern_gpu_sum(double *y, const float *x, int nitems) { __shared__ float lvalues[2048]; int gridSz = (nitems + 2047) / 2048; int colIdx = blockIdx.x / gridSz; int rowBase = (blockIdx.x % gridSz) * 2048; int localId = 2 * threadIdx.x; int i, k; // Load values to local shared buffer x += colIdx * nitems; for (i=threadIdx.x; i < 2048; i+=blockDim.x) lvalues[i] = (rowBase + i < nitems ? x[rowBase + i] : 0.0); __syncthreads(); // Run reduction operations for (k=0; k < 11; k++) { int mask = ((1 << k) - 1); if ((threadIdx.x & mask) == 0) lvalues[localId] += lvalues[localId + (1<<k)]; __syncthreads(); } // Write back the total sum if (threadIdx.x == 0) atomicAdd(&y[colIdx], lvalues[0]); } ''' kern = cupy.RawKernel(source, 'kern_gpu_sum') kern.__call__((gridSz * nattrs,0,0), (1024,0,0), (Y,X,nitems)) X = 0 # unmap GPU memory return Y / nitems $$ LANGUAGE 'plpython3u'; PL/Python\u3067\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u547c\u3073\u51fa\u3059\u305f\u3081\u306e\u4e00\u9023\u306e\u30b9\u30c6\u30c3\u30d7\u304c\u7570\u306a\u3063\u3066\u304d\u307e\u3059\u3002 \u30b7\u30a7\u30eb\u4e0a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u6642\u3068\u306f\u7570\u306a\u308a\u3001SQL\u306e\u5b9f\u884c\u4e2d\u306b\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3092\u901a\u3058\u3066Python\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3067\u304d\u308b\u305f\u3081\u3001\u308f\u3056\u308f\u3056\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u5f35\u3063\u305f\u308a\u3001SELECT\u6587\u3092\u5b9f\u884c\u3057\u3066\u8b58\u5225\u5b50\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 =# SELECT custom_average(pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])); custom_average ------------------------------------------------------- {50.0225953554688,-24.9964806318359,100.037490859375} (1 row) \u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001 pgstrom.arrow_fdw_export_cupy \u306e\u5b9f\u884c\u7d50\u679c\u3067\u3042\u308bGPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50\u304c\u3001\u76f4\u63a5\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570 custom_average \u306e\u5f15\u6570\u3068\u3057\u3066\u5165\u529b\u3055\u308c\u3001\u305d\u3053\u3067Python\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u306e\u9593\u3067\u30c7\u30fc\u30bf\u4ea4\u63db\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001GPU\u30ab\u30fc\u30cd\u30eb\u304c\u8d77\u52d5\u3055\u308c\u3001\u7d50\u679c\u3092\u547c\u3073\u51fa\u3057\u5143\u306b\u8fd4\u3059\u307e\u3067\u306e\u6d41\u308c\u306f\u5168\u304f\u540c\u4e00\u3067\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30ebft\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u3001\u3053\u308c\u3092\u5f15\u6570\u3068\u3057\u3066PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306b\u6e21\u3059\u306e\u3068\u306f\u3001PostgreSQL\u5074\u3067\u53d6\u308a\u6271\u3046\u3079\u304d\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u5168\u304f\u7570\u306a\u3063\u3066\u304f\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4ecb\u3057\u305f\u30c7\u30fc\u30bf\u4ea4\u63db\u30e1\u30ab\u30cb\u30ba\u30e0\u306e\u5834\u5408\u3001\u3053\u308c\u306f\u3042\u308b\u7a2e\u306e\"\u30dd\u30a4\u30f3\u30bf\u6e21\u3057\"\u3068\u3057\u3066\u6a5f\u80fd\u3059\u308b\u305f\u3081\u3001\"\u5024\u6e21\u3057\"\u30b9\u30bf\u30a4\u30eb\u3068\u6bd4\u3079\u3066\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u547c\u3073\u51fa\u3057\u305d\u306e\u3082\u306e\u304c\u975e\u5e38\u306b\u8efd\u3044\u51e6\u7406\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002","title":"In-database Analytics"},{"location":"python/#_1","text":"\u904e\u53bb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306ePG-Strom\u306b\u304a\u3044\u3066\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u6a5f\u68b0\u5b66\u7fd2\u30fb\u7d71\u8a08\u89e3\u6790\u30a8\u30f3\u30b8\u30f3\u306e\u9023\u643a\u306e\u305f\u3081\u306bPL/CUDA\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001SQL\u306e\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3068\u3057\u3066CUDA C\u306e\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u3001\u8a08\u7b97\u96c6\u4e2d\u7684\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092GPU\u306e\u6301\u3064\u6570\u5343\u30b3\u30a2\u306e\u30d7\u30ed\u30bb\u30c3\u30b5\u3067\u51e6\u7406\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u306b\u3059\u308b\u3082\u306e\u3067\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306fCPU\u306e\u767e\u500d\u4ee5\u4e0a\u306e\u51e6\u7406\u901f\u5ea6\u3092\u5b9f\u73fe\u3059\u308b\u4e8b\u3082\u3042\u308a\u307e\u3057\u305f\u3002 \u3057\u304b\u3057\u4e00\u65b9\u3067\u3001\u6a5f\u68b0\u5b66\u7fd2\u3084\u7d71\u8a08\u89e3\u6790\u306e\u9818\u57df\u3067\u306f\u591a\u304f\u306e\u5834\u5408Python\u8a00\u8a9e\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u306a\u6d41\u308c\u3068\u306a\u308a\u3001\u500b\u3005\u306e\u30c7\u30fc\u30bf\u30b5\u30a4\u30a8\u30f3\u30c6\u30a3\u30b9\u30c8\u304cCUDA C\u8a00\u8a9e\u3067\u4e26\u5217\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8a18\u8ff0\u3059\u308b\u3068\u3044\u3046\u30b1\u30fc\u30b9\u306f\u7a00\u3067\u3057\u305f\u3002 PG-Strom v2.3\u4ee5\u964d\u3067\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5185\u5bb9\u3092Python\u5411\u3051\u6a5f\u68b0\u5b66\u7fd2\u30fb\u7d71\u8a08\u89e3\u6790\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u5171\u901a\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u3057\u3066\u4ea4\u63db\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3001\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\u4e8b\u306a\u304fGPU\u306e\u8a08\u7b97\u80fd\u529b\u3092\u5229\u7528\u3059\u308b\u3068\u3044\u3046PL/CUDA\u306e\u7279\u5fb4\u3092\u5f15\u304d\u7d99\u304e\u3064\u3064\u3001Python\u8a00\u8a9e\u306b\u3088\u308b\u9ad8\u3044\u751f\u7523\u6027\u3092\u4e21\u7acb\u3057\u3066\u3044\u307e\u3059\u3002 \u672c\u7ae0\u3067\u8aac\u660e\u3059\u308b\u6a5f\u80fd\u306f\u3001\u57fa\u672c\u7684\u306b\u306f\u30aa\u30f3\u30e1\u30e2\u30ea\u51e6\u7406\u304c\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u91cf\u3092\u5bfe\u8c61\u3068\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u3057\u305f\u304c\u3063\u3066\u3001\u30c6\u30e9\u30d0\u30a4\u30c8\u3092\u8d8a\u3048\u308b\u3088\u3046\u306a\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u3092Python\u304b\u3089\u53c2\u7167\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u3057\u3066\u898b\u305b\u308b\u305f\u3081\u306b\u4f7f\u7528\u3059\u3079\u304d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u308c\u306f\u4f8b\u3048\u3070\u3001\u5927\u898f\u6a21\u306a\u751f\u30ed\u30b0\u30c7\u30fc\u30bf\u306fSSD-to-GPU Direct SQL\u3092\u7528\u3044\u3066\u524d\u51e6\u7406\u3057\u3001\u6b21\u306b\u3053\u308c\u3092\u5171\u901a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3092\u4ecb\u3057\u3066Python\u4e0a\u306e\u6a5f\u68b0\u5b66\u7fd2\u30a8\u30f3\u30b8\u30f3\u306b\u5165\u529b\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002","title":"\u80cc\u666f"},{"location":"python/#cupy","text":"cuPy \u3068\u306f\u3001Python\u74b0\u5883\u306b\u304a\u3044\u3066\u884c\u5217\u6f14\u7b97\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u5e83\u304f\u4f7f\u308f\u308c\u3066\u3044\u308bnumPy\u3068\u5171\u901a\u306eAPI\u7fa4\u3092\u3082\u3061\u3001\u305d\u306e\u6f14\u7b97\u3092GPU\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002 cuPy\u304c\u8a08\u7b97\u306b\u5229\u7528\u3059\u308b\u884c\u5217\u30c7\u30fc\u30bf\u306fGPU\u4e0a\u306b\u914d\u7f6e\u3055\u308c\u3001 cupy.ndarray \u578b\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30b9\u30af\u30ea\u30d7\u30c8\u4e0a\u304b\u3089\u64cd\u4f5c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002cuPy\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084API\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306a\u3069\u306f\u3001 \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002 PG-Strom\u306fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u4fdd\u6301\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092GPU\u4e0a\u306b\u5c55\u958b\u3057\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u74b0\u5883\u306b\u5f53\u8a72\u30e1\u30e2\u30ea\u9818\u57df\u3092\u30de\u30c3\u30d7\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\u4e8b\u306a\u304f\u30b9\u30de\u30fc\u30c8\u306b\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 PG-Strom\u306eSQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy() \u306fGPU\u30c7\u30d0\u30a4\u30b9\u3092\u5272\u308a\u5f53\u3066\u3001Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306e\u95a2\u6570\u306f\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3001\u30ed\u30fc\u30c9\u3059\u3079\u304d\u5217\u540d\u3001\u304a\u3088\u3073\u30bf\u30fc\u30b2\u30c3\u30c8\u306eGPU\u30c7\u30d0\u30a4\u30b9ID\uff08\u7701\u7565\u53ef\uff09\u3092\u5f15\u6570\u306b\u53d6\u308a\u3001\u5f53\u8a72GPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50\u3092 text \u3067\u8fd4\u3057\u307e\u3059\u3002 Python\u30b9\u30af\u30ea\u30d7\u30c8\u5074\u3067\u306f cupy_strom.ipc_import() \u306b\u3053\u306e\u8b58\u5225\u5b50\u3092\u4e0e\u3048\u3066\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u306b\u5c55\u958b\u6e08\u307f\u306e cupy.ndarray \u3092\u30aa\u30fc\u30d7\u30f3\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u5b9f\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002 PostgresSQL\u5074\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3 =# CREATE FOREIGN TABLE ft ( id int, x real, y real, z real ) SERVER arrow_fdw OPTIONS (file '/dev/shm/ftest.arrow', writable 'true'); =# INSERT INTO ft (SELECT x, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,1,10000)::float/100.0 FROM generate_series(1,5) x); =# SELECT * FROM ft; id | x | y | z ----+-------+-------+------- 1 | 51.61 | 73.23 | 7.53 2 | 49.73 | 29.75 | 37.31 3 | 61.15 | 55.15 | 36.07 4 | 23.76 | 40.76 | 51.74 5 | 61.43 | 86.87 | 47.64 (5 rows) Python\u5074\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3 import psycopg2 import cupy import cupy_strom conn = psycopg2.connect(\"host=localhost dbname=postgres\") curr = conn.cursor() curr.execute(\"select pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])\") row = curr.fetchone() X = cupy_strom.ipc_import(row[0]) print(X) conn.close() \u5b9f\u884c\u7d50\u679c $ python ftest.py [[51.61 49.73 61.15 23.76 61.43] [73.23 29.75 55.15 40.76 86.87] [ 7.53 37.31 36.07 51.74 47.64]] \u4e0a\u8a18\u306e\u4f8b\u306f\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089PostgreSQL\u3078\u63a5\u7d9a\u3057\u3001SQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy \u3092\u7528\u3044\u3066\u5916\u90e8\u30c6\u30fc\u30d6\u30eb ft \u306e\u5217 x \u3001 y \u304a\u3088\u3073 z \u306e3\u5217\u304b\u3089\u6210\u308b cupy.ndarray \u7528\u306eGPU\u30d0\u30c3\u30d5\u30a1\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\u7d9a\u3044\u3066\u3001\u305d\u306e\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3067\u3042\u308b\u8b58\u5225\u5b50\u3092 cupy_strom.ipc_import \u95a2\u6570\u306b\u6e21\u3059\u4e8b\u3067\u3001Python\u304b\u3089\u5229\u7528\u53ef\u80fd\u306a cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u3044\u307e\u3059\u3002 \u3044\u3063\u305f\u3093 cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u751f\u6210\u3055\u308c\u305f\u5f8c\u306f\u3001\u65e2\u5b58\u306e cuPy \u306eAPI\u7fa4\u3092\u7528\u3044\u3066\u3053\u306eGPU\u30d0\u30c3\u30d5\u30a1\u3092\u64cd\u4f5c\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u50c5\u304b5\u884cx3\u5217\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u304c10\u5104\u884c\u306e\u30c7\u30fc\u30bf\u306b\u306a\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u540c\u69d8\u306bPostgreSQL\u3068Python\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u9593\u3067\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u5272\u308a\u5f53\u3066\u305fGPU\u30d0\u30c3\u30d5\u30a1\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306b\u89e3\u653e\u3055\u308c\u307e\u3059\u3002\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u5f8c\u3082GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4fdd\u6301\u3057\u7d9a\u3051\u305f\u3044\u5834\u5408\u306f\u3001\u4ee3\u308f\u308a\u306b pgstrom.arrow_fdw_export_cupy_pinned \u3092\u4f7f\u7528\u3057\u3066GPU\u30d0\u30c3\u30d5\u30a1\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u660e\u793a\u7684\u306b pgstrom.arrow_fdw_unpin_gpu_buffer \u3092\u547c\u3073\u51fa\u3057\u3066\u30d4\u30f3\u30cb\u30f3\u30b0\u72b6\u614b\u3092\u89e3\u9664\u3059\u308b\u307e\u3067\u306f\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3092\u5360\u6709\u3057\u7d9a\u3051\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"cuPy\u3092\u7528\u3044\u305f\u30c7\u30fc\u30bf\u4ea4\u63db"},{"location":"python/#cupy_strom","text":"\u524d\u8ff0\u306e\u64cd\u4f5c\u306b\u5fc5\u8981\u306a cupy_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3001 setup.py \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 $ sudo pip3 install --upgrade numpy cupy cython $ git clone https://github.com/heterodb/pg-strom.git $ cd pg-strom/python $ python3 setup.py","title":"cupy_strom\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"python/#cupygpu","text":"cuPy\u306f\u8c4a\u5bcc\u306a\u884c\u5217\u6f14\u7b97API\u3092\u6301\u3063\u3066\u304a\u308a\u3001\u3053\u308c\u3089\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067CUDA C\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306a\u3057\u306bGPU\u306e\u8a08\u7b97\u80fd\u529b\u3092\u5f15\u304d\u51fa\u3059\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u30e6\u30fc\u30b6\u304c\u4f5c\u6210\u3057\u305f\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3001\u5b9f\u884c\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u4f8b\u306f cupy.RawKernel \u3092\u4f7f\u7528\u3057\u3066\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9a\u7fa9\u3057\u305f\u3082\u306e\u3067\u3001\u5165\u529b\u5024('X')\u306e\u5404\u5217\u3054\u3068\u306b\u305d\u306e\u5e73\u5747\u5024\u3092\u5c0e\u51fa\u3059\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002 cupy.RawKernel \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\u306b\u306f\u3001CUDA C\u3067\u8a18\u8ff0\u3055\u308c\u305fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3068\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u95a2\u6570\u540d\u304c\u5fc5\u8981\u3067\u3001\u3053\u308c\u306f __call__ \u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u51fa\u3057\u6642\u306b\u5b9f\u884c\u6642\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u884c\u308f\u308c\u307e\u3059\u3002\uff08\u30d3\u30eb\u30c9\u6e08\u307f\u30d0\u30a4\u30ca\u30ea\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u898b\u3064\u304b\u3089\u306a\u3051\u308c\u3070\uff09 __call__ \u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u306f\u9806\u306b\u30b0\u30ea\u30c3\u30c9\u306e\u5927\u304d\u3055\u3001\u30d6\u30ed\u30c3\u30af\u306e\u5927\u304d\u3055\u3001\u304a\u3088\u3073GPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3078\u306e\u5f15\u6570\u3067\u3059\u3002\u8a73\u7d30\u306a\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\u304c\u3001\u5165\u529b\u5024 X \u30922048\u500b\u306e\u8981\u7d20\u3054\u3068\u306b\u9818\u57df\u5206\u5272\u3057\u30011024\u500b\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u76f8\u4e92\u306b\u5354\u8abf\u52d5\u4f5c\u3092\u884c\u3044\u300111\u56de\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u5404\u30d6\u30ed\u30c3\u30af\u306e\u7dcf\u548c\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u3053\u308c\u304c\u5404\u30d6\u30ed\u30c3\u30af\u6bce\u306b\u4e26\u5217\u306b\u5b9f\u884c\u3055\u308c\u3001\u6700\u7d42\u7684\u306b\u51fa\u529b\u30d0\u30c3\u30d5\u30a1 Y \u306b\u306f\u5217\u3054\u3068\u306e\u7dcf\u548c\u304c\u683c\u7d0d\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 import psycopg2 import cupy import cupy_strom // connect to PostgreSQL, and get identifier of GPU buffer conn = psycopg2.connect(\"host=localhost dbname=postgres\") curr = conn.cursor() curr.execute(\"select pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])\") row = curr.fetchone() // import GPU buffer using the identifier string X = cupy_strom.ipc_import(row[0]) nattrs = X.shape[0] nitems = X.shape[1] gridSz = (nitems + 2047) >> 11; Y = cupy.zeros((nattrs)) // source code of the custom GPU kernel source=''' extern \"C\" __global__ __launch_bounds__(1024) void kern_gpu_sum(double *y, const float *x, int nitems) { __shared__ float lvalues[2048]; int gridSz = (nitems + 2047) / 2048; int colIdx = blockIdx.x / gridSz; int rowBase = (blockIdx.x % gridSz) * 2048; int localId = 2 * threadIdx.x; int i, k; // Load values to local shared buffer x += colIdx * nitems; for (i=threadIdx.x; i < 2048; i+=blockDim.x) lvalues[i] = (rowBase + i < nitems ? x[rowBase + i] : 0.0); __syncthreads(); // Run reduction operations for (k=0; k < 11; k++) { int mask = ((1 << k) - 1); if ((threadIdx.x & mask) == 0) lvalues[localId] += lvalues[localId + (1<<k)]; __syncthreads(); } // Write back the total sum if (threadIdx.x == 0) atomicAdd(&y[colIdx], lvalues[0]); } ''' kern = cupy.RawKernel(source, 'kern_gpu_sum') kern.__call__((gridSz * nattrs,1,1), (1024,1,1), (Y,X,nitems)) print(Y / nitems) conn.close() \u5b9f\u884c\u7d50\u679c =# SELECT pgstrom.arrow_fdw_truncate('ft'); =# INSERT INTO ft (SELECT x, pgstrom.random_int(0,1,10000)::float/100.0, pgstrom.random_int(0,-7500,2500)::float/100.0, pgstrom.random_int(0,5000,15000)::float/100.0 FROM generate_series(1,1000000) x); =# SELECT avg(x), avg(y), avg(z) FROM ft; avg | avg | avg ------------------+-------------------+------------------ 50.0225953391276 | -24.9964806686448 | 100.037490822002 (1 row) $ python ftest.py [ 50.02259536 -24.99648063 100.03749086] \u610f\u56f3\u7684\u306b\u5404\u5217\u306e\u5206\u5e03\u3092\u305a\u3089\u3057\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306b\u3088\u308b\u5e73\u5747\u5024\u306e\u8a08\u7b97\u3067\u3059\u304c\u3001GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4ecb\u3057\u3066cuPy\u3068\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u884c\u3044\u3001\u30ab\u30b9\u30bf\u30e0GPU\u30ab\u30fc\u30cd\u30eb\u3067\u8a08\u7b97\u3057\u305f\u5e73\u5747\u5024\u3068\u3001SQL\u3067\u306e\u8a08\u7b97\u7d50\u679c\u304c\u4e00\u81f4\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002","title":"cuPy\u3092\u7528\u3044\u305f\u30ab\u30b9\u30bf\u30e0GPU\u30ab\u30fc\u30cd\u30eb\u306e\u5b9f\u884c"},{"location":"python/#plpython","text":"PostgreSQL\u3067\u306fPython\u8a00\u8a9e\u306b\u3088\u308b\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u8a18\u8ff0\u304c\u53ef\u80fd\u3067\u3001\u6a19\u6e96\u3067\u540c\u68b1\u3055\u308c\u3066\u3044\u308b PL/Python \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u305d\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 CREATE FUNCTION \u69cb\u6587\u306e LANGUAGE \u53e5\u306b plpython3u \u3068\u6307\u5b9a\u3059\u308b\u4e8b\u3067\u3001\u305d\u306e\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306fPython\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u793a\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306bPL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\u5e73\u5747\u5024\u3092\u6c42\u3081\u308bGPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u306b\u306f\u3082\u3046\u4e00\u5ea6\u767b\u5834\u3057\u3066\u3082\u3089\u3046\u4e8b\u306b\u3057\u307e\u3059\u3002 PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u5f15\u6570\u306f\u3001\u9069\u5207\u306aPython\u30c7\u30fc\u30bf\u578b\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001SQL\u95a2\u6570 pgstrom.arrow_fdw_export_cupy \u306e\u8fd4\u5374\u3059\u308bGPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50(text)\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u3001\u3053\u308c\u3092Python\u5074\u3067\u306f cupy.ndarray \u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u53c2\u7167\u3057\u307e\u3059\u3002\u30b7\u30a7\u30eb\u4e0a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u3068\u5927\u304d\u306a\u9055\u3044\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u305f\u3060\u4e00\u70b9\u3060\u3051\u3001GPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9f\u884c\u3057\u3066 X \u306e\u5217\u3054\u3068\u306e\u7dcf\u548c\u3092 Y \u306b\u683c\u7d0d\u3057\u305f\u5f8c\u3001 X \u306b0\u3092\u4ee3\u5165\u3057\u3066\u660e\u793a\u7684\u306b cupy.ndarray \u3092\u89e3\u653e\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306f\u3001PL/Python\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306b X \u306b\u683c\u7d0d\u3057\u305f cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u751f\u304d\u7d9a\u3051\u3066\u3057\u307e\u3044\u3001\u8b58\u5225\u5b50\u3067\u53c2\u7167\u3057\u305fGPU\u30d0\u30c3\u30d5\u30a1\u304c\u30de\u30c3\u30d7\u3055\u308c\u7d9a\u3051\u3066\u3057\u307e\u3046\u305f\u3081\u306e\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3067\u3059\u3002 PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u4f8b CREATE OR REPLACE FUNCTION custom_average(x_ident text) RETURNS float[] AS $$ import cupy import cupy_strom X = cupy_strom.ipc_import(x_ident) nattrs = X.shape[0] nitems = X.shape[1] gridSz = (nitems + 2047) >> 11; Y = cupy.zeros((nattrs)) source=''' extern \"C\" __global__ __launch_bounds__(1024) void kern_gpu_sum(double *y, const float *x, int nitems) { __shared__ float lvalues[2048]; int gridSz = (nitems + 2047) / 2048; int colIdx = blockIdx.x / gridSz; int rowBase = (blockIdx.x % gridSz) * 2048; int localId = 2 * threadIdx.x; int i, k; // Load values to local shared buffer x += colIdx * nitems; for (i=threadIdx.x; i < 2048; i+=blockDim.x) lvalues[i] = (rowBase + i < nitems ? x[rowBase + i] : 0.0); __syncthreads(); // Run reduction operations for (k=0; k < 11; k++) { int mask = ((1 << k) - 1); if ((threadIdx.x & mask) == 0) lvalues[localId] += lvalues[localId + (1<<k)]; __syncthreads(); } // Write back the total sum if (threadIdx.x == 0) atomicAdd(&y[colIdx], lvalues[0]); } ''' kern = cupy.RawKernel(source, 'kern_gpu_sum') kern.__call__((gridSz * nattrs,0,0), (1024,0,0), (Y,X,nitems)) X = 0 # unmap GPU memory return Y / nitems $$ LANGUAGE 'plpython3u'; PL/Python\u3067\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u306eGPU\u30ab\u30fc\u30cd\u30eb\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u3001Python\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u547c\u3073\u51fa\u3059\u305f\u3081\u306e\u4e00\u9023\u306e\u30b9\u30c6\u30c3\u30d7\u304c\u7570\u306a\u3063\u3066\u304d\u307e\u3059\u3002 \u30b7\u30a7\u30eb\u4e0a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u6642\u3068\u306f\u7570\u306a\u308a\u3001SQL\u306e\u5b9f\u884c\u4e2d\u306b\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u3092\u901a\u3058\u3066Python\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3067\u304d\u308b\u305f\u3081\u3001\u308f\u3056\u308f\u3056\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u5f35\u3063\u305f\u308a\u3001SELECT\u6587\u3092\u5b9f\u884c\u3057\u3066\u8b58\u5225\u5b50\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 =# SELECT custom_average(pgstrom.arrow_fdw_export_cupy('ft','{x,y,z}'::text[])); custom_average ------------------------------------------------------- {50.0225953554688,-24.9964806318359,100.037490859375} (1 row) \u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001 pgstrom.arrow_fdw_export_cupy \u306e\u5b9f\u884c\u7d50\u679c\u3067\u3042\u308bGPU\u30d0\u30c3\u30d5\u30a1\u306e\u8b58\u5225\u5b50\u304c\u3001\u76f4\u63a5\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570 custom_average \u306e\u5f15\u6570\u3068\u3057\u3066\u5165\u529b\u3055\u308c\u3001\u305d\u3053\u3067Python\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u306e\u9593\u3067\u30c7\u30fc\u30bf\u4ea4\u63db\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001GPU\u30ab\u30fc\u30cd\u30eb\u304c\u8d77\u52d5\u3055\u308c\u3001\u7d50\u679c\u3092\u547c\u3073\u51fa\u3057\u5143\u306b\u8fd4\u3059\u307e\u3067\u306e\u6d41\u308c\u306f\u5168\u304f\u540c\u4e00\u3067\u3059\u3002 \u5916\u90e8\u30c6\u30fc\u30d6\u30ebft\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u3001\u3053\u308c\u3092\u5f15\u6570\u3068\u3057\u3066PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306b\u6e21\u3059\u306e\u3068\u306f\u3001PostgreSQL\u5074\u3067\u53d6\u308a\u6271\u3046\u3079\u304d\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u5168\u304f\u7570\u306a\u3063\u3066\u304f\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 GPU\u30d0\u30c3\u30d5\u30a1\u3092\u4ecb\u3057\u305f\u30c7\u30fc\u30bf\u4ea4\u63db\u30e1\u30ab\u30cb\u30ba\u30e0\u306e\u5834\u5408\u3001\u3053\u308c\u306f\u3042\u308b\u7a2e\u306e\"\u30dd\u30a4\u30f3\u30bf\u6e21\u3057\"\u3068\u3057\u3066\u6a5f\u80fd\u3059\u308b\u305f\u3081\u3001\"\u5024\u6e21\u3057\"\u30b9\u30bf\u30a4\u30eb\u3068\u6bd4\u3079\u3066\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u306e\u547c\u3073\u51fa\u3057\u305d\u306e\u3082\u306e\u304c\u975e\u5e38\u306b\u8efd\u3044\u51e6\u7406\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002","title":"PL/Python\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u304b\u3089\u306e\u5229\u7528"},{"location":"ref_devfuncs/","text":"\u95a2\u6570\u3068\u6f14\u7b97\u5b50 \u672c\u7ae0\u3067\u306fGPU\u30c7\u30d0\u30a4\u30b9\u4e0a\u3067\u5b9f\u884c\u53ef\u80fd\u306a\u95a2\u6570\u3068\u6f14\u7b97\u5b50\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u578b\u30ad\u30e3\u30b9\u30c8 destination type source type description bool int4 int2 int4,int8,float2,float4,float8,numeric int4 int2,int8,float2,float4,float8,numeric int8 int2,int4,float2,float4,float8,numeric float2 int2,int4,int8,float4,float8,numeric float4 int2,int4,int8,float2,float8,numeric float8 int2,int4,int8,float2,float4,numeric numeric int2,int4,int8,float2,float4,float8 money int4,int8,numeric inet cidr date timestamp,timestamptz time timetz,timestamp,timestamptz timetz time,timestamptz timestamp date,timestamptz timestamptz date,timestamp \u6570\u5024\u578b\u6f14\u7b97\u5b50 function/operator description TYPE COMP TYPE Comparison of two values TYPE is any of int2,int4,int8 COMP is any of =,<>,<,<=,>=,> TYPE COMP TYPE Comparison of two values TYPE is any of float2,float4,float8 COMP is any of =,<>,<,<=,>=,> numeric COMP numeric Comparison of two values COMP is any of =,<>,<,<=,>=,> TYPE + TYPE Arithemetic addition TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE - TYPE Arithemetic substract TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE * TYPE Arithemetic multiplication TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE / TYPE Arithemetic division TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE % TYPE Reminer operator TYPE is any of int2,int4,int8 TYPE & TYPE Bitwise AND TYPE is any of int2,int4,int8 TYPE | TYPE Bitwise OR TYPE is any of int2,int4,int8 TYPE # TYPE Bitwise XOR TYPE is any of int2,int4,int8 ~ TYPE Bitwise NOT TYPE is any if int2,int4,int8 TYPE >> int4 Right shift TYPE is any of int2,int4,int8 TYPE << int4 Left shift TYPE is any of int2,int4,int8 + TYPE Unary plus TYPE is any of int2,int4,int8,float2,float4,float8,numeric - TYPE Unary minus TYPE is any of int2,int4,int8,float2,float4,float8,numeric @TYPE Absolute value TYPE is any of int2,int4,int8,float2,float4,float8,numeric \u6570\u5b66\u95a2\u6570 functions/operators description cbrt(float8) cube root dcbrt(float8) cube root ceil(float8) nearest integer greater than or equal to argument ceiling(float8) nearest integer greater than or equal to argument exp(float8) exponential dexp(float8) exponential floor(float8) nearest integer less than or equal to argument ln(float8) natural logarithm dlog1(float8) natural logarithm log(float8) base 10 logarithm dlog10(float8) base 10 logarithm pi() circumference ratio power(float8,float8) power pow(float8,float8) power dpow(float8,float8) power round(float8) round to the nearest integer dround(float8) round to the nearest integer sign(float8) sign of the argument sqrt(float8) square root dsqrt(float8) square root trunc(float8) truncate toward zero dtrunc(float8) truncate toward zero \u4e09\u89d2\u95a2\u6570 functions/operators description degrees(float8) radians to degrees radians(float8) degrees to radians acos(float8) inverse cosine asin(float8) inverse sine atan(float8) inverse tangent atan2(float8,float8) inverse tangent of arg1 / arg2 cos(float8) cosine cot(float8) cotangent sin(float8) sine tan(float8) tangent \u65e5\u4ed8/\u6642\u523b\u578b\u6f14\u7b97\u5b50 functions/operators description date COMP date COMP is any of =,<>,<,<=,>=,> date COMP timestamp COMP is any of =,<>,<,<=,>=,> date COMP timestamptz COMP is any of =,<>,<,<=,>=,> time COMP time COMP is any of =,<>,<,<=,>=,> timetz COMP timetz COMP is any of =,<>,<,<=,>=,> timestamp COMP timestamp COMP is any of =,<>,<,<=,>=,> timestamp COMP date COMP is any of =,<>,<,<=,>=,> timestamptz COMP timestamptz COMP is any of =,<>,<,<=,>=,> timestamptz COMP date COMP is any of =,<>,<,<=,>=,> timestamp COMP timestamptz COMP is any of =,<>,<,<=,>=,> timestamptz COMP timestamp COMP is any of =,<>,<,<=,>=,> interval COMP interval COMP is any of =,<>,<,<=,>=,> date OP int4 OP is either of +,- int4 + date date - date date + time date + timetz time + date time - time timestamp - timestamp timetz OP interval OP is either of +,- timestamptz OP interval OP is either of +,- overlaps(TYPE,TYPE,TYPE,TYPE) TYPE is any of time,timetz,timestamp,timestamptz extract(text FROM TYPE) TYPE is any of time,timetz,timestamp,timestamptz,interval now() - interval unary minus operator interval OP interval OP is either of +,- \u6587\u5b57\u5217\u95a2\u6570/\u6f14\u7b97\u5b50 functions/operators description {text,bpchar} COMP {text,bpchar} COMP is either of =,<> {text,bpchar} COMP {text,bpchar} COMP is either of <,<=,>=,> Only available on no-locale or UTF-8 varchar || varchar Both side must be varchar(n) with maximum length. substring , substr length(TYPE) length of the string TYPE is either of text,bpchar TYPE LIKE text TYPE is either of text,bpchar TYPE NOT LIKE text TYPE is either of text,bpchar TYPE ILIKE text TYPE is either of text,bpchar Only available on no-locale or UTF-8 TYPE NOT ILIKE text TYPE is either of text,bpchar Only available on no-locale or UTF-8 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u6570/\u6f14\u7b97\u5b50 functions/operators description macaddr COMP macaddr COMP is any of =,<>,<,<=,>=,> macaddr & macaddr Bitwise AND operator macaddr | macaddr Bitwise OR operator ~ macaddr Bitwise NOT operator trunc(macaddr) Set last 3 bytes to zero inet COMP inet COMP is any of =,<>,<,<=,>=,> inet INCL inet INCL is any of <<,<<=,>>,>>=,&& ~ inet inet & inet inet | inet inet + int8 inet - int8 inet - inet broadcast(inet) family(inet) hostmask(inet) masklen(inet) netmask(inet) network(inet) set_masklen(cidr,int) set_masklen(inet,int) inet_same_family(inet, inet) inet_merge(inet,inet) \u901a\u8ca8\u578b\u6f14\u7b97\u5b50 functions/operators description money COMP money COMP is any of =,<>,<,<=,>=,> money OP money OP is any of +,-,/ money * TYPE TYPE is any of int2,int4,float2,float4,float8 TYPE * money TYPE is any of int2,int4,float2,float4,float8 money / TYPE TYPE is any of int2,int4,float2,float4,float8 uuid\u578b\u6f14\u7b97\u5b50 functions/operators description uuid COMP uuid COMP is any of =,<>,<,<=,>=,> JSONB\u578b\u6f14\u7b97\u5b50 functions/operators description jsonb -> KEY Get a JSON object field specified by the KEY jsonb -> NUM Get a JSON array element indexed by NUM jsonb ->> KEY Get a JSON object field specified by the KEY , as text jsonb ->> NUM Get a JSON array element indexed by NUM (jsonb ->> KEY)::TYPE TYPE is any of int2,int4,int8,float4,float8,numeric Get a JSON object field specified by KEY , as numeric data type. See the note below. (jsonb ->> NUM)::TYPE TYPE is any of int2,int4,int8,float4,float8,numeric Get a JSON array element indexed by NUM , as numeric data type. See the note below. jsonb ? KEY Check whether jsonb object contains the KEY Note jsonb ->> KEY \u6f14\u7b97\u5b50\u306b\u3088\u3063\u3066\u53d6\u308a\u51fa\u3057\u305f\u6570\u5024\u30c7\u30fc\u30bf\u3092 float \u3084 numeric \u306a\u3069\u6570\u5024\u578b\u306b\u5909\u63db\u3059\u308b\u6642\u3001\u901a\u5e38\u3001PostgreSQL\u306fjsonb\u5185\u90e8\u8868\u73fe\u3092\u30c6\u30ad\u30b9\u30c8\u3068\u3057\u3066\u51fa\u529b\u3057\u3001\u305d\u308c\u3092\u6570\u5024\u8868\u73fe\u306b\u5909\u63db\u3059\u308b\u3068\u3044\u30462\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002 PG-Strom\u306f jsonb ->> KEY \u6f14\u7b97\u5b50\u306b\u3088\u308b\u53c2\u7167\u3068\u30c6\u30ad\u30b9\u30c8\u21d2\u6570\u5024\u8868\u73fe\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u304c\u9023\u7d9a\u3057\u3066\u3044\u308b\u6642\u3001jsonb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304b\u3089\u6570\u5024\u8868\u73fe\u3092\u53d6\u308a\u51fa\u3059\u305f\u3081\u306e\u7279\u5225\u306a\u30c7\u30d0\u30a4\u30b9\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3067\u6700\u9069\u5316\u3092\u884c\u3044\u307e\u3059\u3002 \u7bc4\u56f2\u578b\u6f14\u7b97\u5b50 functions/operators description RANGE = RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE <> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE < RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE <= RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE > RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE >= RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE @ RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE @ TYPE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE is element type of RANGE . RANGE <@RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE <@RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE is element type of RANGE . RANGE && RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE << RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE >> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE &< RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE &> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE -|- RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE + RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE * RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE - RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange isempty(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower_inc(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper_inc(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower_inf(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper_inf(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange range_merge(RANGE,RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange \u305d\u306e\u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\u95a2\u6570 functions/operators result description as_int8(float8) int8 Re-interpret double-precision floating point bit-pattern as 64bit integer value as_int4(float4) int4 Re-interpret single-precision floating point bit-pattern as 32bit integer value as_int2(float2) int2 Re-interpret half-precision floating point bit-pattern as 16bit integer value as_float8(int8) float8 Re-interpret 64bit integer bit-pattern as double-precision floating point value as_float4(int4) float4 Re-interpret 32bit integer bit-pattern as single-precision floating point value as_float2(int2) float2 Re-interpret 16bit integer bit-pattern as half-precision floating point value","title":"\u95a2\u6570\u3068\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_1","text":"destination type source type description bool int4 int2 int4,int8,float2,float4,float8,numeric int4 int2,int8,float2,float4,float8,numeric int8 int2,int4,float2,float4,float8,numeric float2 int2,int4,int8,float4,float8,numeric float4 int2,int4,int8,float2,float8,numeric float8 int2,int4,int8,float2,float4,numeric numeric int2,int4,int8,float2,float4,float8 money int4,int8,numeric inet cidr date timestamp,timestamptz time timetz,timestamp,timestamptz timetz time,timestamptz timestamp date,timestamptz timestamptz date,timestamp","title":"\u578b\u30ad\u30e3\u30b9\u30c8"},{"location":"ref_devfuncs/#_2","text":"function/operator description TYPE COMP TYPE Comparison of two values TYPE is any of int2,int4,int8 COMP is any of =,<>,<,<=,>=,> TYPE COMP TYPE Comparison of two values TYPE is any of float2,float4,float8 COMP is any of =,<>,<,<=,>=,> numeric COMP numeric Comparison of two values COMP is any of =,<>,<,<=,>=,> TYPE + TYPE Arithemetic addition TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE - TYPE Arithemetic substract TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE * TYPE Arithemetic multiplication TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE / TYPE Arithemetic division TYPE is any of int2,int4,int8,float2,float4,float8,numeric TYPE % TYPE Reminer operator TYPE is any of int2,int4,int8 TYPE & TYPE Bitwise AND TYPE is any of int2,int4,int8 TYPE | TYPE Bitwise OR TYPE is any of int2,int4,int8 TYPE # TYPE Bitwise XOR TYPE is any of int2,int4,int8 ~ TYPE Bitwise NOT TYPE is any if int2,int4,int8 TYPE >> int4 Right shift TYPE is any of int2,int4,int8 TYPE << int4 Left shift TYPE is any of int2,int4,int8 + TYPE Unary plus TYPE is any of int2,int4,int8,float2,float4,float8,numeric - TYPE Unary minus TYPE is any of int2,int4,int8,float2,float4,float8,numeric @TYPE Absolute value TYPE is any of int2,int4,int8,float2,float4,float8,numeric","title":"\u6570\u5024\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_3","text":"functions/operators description cbrt(float8) cube root dcbrt(float8) cube root ceil(float8) nearest integer greater than or equal to argument ceiling(float8) nearest integer greater than or equal to argument exp(float8) exponential dexp(float8) exponential floor(float8) nearest integer less than or equal to argument ln(float8) natural logarithm dlog1(float8) natural logarithm log(float8) base 10 logarithm dlog10(float8) base 10 logarithm pi() circumference ratio power(float8,float8) power pow(float8,float8) power dpow(float8,float8) power round(float8) round to the nearest integer dround(float8) round to the nearest integer sign(float8) sign of the argument sqrt(float8) square root dsqrt(float8) square root trunc(float8) truncate toward zero dtrunc(float8) truncate toward zero","title":"\u6570\u5b66\u95a2\u6570"},{"location":"ref_devfuncs/#_4","text":"functions/operators description degrees(float8) radians to degrees radians(float8) degrees to radians acos(float8) inverse cosine asin(float8) inverse sine atan(float8) inverse tangent atan2(float8,float8) inverse tangent of arg1 / arg2 cos(float8) cosine cot(float8) cotangent sin(float8) sine tan(float8) tangent","title":"\u4e09\u89d2\u95a2\u6570"},{"location":"ref_devfuncs/#_5","text":"functions/operators description date COMP date COMP is any of =,<>,<,<=,>=,> date COMP timestamp COMP is any of =,<>,<,<=,>=,> date COMP timestamptz COMP is any of =,<>,<,<=,>=,> time COMP time COMP is any of =,<>,<,<=,>=,> timetz COMP timetz COMP is any of =,<>,<,<=,>=,> timestamp COMP timestamp COMP is any of =,<>,<,<=,>=,> timestamp COMP date COMP is any of =,<>,<,<=,>=,> timestamptz COMP timestamptz COMP is any of =,<>,<,<=,>=,> timestamptz COMP date COMP is any of =,<>,<,<=,>=,> timestamp COMP timestamptz COMP is any of =,<>,<,<=,>=,> timestamptz COMP timestamp COMP is any of =,<>,<,<=,>=,> interval COMP interval COMP is any of =,<>,<,<=,>=,> date OP int4 OP is either of +,- int4 + date date - date date + time date + timetz time + date time - time timestamp - timestamp timetz OP interval OP is either of +,- timestamptz OP interval OP is either of +,- overlaps(TYPE,TYPE,TYPE,TYPE) TYPE is any of time,timetz,timestamp,timestamptz extract(text FROM TYPE) TYPE is any of time,timetz,timestamp,timestamptz,interval now() - interval unary minus operator interval OP interval OP is either of +,-","title":"\u65e5\u4ed8/\u6642\u523b\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_6","text":"functions/operators description {text,bpchar} COMP {text,bpchar} COMP is either of =,<> {text,bpchar} COMP {text,bpchar} COMP is either of <,<=,>=,> Only available on no-locale or UTF-8 varchar || varchar Both side must be varchar(n) with maximum length. substring , substr length(TYPE) length of the string TYPE is either of text,bpchar TYPE LIKE text TYPE is either of text,bpchar TYPE NOT LIKE text TYPE is either of text,bpchar TYPE ILIKE text TYPE is either of text,bpchar Only available on no-locale or UTF-8 TYPE NOT ILIKE text TYPE is either of text,bpchar Only available on no-locale or UTF-8","title":"\u6587\u5b57\u5217\u95a2\u6570/\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_7","text":"functions/operators description macaddr COMP macaddr COMP is any of =,<>,<,<=,>=,> macaddr & macaddr Bitwise AND operator macaddr | macaddr Bitwise OR operator ~ macaddr Bitwise NOT operator trunc(macaddr) Set last 3 bytes to zero inet COMP inet COMP is any of =,<>,<,<=,>=,> inet INCL inet INCL is any of <<,<<=,>>,>>=,&& ~ inet inet & inet inet | inet inet + int8 inet - int8 inet - inet broadcast(inet) family(inet) hostmask(inet) masklen(inet) netmask(inet) network(inet) set_masklen(cidr,int) set_masklen(inet,int) inet_same_family(inet, inet) inet_merge(inet,inet)","title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u6570/\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_8","text":"functions/operators description money COMP money COMP is any of =,<>,<,<=,>=,> money OP money OP is any of +,-,/ money * TYPE TYPE is any of int2,int4,float2,float4,float8 TYPE * money TYPE is any of int2,int4,float2,float4,float8 money / TYPE TYPE is any of int2,int4,float2,float4,float8","title":"\u901a\u8ca8\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#uuid","text":"functions/operators description uuid COMP uuid COMP is any of =,<>,<,<=,>=,>","title":"uuid\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#jsonb","text":"functions/operators description jsonb -> KEY Get a JSON object field specified by the KEY jsonb -> NUM Get a JSON array element indexed by NUM jsonb ->> KEY Get a JSON object field specified by the KEY , as text jsonb ->> NUM Get a JSON array element indexed by NUM (jsonb ->> KEY)::TYPE TYPE is any of int2,int4,int8,float4,float8,numeric Get a JSON object field specified by KEY , as numeric data type. See the note below. (jsonb ->> NUM)::TYPE TYPE is any of int2,int4,int8,float4,float8,numeric Get a JSON array element indexed by NUM , as numeric data type. See the note below. jsonb ? KEY Check whether jsonb object contains the KEY Note jsonb ->> KEY \u6f14\u7b97\u5b50\u306b\u3088\u3063\u3066\u53d6\u308a\u51fa\u3057\u305f\u6570\u5024\u30c7\u30fc\u30bf\u3092 float \u3084 numeric \u306a\u3069\u6570\u5024\u578b\u306b\u5909\u63db\u3059\u308b\u6642\u3001\u901a\u5e38\u3001PostgreSQL\u306fjsonb\u5185\u90e8\u8868\u73fe\u3092\u30c6\u30ad\u30b9\u30c8\u3068\u3057\u3066\u51fa\u529b\u3057\u3001\u305d\u308c\u3092\u6570\u5024\u8868\u73fe\u306b\u5909\u63db\u3059\u308b\u3068\u3044\u30462\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002 PG-Strom\u306f jsonb ->> KEY \u6f14\u7b97\u5b50\u306b\u3088\u308b\u53c2\u7167\u3068\u30c6\u30ad\u30b9\u30c8\u21d2\u6570\u5024\u8868\u73fe\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u304c\u9023\u7d9a\u3057\u3066\u3044\u308b\u6642\u3001jsonb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304b\u3089\u6570\u5024\u8868\u73fe\u3092\u53d6\u308a\u51fa\u3059\u305f\u3081\u306e\u7279\u5225\u306a\u30c7\u30d0\u30a4\u30b9\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3067\u6700\u9069\u5316\u3092\u884c\u3044\u307e\u3059\u3002","title":"JSONB\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_9","text":"functions/operators description RANGE = RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE <> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE < RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE <= RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE > RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE >= RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE @ RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE @ TYPE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE is element type of RANGE . RANGE <@RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE <@RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange TYPE is element type of RANGE . RANGE && RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE << RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE >> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE &< RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE &> RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE -|- RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE + RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE * RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange RANGE - RANGE RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange isempty(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower_inc(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper_inc(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange lower_inf(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange upper_inf(RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange range_merge(RANGE,RANGE) RANGE is any of int4range,int8range,tsrange,tstzrange,daterange","title":"\u7bc4\u56f2\u578b\u6f14\u7b97\u5b50"},{"location":"ref_devfuncs/#_10","text":"functions/operators result description as_int8(float8) int8 Re-interpret double-precision floating point bit-pattern as 64bit integer value as_int4(float4) int4 Re-interpret single-precision floating point bit-pattern as 32bit integer value as_int2(float2) int2 Re-interpret half-precision floating point bit-pattern as 16bit integer value as_float8(int8) float8 Re-interpret 64bit integer bit-pattern as double-precision floating point value as_float4(int4) float4 Re-interpret 32bit integer bit-pattern as single-precision floating point value as_float2(int2) float2 Re-interpret 16bit integer bit-pattern as half-precision floating point value","title":"\u305d\u306e\u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\u95a2\u6570"},{"location":"ref_params/","text":"GUC\u30d1\u30e9\u30e1\u30fc\u30bf \u672c\u7bc0\u3067\u306fPG-Strom\u306e\u63d0\u4f9b\u3059\u308b\u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u7279\u5b9a\u6a5f\u80fd\u306e\u6709\u52b9\u5316/\u7121\u52b9\u5316 \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enabled bool on PG-Strom\u6a5f\u80fd\u5168\u4f53\u3092\u4e00\u62ec\u3057\u3066\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpuscan bool on GpuScan\u306b\u3088\u308b\u30b9\u30ad\u30e3\u30f3\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpuhashjoin bool on HashJoin\u306b\u3088\u308bGpuJoin\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpunestloop bool on NestLoop\u306b\u3088\u308bGpuJoin\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpupreagg bool on GpuPreAgg\u306b\u3088\u308b\u96c6\u7d04\u51e6\u7406\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_brin bool on BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u3063\u305f\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_partitionwise_gpujoin bool on GpuJoin\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.enable_partitionwise_gpupreagg bool on GpuPreAgg\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.pullup_outer_scan bool on GpuPreAgg/GpuJoin\u76f4\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u304c\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u3067\u3042\u308b\u5834\u5408\u306b\u3001\u4e0a\u4f4d\u30ce\u30fc\u30c9\u3067\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u3082\u884c\u3044\u3001CPU/RAM\u21d4GPU\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u7701\u7565\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.pullup_outer_join bool on GpuPreAgg\u76f4\u4e0b\u304cGpuJoin\u3067\u3042\u308b\u5834\u5408\u306b\u3001JOIN\u51e6\u7406\u3092\u4e0a\u4f4d\u306e\u5b9f\u884c\u8a08\u753b\u306b\u5f15\u304d\u4e0a\u3052\u3001CPU\u21d4GPU\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u7701\u7565\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.enable_numeric_aggfuncs bool on numeric \u30c7\u30fc\u30bf\u578b\u3092\u5f15\u6570\u306b\u53d6\u308b\u96c6\u7d04\u6f14\u7b97\u3092GPU\u3067\u51e6\u7406\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.cpu_fallback bool off GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\"CPU\u518d\u5b9f\u884c\"\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u305f\u3068\u304d\u306b\u3001\u5b9f\u969b\u306bCPU\u3067\u306e\u518d\u5b9f\u884c\u3092\u8a66\u307f\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.regression_test_mode bool off GPU\u30e2\u30c7\u30eb\u540d\u306a\u3069\u3001\u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u3066\u8868\u793a\u304c\u5909\u308f\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b EXPLAIN \u30b3\u30de\u30f3\u30c9\u306e\u51fa\u529b\u3092\u6291\u5236\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306b\u304a\u3051\u308b\u507d\u967d\u6027\u3092\u9632\u3050\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3001\u901a\u5e38\u306f\u5229\u7528\u8005\u304c\u64cd\u4f5c\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u95a2\u3059\u308b\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.chunk_size int 65534kB PG-Strom\u304c1\u56de\u306eGPU\u30ab\u30fc\u30cd\u30eb\u547c\u3073\u51fa\u3057\u3067\u51e6\u7406\u3059\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u5927\u304d\u3055\u3067\u3059\u3002\u304b\u3064\u3066\u306f\u5909\u66f4\u53ef\u80fd\u3067\u3057\u305f\u304c\u3001\u307b\u3068\u3093\u3069\u610f\u5473\u304c\u306a\u3044\u305f\u3081\u3001\u73fe\u5728\u3067\u306f\u7d0464MB\u306b\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 pg_strom.gpu_setup_cost real 4000 GPU\u30c7\u30d0\u30a4\u30b9\u306e\u521d\u671f\u5316\u306b\u8981\u3059\u308b\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 pg_strom.gpu_dma_cost real 10 \u30c1\u30e3\u30f3\u30af(64MB)\u3042\u305f\u308a\u306eDMA\u8ee2\u9001\u306b\u8981\u3059\u308b\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 pg_strom.gpu_operator_cost real 0.00015 GPU\u306e\u6f14\u7b97\u5f0f\u3042\u305f\u308a\u306e\u51e6\u7406\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 cpu_operator_cost \u3088\u308a\u3082\u5927\u304d\u306a\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u3044\u304b\u306a\u308b\u30b5\u30a4\u30ba\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3082PG-Strom\u304c\u9078\u629e\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u304f\u306a\u308b\u3002 \u30a8\u30b0\u30bc\u30ad\u30e5\u30fc\u30bf\u306b\u95a2\u3059\u308b\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.global_max_async_tasks int 160 PG-Strom\u304cGPU\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u975e\u540c\u671f\u30bf\u30b9\u30af\u306e\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067\u306e\u6700\u5927\u5024\u3002 pg_strom.local_max_async_tasks int 8 PG-Strom\u304cGPU\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u975e\u540c\u671f\u30bf\u30b9\u30af\u306e\u30d7\u30ed\u30bb\u30b9\u6bce\u306e\u6700\u5927\u5024\u3002CPU\u30d1\u30e9\u30ec\u30eb\u51e6\u7406\u3068\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u4e0a\u9650\u5024\u306f\u500b\u3005\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u6bce\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u30d0\u30c3\u30c1\u30b8\u30e7\u30d6\u5168\u4f53\u3067\u306f pg_strom.local_max_async_tasks \u3088\u308a\u3082\u591a\u304f\u306e\u975e\u540c\u671f\u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002 pg_strom.max_number_of_gpucontext int \u81ea\u52d5 GPU\u30c7\u30d0\u30a4\u30b9\u3092\u62bd\u8c61\u5316\u3057\u305f\u5185\u90e8\u30c7\u30fc\u30bf\u69cb\u9020 GpuContext \u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u3001\u521d\u671f\u5024\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u95a2\u9023\u306e\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.nvme_strom_enabled bool on SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.nvme_strom_threshold int \u81ea\u52d5 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u3092\u767a\u52d5\u3055\u305b\u308b\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u306e\u95be\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002 pg_strom.nvme_distance_map string NULL NVME-SSD\u306b\u8fd1\u3044GPU\u3092\u624b\u52d5\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u306fsysfs\u304b\u3089\u53d6\u5f97\u3057\u305fPCIe\u30d0\u30b9\u30c8\u30dd\u30ed\u30b8\u60c5\u5831\u306b\u3088\u308b\u81ea\u52d5\u8a2d\u5b9a\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002 Arrow_Fdw\u95a2\u9023\u306e\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e arrow_fdw.enabled bool on \u63a8\u5b9a\u30b3\u30b9\u30c8\u5024\u3092\u8abf\u6574\u3057\u3001Arrow_Fdw\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\u305f\u3060\u3057\u3001GpuScan\u304c\u5229\u7528\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u306f\u3001Arrow_Fdw\u306b\u3088\u308bForeign Scan\u3060\u3051\u304cArrow\u30d5\u30a1\u30a4\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3067\u304d\u308b\u3068\u3044\u3046\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 arrow_fdw.metadata_cache_size int 128MB Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u5171\u6709\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 arrow_fdw.record_batch_size int 256MB Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u66f8\u304d\u8fbc\u3080\u969b\u306e RecordBatch \u306e\u5927\u304d\u3055\u306e\u95be\u5024\u3067\u3059\u3002 INSERT \u30b3\u30de\u30f3\u30c9\u304c\u5b8c\u4e86\u3057\u3066\u3044\u306a\u304f\u3068\u3082\u3001Arrow_Fdw\u306f\u7dcf\u66f8\u304d\u8fbc\u307f\u30b5\u30a4\u30ba\u304c\u3053\u306e\u5024\u3092\u8d8a\u3048\u308b\u3068\u30d0\u30c3\u30d5\u30a1\u306e\u5185\u5bb9\u3092Apache Arrow\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002 GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u751f\u6210\u3068\u30d3\u30eb\u30c9\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.program_cache_size int 256MB \u30d3\u30eb\u30c9\u6e08\u307f\u306eGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304f\u305f\u3081\u306e\u5171\u6709\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30b5\u30a4\u30ba\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 pg_strom.num_program_builders int 2 GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u975e\u540c\u671f\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 pg_strom.debug_jit_compile_options bool off GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306eJIT\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u3001\u30c7\u30d0\u30c3\u30b0\u30aa\u30d7\u30b7\u30e7\u30f3\uff08\u884c\u756a\u53f7\u3068\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\uff09\u3092\u542b\u3081\u308b\u304b\u3069\u3046\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002GPU\u30b3\u30a2\u30c0\u30f3\u30d7\u7b49\u3092\u7528\u3044\u305f\u8907\u96d1\u306a\u30d0\u30b0\u306e\u89e3\u6790\u306b\u6709\u7528\u3067\u3059\u304c\u3001\u6027\u80fd\u306e\u30c7\u30b0\u30ec\u30fc\u30c9\u3092\u5f15\u304d\u8d77\u3053\u3059\u305f\u3081\u3001\u901a\u5e38\u306f\u4f7f\u7528\u3059\u3079\u304d\u3067\u3042\u308a\u307e\u305b\u3093\u3002 pg_strom.debug_kernel_source bool off \u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c on \u306e\u5834\u5408\u3001 EXPLAIN VERBOSE \u30b3\u30de\u30f3\u30c9\u3067\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304d\u51fa\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u51fa\u529b\u3057\u307e\u3059\u3002 GPU\u30c7\u30d0\u30a4\u30b9\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.cuda_visible_devices string '' PostgreSQL\u306e\u8d77\u52d5\u6642\u306b\u7279\u5b9a\u306eGPU\u30c7\u30d0\u30a4\u30b9\u3060\u3051\u3092\u8a8d\u8b58\u3055\u305b\u3066\u3044\u5834\u5408\u306f\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u74b0\u5883\u5909\u6570 CUDA_VISIBLE_DEVICES \u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3068\u540c\u7b49\u3067\u3059\u3002 pg_strom.gpu_memory_segment_size int 512MB PG-Strom\u304cGPU\u30e1\u30e2\u30ea\u3092\u30a2\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u969b\u306b\u30011\u56de\u306eCUDA API\u547c\u3073\u51fa\u3057\u3067\u7372\u5f97\u3059\u308bGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306e\u5024\u304c\u5927\u304d\u3044\u3068API\u547c\u3073\u51fa\u3057\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306f\u6e1b\u3089\u305b\u307e\u3059\u304c\u3001\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30ed\u30b9\u306f\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u3002 pg_strom.max_num_preserved_gpu_memory int 2048 \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u6570\u306e\u4e0a\u9650\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u306f\u521d\u671f\u5024\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u30b7\u30b9\u30c6\u30e0\u5171\u6709\u30e1\u30e2\u30ea\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a \u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e shmbuf.segment_size int 256MB shmbuf.num_logical_segments int \u81ea\u52d5 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8ad6\u7406\u30bb\u30b0\u30e1\u30f3\u30c8\u30b5\u30a4\u30ba\u306f\u30b7\u30b9\u30c6\u30e0\u642d\u8f09\u7269\u7406\u30e1\u30e2\u30ea\u306e2\u500d\u306e\u5927\u304d\u3055\u3067\u3059\u3002","title":"GUC\u30d1\u30e9\u30e1\u30fc\u30bf"},{"location":"ref_params/#_1","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.enabled bool on PG-Strom\u6a5f\u80fd\u5168\u4f53\u3092\u4e00\u62ec\u3057\u3066\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpuscan bool on GpuScan\u306b\u3088\u308b\u30b9\u30ad\u30e3\u30f3\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpuhashjoin bool on HashJoin\u306b\u3088\u308bGpuJoin\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpunestloop bool on NestLoop\u306b\u3088\u308bGpuJoin\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_gpupreagg bool on GpuPreAgg\u306b\u3088\u308b\u96c6\u7d04\u51e6\u7406\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_brin bool on BRIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u3063\u305f\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.enable_partitionwise_gpujoin bool on GpuJoin\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.enable_partitionwise_gpupreagg bool on GpuPreAgg\u3092\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8981\u7d20\u3078\u30d7\u30c3\u30b7\u30e5\u30c0\u30a6\u30f3\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002PostgreSQL v10\u4ee5\u964d\u3067\u306e\u307f\u5bfe\u5fdc\u3002 pg_strom.pullup_outer_scan bool on GpuPreAgg/GpuJoin\u76f4\u4e0b\u306e\u5b9f\u884c\u8a08\u753b\u304c\u5168\u4ef6\u30b9\u30ad\u30e3\u30f3\u3067\u3042\u308b\u5834\u5408\u306b\u3001\u4e0a\u4f4d\u30ce\u30fc\u30c9\u3067\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u3082\u884c\u3044\u3001CPU/RAM\u21d4GPU\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u7701\u7565\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.pullup_outer_join bool on GpuPreAgg\u76f4\u4e0b\u304cGpuJoin\u3067\u3042\u308b\u5834\u5408\u306b\u3001JOIN\u51e6\u7406\u3092\u4e0a\u4f4d\u306e\u5b9f\u884c\u8a08\u753b\u306b\u5f15\u304d\u4e0a\u3052\u3001CPU\u21d4GPU\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u7701\u7565\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.enable_numeric_aggfuncs bool on numeric \u30c7\u30fc\u30bf\u578b\u3092\u5f15\u6570\u306b\u53d6\u308b\u96c6\u7d04\u6f14\u7b97\u3092GPU\u3067\u51e6\u7406\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.cpu_fallback bool off GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\"CPU\u518d\u5b9f\u884c\"\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u305f\u3068\u304d\u306b\u3001\u5b9f\u969b\u306bCPU\u3067\u306e\u518d\u5b9f\u884c\u3092\u8a66\u307f\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u3002 pg_strom.regression_test_mode bool off GPU\u30e2\u30c7\u30eb\u540d\u306a\u3069\u3001\u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u3066\u8868\u793a\u304c\u5909\u308f\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b EXPLAIN \u30b3\u30de\u30f3\u30c9\u306e\u51fa\u529b\u3092\u6291\u5236\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306b\u304a\u3051\u308b\u507d\u967d\u6027\u3092\u9632\u3050\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3001\u901a\u5e38\u306f\u5229\u7528\u8005\u304c\u64cd\u4f5c\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002","title":"\u7279\u5b9a\u6a5f\u80fd\u306e\u6709\u52b9\u5316/\u7121\u52b9\u5316"},{"location":"ref_params/#_2","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.chunk_size int 65534kB PG-Strom\u304c1\u56de\u306eGPU\u30ab\u30fc\u30cd\u30eb\u547c\u3073\u51fa\u3057\u3067\u51e6\u7406\u3059\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306e\u5927\u304d\u3055\u3067\u3059\u3002\u304b\u3064\u3066\u306f\u5909\u66f4\u53ef\u80fd\u3067\u3057\u305f\u304c\u3001\u307b\u3068\u3093\u3069\u610f\u5473\u304c\u306a\u3044\u305f\u3081\u3001\u73fe\u5728\u3067\u306f\u7d0464MB\u306b\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 pg_strom.gpu_setup_cost real 4000 GPU\u30c7\u30d0\u30a4\u30b9\u306e\u521d\u671f\u5316\u306b\u8981\u3059\u308b\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 pg_strom.gpu_dma_cost real 10 \u30c1\u30e3\u30f3\u30af(64MB)\u3042\u305f\u308a\u306eDMA\u8ee2\u9001\u306b\u8981\u3059\u308b\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 pg_strom.gpu_operator_cost real 0.00015 GPU\u306e\u6f14\u7b97\u5f0f\u3042\u305f\u308a\u306e\u51e6\u7406\u30b3\u30b9\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3002 cpu_operator_cost \u3088\u308a\u3082\u5927\u304d\u306a\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u3044\u304b\u306a\u308b\u30b5\u30a4\u30ba\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3082PG-Strom\u304c\u9078\u629e\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u304f\u306a\u308b\u3002","title":"\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306b\u95a2\u3059\u308b\u8a2d\u5b9a"},{"location":"ref_params/#_3","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.global_max_async_tasks int 160 PG-Strom\u304cGPU\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u975e\u540c\u671f\u30bf\u30b9\u30af\u306e\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067\u306e\u6700\u5927\u5024\u3002 pg_strom.local_max_async_tasks int 8 PG-Strom\u304cGPU\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u6295\u5165\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u975e\u540c\u671f\u30bf\u30b9\u30af\u306e\u30d7\u30ed\u30bb\u30b9\u6bce\u306e\u6700\u5927\u5024\u3002CPU\u30d1\u30e9\u30ec\u30eb\u51e6\u7406\u3068\u4f75\u7528\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u4e0a\u9650\u5024\u306f\u500b\u3005\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u6bce\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u30d0\u30c3\u30c1\u30b8\u30e7\u30d6\u5168\u4f53\u3067\u306f pg_strom.local_max_async_tasks \u3088\u308a\u3082\u591a\u304f\u306e\u975e\u540c\u671f\u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002 pg_strom.max_number_of_gpucontext int \u81ea\u52d5 GPU\u30c7\u30d0\u30a4\u30b9\u3092\u62bd\u8c61\u5316\u3057\u305f\u5185\u90e8\u30c7\u30fc\u30bf\u69cb\u9020 GpuContext \u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u3001\u521d\u671f\u5024\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002","title":"\u30a8\u30b0\u30bc\u30ad\u30e5\u30fc\u30bf\u306b\u95a2\u3059\u308b\u8a2d\u5b9a"},{"location":"ref_params/#ssd-to-gpu","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.nvme_strom_enabled bool on SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u3092\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3002 pg_strom.nvme_strom_threshold int \u81ea\u52d5 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u3092\u767a\u52d5\u3055\u305b\u308b\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u306e\u95be\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002 pg_strom.nvme_distance_map string NULL NVME-SSD\u306b\u8fd1\u3044GPU\u3092\u624b\u52d5\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u306fsysfs\u304b\u3089\u53d6\u5f97\u3057\u305fPCIe\u30d0\u30b9\u30c8\u30dd\u30ed\u30b8\u60c5\u5831\u306b\u3088\u308b\u81ea\u52d5\u8a2d\u5b9a\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002","title":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u95a2\u9023\u306e\u8a2d\u5b9a"},{"location":"ref_params/#arrow_fdw","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e arrow_fdw.enabled bool on \u63a8\u5b9a\u30b3\u30b9\u30c8\u5024\u3092\u8abf\u6574\u3057\u3001Arrow_Fdw\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\u305f\u3060\u3057\u3001GpuScan\u304c\u5229\u7528\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u306f\u3001Arrow_Fdw\u306b\u3088\u308bForeign Scan\u3060\u3051\u304cArrow\u30d5\u30a1\u30a4\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3067\u304d\u308b\u3068\u3044\u3046\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 arrow_fdw.metadata_cache_size int 128MB Arrow\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u5171\u6709\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 arrow_fdw.record_batch_size int 256MB Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u3078\u66f8\u304d\u8fbc\u3080\u969b\u306e RecordBatch \u306e\u5927\u304d\u3055\u306e\u95be\u5024\u3067\u3059\u3002 INSERT \u30b3\u30de\u30f3\u30c9\u304c\u5b8c\u4e86\u3057\u3066\u3044\u306a\u304f\u3068\u3082\u3001Arrow_Fdw\u306f\u7dcf\u66f8\u304d\u8fbc\u307f\u30b5\u30a4\u30ba\u304c\u3053\u306e\u5024\u3092\u8d8a\u3048\u308b\u3068\u30d0\u30c3\u30d5\u30a1\u306e\u5185\u5bb9\u3092Apache Arrow\u30d5\u30a1\u30a4\u30eb\u3078\u3068\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002","title":"Arrow_Fdw\u95a2\u9023\u306e\u8a2d\u5b9a"},{"location":"ref_params/#gpu","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.program_cache_size int 256MB \u30d3\u30eb\u30c9\u6e08\u307f\u306eGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304f\u305f\u3081\u306e\u5171\u6709\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30b5\u30a4\u30ba\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 pg_strom.num_program_builders int 2 GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u975e\u540c\u671f\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u306b\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002 pg_strom.debug_jit_compile_options bool off GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306eJIT\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u3001\u30c7\u30d0\u30c3\u30b0\u30aa\u30d7\u30b7\u30e7\u30f3\uff08\u884c\u756a\u53f7\u3068\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\uff09\u3092\u542b\u3081\u308b\u304b\u3069\u3046\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002GPU\u30b3\u30a2\u30c0\u30f3\u30d7\u7b49\u3092\u7528\u3044\u305f\u8907\u96d1\u306a\u30d0\u30b0\u306e\u89e3\u6790\u306b\u6709\u7528\u3067\u3059\u304c\u3001\u6027\u80fd\u306e\u30c7\u30b0\u30ec\u30fc\u30c9\u3092\u5f15\u304d\u8d77\u3053\u3059\u305f\u3081\u3001\u901a\u5e38\u306f\u4f7f\u7528\u3059\u3079\u304d\u3067\u3042\u308a\u307e\u305b\u3093\u3002 pg_strom.debug_kernel_source bool off \u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c on \u306e\u5834\u5408\u3001 EXPLAIN VERBOSE \u30b3\u30de\u30f3\u30c9\u3067\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304d\u51fa\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u51fa\u529b\u3057\u307e\u3059\u3002","title":"GPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u751f\u6210\u3068\u30d3\u30eb\u30c9\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a"},{"location":"ref_params/#gpu_1","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e pg_strom.cuda_visible_devices string '' PostgreSQL\u306e\u8d77\u52d5\u6642\u306b\u7279\u5b9a\u306eGPU\u30c7\u30d0\u30a4\u30b9\u3060\u3051\u3092\u8a8d\u8b58\u3055\u305b\u3066\u3044\u5834\u5408\u306f\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u74b0\u5883\u5909\u6570 CUDA_VISIBLE_DEVICES \u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3068\u540c\u7b49\u3067\u3059\u3002 pg_strom.gpu_memory_segment_size int 512MB PG-Strom\u304cGPU\u30e1\u30e2\u30ea\u3092\u30a2\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u969b\u306b\u30011\u56de\u306eCUDA API\u547c\u3073\u51fa\u3057\u3067\u7372\u5f97\u3059\u308bGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306e\u5024\u304c\u5927\u304d\u3044\u3068API\u547c\u3073\u51fa\u3057\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306f\u6e1b\u3089\u305b\u307e\u3059\u304c\u3001\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30ed\u30b9\u306f\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u3002 pg_strom.max_num_preserved_gpu_memory int 2048 \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u6570\u306e\u4e0a\u9650\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u901a\u5e38\u306f\u521d\u671f\u5024\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002","title":"GPU\u30c7\u30d0\u30a4\u30b9\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a"},{"location":"ref_params/#_4","text":"\u30d1\u30e9\u30e1\u30fc\u30bf\u540d \u578b \u521d\u671f\u5024 \u8aac\u660e shmbuf.segment_size int 256MB shmbuf.num_logical_segments int \u81ea\u52d5 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8ad6\u7406\u30bb\u30b0\u30e1\u30f3\u30c8\u30b5\u30a4\u30ba\u306f\u30b7\u30b9\u30c6\u30e0\u642d\u8f09\u7269\u7406\u30e1\u30e2\u30ea\u306e2\u500d\u306e\u5927\u304d\u3055\u3067\u3059\u3002","title":"\u30b7\u30b9\u30c6\u30e0\u5171\u6709\u30e1\u30e2\u30ea\u306b\u95a2\u9023\u3059\u308b\u8a2d\u5b9a"},{"location":"ref_sqlfuncs/","text":"SQL\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u672c\u7ae0\u3067\u306fPG-Strom\u304c\u72ec\u81ea\u306b\u63d0\u4f9b\u3059\u308bSQL\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u95a2\u6570 \u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e gpu_device_name(int = 0) text \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306e\u540d\u524d\u3092\u8fd4\u3057\u307e\u3059 gpu_global_memsize(int = 0) bigint \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306e\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u5bb9\u91cf\u3092\u8fd4\u3057\u307e\u3059 gpu_max_blocksize(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u6700\u5927\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u306eGPU\u3067\u306f1024\u3067\u3059\u3002 gpu_warp_size(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30ef\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u8fd4\u3057\u307e\u3059\u3002\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u306eGPU\u3067\u306f32\u3067\u3059\u3002 gpu_max_shared_memory_perblock(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u3042\u305f\u308a\u5171\u6709\u30e1\u30e2\u30ea\u306e\u6700\u5927\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_registers_perblock(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u3042\u305f\u308a\u30ec\u30b8\u30b9\u30bf\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_multiptocessors(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308bSM(Streaming Multiprocessor)\u30e6\u30cb\u30c3\u30c8\u306e\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_cuda_cores(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308bCUDA\u30b3\u30a2\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_cc_major(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306eCC(Compute Capability)\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_cc_minor(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306eCC(Compute Capability)\u30de\u30a4\u30ca\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_pci_id(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u304c\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308bPCI\u30d0\u30b9ID\u3092\u8fd4\u3057\u307e\u3059\u3002 Arrow_Fdw\u95a2\u9023 \u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.arrow_fdw_truncate(regclass) bool \u6307\u5b9a\u3055\u308c\u305fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u5168\u3066\u6d88\u53bb\u3057\u307e\u3059\u3002Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306f writable \u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 GPU\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u95a2\u6570 \u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.arrow_fdw_export_cupy(regclass, text[], int) text \u6307\u5b9a\u3055\u308c\u305f\u5217\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092cuPy\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0( cupy.ndarray )\u3068\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002GPU\u30d0\u30c3\u30d5\u30a1\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306b\u89e3\u653e\u3055\u308c\u307e\u3059\u3002 pgstrom.arrow_fdw_export_cupy_pinned(regclass, text[], int) text \u6307\u5b9a\u3055\u308c\u305f\u5217\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092cuPy\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0( cupy.ndarray )\u3068\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002GPU\u30d0\u30c3\u30d5\u30a1\u306f\u30d4\u30f3\u30cb\u30f3\u30b0\u3055\u308c\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u5f8c\u3082\u6709\u52b9\u3067\u3059\u3002 pgstrom.arrow_fdw_put_gpu_buffer(text) bool \u4e0a\u8a18\u306e\u95a2\u6570\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3055\u308c\u305fGPU\u30d0\u30c3\u30d5\u30a1\u3092\u89e3\u653e\u3057\u307e\u3059\u3002 pgstrom.arrow_fdw_unpin_gpu_buffer(text) bool \u4e0a\u8a18\u306e\u95a2\u6570\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3055\u308c\u305fGPU\u30d0\u30c3\u30d5\u30a1\u306e\u30d4\u30f3\u30cb\u30f3\u30b0\u3092\u89e3\u9664\u3057\u307e\u3059\u3002 \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u751f\u6210\u95a2\u6570 \u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.random_setseed(int) void \u4e71\u6570\u306e\u7cfb\u5217\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002 pgstrom.random_int(float=0.0, bigint=0, bigint=INT_MAX) bigint bigint \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_float(float=0.0, float=0.0, float=1.0) float float \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_date(float=0.0, date='2015-01-01', date='2025-12-31') date date \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_time(float=0.0, time='00:00:00', time='23:59:59') time time \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_timetz(float=0.0, time='00:00:00', time='23:59:59') timetz timetz \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_timestamp(float=0.0, timestamp='2015-01-01', timestamp='2025-01-01') timestamp timestamp \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_macaddr(float=0.0, macaddr='ab:cd:00:00:00', macaddr='ab:cd:ff:ff:ff:ff') macaddr macaddr \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_inet(float=0.0, inet='192.168.0.1/16') inet inet \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_text(float=0.0, text='test_**') text text \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u7b2c\u4e8c\u5f15\u6570\u306e'*'\u6587\u5b57\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002 pgstrom.random_text_len(float=0.0, int=10) text text \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u6587\u5b57\u5217\u9577\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_int4range(float=0.0, bigint=0, bigint=INT_MAX) int4range int4range \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_int8range(float=0.0, bigint=0, bigint=LONG_MAX) int8range int8range \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_tsrange(float=0.0, timestamp='2015-01-01', timestamp='2025-01-01') tsrange tsrange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_tstzrange(float=0.0, timestamptz='2015-01-01', timestamptz='2025-01-01') tstzrange tstzrange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_daterange(float=0.0, date='2015-01-01', date='2025-12-31') daterange daterange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 \u305d\u306e\u4ed6\u306e\u95a2\u6570 \u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.license_query() text \u73fe\u5728\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u5546\u7528\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002 \u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc PG-Strom\u306f\u5185\u90e8\u72b6\u614b\u3092\u30e6\u30fc\u30b6\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u51fa\u529b\u3059\u308b\u305f\u3081\u306e\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u3092\u3044\u304f\u3064\u304b\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u5c06\u6765\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u60c5\u5831\u304c\u8ffd\u52a0\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089 SELECT * FROM ... \u306b\u3088\u3063\u3066\u3053\u308c\u3089\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u907f\u3051\u3066\u304f\u3060\u3055\u3044\u3002 pgstrom.device_info pgstrom.device_info \u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u3001PG-Strom\u304c\u8a8d\u8b58\u3057\u3066\u3044\u308bGPU\u306e\u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u5024\u3092\u51fa\u529b\u3057\u307e\u3059\u3002 GPU\u306f\u30e2\u30c7\u30eb\u3054\u3068\u306b\u30b3\u30a2\u6570\u3084\u30e1\u30e2\u30ea\u5bb9\u91cf\u3001\u6700\u5927\u30b9\u30ec\u30c3\u30c9\u6570\u306a\u3069\u306e\u30b9\u30da\u30c3\u30af\u304c\u7570\u306a\u3063\u3066\u304a\u308a\u3001PL/CUDA\u95a2\u6570\u306a\u3069\u3067\u76f4\u63a5GPU\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u3001\u3053\u308c\u3089\u306e\u60c5\u5831\u3092\u5143\u306b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u6700\u9069\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u540d\u524d \u30c7\u30fc\u30bf\u578b \u8aac\u660e device_nr int GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7 aindex int \u5c5e\u6027\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 attribute text \u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u540d value text \u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u5024 pgstrom.device_preserved_meminfo pgstrom.device_preserved_meminfo \u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u3001\u8907\u6570\u306ePostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u5171\u6709\u3059\u308b\u305f\u3081\u306b\u4e88\u3081\u78ba\u4fdd\u6e08\u307f\u306eGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u9818\u57df\u306e\u60c5\u5831\u3092\u51fa\u529b\u3057\u307e\u3059\u3002 \u73fe\u5728\u306e\u3068\u3053\u308d\u3001Arrow_Fdw\u306ePython\u9023\u643a\u6a5f\u80fd\u304c\u3053\u308c\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u540d\u524d \u30c7\u30fc\u30bf\u578b \u8aac\u660e device_nr int GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7 handle bytea \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306eIPC\u30cf\u30f3\u30c9\u30e9 owner regrole \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u4f5c\u6210\u8005 length bigint \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30d0\u30a4\u30c8\u5358\u4f4d\u306e\u9577\u3055 ctime timestamp with time zone \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u4f5c\u6210\u6642\u523b","title":"SQL\u30aa\u30d6\u30b8\u30a7\u30af\u30c8"},{"location":"ref_sqlfuncs/#_1","text":"\u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e gpu_device_name(int = 0) text \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306e\u540d\u524d\u3092\u8fd4\u3057\u307e\u3059 gpu_global_memsize(int = 0) bigint \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306e\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u5bb9\u91cf\u3092\u8fd4\u3057\u307e\u3059 gpu_max_blocksize(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u6700\u5927\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u306eGPU\u3067\u306f1024\u3067\u3059\u3002 gpu_warp_size(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30ef\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u8fd4\u3057\u307e\u3059\u3002\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u306eGPU\u3067\u306f32\u3067\u3059\u3002 gpu_max_shared_memory_perblock(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u3042\u305f\u308a\u5171\u6709\u30e1\u30e2\u30ea\u306e\u6700\u5927\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_registers_perblock(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308b\u30d6\u30ed\u30c3\u30af\u3042\u305f\u308a\u30ec\u30b8\u30b9\u30bf\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_multiptocessors(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308bSM(Streaming Multiprocessor)\u30e6\u30cb\u30c3\u30c8\u306e\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_num_cuda_cores(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306b\u304a\u3051\u308bCUDA\u30b3\u30a2\u6570\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_cc_major(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306eCC(Compute Capability)\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_cc_minor(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u306eCC(Compute Capability)\u30de\u30a4\u30ca\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8fd4\u3057\u307e\u3059\u3002 gpu_pci_id(int = 0) int \u6307\u5b9a\u3057\u305fGPU\u30c7\u30d0\u30a4\u30b9\u304c\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308bPCI\u30d0\u30b9ID\u3092\u8fd4\u3057\u307e\u3059\u3002","title":"\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u95a2\u6570"},{"location":"ref_sqlfuncs/#arrow_fdw","text":"\u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.arrow_fdw_truncate(regclass) bool \u6307\u5b9a\u3055\u308c\u305fArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u5168\u3066\u6d88\u53bb\u3057\u307e\u3059\u3002Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306f writable \u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002","title":"Arrow_Fdw\u95a2\u9023"},{"location":"ref_sqlfuncs/#gpu","text":"\u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.arrow_fdw_export_cupy(regclass, text[], int) text \u6307\u5b9a\u3055\u308c\u305f\u5217\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092cuPy\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0( cupy.ndarray )\u3068\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002GPU\u30d0\u30c3\u30d5\u30a1\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306b\u89e3\u653e\u3055\u308c\u307e\u3059\u3002 pgstrom.arrow_fdw_export_cupy_pinned(regclass, text[], int) text \u6307\u5b9a\u3055\u308c\u305f\u5217\u306eArrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092cuPy\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0( cupy.ndarray )\u3068\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002GPU\u30d0\u30c3\u30d5\u30a1\u306f\u30d4\u30f3\u30cb\u30f3\u30b0\u3055\u308c\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u5f8c\u3082\u6709\u52b9\u3067\u3059\u3002 pgstrom.arrow_fdw_put_gpu_buffer(text) bool \u4e0a\u8a18\u306e\u95a2\u6570\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3055\u308c\u305fGPU\u30d0\u30c3\u30d5\u30a1\u3092\u89e3\u653e\u3057\u307e\u3059\u3002 pgstrom.arrow_fdw_unpin_gpu_buffer(text) bool \u4e0a\u8a18\u306e\u95a2\u6570\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3055\u308c\u305fGPU\u30d0\u30c3\u30d5\u30a1\u306e\u30d4\u30f3\u30cb\u30f3\u30b0\u3092\u89e3\u9664\u3057\u307e\u3059\u3002","title":"GPU\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u95a2\u6570"},{"location":"ref_sqlfuncs/#_2","text":"\u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.random_setseed(int) void \u4e71\u6570\u306e\u7cfb\u5217\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002 pgstrom.random_int(float=0.0, bigint=0, bigint=INT_MAX) bigint bigint \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_float(float=0.0, float=0.0, float=1.0) float float \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_date(float=0.0, date='2015-01-01', date='2025-12-31') date date \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_time(float=0.0, time='00:00:00', time='23:59:59') time time \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_timetz(float=0.0, time='00:00:00', time='23:59:59') timetz timetz \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_timestamp(float=0.0, timestamp='2015-01-01', timestamp='2025-01-01') timestamp timestamp \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_macaddr(float=0.0, macaddr='ab:cd:00:00:00', macaddr='ab:cd:ff:ff:ff:ff') macaddr macaddr \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_inet(float=0.0, inet='192.168.0.1/16') inet inet \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_text(float=0.0, text='test_**') text text \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u7b2c\u4e8c\u5f15\u6570\u306e'*'\u6587\u5b57\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002 pgstrom.random_text_len(float=0.0, int=10) text text \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u6587\u5b57\u5217\u9577\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_int4range(float=0.0, bigint=0, bigint=INT_MAX) int4range int4range \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_int8range(float=0.0, bigint=0, bigint=LONG_MAX) int8range int8range \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_tsrange(float=0.0, timestamp='2015-01-01', timestamp='2025-01-01') tsrange tsrange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_tstzrange(float=0.0, timestamptz='2015-01-01', timestamptz='2025-01-01') tstzrange tstzrange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002 pgstrom.random_daterange(float=0.0, date='2015-01-01', date='2025-12-31') daterange daterange \u578b\u306e\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u306e\u7bc4\u56f2\u5185\u3067\u751f\u6210\u3057\u307e\u3059\u3002","title":"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u751f\u6210\u95a2\u6570"},{"location":"ref_sqlfuncs/#_3","text":"\u95a2\u6570 \u623b\u308a\u5024 \u8aac\u660e pgstrom.license_query() text \u73fe\u5728\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u5546\u7528\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002","title":"\u305d\u306e\u4ed6\u306e\u95a2\u6570"},{"location":"ref_sqlfuncs/#_4","text":"PG-Strom\u306f\u5185\u90e8\u72b6\u614b\u3092\u30e6\u30fc\u30b6\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u51fa\u529b\u3059\u308b\u305f\u3081\u306e\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u3092\u3044\u304f\u3064\u304b\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u5c06\u6765\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u60c5\u5831\u304c\u8ffd\u52a0\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089 SELECT * FROM ... \u306b\u3088\u3063\u3066\u3053\u308c\u3089\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u3092\u53c2\u7167\u3059\u308b\u4e8b\u306f\u907f\u3051\u3066\u304f\u3060\u3055\u3044\u3002 pgstrom.device_info pgstrom.device_info \u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u3001PG-Strom\u304c\u8a8d\u8b58\u3057\u3066\u3044\u308bGPU\u306e\u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u5024\u3092\u51fa\u529b\u3057\u307e\u3059\u3002 GPU\u306f\u30e2\u30c7\u30eb\u3054\u3068\u306b\u30b3\u30a2\u6570\u3084\u30e1\u30e2\u30ea\u5bb9\u91cf\u3001\u6700\u5927\u30b9\u30ec\u30c3\u30c9\u6570\u306a\u3069\u306e\u30b9\u30da\u30c3\u30af\u304c\u7570\u306a\u3063\u3066\u304a\u308a\u3001PL/CUDA\u95a2\u6570\u306a\u3069\u3067\u76f4\u63a5GPU\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u3001\u3053\u308c\u3089\u306e\u60c5\u5831\u3092\u5143\u306b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u6700\u9069\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u540d\u524d \u30c7\u30fc\u30bf\u578b \u8aac\u660e device_nr int GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7 aindex int \u5c5e\u6027\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 attribute text \u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u540d value text \u30c7\u30d0\u30a4\u30b9\u5c5e\u6027\u5024 pgstrom.device_preserved_meminfo pgstrom.device_preserved_meminfo \u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u306f\u3001\u8907\u6570\u306ePostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u5171\u6709\u3059\u308b\u305f\u3081\u306b\u4e88\u3081\u78ba\u4fdd\u6e08\u307f\u306eGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u9818\u57df\u306e\u60c5\u5831\u3092\u51fa\u529b\u3057\u307e\u3059\u3002 \u73fe\u5728\u306e\u3068\u3053\u308d\u3001Arrow_Fdw\u306ePython\u9023\u643a\u6a5f\u80fd\u304c\u3053\u308c\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u540d\u524d \u30c7\u30fc\u30bf\u578b \u8aac\u660e device_nr int GPU\u30c7\u30d0\u30a4\u30b9\u756a\u53f7 handle bytea \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306eIPC\u30cf\u30f3\u30c9\u30e9 owner regrole \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u4f5c\u6210\u8005 length bigint \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30d0\u30a4\u30c8\u5358\u4f4d\u306e\u9577\u3055 ctime timestamp with time zone \u78ba\u4fdd\u6e08\u307fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u4f5c\u6210\u6642\u523b","title":"\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc"},{"location":"ref_types/","text":"\u30c7\u30fc\u30bf\u578b PG-Strom\u306f\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u578b\u3092GPU\u3067\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u6570\u5024\u30c7\u30fc\u30bf\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 smallint short 2 bytes integer int 4 bytes bigint long 8 bytes float2 short 2 bytes \u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u3002PG-Strom\u306b\u3088\u308b\u72ec\u81ea\u62e1\u5f35\u3002 real float 4 bytes float double 8 bytes numeric int128 \u53ef\u5909\u9577 \u5185\u90e8\u5f62\u5f0f\u306f128bit\u56fa\u5b9a\u5c11\u6570\u70b9\u578b Note GPU\u304c numeric \u578b\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u969b\u3001\u5b9f\u88c5\u4e0a\u306e\u7406\u7531\u304b\u3089\u3053\u308c\u3092128bit\u56fa\u5b9a\u5c11\u6570\u70b9\u306e\u5185\u90e8\u8868\u73fe\u306b\u5909\u63db\u3057\u3066\u51e6\u7406\u3057\u307e\u3059\u3002\uff08\u3053\u308c\u306f Apache Arrow \u306e Decimal \u578b\u3068\u540c\u4e00\u306e\u5f62\u5f0f\u3067\u3059\uff09 \u3053\u308c\u3089\u5185\u90e8\u8868\u73fe\u3078\u306e/\u304b\u3089\u306e\u5909\u63db\u306f\u900f\u904e\u7684\u306b\u884c\u308f\u308c\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u3001\u6841\u6570\u306e\u5927\u304d\u306a numeric \u578b\u306e\u30c7\u30fc\u30bf\u306f\u8868\u73fe\u3059\u308b\u4e8b\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001PG-Strom\u306fCPU\u5074\u3067\u306e\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092\u8a66\u307f\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6841\u6570\u306e\u5927\u304d\u306a numeric \u578b\u306e\u30c7\u30fc\u30bf\u3092GPU\u306b\u4e0e\u3048\u308b\u3068\u5374\u3063\u3066\u5b9f\u884c\u901f\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u3053\u308c\u3092\u907f\u3051\u308b\u306b\u306f\u3001GUC\u30d1\u30e9\u30e1\u30fc\u30bf pg_strom.enable_numeric_type \u3092\u4f7f\u7528\u3057\u3066 numeric \u30c7\u30fc\u30bf\u578b\u3092\u542b\u3080\u6f14\u7b97\u5f0f\u3092GPU\u3067\u5b9f\u884c\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002 Note GPU\u3067\u306f\u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u304c\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001CPU(x86_64\u30d7\u30ed\u30bb\u30c3\u30b5)\u3067\u306f\u672a\u5bfe\u5fdc\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u3001 float2 \u30c7\u30fc\u30bf\u578b\u3092CPU\u3067\u51e6\u7406\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u3053\u308c\u3092\u4e00\u5ea6 float \u3084 double \u578b\u306b\u5909\u63db\u3057\u305f\u4e0a\u3067\u6f14\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001GPU\u306e\u3088\u3046\u306b float2 \u306e\u65b9\u304c\u6f14\u7b97\u901f\u5ea6\u3067\u6709\u5229\u3068\u3044\u3046\u4e8b\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u6a5f\u68b0\u5b66\u7fd2\u3084\u7d71\u8a08\u89e3\u6790\u7528\u9014\u306b\u30c7\u30fc\u30bf\u91cf\u3092\u6291\u5236\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002 \u6a19\u6e96\u306e\u65e5\u4ed8\u6642\u523b\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 date DateADT 4 bytes time TimeADT 8 bytes timetz TimeTzADT 12 bytes timestamp Timestamp 8 bytes timestamptz TimestampTz 8 bytes interval Interval 16 bytes time interval \u6a19\u6e96\u306e\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 bpchar varlena * \u53ef\u5909\u9577 varchar varlena * \u53ef\u5909\u9577 bytea varlena * \u53ef\u5909\u9577 text varlena * \u53ef\u5909\u9577 \u6a19\u6e96\u306e\u975e\u69cb\u9020\u30c7\u30fc\u30bf\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 jsonb varlena * \u53ef\u5909\u9577 Note jsonb \u30c7\u30fc\u30bf\u578b\u3092GPU\u3067\u51e6\u7406\u3055\u305b\u308b\u5834\u5408\u306b\u306f\u3001\u6b21\u306e2\u3064\u306e\u70b9\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u5b9f\u969b\u306b\u53c2\u7167\u3055\u308c\u306a\u3044\u5c5e\u6027\u3082\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u8aad\u307f\u51fa\u3057\u3001GPU\u306b\u8ee2\u9001\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001I/O\u30d0\u30b9\u306e\u5229\u7528\u52b9\u7387\u306f\u5fc5\u305a\u3057\u3082\u826f\u304f\u306a\u3044\u30c7\u30fc\u30bf\u578b\u3067\u3042\u308b\u4e8b\u3002\u30c7\u30fc\u30bf\u9577\u304c TOAST\u5316 \u306e\u95be\u5024\uff08\u901a\u5e38\u306f2kB\u5f31\uff09\u3092\u8d8a\u3048\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001 jsonb \u30c7\u30fc\u30bf\u5168\u4f53\u304cTOAST\u30c6\u30fc\u30d6\u30eb\u3078\u66f8\u304d\u51fa\u3055\u308c\u308b\u305f\u3081\u3001GPU\u5074\u3067\u306f\u51e6\u7406\u3067\u304d\u305a\u975e\u52b9\u7387\u306aCPU-fallback\u51e6\u7406\u3092\u547c\u3073\u51fa\u3057\u3066\u3057\u307e\u3046\u4e8b\u3002 \u5f8c\u8005\u306e\u554f\u984c\u306b\u5bfe\u3057\u3066\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30aa\u30d7\u30b7\u30e7\u30f3 toast_tuple_target \u3092\u62e1\u5927\u3057\u3001TOAST\u5316\u306e\u95be\u5024\u3092\u5f15\u304d\u4e0a\u3052\u308b\u4e8b\u3067\u3042\u308b\u7a0b\u5ea6\u306f\u56de\u907f\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 \u6a19\u6e96\u306e\u96d1\u591a\u306a\u30c7\u30fc\u30bf\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 boolean cl_bool 1 byte money cl_long 8 bytes uuid pg_uuid 16 bytes macaddr macaddr 6 bytes inet inet_struct 7 bytes or 19 bytes cidr inet_struct 7 bytes or 19 bytes \u6a19\u6e96\u306e\u7bc4\u56f2\u578b SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 int4range __int4range 14 bytes int8range __int8range 22 bytes tsrange __tsrange 22 bytes tstzrange __tstzrange 22 bytes daterange __daterange 14 bytes","title":"\u30c7\u30fc\u30bf\u578b"},{"location":"ref_types/#_1","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 smallint short 2 bytes integer int 4 bytes bigint long 8 bytes float2 short 2 bytes \u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u3002PG-Strom\u306b\u3088\u308b\u72ec\u81ea\u62e1\u5f35\u3002 real float 4 bytes float double 8 bytes numeric int128 \u53ef\u5909\u9577 \u5185\u90e8\u5f62\u5f0f\u306f128bit\u56fa\u5b9a\u5c11\u6570\u70b9\u578b Note GPU\u304c numeric \u578b\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u969b\u3001\u5b9f\u88c5\u4e0a\u306e\u7406\u7531\u304b\u3089\u3053\u308c\u3092128bit\u56fa\u5b9a\u5c11\u6570\u70b9\u306e\u5185\u90e8\u8868\u73fe\u306b\u5909\u63db\u3057\u3066\u51e6\u7406\u3057\u307e\u3059\u3002\uff08\u3053\u308c\u306f Apache Arrow \u306e Decimal \u578b\u3068\u540c\u4e00\u306e\u5f62\u5f0f\u3067\u3059\uff09 \u3053\u308c\u3089\u5185\u90e8\u8868\u73fe\u3078\u306e/\u304b\u3089\u306e\u5909\u63db\u306f\u900f\u904e\u7684\u306b\u884c\u308f\u308c\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u3001\u6841\u6570\u306e\u5927\u304d\u306a numeric \u578b\u306e\u30c7\u30fc\u30bf\u306f\u8868\u73fe\u3059\u308b\u4e8b\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001PG-Strom\u306fCPU\u5074\u3067\u306e\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092\u8a66\u307f\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6841\u6570\u306e\u5927\u304d\u306a numeric \u578b\u306e\u30c7\u30fc\u30bf\u3092GPU\u306b\u4e0e\u3048\u308b\u3068\u5374\u3063\u3066\u5b9f\u884c\u901f\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002 \u3053\u308c\u3092\u907f\u3051\u308b\u306b\u306f\u3001GUC\u30d1\u30e9\u30e1\u30fc\u30bf pg_strom.enable_numeric_type \u3092\u4f7f\u7528\u3057\u3066 numeric \u30c7\u30fc\u30bf\u578b\u3092\u542b\u3080\u6f14\u7b97\u5f0f\u3092GPU\u3067\u5b9f\u884c\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002 Note GPU\u3067\u306f\u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u304c\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001CPU(x86_64\u30d7\u30ed\u30bb\u30c3\u30b5)\u3067\u306f\u672a\u5bfe\u5fdc\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u3001 float2 \u30c7\u30fc\u30bf\u578b\u3092CPU\u3067\u51e6\u7406\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u3053\u308c\u3092\u4e00\u5ea6 float \u3084 double \u578b\u306b\u5909\u63db\u3057\u305f\u4e0a\u3067\u6f14\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001GPU\u306e\u3088\u3046\u306b float2 \u306e\u65b9\u304c\u6f14\u7b97\u901f\u5ea6\u3067\u6709\u5229\u3068\u3044\u3046\u4e8b\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u6a5f\u68b0\u5b66\u7fd2\u3084\u7d71\u8a08\u89e3\u6790\u7528\u9014\u306b\u30c7\u30fc\u30bf\u91cf\u3092\u6291\u5236\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002","title":"\u6570\u5024\u30c7\u30fc\u30bf\u578b"},{"location":"ref_types/#_2","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 date DateADT 4 bytes time TimeADT 8 bytes timetz TimeTzADT 12 bytes timestamp Timestamp 8 bytes timestamptz TimestampTz 8 bytes interval Interval 16 bytes time interval","title":"\u6a19\u6e96\u306e\u65e5\u4ed8\u6642\u523b\u578b"},{"location":"ref_types/#_3","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 bpchar varlena * \u53ef\u5909\u9577 varchar varlena * \u53ef\u5909\u9577 bytea varlena * \u53ef\u5909\u9577 text varlena * \u53ef\u5909\u9577","title":"\u6a19\u6e96\u306e\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b"},{"location":"ref_types/#_4","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 jsonb varlena * \u53ef\u5909\u9577 Note jsonb \u30c7\u30fc\u30bf\u578b\u3092GPU\u3067\u51e6\u7406\u3055\u305b\u308b\u5834\u5408\u306b\u306f\u3001\u6b21\u306e2\u3064\u306e\u70b9\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u5b9f\u969b\u306b\u53c2\u7167\u3055\u308c\u306a\u3044\u5c5e\u6027\u3082\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u8aad\u307f\u51fa\u3057\u3001GPU\u306b\u8ee2\u9001\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001I/O\u30d0\u30b9\u306e\u5229\u7528\u52b9\u7387\u306f\u5fc5\u305a\u3057\u3082\u826f\u304f\u306a\u3044\u30c7\u30fc\u30bf\u578b\u3067\u3042\u308b\u4e8b\u3002\u30c7\u30fc\u30bf\u9577\u304c TOAST\u5316 \u306e\u95be\u5024\uff08\u901a\u5e38\u306f2kB\u5f31\uff09\u3092\u8d8a\u3048\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001 jsonb \u30c7\u30fc\u30bf\u5168\u4f53\u304cTOAST\u30c6\u30fc\u30d6\u30eb\u3078\u66f8\u304d\u51fa\u3055\u308c\u308b\u305f\u3081\u3001GPU\u5074\u3067\u306f\u51e6\u7406\u3067\u304d\u305a\u975e\u52b9\u7387\u306aCPU-fallback\u51e6\u7406\u3092\u547c\u3073\u51fa\u3057\u3066\u3057\u307e\u3046\u4e8b\u3002 \u5f8c\u8005\u306e\u554f\u984c\u306b\u5bfe\u3057\u3066\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30aa\u30d7\u30b7\u30e7\u30f3 toast_tuple_target \u3092\u62e1\u5927\u3057\u3001TOAST\u5316\u306e\u95be\u5024\u3092\u5f15\u304d\u4e0a\u3052\u308b\u4e8b\u3067\u3042\u308b\u7a0b\u5ea6\u306f\u56de\u907f\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002","title":"\u6a19\u6e96\u306e\u975e\u69cb\u9020\u30c7\u30fc\u30bf\u578b"},{"location":"ref_types/#_5","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 boolean cl_bool 1 byte money cl_long 8 bytes uuid pg_uuid 16 bytes macaddr macaddr 6 bytes inet inet_struct 7 bytes or 19 bytes cidr inet_struct 7 bytes or 19 bytes","title":"\u6a19\u6e96\u306e\u96d1\u591a\u306a\u30c7\u30fc\u30bf\u578b"},{"location":"ref_types/#_6","text":"SQL\u30c7\u30fc\u30bf\u578b \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f \u30c7\u30fc\u30bf\u9577 \u5099\u8003 int4range __int4range 14 bytes int8range __int8range 22 bytes tsrange __tsrange 22 bytes tstzrange __tstzrange 22 bytes daterange __daterange 14 bytes","title":"\u6a19\u6e96\u306e\u7bc4\u56f2\u578b"},{"location":"release_note/","text":"PG-Strom v2.3\u30ea\u30ea\u30fc\u30b9 PG-Strom Development Team (1-Apr-2020) \u6982\u8981 PG-Strom v2.3\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 - GpuJoin\u306eInner\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u304cCPU\u4e26\u5217\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - Arrow_Fdw\u304cINSERT/TRUNCATE\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - pg2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u8a18\u30e2\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - mysql2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002 \u52d5\u4f5c\u74b0\u5883 PostgreSQL v10, v11, v12 CUDA Toolkit 10.1 \u4ee5\u964d CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal or Volta) \u65b0\u6a5f\u80fd GpuJoin\u306eInner\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u304cCPU\u4e26\u5217\u306b\u5bfe\u5fdc \u5f93\u6765\u306fGpuJoin\u306eInner\u5074\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u306f\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u307f\u304c\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u306e\u5236\u7d04\u306b\u3088\u308a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u4e26\u5217\u30b9\u30ad\u30e3\u30f3\u304c\u6975\u7aef\u306b\u9045\u5ef6\u3059\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306e\u6a5f\u80fd\u5f37\u5316\u306b\u3088\u308a\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3001\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u3069\u3061\u3089\u3067\u3082Inner\u5074\u30d0\u30c3\u30d5\u30a1\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5834\u5408\u3067\u3082\u3001\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u304c\u76f4\u3061\u306bGpuJoin\u51e6\u7406\u3092\u958b\u59cb\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 Partition-wise Asymmetric GpuJoin\u306e\u518d\u8a2d\u8a08 \u5168\u4f53\u7684\u306a\u30c7\u30b6\u30a4\u30f3\u306e\u518d\u8a2d\u8a08\u3092\u884c\u3044\u3001\u9069\u5207\u306a\u5c40\u9762\u306b\u304a\u3044\u3066\u591a\u6bb5GpuJoin\u304c\u9078\u629e\u3055\u308c\u3084\u3059\u304f\u306a\u308b\u3088\u3046\u6539\u826f\u3092\u884c\u3044\u307e\u3057\u305f\u3002 Arrow_Fdw\u304cINSERT/TRUNCATE\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3001 INSERT \u306b\u3088\u308b\u30d0\u30eb\u30af\u30ed\u30fc\u30c9\u3068\u3001 pgstrom.arrow_fdw_truncate \u306b\u3088\u308bTRUNCATE\u51e6\u7406\u3092\u884c\u3046\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 CuPy\u9023\u643a\u3068\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306eGPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30ed\u30fc\u30c9\u3057\u3001\u3053\u308c\u3092CuPy\u306e cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066Python\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u53c2\u7167\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 pg2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u8a18\u30e2\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 pg2arrow \u30b3\u30de\u30f3\u30c9\u306b --append \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3001\u65e2\u5b58\u306eApache Arrow\u306b\u5bfe\u3057\u3066\u8ffd\u8a18\u3092\u884c\u3046\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 \u307e\u305f\u540c\u6642\u306b\u3001 SELECT * FROM table \u306e\u5225\u540d\u8868\u8a18\u3068\u3057\u3066 -t table \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002 mysql2arrow\u30b3\u30de\u30f3\u30c9\u3092\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002 PostgreSQL\u3067\u306f\u306a\u304f\u3001MySQL\u306b\u63a5\u7d9a\u3057\u3066\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092Apache Arrow\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b mysql2arrow \u30b3\u30de\u30f3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002 \u5217\u6319\u578b\u306e\u30c7\u30fc\u30bf\u3082\u901a\u5e38\u306eUtf8\u578b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\uff08DictionaryBatch\u3092\u4f7f\u7528\u3057\u306a\u3044\uff09\u4ee5\u5916\u306f\u3001 pg2arrow \u3068\u540c\u7b49\u306e\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 \u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f PostgreSQL\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u5408\u308f\u305b\u3066\u3001\u5e7e\u3064\u304b\u306e\u57fa\u672c\u7684\u306a\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002 \u4fee\u6b63\u3055\u308c\u305f\u4e3b\u306a\u4e0d\u5177\u5408 GPU\u30c7\u30d0\u30a4\u30b9\u95a2\u6570/\u578b\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\u5316\u306e\u30ed\u30b8\u30c3\u30af\u3092\u6539\u5584 ALTER\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u3001\u5168\u3066\u306eGPU\u30c7\u30d0\u30a4\u30b9\u95a2\u6570/\u578b\u306e\u30e1\u30bf\u60c5\u5831\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u7121\u52b9\u5316\u306e\u5fc5\u8981\u306e\u3042\u308b\u30a8\u30f3\u30c8\u30ea\u306e\u307f\u3092\u30af\u30ea\u30a2\u3059\u308b\u3088\u3046\u4fee\u6b63\u3092\u884c\u3044\u307e\u3057\u305f\u3002 GROUP BY\u3067\u540c\u3058\u5217\u3092\u5076\u6570\u56de\u6307\u5b9a\u3057\u305f\u969b\u306b\u6975\u7aef\u306a\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4f4e\u4e0b\u3092\u4fee\u6b63 GROUP BY\u306e\u30ad\u30fc\u5024\u304c\u8907\u6570\u3042\u308b\u6642\u306b\u3001GpuPreAgg\u306f\u30cf\u30c3\u30b7\u30e5\u5024\u3092XOR\u3067\u7d50\u5408\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u305d\u306e\u305f\u3081\u3001\u540c\u3058\u5217\u3092\u5076\u6570\u56de\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u306f\u5e38\u306b\u30cf\u30c3\u30b7\u30e5\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c0\u306b\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u9069\u5f53\u306a\u30e9\u30f3\u30c0\u30e0\u5316\u51e6\u7406\u3092\u52a0\u3048\u308b\u4e8b\u3067\u30cf\u30c3\u30b7\u30e5\u5024\u304c\u5206\u6563\u3059\u308b\u3088\u3046\u4fee\u6b63\u3057\u3066\u3044\u307e\u3059\u3002 \u6f5c\u5728\u7684\u306aGpuScan\u7121\u9650\u30eb\u30fc\u30d7\u306e\u554f\u984c\u3092\u4fee\u6b63 SSD2GPU Direct SQL\u306e\u4f7f\u7528\u6642\u3001\u5909\u6570\u306e\u672a\u521d\u671f\u5316\u306b\u3088\u308aGpuScan\u304c\u7121\u9650\u30eb\u30fc\u30d7\u306b\u9665\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u6f5c\u5728\u7684\u306aGpuJoin\u306eGPU\u30ab\u30fc\u30cd\u30eb\u30af\u30e9\u30c3\u30b7\u30e5 3\u500b\u4ee5\u4e0a\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u7d50\u5408\u3059\u308bGpuJoin\u3067\u3001\u5909\u6570\u306e\u672a\u521d\u671f\u5316\u306b\u3088\u308aGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u306eCustomScan API\u306b\u306f\u3001\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea(DSM)\u306e\u6b63\u3057\u3044\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306b\u5fc5\u8981\u306a\u5e7e\u3064\u304b\u306eAPI\u304c\u6b20\u3051\u3066\u304a\u308a\u3001v10\u4ee5\u964d\u3068\u5171\u901a\u306e\u30b3\u30fc\u30c9\u3092\u4fdd\u5b88\u3059\u308b\u4e0a\u3067\u969c\u5bb3\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u554f\u984c\u304b\u3089\u3001\u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f PostgreSQL v9.6 \u306f\u30b5\u30dd\u30fc\u30c8\u5916\u3068\u306a\u308a\u307e\u3059\u3002 PL/CUDA \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u72ec\u81ea\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u74b0\u5883\u3088\u308a\u3082\u3001Python\u8a00\u8a9e\u306a\u3069\u30e6\u30fc\u30b6\u306e\u4f7f\u3044\u6163\u308c\u305f\u8a00\u8a9e\u74b0\u5883\u306e\u65b9\u304c\u671b\u307e\u3057\u3044\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002 \u4eca\u5f8c\u306f\u3001Arrow_Fdw\u306eGPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6a5f\u80fd\u3068PL/Python\u7d4c\u7531\u3067\u306eCuPy\u547c\u51fa\u3057\u3092\u4f75\u7528\u3059\u308b\u4e8b\u3067\u3001In-database\u6a5f\u68b0\u5b66\u7fd2/\u7d71\u8a08\u89e3\u6790\u306e\u4ee3\u66ff\u624b\u6bb5\u3068\u306a\u308a\u307e\u3059\u3002 Gstore_Fdw \u672c\u6a5f\u80fd\u306f\u3001\u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw\u3068GPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6a5f\u80fd\u306b\u3088\u308a\u4ee3\u66ff\u3055\u308c\u307e\u3057\u305f\u3002 Largeobject\uff5eGPU\u9593\u30a8\u30af\u30b9\u30dd\u30fc\u30c8/\u30a4\u30f3\u30dd\u30fc\u30c8 \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u672c\u6a5f\u80fd\u306f\u4e0d\u8981\u3068\u5224\u65ad\u3057\u307e\u3057\u305f\u3002 PG-Strom v2.2\u30ea\u30ea\u30fc\u30b9 PG-Strom Development Team (1-May-2019) \u6982\u8981 PG-Strom v2.2\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3078\u306e\u5bfe\u5fdc Arrow_Fdw\u306b\u3088\u308b\u5217\u6307\u5411\u30b9\u30c8\u30a2\u306e\u30b5\u30dd\u30fc\u30c8 \u30d3\u30eb\u30c9\u6e08\u307fGPU\u30d0\u30a4\u30ca\u30ea\u3078\u306e\u5bfe\u5fdc Jsonb\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc \u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059GPU\u95a2\u6570\u306e\u5bfe\u5fdc GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\uff08Gstore_Fdw\uff09\u306e\u30bd\u30fc\u30c8\u5bfe\u5fdc NVMEoF\u3078\u306e\u5bfe\u5fdc\uff08\u5b9f\u9a13\u7684\u6a5f\u80fd\uff09 \u52d5\u4f5c\u74b0\u5883 PostgreSQL v9.6, v10, v11 CUDA Toolkit 10.1 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal\u4ee5\u964d) \u65b0\u6a5f\u80fd \u30c6\u30fc\u30d6\u30eb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3078\u306e\u5bfe\u5fdc \u30de\u30eb\u30c1GPU\u69cb\u6210\u306e\u5834\u5408\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u69cb\u6210\u3059\u308b\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u7269\u7406\u7684\u306aGPU\u3068\u306e\u8ddd\u96e2\u306b\u5fdc\u3058\u3066\u6700\u9069\u306aGPU\u3092\u9078\u629e\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002NVME-oF\u74b0\u5883\u306a\u3069PCIe\u30d0\u30b9\u306e\u69cb\u6210\u3060\u3051\u3067\u306f\u6700\u9069\u8ddd\u96e2\u3092\u5224\u65ad\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001DB\u7ba1\u7406\u8005\u306f pg_strom.nvme_distance_map \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u3044\u3066\u5bfe\u5fdc\u95a2\u4fc2\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u975e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3068\u306eJOIN\u6642\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3068\u975e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3068\u306eJOIN\u3092\u884c\u3063\u305f\u5f8c\u3001\u5404\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u51e6\u7406\u7d50\u679c\u3092\u7d50\u5408\u3059\u308b\u3088\u3046\u306a\u5b9f\u884c\u8a08\u753b\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u672c\u6a5f\u80fd\u306f Asymmetric Partition-wise JOIN \u3068\u3044\u3046\u540d\u79f0\u3067PostgreSQL v13\u306e\u672c\u4f53\u6a5f\u80fd\u3078\u3068\u63d0\u6848\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Arrow_Fdw\u306b\u3088\u308b\u5217\u6307\u5411\u30b9\u30c8\u30a2\u306e\u30b5\u30dd\u30fc\u30c8 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u7d4c\u7531\u3067Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u51fa\u3057\u306b\u5bfe\u5fdc\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 SSD-to-GPU Direct SQL\u3092\u7528\u3044\u305fApache Arrow\u306e\u8aad\u307f\u51fa\u3057\u3068SQL\u5b9f\u884c\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 \u30d3\u30eb\u30c9\u6e08\u307fGPU\u30d0\u30a4\u30ca\u30ea\u3078\u306e\u5bfe\u5fdc SQL\u304b\u3089GPU\u30d0\u30a4\u30ca\u30ea\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3059\u308b\u969b\u3001\u5f93\u6765\u306f\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u8981\u7d20\u306e\u306a\u3044\u95a2\u6570\u7fa4\uff08\u30e9\u30a4\u30d6\u30e9\u30ea\u95a2\u6570\u306b\u9177\u4f3c\uff09\u3082\u542b\u3081\u3066CUDA C\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3001\u305d\u308c\u3092NVRTC(NVIDIA Run-Time Compiler)\u3092\u7528\u3044\u3066\u30d3\u30eb\u30c9\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4e00\u90e8\u306e\u8907\u96d1\u306a\u95a2\u6570\u306e\u5f71\u97ff\u3067\u30d3\u30eb\u30c9\u6642\u9593\u304c\u6975\u7aef\u306b\u9577\u304f\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002 v2.2\u306b\u304a\u3044\u3066\u3001\u9759\u7684\u306a\u95a2\u6570\u7fa4\u306f\u4e8b\u524d\u306b\u30d3\u30eb\u30c9\u3055\u308c\u3001SQL\u304b\u3089\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u90e8\u5206\u306e\u307f\u3092\u5b9f\u884c\u6642\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001GPU\u30d0\u30a4\u30ca\u30ea\u306e\u751f\u6210\u6642\u9593\u304c\u5927\u5e45\u306b\u6e1b\u5c11\u3059\u308b\u4e8b\u3068\u306a\u308a\u307e\u3057\u305f\u3002 JSONB\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc GPU\u5074\u3067JSONB\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5b50\u8981\u7d20\u3092\u53c2\u7167\u3057\u3001 numeric \u3084 text \u5024\u3068\u3057\u3066\u6761\u4ef6\u53e5\u306a\u3069\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002 \u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059GPU\u95a2\u6570\u306e\u5bfe\u5fdc textcat \u306a\u3069\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059SQL\u95a2\u6570\u3092GPU\u5074\u3067\u5b9f\u88c5\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\uff08Gstore_Fdw\uff09\u306e\u30bd\u30fc\u30c8\u5bfe\u5fdc PL/CUDA\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4ee5\u5916\u306b\u3001GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u3066\u5b9f\u884c\u3059\u308bSQL\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306fGpuScan\u304a\u3088\u3073GpuSort\u306e\uff12\u7a2e\u985e\u3067\u3001JOIN\u304a\u3088\u3073GROUP BY\u306b\u306f\u307e\u3060\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002 \u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306e\u8ffd\u52a0 \u7c21\u6613\u306a\u30c6\u30b9\u30c8\u306e\u305f\u3081\u3001\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002 NVME-oF\u3078\u306e\u5bfe\u5fdc\uff08\u5b9f\u9a13\u7684\u6a5f\u80fd\uff09 NVME-over-Fabric\u3092\u7528\u3044\u3066\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30ea\u30e2\u30fc\u30c8\u306eNVME\u30c7\u30a3\u30b9\u30af\u304b\u3089\u306eSSD-to-GPU Direct SQL\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u305f\u3060\u3057\u3001Red Hat Enterprise Linux 7.x / CentOS 7.x\u3067\u306f nvme_rdma \u30c9\u30e9\u30a4\u30d0\u306e\u5165\u308c\u66ff\u3048\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001\u73fe\u5728\u306e\u3068\u3053\u308d\u5b9f\u9a13\u7684\u6a5f\u80fd\u3068\u3044\u3046\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u5c06\u6765\u5ec3\u6b62\u4e88\u5b9a\u306e\u6a5f\u80fd PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u306eCustomScan API\u306b\u306f\u3001\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea(DSM)\u306e\u6b63\u3057\u3044\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306b\u5fc5\u8981\u306a\u5e7e\u3064\u304b\u306eAPI\u304c\u6b20\u3051\u3066\u304a\u308a\u3001\u5b9f\u884c\u6642\u7d71\u8a08\u60c5\u5831\u306e\u63a1\u53d6\u306a\u3069\u304c\u4e0d\u53ef\u80fd\u3067\u3057\u305f\u3002 \u307e\u305f\u3001\u5185\u90e8\u7684\u306b\u5f0f\u8868\u73fe(Expression)\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u306b\u3082\u5909\u66f4\u304c\u52a0\u3048\u3089\u308c\u3066\u3044\u308b\u4e8b\u304b\u3089\u3001\u5c11\u306a\u304f\u306a\u3044\u7b87\u6240\u3067 #if ... #endif \u30d6\u30ed\u30c3\u30af\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001\u30b3\u30fc\u30c9\u306e\u4fdd\u5b88\u6027\u3092\u640d\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002 \u3053\u308c\u3089\u306e\u554f\u984c\u306b\u3088\u308a\u3001PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8\u306f\u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6700\u5f8c\u3068\u306a\u308a\u307e\u3059\u3002PG-Strom\u3092PostgreSQL v9.6\u3067\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f\u3001\u65e9\u671f\u306bPostgreSQL v11\u3078\u3068\u79fb\u884c\u3055\u308c\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 Gstore_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306epgstrom\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u4e0a\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u3001\u5143\u3005PL/CUDA\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u8a2d\u8a08\u3055\u308c\u305f\u72ec\u81ea\u306e\u5217\u5f62\u5f0f\u3067\u3001\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u3084numeric\u30c7\u30fc\u30bf\u578b\u306e\u8868\u73fe\u306fPostgreSQL\u306e\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u3002 \u305d\u306e\u5f8c\u3001GPU\u4e0a\u3067\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u7528\u5171\u901a\u5f62\u5f0f\u3068\u3057\u3066\u3001Apache Arrow\u5f62\u5f0f\u3092\u5143\u306b\u3057\u305fNVIDIA RAPIDS(cuDF)\u304c\u516c\u958b\u3055\u308c\u3001\u591a\u304f\u306e\u6a5f\u68b0\u5b66\u7fd2\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3084Python\u3067\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30b9\u30bf\u30c3\u30af\u306a\u3069\u5bfe\u5fdc\u304c\u5f37\u5316\u3055\u308c\u3064\u3064\u3042\u308a\u307e\u3059\u3002 \u4eca\u5f8c\u3001PG-Strom\u306fGstore_Fdw\u306e\u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f\u3092cuDF\u3068\u5171\u901a\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u66f4\u3057\u3001\u3053\u308c\u3089\u6a5f\u68b0\u5b66\u7fd2\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u306e\u76f8\u4e92\u904b\u7528\u6027\u3092\u6539\u5584\u3057\u307e\u3059\u3002\u30b3\u30fc\u30c9\u306e\u4fdd\u5b88\u6027\u3092\u9ad8\u304f\u3059\u308b\u305f\u3081\u3001\u5f93\u6765\u306e\u72ec\u81ea\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u5ec3\u6b62\u3068\u306a\u308a\u307e\u3059\u3002 \u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u30ad\u30e3\u30c3\u30b7\u30e5 \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u591a\u304f\u306e\u30b1\u30fc\u30b9\u3067\u306fArrow_Fdw\u3067\u5341\u5206\u306b\u4ee3\u66ff\u53ef\u80fd\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3042\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\u91cd\u8907\u6a5f\u80fd\u3067\u3042\u308b\u305f\u3081\u3001\u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002 PG-Strom v2.0\u30ea\u30ea\u30fc\u30b9 PG-Strom Development Team (17-Apr-2018) \u6982\u8981 PG-Strom v2.0\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 GPU\u3092\u7ba1\u7406\u3059\u308b\u5185\u90e8\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u5168\u4f53\u7684\u306a\u518d\u8a2d\u8a08\u3068\u5b89\u5b9a\u5316 CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217\u5b9f\u884c SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2(store_fdw) GpuJoin\u3068GpuPreAgg\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u9ad8\u901f\u5316 GpuPreAgg+GpuJoin+GpuScan \u5bc6\u7d50\u5408GPU\u30ab\u30fc\u30cd\u30eb \u65b0\u6a5f\u80fd\u306e\u30b5\u30de\u30ea\u306f\u3053\u3061\u3089\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\uff1a PG-Strom v2.0 Technical Brief . \u52d5\u4f5c\u74b0\u5883 PostgreSQL v9.6, v10 CUDA Toolkit 9.1 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal\u4ee5\u964d) \u65b0\u6a5f\u80fd GPU\u3092\u7ba1\u7406\u3059\u308b\u5185\u90e8\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u5168\u4f53\u7684\u306a\u518d\u8a2d\u8a08\u3068\u5b89\u5b9a\u5316 PostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306f\u540c\u6642\u306b\uff11\u500b\u306eGPU\u3060\u3051\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30de\u30eb\u30c1GPU\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306fPostgreSQL\u306eCPU\u4e26\u5217\u3068\u306e\u4f75\u7528\u304c\u524d\u63d0\u306b\u306a\u308a\u307e\u3059\u304c\u3001CPU\u30b9\u30ec\u30c3\u30c9\u304cGPU\u3078\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306fGPU\u306e\u51e6\u7406\u80fd\u529b\u3088\u308a\u3082\u305a\u3063\u3068\u4f4e\u3044\u305f\u3081\u3001\u901a\u5e38\u3001\u3053\u308c\u306f\u554f\u984c\u3068\u306f\u306a\u308a\u307e\u305b\u3093\u3002\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u8a2d\u8a08\u306e\u30b7\u30f3\u30d7\u30eb\u5316\u3092\u512a\u5148\u3057\u307e\u3057\u305f\u3002 Pascal\u4e16\u4ee3\u4ee5\u964d\u306eGPU\u3067\u63a1\u7528\u3055\u308c\u305fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u307b\u307c\u5168\u9762\u7684\u306b\u63a1\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u591a\u304f\u306f\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u307e\u3067\u5fc5\u8981\u306a\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u306e\u5927\u304d\u3055\u304c\u5206\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u3053\u308c\u307e\u3067\u306f\u5fc5\u8981\u4ee5\u4e0a\u306b\u30d0\u30c3\u30d5\u30a1\u3092\u7372\u5f97\u3057\u3001\u307e\u305f\u30e1\u30e2\u30ea\u4e0d\u8db3\u6642\u306b\u306f\u518d\u5b9f\u884c\u3092\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3089\u306f\u540c\u6642\u5b9f\u884c\u30d7\u30ed\u30bb\u30b9\u306e\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u5236\u9650\u3057\u3001\u307e\u305f\u8907\u96d1\u306a\u4f8b\u5916\u30ed\u30b8\u30c3\u30af\u306f\u30d0\u30b0\u306e\u6e29\u5e8a\u3067\u3057\u305f\u3002GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001\u8a2d\u8a08\u306e\u30b7\u30f3\u30d7\u30eb\u5316\u3092\u884c\u3044\u307e\u3057\u305f\u3002 CUDA\u306e\u975e\u540c\u671f\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5229\u7528\u3092\u6b62\u3081\u307e\u3057\u305f\u3002GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u5229\u7528\u3059\u308b\u3068\u3001DMA\u8ee2\u9001\u306e\u305f\u3081\u306e\u975e\u540c\u671fAPI\uff08 cuMemCpyHtoD \u306a\u3069\uff09\u306f\u540c\u671f\u7684\u306b\u632f\u821e\u3046\u3088\u3046\u306b\u306a\u308b\u305f\u3081\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u591a\u91cd\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u4ee3\u308f\u308a\u306bPG-Strom\u81ea\u8eab\u304c\u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9\u3092\u7ba1\u7406\u3057\u3001\u3053\u308c\u3089\u306e\u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9\u304c\u305d\u308c\u305e\u308c\u540c\u671fAPI\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u8a2d\u8a08\u5909\u66f4\u3092\u884c\u3044\u307e\u3057\u305f\u3002\u526f\u7523\u7269\u3068\u3057\u3066\u3001\u975e\u540c\u671f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\uff08 cuStreamAddCallback \uff09\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u3063\u305f\u306e\u3067\u3001MPS\u3092\u5229\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217\u5b9f\u884c PostgreSQL v9.6\u3067\u65b0\u305f\u306b\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305fCPU\u4e26\u5217\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 PG-Strom\u306e\u63d0\u4f9b\u3059\u308bGpuScan\u3001GpuJoin\u304a\u3088\u3073GpuPreAgg\u306e\u5404\u30ed\u30b8\u30c3\u30af\u306f\u8907\u6570\u306ePostgreSQL\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308a\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 PostgreSQL v9.6\u3067\u306fCPU\u4e26\u5217\u5b9f\u884c\u306e\u969b\u306b EXPLAIN ANALYZE \u3067\u53d6\u5f97\u3059\u308bPG-Strom\u72ec\u81ea\u306e\u7d71\u8a08\u60c5\u5831\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001CustomScan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9API\u3067 ShutdownCustomScan \u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001DSM\uff08\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea\uff09\u306e\u89e3\u653e\u524d\u306b\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30d7\u30ed\u30bb\u30b9\u304c\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u60c5\u5831\u3092\u56de\u53ce\u3059\u308b\u624b\u6bb5\u304c\u7121\u304b\u3063\u305f\u305f\u3081\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c Linux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb nvme_strom \u3092\u7528\u3044\u308b\u4e8b\u3067\u3001NVMe\u898f\u683c\u306b\u5bfe\u5fdc\u3057\u305fSSD\u4e0a\u306ePostgreSQL\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u3001CPU/RAM\u3092\u4ecb\u3055\u305a\u30c0\u30a4\u30ec\u30af\u30c8\u306bGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3078\u8ee2\u9001\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u30b7\u30b9\u30c6\u30e0RAM\u306b\u8f09\u308a\u5207\u3089\u306a\u3044\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3067\u3042\u3063\u3066\u3082\u3001\u672c\u6a5f\u80fd\u306b\u3088\u308aPG-Strom\u306e\u9069\u7528\u304c\u73fe\u5b9f\u7684\u306a\u9078\u629e\u80a2\u3068\u306a\u308b\u4e8b\u3067\u3057\u3087\u3046\u3002 \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u5c64\u3084\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u7d4c\u7531\u3057\u306a\u3044\u305f\u3081\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9650\u754c\u306b\u8fd1\u3044\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u5f15\u304d\u51fa\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3001\u304b\u3064\u3001GPU\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081CPU\u306e\u51e6\u7406\u3059\u3079\u304d\u30c7\u30fc\u30bf\u91cf\u3092\u6e1b\u3089\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u7279\u6027\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4e00\u822c\u7684\u306b\u306f\u8a08\u7b97\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308bGPU\u3092\u3001I/O\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u9ad8\u901f\u5316\u306b\u9069\u7528\u3059\u308b\u4e8b\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002 \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5 RAM\u30b5\u30a4\u30ba\u306b\u8f09\u308b\u7a0b\u5ea6\u306e\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u306f\u3001\u3088\u308aGPU\u3067\u306e\u51e6\u7406\u306b\u9069\u3057\u305f\u5217\u30c7\u30fc\u30bf\u5f62\u5f0f\u306b\u5909\u5f62\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u969b\u3057\u3066\u3001\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306b\u306fPostgreSQL\u306e\u5171\u6709\u30d0\u30c3\u30d5\u30a1\u3088\u308a\u3082\u3053\u3061\u3089\u3092\u512a\u5148\u3057\u3066\u53c2\u7167\u3057\u307e\u3059\u3002 \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u540c\u671f\u7684\u3001\u307e\u305f\u306f\u975e\u540c\u671f\u7684\u306b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u521d\u671f\u306ePG-Strom\u3067\u4f3c\u305f\u3088\u3046\u306a\u6a5f\u80fd\u304c\u5b58\u5728\u3057\u3066\u3044\u305f\u4e8b\u3092\u899a\u3048\u3066\u304a\u3089\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002v2.0\u3067\u65b0\u305f\u306b\u5b9f\u88c5\u3055\u308c\u305f\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u884c\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u3001\u5f53\u8a72\u884c\u3092\u542b\u3080\u30ad\u30e3\u30c3\u30b7\u30e5\u30d6\u30ed\u30c3\u30af\u3092\u6d88\u53bb\uff08invalidation\uff09\u3057\u307e\u3059\u3002\u884c\u30b9\u30c8\u30a2\u306e\u66f4\u65b0\u306b\u5408\u308f\u305b\u3066\u5217\u30ad\u30e3\u30c3\u30b7\u30e5\u5074\u306e\u66f4\u65b0\u3092\u884c\u3046\u3068\u3044\u3046\u4e8b\u306f\u884c\u308f\u306a\u3044\u305f\u3081\u3001\u66f4\u65b0\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u3059\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4f4e\u4e0b\u306f\u9650\u5b9a\u7684\u3067\u3059\u3002 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2(gstore_fdw) GPU\u4e0a\u306b\u78ba\u4fdd\u3057\u305f\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u9818\u57df\u306b\u5bfe\u3057\u3066\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\uff08Foreign Table\uff09\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5229\u7528\u3057\u3066SQL\u306eSELECT/INSERT/UPDATE/DELETE\u306b\u3088\u308a\u8aad\u307f\u66f8\u304d\u3092\u884c\u3046\u6a5f\u80fd\u3067\u3059\u3002 \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f pgstrom \u578b\u306e\u307f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001PG-Strom\u306e\u30d0\u30c3\u30d5\u30a1\u5f62\u5f0f KDS_FORMAT_COLUMN \u30bf\u30a4\u30d7\u3068\u540c\u4e00\u306e\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u3001LZ\u65b9\u5f0f\u306b\u3088\u308b\u30c7\u30fc\u30bf\u5727\u7e2e\u3092\u884c\u3046\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 v2.0\u306e\u6642\u70b9\u3067\u306f\u3001GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u306fPL/CUDA\u95a2\u6570\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u3060\u3051\u5229\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 GpuJoin\u3068GpuPreAgg\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u9ad8\u901f\u5316 \u5f93\u6765\u3001GpuJoin\u3068GpuPreAgg\u3067\u5185\u90e8\u7684\u306b\u4f7f\u7528\u3057\u3066\u3044\u305fDynamic Parallelism\u306e\u5229\u7528\u3092\u3084\u3081\u3001\u51e6\u7406\u30ed\u30b8\u30c3\u30af\u5168\u4f53\u306e\u898b\u76f4\u3057\u3092\u884c\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001GPU\u30b5\u30d6\u30ab\u30fc\u30cd\u30eb\u306e\u8d77\u52d5\u5f8c\u3001\u305d\u306e\u5b8c\u4e86\u3092\u5358\u306b\u5f85\u3063\u3066\u3044\u308b\u3060\u3051\u306eGPU\u30ab\u30fc\u30cd\u30eb\u304c\u5b9f\u884c\u30b9\u30ed\u30c3\u30c8\u3092\u5360\u6709\u3057\u3001GPU\u306e\u4f7f\u7528\u7387\u304c\u4e0a\u304c\u3089\u306a\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u3063\u305f\u305f\u3081\u3067\u3059\u3002 \u3053\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u526f\u7523\u7269\u3068\u3057\u3066\u3001GpuJoin\u306e\u30b5\u30b9\u30da\u30f3\u30c9/\u30ec\u30b8\u30e5\u30fc\u30e0\u6a5f\u80fd\u304c\u5b9f\u88c5\u3055\u308c\u307e\u3057\u305f\u3002\u539f\u7406\u4e0a\u3001SQL\u306eJOIN\u51e6\u7406\u306f\u5165\u529b\u3057\u305f\u884c\u6570\u3088\u308a\u3082\u51fa\u529b\u3059\u308b\u884c\u6570\u306e\u65b9\u304c\u5897\u3048\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u51e6\u7406\u7d50\u679c\u3092\u66f8\u304d\u8fbc\u3080\u30d0\u30c3\u30d5\u30a1\u306e\u6b8b\u308a\u30b5\u30a4\u30ba\u304c\u4e0d\u8db3\u3057\u305f\u6642\u70b9\u3067GpuJoin\u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3057\u3001\u65b0\u3057\u3044\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u3092\u5272\u308a\u5f53\u3066\u3066\u30ec\u30b8\u30e5\u30fc\u30e0\u3059\u308b\u3088\u3046\u306b\u4fee\u6b63\u3055\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u306e\u30b5\u30a4\u30ba\u63a8\u5b9a\u304c\u7c21\u7565\u5316\u3055\u308c\u305f\u307b\u304b\u3001\u5b9f\u884c\u6642\u306e\u30d0\u30c3\u30d5\u30a1\u4e0d\u8db3\u306b\u3088\u308b\u518d\u5b9f\u884c\u306e\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002 GpuPreAgg+GpuJoin+GpuScan \u5bc6\u7d50\u5408GPU\u30ab\u30fc\u30cd\u30eb GPU\u3067\u5b9f\u884c\u53ef\u80fd\u306aSCAN\u3001JOIN\u3001GROUP BY\u304c\u9023\u7d9a\u3057\u3066\u3044\u308b\u3068\u304d\u3001\u5bfe\u5fdc\u3059\u308bGpuScan\u3001GpuJoin\u3001GpuPreAgg\u306b\u76f8\u5f53\u3059\u308b\u51e6\u7406\u3092\u4e00\u56de\u306eGPU\u30ab\u30fc\u30cd\u30eb\u547c\u3073\u51fa\u3057\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001GpuJoin\u306e\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u3092\u305d\u306e\u307e\u307eGpuPreAgg\u306e\u5165\u529b\u30d0\u30c3\u30d5\u30a1\u3068\u3057\u3066\u6271\u3046\u306a\u3069\u3001CPU\u3068GPU\u306e\u9593\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u6700\u5c0f\u9650\u306b\u6291\u3048\u308b\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u3053\u306e\u6a5f\u80fd\u306f\u7279\u306b\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3068\u52b9\u679c\u7684\u3067\u3059\u3002 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc uuid \u578b\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u578b\uff08 inet \u3001 cidr \u3001\u304a\u3088\u3073 macaddr \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u7bc4\u56f2\u578b\uff08 int4range \u3001 int8range \u3001 tsrange \u3001 tstzrange \u3001 daterange \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\uff08 float2 \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u306b\u95a2\u9023\u3059\u308bCPU\u5074\u306e\u5b9f\u88c5\u306fPG-Strom\u306e\u72ec\u81ea\u5b9f\u88c5\u306b\u3088\u308b\u3082\u306e\u3067\u3059\u3002 \u65b0\u3057\u3044\u6f14\u7b97\u5b50/\u95a2\u6570\u306e\u5bfe\u5fdc \u65e5\u4ed8\u6642\u523b\u578b\u306b\u5bfe\u3059\u308b EXTRACT(field FROM timestamp) \u6f14\u7b97\u5b50\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 New data type support uuid type Network address types ( inet , cidr and macaddr ) Range data types ( int4range , int8range , tsrange , tstzrange , daterange ) Half-precision floating point type ( float2 ). Its CPU side are also implemented by PG-Strom itself, not PostgreSQL's built-in feature. New operators / functions EXTRACT(field FROM timestamp) operator on the date and time types PL/CUDA\u95a2\u9023\u306e\u5f37\u5316 #plcuda_include \u306e\u62e1\u5f35\u306b\u3088\u308a\u3001 text \u578b\u3092\u8fd4\u3059SQL\u95a2\u6570\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u5f15\u6570\u306e\u5024\u306b\u3088\u3063\u3066\u633f\u5165\u3059\u308b\u30b3\u30fc\u30c9\u3092\u5909\u3048\u308b\u4e8b\u304c\u3067\u304d\u308b\u305f\u3081\u3001\u5358\u306b\u5916\u90e8\u5b9a\u7fa9\u95a2\u6570\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u3067\u306a\u304f\u3001\u52d5\u7684\u306b\u3044\u304f\u3064\u3082\u306eGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308a\u51fa\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002 PL/CUDA\u95a2\u6570\u306e\u5f15\u6570\u306b reggstore \u578b\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001GPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3078\u306f\u5bfe\u5fdc\u3059\u308bGPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u306e\u30dd\u30a4\u30f3\u30bf\u304c\u6e21\u3055\u308c\u307e\u3059\u3002OID\u5024\u304c\u6e21\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u305d\u306e\u4ed6\u306e\u6a5f\u80fd\u5f37\u5316 lo_import_gpu \u304a\u3088\u3073 lo_export_gpu \u95a2\u6570\u306b\u3088\u308a\u3001\u5916\u90e8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u4fdd\u3057\u305fGPU\u30e1\u30e2\u30ea\u306e\u5185\u5bb9\u3092\u76f4\u63a5PostgreSQL\u306e\u30e9\u30fc\u30b8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a18\u9332\u3057\u305f\u308a\u3001\u9006\u306b\u30e9\u30fc\u30b8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5185\u5bb9\u3092GPU\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0 PostgreSQL Global Development Group\u306e\u914d\u5e03\u3059\u308bPostgreSQL\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u9069\u5408\u3059\u308b\u3088\u3046\u3001RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3092\u884c\u3044\u307e\u3057\u305f\u3002 \u5168\u3066\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7269\u4ef6\u306fHeteroDB SWDC(Software Distribution Center)\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 PG-Strom\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092markdown\u3068mkdocs\u3092\u7528\u3044\u3066\u5168\u9762\u7684\u306b\u66f8\u304d\u76f4\u3057\u307e\u3057\u305f\u3002\u5f93\u6765\u306eHTML\u3092\u7528\u3044\u305f\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u6bd4\u3079\u3001\u3088\u308a\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u5bb9\u6613\u3067\u65b0\u6a5f\u80fd\u306e\u958b\u767a\u306b\u5408\u308f\u305b\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u62e1\u5145\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002 \u30c6\u30b9\u30c8 PostgreSQL\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3057\u3066\u3001PG-Strom\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002 \u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd PostgreSQL v9.5\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u3067\u306fCPU\u4e26\u5217\u30af\u30a8\u30ea\u306e\u63d0\u4f9b\u306b\u4f34\u3044\u3001\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6/\u30a8\u30b0\u30bc\u30ad\u30e5\u30fc\u30bf\u5171\u306b\u5927\u304d\u306a\u4fee\u6b63\u304c\u52a0\u3048\u3089\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u3068\u5bc6\u63a5\u306b\u9023\u643a\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3068\u3063\u3066\u6700\u3082\u30a4\u30f3\u30d1\u30af\u30c8\u306e\u5927\u304d\u306a\u5909\u66f4\u306f\u300eupper planner path-ification\u300f\u3068\u547c\u3070\u308c\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5f37\u5316\u3067\u3001\u96c6\u7d04\u6f14\u7b97\u3084\u30bd\u30fc\u30c8\u306a\u3069\u306e\u5b9f\u884c\u8a08\u753b\u3082\u30b3\u30b9\u30c8\u30d9\u30fc\u30b9\u3067\u8907\u6570\u306e\u7570\u306a\u308b\u65b9\u6cd5\u3092\u6bd4\u8f03\u3057\u3066\u6700\u9069\u306a\u3082\u306e\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u3053\u308c\u306fGpuPreAgg\u3092\u5b9f\u88c5\u3059\u308b\u305f\u3081\u306b\u30d5\u30c3\u30af\u3092\u5229\u7528\u3057\u3066\u5b9f\u884c\u8a08\u753b\u3092\u66f8\u304d\u63db\u3048\u3066\u3044\u305f\u5f93\u6765\u306e\u65b9\u6cd5\u3068\u306f\u6839\u672c\u7684\u306b\u7570\u306a\u308a\u3001\u3088\u308a\u5408\u7406\u7684\u304b\u3064\u4fe1\u983c\u3067\u304d\u308b\u65b9\u6cd5\u3067GPU\u3092\u7528\u3044\u305f\u96c6\u7d04\u6f14\u7b97\u3092\u633f\u5165\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u3001\u30d0\u30b0\u306e\u6e29\u5e8a\u3067\u3042\u3063\u305f\u5b9f\u884c\u8a08\u753b\u306e\u66f8\u304d\u63db\u3048\u30ed\u30b8\u30c3\u30af\u3092\u6368\u3066\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u540c\u6642\u306b\u3001CustomScan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3082CPU\u4e26\u5217\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306eAPI\u304c\u62e1\u5f35\u3055\u308c\u3001\u3053\u308c\u3089\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306bPostgreSQL v9.5\u30b5\u30dd\u30fc\u30c8\u306f\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002 GpuSort\u6a5f\u80fd GpuSort\u6a5f\u80fd\u306f\u6027\u80fd\u4e0a\u306e\u30e1\u30ea\u30c3\u30c8\u304c\u5f97\u3089\u308c\u306a\u3044\u305f\u3081\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002 \u30bd\u30fc\u30c8\u306fGPU\u306e\u5f97\u610f\u3068\u3059\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u4e00\u3064\u3067\u3059\u3002\u3057\u304b\u3057\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u5927\u304d\u3055\u3092\u8d8a\u3048\u308b\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u30bd\u30fc\u30c8\u3059\u308b\u5834\u5408\u3001\u8907\u6570\u306e\u30c1\u30e3\u30f3\u30af\u306b\u5206\u5272\u3057\u3066\u90e8\u5206\u30bd\u30fc\u30c8\u3092\u884c\u3044\u3001\u5f8c\u3067CPU\u5074\u3067\u3053\u308c\u3092\u7d50\u5408\u3057\u3066\u6700\u7d42\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u7d50\u5408\u30d5\u30a7\u30fc\u30ba\u306e\u51e6\u7406\u3092\u8efd\u304f\u3059\u308b\u306b\u306f\u3001GPU\u3067\u30bd\u30fc\u30c8\u3059\u3079\u304d\u30c1\u30e3\u30f3\u30af\u306e\u30b5\u30a4\u30ba\u3092\u5927\u304d\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4e00\u65b9\u3067\u30c1\u30e3\u30f3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u30bd\u30fc\u30c8\u51e6\u7406\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306e\u30ea\u30fc\u30c9\u30bf\u30a4\u30e0\u304c\u9577\u304f\u306a\u308a\u3001PG-Strom\u306e\u7279\u9577\u306e\u4e00\u3064\u3067\u3042\u308b\u975e\u540c\u671f\u51e6\u7406\u306b\u3088\u308b\u30c7\u30fc\u30bf\u8ee2\u9001\u30ec\u30a4\u30c6\u30f3\u30b7\u306e\u96a0\u307a\u3044\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u3042\u308a\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u554f\u984c\u306b\u5bfe\u51e6\u3059\u308b\u306e\u306f\u56f0\u96e3\u3001\u5c11\u306a\u304f\u3068\u3082\u6642\u671f\u5c1a\u65e9\u3067\u3042\u308b\u3068\u5224\u65ad\u3057\u3001GpuSort\u6a5f\u80fd\u306f\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002","title":"\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8"},{"location":"release_note/#pg-strom-v23","text":"PG-Strom Development Team (1-Apr-2020)","title":"PG-Strom v2.3\u30ea\u30ea\u30fc\u30b9"},{"location":"release_note/#_1","text":"PG-Strom v2.3\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 - GpuJoin\u306eInner\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u304cCPU\u4e26\u5217\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - Arrow_Fdw\u304cINSERT/TRUNCATE\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - pg2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u8a18\u30e2\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 - mysql2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002","title":"\u6982\u8981"},{"location":"release_note/#_2","text":"PostgreSQL v10, v11, v12 CUDA Toolkit 10.1 \u4ee5\u964d CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal or Volta)","title":"\u52d5\u4f5c\u74b0\u5883"},{"location":"release_note/#_3","text":"GpuJoin\u306eInner\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u304cCPU\u4e26\u5217\u306b\u5bfe\u5fdc \u5f93\u6765\u306fGpuJoin\u306eInner\u5074\u30d0\u30c3\u30d5\u30a1\u306e\u69cb\u7bc9\u306f\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u307f\u304c\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u306e\u5236\u7d04\u306b\u3088\u308a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u4e26\u5217\u30b9\u30ad\u30e3\u30f3\u304c\u6975\u7aef\u306b\u9045\u5ef6\u3059\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306e\u6a5f\u80fd\u5f37\u5316\u306b\u3088\u308a\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3001\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u3069\u3061\u3089\u3067\u3082Inner\u5074\u30d0\u30c3\u30d5\u30a1\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5316\u30c6\u30fc\u30d6\u30eb\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5834\u5408\u3067\u3082\u3001\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u304c\u76f4\u3061\u306bGpuJoin\u51e6\u7406\u3092\u958b\u59cb\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 Partition-wise Asymmetric GpuJoin\u306e\u518d\u8a2d\u8a08 \u5168\u4f53\u7684\u306a\u30c7\u30b6\u30a4\u30f3\u306e\u518d\u8a2d\u8a08\u3092\u884c\u3044\u3001\u9069\u5207\u306a\u5c40\u9762\u306b\u304a\u3044\u3066\u591a\u6bb5GpuJoin\u304c\u9078\u629e\u3055\u308c\u3084\u3059\u304f\u306a\u308b\u3088\u3046\u6539\u826f\u3092\u884c\u3044\u307e\u3057\u305f\u3002 Arrow_Fdw\u304cINSERT/TRUNCATE\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3001 INSERT \u306b\u3088\u308b\u30d0\u30eb\u30af\u30ed\u30fc\u30c9\u3068\u3001 pgstrom.arrow_fdw_truncate \u306b\u3088\u308bTRUNCATE\u51e6\u7406\u3092\u884c\u3046\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 CuPy\u9023\u643a\u3068\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306eGPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8 Arrow_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u4e0a\u306e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30ed\u30fc\u30c9\u3057\u3001\u3053\u308c\u3092CuPy\u306e cupy.ndarray \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066Python\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u53c2\u7167\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 pg2arrow\u30b3\u30de\u30f3\u30c9\u304c\u8ffd\u8a18\u30e2\u30fc\u30c9\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 pg2arrow \u30b3\u30de\u30f3\u30c9\u306b --append \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3001\u65e2\u5b58\u306eApache Arrow\u306b\u5bfe\u3057\u3066\u8ffd\u8a18\u3092\u884c\u3046\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 \u307e\u305f\u540c\u6642\u306b\u3001 SELECT * FROM table \u306e\u5225\u540d\u8868\u8a18\u3068\u3057\u3066 -t table \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002 mysql2arrow\u30b3\u30de\u30f3\u30c9\u3092\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002 PostgreSQL\u3067\u306f\u306a\u304f\u3001MySQL\u306b\u63a5\u7d9a\u3057\u3066\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u7d50\u679c\u3092Apache Arrow\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b mysql2arrow \u30b3\u30de\u30f3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002 \u5217\u6319\u578b\u306e\u30c7\u30fc\u30bf\u3082\u901a\u5e38\u306eUtf8\u578b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\uff08DictionaryBatch\u3092\u4f7f\u7528\u3057\u306a\u3044\uff09\u4ee5\u5916\u306f\u3001 pg2arrow \u3068\u540c\u7b49\u306e\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 \u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f PostgreSQL\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u5408\u308f\u305b\u3066\u3001\u5e7e\u3064\u304b\u306e\u57fa\u672c\u7684\u306a\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002","title":"\u65b0\u6a5f\u80fd"},{"location":"release_note/#_4","text":"GPU\u30c7\u30d0\u30a4\u30b9\u95a2\u6570/\u578b\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\u5316\u306e\u30ed\u30b8\u30c3\u30af\u3092\u6539\u5584 ALTER\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u3001\u5168\u3066\u306eGPU\u30c7\u30d0\u30a4\u30b9\u95a2\u6570/\u578b\u306e\u30e1\u30bf\u60c5\u5831\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u7121\u52b9\u5316\u306e\u5fc5\u8981\u306e\u3042\u308b\u30a8\u30f3\u30c8\u30ea\u306e\u307f\u3092\u30af\u30ea\u30a2\u3059\u308b\u3088\u3046\u4fee\u6b63\u3092\u884c\u3044\u307e\u3057\u305f\u3002 GROUP BY\u3067\u540c\u3058\u5217\u3092\u5076\u6570\u56de\u6307\u5b9a\u3057\u305f\u969b\u306b\u6975\u7aef\u306a\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4f4e\u4e0b\u3092\u4fee\u6b63 GROUP BY\u306e\u30ad\u30fc\u5024\u304c\u8907\u6570\u3042\u308b\u6642\u306b\u3001GpuPreAgg\u306f\u30cf\u30c3\u30b7\u30e5\u5024\u3092XOR\u3067\u7d50\u5408\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u305d\u306e\u305f\u3081\u3001\u540c\u3058\u5217\u3092\u5076\u6570\u56de\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u306f\u5e38\u306b\u30cf\u30c3\u30b7\u30e5\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c0\u306b\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u9069\u5f53\u306a\u30e9\u30f3\u30c0\u30e0\u5316\u51e6\u7406\u3092\u52a0\u3048\u308b\u4e8b\u3067\u30cf\u30c3\u30b7\u30e5\u5024\u304c\u5206\u6563\u3059\u308b\u3088\u3046\u4fee\u6b63\u3057\u3066\u3044\u307e\u3059\u3002 \u6f5c\u5728\u7684\u306aGpuScan\u7121\u9650\u30eb\u30fc\u30d7\u306e\u554f\u984c\u3092\u4fee\u6b63 SSD2GPU Direct SQL\u306e\u4f7f\u7528\u6642\u3001\u5909\u6570\u306e\u672a\u521d\u671f\u5316\u306b\u3088\u308aGpuScan\u304c\u7121\u9650\u30eb\u30fc\u30d7\u306b\u9665\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u6f5c\u5728\u7684\u306aGpuJoin\u306eGPU\u30ab\u30fc\u30cd\u30eb\u30af\u30e9\u30c3\u30b7\u30e5 3\u500b\u4ee5\u4e0a\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u7d50\u5408\u3059\u308bGpuJoin\u3067\u3001\u5909\u6570\u306e\u672a\u521d\u671f\u5316\u306b\u3088\u308aGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3057\u305f\u3002","title":"\u4fee\u6b63\u3055\u308c\u305f\u4e3b\u306a\u4e0d\u5177\u5408"},{"location":"release_note/#_5","text":"PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u306eCustomScan API\u306b\u306f\u3001\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea(DSM)\u306e\u6b63\u3057\u3044\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306b\u5fc5\u8981\u306a\u5e7e\u3064\u304b\u306eAPI\u304c\u6b20\u3051\u3066\u304a\u308a\u3001v10\u4ee5\u964d\u3068\u5171\u901a\u306e\u30b3\u30fc\u30c9\u3092\u4fdd\u5b88\u3059\u308b\u4e0a\u3067\u969c\u5bb3\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u554f\u984c\u304b\u3089\u3001\u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f PostgreSQL v9.6 \u306f\u30b5\u30dd\u30fc\u30c8\u5916\u3068\u306a\u308a\u307e\u3059\u3002 PL/CUDA \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u72ec\u81ea\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u74b0\u5883\u3088\u308a\u3082\u3001Python\u8a00\u8a9e\u306a\u3069\u30e6\u30fc\u30b6\u306e\u4f7f\u3044\u6163\u308c\u305f\u8a00\u8a9e\u74b0\u5883\u306e\u65b9\u304c\u671b\u307e\u3057\u3044\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002 \u4eca\u5f8c\u306f\u3001Arrow_Fdw\u306eGPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6a5f\u80fd\u3068PL/Python\u7d4c\u7531\u3067\u306eCuPy\u547c\u51fa\u3057\u3092\u4f75\u7528\u3059\u308b\u4e8b\u3067\u3001In-database\u6a5f\u68b0\u5b66\u7fd2/\u7d71\u8a08\u89e3\u6790\u306e\u4ee3\u66ff\u624b\u6bb5\u3068\u306a\u308a\u307e\u3059\u3002 Gstore_Fdw \u672c\u6a5f\u80fd\u306f\u3001\u66f8\u304d\u8fbc\u307f\u53ef\u80fdArrow_Fdw\u3068GPU\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6a5f\u80fd\u306b\u3088\u308a\u4ee3\u66ff\u3055\u308c\u307e\u3057\u305f\u3002 Largeobject\uff5eGPU\u9593\u30a8\u30af\u30b9\u30dd\u30fc\u30c8/\u30a4\u30f3\u30dd\u30fc\u30c8 \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u672c\u6a5f\u80fd\u306f\u4e0d\u8981\u3068\u5224\u65ad\u3057\u307e\u3057\u305f\u3002","title":"\u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd"},{"location":"release_note/#pg-strom-v22","text":"PG-Strom Development Team (1-May-2019)","title":"PG-Strom v2.2\u30ea\u30ea\u30fc\u30b9"},{"location":"release_note/#_6","text":"PG-Strom v2.2\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3078\u306e\u5bfe\u5fdc Arrow_Fdw\u306b\u3088\u308b\u5217\u6307\u5411\u30b9\u30c8\u30a2\u306e\u30b5\u30dd\u30fc\u30c8 \u30d3\u30eb\u30c9\u6e08\u307fGPU\u30d0\u30a4\u30ca\u30ea\u3078\u306e\u5bfe\u5fdc Jsonb\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc \u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059GPU\u95a2\u6570\u306e\u5bfe\u5fdc GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\uff08Gstore_Fdw\uff09\u306e\u30bd\u30fc\u30c8\u5bfe\u5fdc NVMEoF\u3078\u306e\u5bfe\u5fdc\uff08\u5b9f\u9a13\u7684\u6a5f\u80fd\uff09","title":"\u6982\u8981"},{"location":"release_note/#_7","text":"PostgreSQL v9.6, v10, v11 CUDA Toolkit 10.1 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal\u4ee5\u964d)","title":"\u52d5\u4f5c\u74b0\u5883"},{"location":"release_note/#_8","text":"\u30c6\u30fc\u30d6\u30eb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3078\u306e\u5bfe\u5fdc \u30de\u30eb\u30c1GPU\u69cb\u6210\u306e\u5834\u5408\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u69cb\u6210\u3059\u308b\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u7269\u7406\u7684\u306aGPU\u3068\u306e\u8ddd\u96e2\u306b\u5fdc\u3058\u3066\u6700\u9069\u306aGPU\u3092\u9078\u629e\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002NVME-oF\u74b0\u5883\u306a\u3069PCIe\u30d0\u30b9\u306e\u69cb\u6210\u3060\u3051\u3067\u306f\u6700\u9069\u8ddd\u96e2\u3092\u5224\u65ad\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001DB\u7ba1\u7406\u8005\u306f pg_strom.nvme_distance_map \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u3044\u3066\u5bfe\u5fdc\u95a2\u4fc2\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u975e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3068\u306eJOIN\u6642\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5b50\u30c6\u30fc\u30d6\u30eb\u3068\u975e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3068\u306eJOIN\u3092\u884c\u3063\u305f\u5f8c\u3001\u5404\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u51e6\u7406\u7d50\u679c\u3092\u7d50\u5408\u3059\u308b\u3088\u3046\u306a\u5b9f\u884c\u8a08\u753b\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u672c\u6a5f\u80fd\u306f Asymmetric Partition-wise JOIN \u3068\u3044\u3046\u540d\u79f0\u3067PostgreSQL v13\u306e\u672c\u4f53\u6a5f\u80fd\u3078\u3068\u63d0\u6848\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Arrow_Fdw\u306b\u3088\u308b\u5217\u6307\u5411\u30b9\u30c8\u30a2\u306e\u30b5\u30dd\u30fc\u30c8 \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u7d4c\u7531\u3067Apache Arrow\u5f62\u5f0f\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u51fa\u3057\u306b\u5bfe\u5fdc\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 SSD-to-GPU Direct SQL\u3092\u7528\u3044\u305fApache Arrow\u306e\u8aad\u307f\u51fa\u3057\u3068SQL\u5b9f\u884c\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002 \u30d3\u30eb\u30c9\u6e08\u307fGPU\u30d0\u30a4\u30ca\u30ea\u3078\u306e\u5bfe\u5fdc SQL\u304b\u3089GPU\u30d0\u30a4\u30ca\u30ea\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3059\u308b\u969b\u3001\u5f93\u6765\u306f\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u8981\u7d20\u306e\u306a\u3044\u95a2\u6570\u7fa4\uff08\u30e9\u30a4\u30d6\u30e9\u30ea\u95a2\u6570\u306b\u9177\u4f3c\uff09\u3082\u542b\u3081\u3066CUDA C\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3001\u305d\u308c\u3092NVRTC(NVIDIA Run-Time Compiler)\u3092\u7528\u3044\u3066\u30d3\u30eb\u30c9\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4e00\u90e8\u306e\u8907\u96d1\u306a\u95a2\u6570\u306e\u5f71\u97ff\u3067\u30d3\u30eb\u30c9\u6642\u9593\u304c\u6975\u7aef\u306b\u9577\u304f\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002 v2.2\u306b\u304a\u3044\u3066\u3001\u9759\u7684\u306a\u95a2\u6570\u7fa4\u306f\u4e8b\u524d\u306b\u30d3\u30eb\u30c9\u3055\u308c\u3001SQL\u304b\u3089\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u90e8\u5206\u306e\u307f\u3092\u5b9f\u884c\u6642\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001GPU\u30d0\u30a4\u30ca\u30ea\u306e\u751f\u6210\u6642\u9593\u304c\u5927\u5e45\u306b\u6e1b\u5c11\u3059\u308b\u4e8b\u3068\u306a\u308a\u307e\u3057\u305f\u3002 JSONB\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc GPU\u5074\u3067JSONB\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5b50\u8981\u7d20\u3092\u53c2\u7167\u3057\u3001 numeric \u3084 text \u5024\u3068\u3057\u3066\u6761\u4ef6\u53e5\u306a\u3069\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002 \u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059GPU\u95a2\u6570\u306e\u5bfe\u5fdc textcat \u306a\u3069\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u578b\u3092\u8fd4\u3059SQL\u95a2\u6570\u3092GPU\u5074\u3067\u5b9f\u88c5\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\uff08Gstore_Fdw\uff09\u306e\u30bd\u30fc\u30c8\u5bfe\u5fdc PL/CUDA\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u4ee5\u5916\u306b\u3001GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u3066\u5b9f\u884c\u3059\u308bSQL\u3092GPU\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306fGpuScan\u304a\u3088\u3073GpuSort\u306e\uff12\u7a2e\u985e\u3067\u3001JOIN\u304a\u3088\u3073GROUP BY\u306b\u306f\u307e\u3060\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002 \u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306e\u8ffd\u52a0 \u7c21\u6613\u306a\u30c6\u30b9\u30c8\u306e\u305f\u3081\u3001\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002 NVME-oF\u3078\u306e\u5bfe\u5fdc\uff08\u5b9f\u9a13\u7684\u6a5f\u80fd\uff09 NVME-over-Fabric\u3092\u7528\u3044\u3066\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30ea\u30e2\u30fc\u30c8\u306eNVME\u30c7\u30a3\u30b9\u30af\u304b\u3089\u306eSSD-to-GPU Direct SQL\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u305f\u3060\u3057\u3001Red Hat Enterprise Linux 7.x / CentOS 7.x\u3067\u306f nvme_rdma \u30c9\u30e9\u30a4\u30d0\u306e\u5165\u308c\u66ff\u3048\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001\u73fe\u5728\u306e\u3068\u3053\u308d\u5b9f\u9a13\u7684\u6a5f\u80fd\u3068\u3044\u3046\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002","title":"\u65b0\u6a5f\u80fd"},{"location":"release_note/#_9","text":"PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u306eCustomScan API\u306b\u306f\u3001\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea(DSM)\u306e\u6b63\u3057\u3044\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306b\u5fc5\u8981\u306a\u5e7e\u3064\u304b\u306eAPI\u304c\u6b20\u3051\u3066\u304a\u308a\u3001\u5b9f\u884c\u6642\u7d71\u8a08\u60c5\u5831\u306e\u63a1\u53d6\u306a\u3069\u304c\u4e0d\u53ef\u80fd\u3067\u3057\u305f\u3002 \u307e\u305f\u3001\u5185\u90e8\u7684\u306b\u5f0f\u8868\u73fe(Expression)\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u306b\u3082\u5909\u66f4\u304c\u52a0\u3048\u3089\u308c\u3066\u3044\u308b\u4e8b\u304b\u3089\u3001\u5c11\u306a\u304f\u306a\u3044\u7b87\u6240\u3067 #if ... #endif \u30d6\u30ed\u30c3\u30af\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001\u30b3\u30fc\u30c9\u306e\u4fdd\u5b88\u6027\u3092\u640d\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002 \u3053\u308c\u3089\u306e\u554f\u984c\u306b\u3088\u308a\u3001PostgreSQL v9.6\u30b5\u30dd\u30fc\u30c8\u306f\u672c\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6700\u5f8c\u3068\u306a\u308a\u307e\u3059\u3002PG-Strom\u3092PostgreSQL v9.6\u3067\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f\u3001\u65e9\u671f\u306bPostgreSQL v11\u3078\u3068\u79fb\u884c\u3055\u308c\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 Gstore_Fdw\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306epgstrom\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u4e0a\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u3001\u5143\u3005PL/CUDA\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u8a2d\u8a08\u3055\u308c\u305f\u72ec\u81ea\u306e\u5217\u5f62\u5f0f\u3067\u3001\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u3084numeric\u30c7\u30fc\u30bf\u578b\u306e\u8868\u73fe\u306fPostgreSQL\u306e\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u3002 \u305d\u306e\u5f8c\u3001GPU\u4e0a\u3067\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u7528\u5171\u901a\u5f62\u5f0f\u3068\u3057\u3066\u3001Apache Arrow\u5f62\u5f0f\u3092\u5143\u306b\u3057\u305fNVIDIA RAPIDS(cuDF)\u304c\u516c\u958b\u3055\u308c\u3001\u591a\u304f\u306e\u6a5f\u68b0\u5b66\u7fd2\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3084Python\u3067\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30b9\u30bf\u30c3\u30af\u306a\u3069\u5bfe\u5fdc\u304c\u5f37\u5316\u3055\u308c\u3064\u3064\u3042\u308a\u307e\u3059\u3002 \u4eca\u5f8c\u3001PG-Strom\u306fGstore_Fdw\u306e\u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f\u3092cuDF\u3068\u5171\u901a\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u66f4\u3057\u3001\u3053\u308c\u3089\u6a5f\u68b0\u5b66\u7fd2\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u306e\u76f8\u4e92\u904b\u7528\u6027\u3092\u6539\u5584\u3057\u307e\u3059\u3002\u30b3\u30fc\u30c9\u306e\u4fdd\u5b88\u6027\u3092\u9ad8\u304f\u3059\u308b\u305f\u3081\u3001\u5f93\u6765\u306e\u72ec\u81ea\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u5ec3\u6b62\u3068\u306a\u308a\u307e\u3059\u3002","title":"\u5c06\u6765\u5ec3\u6b62\u4e88\u5b9a\u306e\u6a5f\u80fd"},{"location":"release_note/#_10","text":"\u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u30ad\u30e3\u30c3\u30b7\u30e5 \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u5206\u6790\u3057\u305f\u7d50\u679c\u3001\u591a\u304f\u306e\u30b1\u30fc\u30b9\u3067\u306fArrow_Fdw\u3067\u5341\u5206\u306b\u4ee3\u66ff\u53ef\u80fd\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3067\u3042\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\u91cd\u8907\u6a5f\u80fd\u3067\u3042\u308b\u305f\u3081\u3001\u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002","title":"\u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd"},{"location":"release_note/#pg-strom-v20","text":"PG-Strom Development Team (17-Apr-2018)","title":"PG-Strom v2.0\u30ea\u30ea\u30fc\u30b9"},{"location":"release_note/#_11","text":"PG-Strom v2.0\u306b\u304a\u3051\u308b\u4e3b\u8981\u306a\u6a5f\u80fd\u5f37\u5316\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002 GPU\u3092\u7ba1\u7406\u3059\u308b\u5185\u90e8\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u5168\u4f53\u7684\u306a\u518d\u8a2d\u8a08\u3068\u5b89\u5b9a\u5316 CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217\u5b9f\u884c SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2(store_fdw) GpuJoin\u3068GpuPreAgg\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u9ad8\u901f\u5316 GpuPreAgg+GpuJoin+GpuScan \u5bc6\u7d50\u5408GPU\u30ab\u30fc\u30cd\u30eb \u65b0\u6a5f\u80fd\u306e\u30b5\u30de\u30ea\u306f\u3053\u3061\u3089\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\uff1a PG-Strom v2.0 Technical Brief .","title":"\u6982\u8981"},{"location":"release_note/#_12","text":"PostgreSQL v9.6, v10 CUDA Toolkit 9.1 CUDA Toolkit\u306e\u30b5\u30dd\u30fc\u30c8\u3059\u308bLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 Intel x86 64bit \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3(x86_64) NVIDIA GPU CC 6.0 \u4ee5\u964d (Pascal\u4ee5\u964d)","title":"\u52d5\u4f5c\u74b0\u5883"},{"location":"release_note/#_13","text":"GPU\u3092\u7ba1\u7406\u3059\u308b\u5185\u90e8\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u5168\u4f53\u7684\u306a\u518d\u8a2d\u8a08\u3068\u5b89\u5b9a\u5316 PostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306f\u540c\u6642\u306b\uff11\u500b\u306eGPU\u3060\u3051\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30de\u30eb\u30c1GPU\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306fPostgreSQL\u306eCPU\u4e26\u5217\u3068\u306e\u4f75\u7528\u304c\u524d\u63d0\u306b\u306a\u308a\u307e\u3059\u304c\u3001CPU\u30b9\u30ec\u30c3\u30c9\u304cGPU\u3078\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306fGPU\u306e\u51e6\u7406\u80fd\u529b\u3088\u308a\u3082\u305a\u3063\u3068\u4f4e\u3044\u305f\u3081\u3001\u901a\u5e38\u3001\u3053\u308c\u306f\u554f\u984c\u3068\u306f\u306a\u308a\u307e\u305b\u3093\u3002\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u8a2d\u8a08\u306e\u30b7\u30f3\u30d7\u30eb\u5316\u3092\u512a\u5148\u3057\u307e\u3057\u305f\u3002 Pascal\u4e16\u4ee3\u4ee5\u964d\u306eGPU\u3067\u63a1\u7528\u3055\u308c\u305fGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u307b\u307c\u5168\u9762\u7684\u306b\u63a1\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u591a\u304f\u306f\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u307e\u3067\u5fc5\u8981\u306a\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u306e\u5927\u304d\u3055\u304c\u5206\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u3053\u308c\u307e\u3067\u306f\u5fc5\u8981\u4ee5\u4e0a\u306b\u30d0\u30c3\u30d5\u30a1\u3092\u7372\u5f97\u3057\u3001\u307e\u305f\u30e1\u30e2\u30ea\u4e0d\u8db3\u6642\u306b\u306f\u518d\u5b9f\u884c\u3092\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3089\u306f\u540c\u6642\u5b9f\u884c\u30d7\u30ed\u30bb\u30b9\u306e\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u5236\u9650\u3057\u3001\u307e\u305f\u8907\u96d1\u306a\u4f8b\u5916\u30ed\u30b8\u30c3\u30af\u306f\u30d0\u30b0\u306e\u6e29\u5e8a\u3067\u3057\u305f\u3002GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001\u8a2d\u8a08\u306e\u30b7\u30f3\u30d7\u30eb\u5316\u3092\u884c\u3044\u307e\u3057\u305f\u3002 CUDA\u306e\u975e\u540c\u671f\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5229\u7528\u3092\u6b62\u3081\u307e\u3057\u305f\u3002GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u30c7\u30de\u30f3\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092\u5229\u7528\u3059\u308b\u3068\u3001DMA\u8ee2\u9001\u306e\u305f\u3081\u306e\u975e\u540c\u671fAPI\uff08 cuMemCpyHtoD \u306a\u3069\uff09\u306f\u540c\u671f\u7684\u306b\u632f\u821e\u3046\u3088\u3046\u306b\u306a\u308b\u305f\u3081\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u591a\u91cd\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u4ee3\u308f\u308a\u306bPG-Strom\u81ea\u8eab\u304c\u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9\u3092\u7ba1\u7406\u3057\u3001\u3053\u308c\u3089\u306e\u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9\u304c\u305d\u308c\u305e\u308c\u540c\u671fAPI\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u8a2d\u8a08\u5909\u66f4\u3092\u884c\u3044\u307e\u3057\u305f\u3002\u526f\u7523\u7269\u3068\u3057\u3066\u3001\u975e\u540c\u671f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\uff08 cuStreamAddCallback \uff09\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u3063\u305f\u306e\u3067\u3001MPS\u3092\u5229\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002 CPU+GPU\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u4e26\u5217\u5b9f\u884c PostgreSQL v9.6\u3067\u65b0\u305f\u306b\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305fCPU\u4e26\u5217\u5b9f\u884c\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 PG-Strom\u306e\u63d0\u4f9b\u3059\u308bGpuScan\u3001GpuJoin\u304a\u3088\u3073GpuPreAgg\u306e\u5404\u30ed\u30b8\u30c3\u30af\u306f\u8907\u6570\u306ePostgreSQL\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308a\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 PostgreSQL v9.6\u3067\u306fCPU\u4e26\u5217\u5b9f\u884c\u306e\u969b\u306b EXPLAIN ANALYZE \u3067\u53d6\u5f97\u3059\u308bPG-Strom\u72ec\u81ea\u306e\u7d71\u8a08\u60c5\u5831\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001CustomScan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9API\u3067 ShutdownCustomScan \u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001DSM\uff08\u52d5\u7684\u5171\u6709\u30e1\u30e2\u30ea\uff09\u306e\u89e3\u653e\u524d\u306b\u30b3\u30fc\u30c7\u30a3\u30cd\u30fc\u30bf\u30d7\u30ed\u30bb\u30b9\u304c\u30ef\u30fc\u30ab\u30fc\u30d7\u30ed\u30bb\u30b9\u306e\u60c5\u5831\u3092\u56de\u53ce\u3059\u308b\u624b\u6bb5\u304c\u7121\u304b\u3063\u305f\u305f\u3081\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c Linux\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb nvme_strom \u3092\u7528\u3044\u308b\u4e8b\u3067\u3001NVMe\u898f\u683c\u306b\u5bfe\u5fdc\u3057\u305fSSD\u4e0a\u306ePostgreSQL\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u3001CPU/RAM\u3092\u4ecb\u3055\u305a\u30c0\u30a4\u30ec\u30af\u30c8\u306bGPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3078\u8ee2\u9001\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u30b7\u30b9\u30c6\u30e0RAM\u306b\u8f09\u308a\u5207\u3089\u306a\u3044\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3067\u3042\u3063\u3066\u3082\u3001\u672c\u6a5f\u80fd\u306b\u3088\u308aPG-Strom\u306e\u9069\u7528\u304c\u73fe\u5b9f\u7684\u306a\u9078\u629e\u80a2\u3068\u306a\u308b\u4e8b\u3067\u3057\u3087\u3046\u3002 \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u5c64\u3084\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u7d4c\u7531\u3057\u306a\u3044\u305f\u3081\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9650\u754c\u306b\u8fd1\u3044\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u5f15\u304d\u51fa\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3001\u304b\u3064\u3001GPU\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081CPU\u306e\u51e6\u7406\u3059\u3079\u304d\u30c7\u30fc\u30bf\u91cf\u3092\u6e1b\u3089\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u7279\u6027\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4e00\u822c\u7684\u306b\u306f\u8a08\u7b97\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308bGPU\u3092\u3001I/O\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u9ad8\u901f\u5316\u306b\u9069\u7528\u3059\u308b\u4e8b\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002 \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5 RAM\u30b5\u30a4\u30ba\u306b\u8f09\u308b\u7a0b\u5ea6\u306e\u5927\u304d\u3055\u306e\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u306f\u3001\u3088\u308aGPU\u3067\u306e\u51e6\u7406\u306b\u9069\u3057\u305f\u5217\u30c7\u30fc\u30bf\u5f62\u5f0f\u306b\u5909\u5f62\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30e3\u30f3\u306b\u969b\u3057\u3066\u3001\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306b\u306fPostgreSQL\u306e\u5171\u6709\u30d0\u30c3\u30d5\u30a1\u3088\u308a\u3082\u3053\u3061\u3089\u3092\u512a\u5148\u3057\u3066\u53c2\u7167\u3057\u307e\u3059\u3002 \u30a4\u30f3\u30e1\u30e2\u30ea\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u540c\u671f\u7684\u3001\u307e\u305f\u306f\u975e\u540c\u671f\u7684\u306b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u521d\u671f\u306ePG-Strom\u3067\u4f3c\u305f\u3088\u3046\u306a\u6a5f\u80fd\u304c\u5b58\u5728\u3057\u3066\u3044\u305f\u4e8b\u3092\u899a\u3048\u3066\u304a\u3089\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002v2.0\u3067\u65b0\u305f\u306b\u5b9f\u88c5\u3055\u308c\u305f\u5217\u6307\u5411\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u884c\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u3001\u5f53\u8a72\u884c\u3092\u542b\u3080\u30ad\u30e3\u30c3\u30b7\u30e5\u30d6\u30ed\u30c3\u30af\u3092\u6d88\u53bb\uff08invalidation\uff09\u3057\u307e\u3059\u3002\u884c\u30b9\u30c8\u30a2\u306e\u66f4\u65b0\u306b\u5408\u308f\u305b\u3066\u5217\u30ad\u30e3\u30c3\u30b7\u30e5\u5074\u306e\u66f4\u65b0\u3092\u884c\u3046\u3068\u3044\u3046\u4e8b\u306f\u884c\u308f\u306a\u3044\u305f\u3081\u3001\u66f4\u65b0\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u5bfe\u3059\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4f4e\u4e0b\u306f\u9650\u5b9a\u7684\u3067\u3059\u3002 GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2(gstore_fdw) GPU\u4e0a\u306b\u78ba\u4fdd\u3057\u305f\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u9818\u57df\u306b\u5bfe\u3057\u3066\u3001\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\uff08Foreign Table\uff09\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5229\u7528\u3057\u3066SQL\u306eSELECT/INSERT/UPDATE/DELETE\u306b\u3088\u308a\u8aad\u307f\u66f8\u304d\u3092\u884c\u3046\u6a5f\u80fd\u3067\u3059\u3002 \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f pgstrom \u578b\u306e\u307f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001PG-Strom\u306e\u30d0\u30c3\u30d5\u30a1\u5f62\u5f0f KDS_FORMAT_COLUMN \u30bf\u30a4\u30d7\u3068\u540c\u4e00\u306e\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u53ef\u5909\u9577\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u3001LZ\u65b9\u5f0f\u306b\u3088\u308b\u30c7\u30fc\u30bf\u5727\u7e2e\u3092\u884c\u3046\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 v2.0\u306e\u6642\u70b9\u3067\u306f\u3001GPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u306fPL/CUDA\u95a2\u6570\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3057\u3066\u3060\u3051\u5229\u7528\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 GpuJoin\u3068GpuPreAgg\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u9ad8\u901f\u5316 \u5f93\u6765\u3001GpuJoin\u3068GpuPreAgg\u3067\u5185\u90e8\u7684\u306b\u4f7f\u7528\u3057\u3066\u3044\u305fDynamic Parallelism\u306e\u5229\u7528\u3092\u3084\u3081\u3001\u51e6\u7406\u30ed\u30b8\u30c3\u30af\u5168\u4f53\u306e\u898b\u76f4\u3057\u3092\u884c\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001GPU\u30b5\u30d6\u30ab\u30fc\u30cd\u30eb\u306e\u8d77\u52d5\u5f8c\u3001\u305d\u306e\u5b8c\u4e86\u3092\u5358\u306b\u5f85\u3063\u3066\u3044\u308b\u3060\u3051\u306eGPU\u30ab\u30fc\u30cd\u30eb\u304c\u5b9f\u884c\u30b9\u30ed\u30c3\u30c8\u3092\u5360\u6709\u3057\u3001GPU\u306e\u4f7f\u7528\u7387\u304c\u4e0a\u304c\u3089\u306a\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u3063\u305f\u305f\u3081\u3067\u3059\u3002 \u3053\u306e\u518d\u8a2d\u8a08\u306b\u4f34\u3046\u526f\u7523\u7269\u3068\u3057\u3066\u3001GpuJoin\u306e\u30b5\u30b9\u30da\u30f3\u30c9/\u30ec\u30b8\u30e5\u30fc\u30e0\u6a5f\u80fd\u304c\u5b9f\u88c5\u3055\u308c\u307e\u3057\u305f\u3002\u539f\u7406\u4e0a\u3001SQL\u306eJOIN\u51e6\u7406\u306f\u5165\u529b\u3057\u305f\u884c\u6570\u3088\u308a\u3082\u51fa\u529b\u3059\u308b\u884c\u6570\u306e\u65b9\u304c\u5897\u3048\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u51e6\u7406\u7d50\u679c\u3092\u66f8\u304d\u8fbc\u3080\u30d0\u30c3\u30d5\u30a1\u306e\u6b8b\u308a\u30b5\u30a4\u30ba\u304c\u4e0d\u8db3\u3057\u305f\u6642\u70b9\u3067GpuJoin\u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3057\u3001\u65b0\u3057\u3044\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u3092\u5272\u308a\u5f53\u3066\u3066\u30ec\u30b8\u30e5\u30fc\u30e0\u3059\u308b\u3088\u3046\u306b\u4fee\u6b63\u3055\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u306e\u30b5\u30a4\u30ba\u63a8\u5b9a\u304c\u7c21\u7565\u5316\u3055\u308c\u305f\u307b\u304b\u3001\u5b9f\u884c\u6642\u306e\u30d0\u30c3\u30d5\u30a1\u4e0d\u8db3\u306b\u3088\u308b\u518d\u5b9f\u884c\u306e\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002 GpuPreAgg+GpuJoin+GpuScan \u5bc6\u7d50\u5408GPU\u30ab\u30fc\u30cd\u30eb GPU\u3067\u5b9f\u884c\u53ef\u80fd\u306aSCAN\u3001JOIN\u3001GROUP BY\u304c\u9023\u7d9a\u3057\u3066\u3044\u308b\u3068\u304d\u3001\u5bfe\u5fdc\u3059\u308bGpuScan\u3001GpuJoin\u3001GpuPreAgg\u306b\u76f8\u5f53\u3059\u308b\u51e6\u7406\u3092\u4e00\u56de\u306eGPU\u30ab\u30fc\u30cd\u30eb\u547c\u3073\u51fa\u3057\u3067\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001GpuJoin\u306e\u7d50\u679c\u30d0\u30c3\u30d5\u30a1\u3092\u305d\u306e\u307e\u307eGpuPreAgg\u306e\u5165\u529b\u30d0\u30c3\u30d5\u30a1\u3068\u3057\u3066\u6271\u3046\u306a\u3069\u3001CPU\u3068GPU\u306e\u9593\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u3092\u6700\u5c0f\u9650\u306b\u6291\u3048\u308b\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u3053\u306e\u6a5f\u80fd\u306f\u7279\u306b\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3068\u52b9\u679c\u7684\u3067\u3059\u3002 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\u578b\u306e\u5bfe\u5fdc uuid \u578b\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u578b\uff08 inet \u3001 cidr \u3001\u304a\u3088\u3073 macaddr \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u7bc4\u56f2\u578b\uff08 int4range \u3001 int8range \u3001 tsrange \u3001 tstzrange \u3001 daterange \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 \u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\uff08 float2 \uff09\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u534a\u7cbe\u5ea6\u6d6e\u52d5\u5c0f\u6570\u70b9\u578b\u306b\u95a2\u9023\u3059\u308bCPU\u5074\u306e\u5b9f\u88c5\u306fPG-Strom\u306e\u72ec\u81ea\u5b9f\u88c5\u306b\u3088\u308b\u3082\u306e\u3067\u3059\u3002 \u65b0\u3057\u3044\u6f14\u7b97\u5b50/\u95a2\u6570\u306e\u5bfe\u5fdc \u65e5\u4ed8\u6642\u523b\u578b\u306b\u5bfe\u3059\u308b EXTRACT(field FROM timestamp) \u6f14\u7b97\u5b50\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002 New data type support uuid type Network address types ( inet , cidr and macaddr ) Range data types ( int4range , int8range , tsrange , tstzrange , daterange ) Half-precision floating point type ( float2 ). Its CPU side are also implemented by PG-Strom itself, not PostgreSQL's built-in feature. New operators / functions EXTRACT(field FROM timestamp) operator on the date and time types PL/CUDA\u95a2\u9023\u306e\u5f37\u5316 #plcuda_include \u306e\u62e1\u5f35\u306b\u3088\u308a\u3001 text \u578b\u3092\u8fd4\u3059SQL\u95a2\u6570\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u5f15\u6570\u306e\u5024\u306b\u3088\u3063\u3066\u633f\u5165\u3059\u308b\u30b3\u30fc\u30c9\u3092\u5909\u3048\u308b\u4e8b\u304c\u3067\u304d\u308b\u305f\u3081\u3001\u5358\u306b\u5916\u90e8\u5b9a\u7fa9\u95a2\u6570\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u3067\u306a\u304f\u3001\u52d5\u7684\u306b\u3044\u304f\u3064\u3082\u306eGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308a\u51fa\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002 PL/CUDA\u95a2\u6570\u306e\u5f15\u6570\u306b reggstore \u578b\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001GPU\u30ab\u30fc\u30cd\u30eb\u95a2\u6570\u3078\u306f\u5bfe\u5fdc\u3059\u308bGPU\u30e1\u30e2\u30ea\u30b9\u30c8\u30a2\u306e\u30dd\u30a4\u30f3\u30bf\u304c\u6e21\u3055\u308c\u307e\u3059\u3002OID\u5024\u304c\u6e21\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u305d\u306e\u4ed6\u306e\u6a5f\u80fd\u5f37\u5316 lo_import_gpu \u304a\u3088\u3073 lo_export_gpu \u95a2\u6570\u306b\u3088\u308a\u3001\u5916\u90e8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u4fdd\u3057\u305fGPU\u30e1\u30e2\u30ea\u306e\u5185\u5bb9\u3092\u76f4\u63a5PostgreSQL\u306e\u30e9\u30fc\u30b8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a18\u9332\u3057\u305f\u308a\u3001\u9006\u306b\u30e9\u30fc\u30b8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5185\u5bb9\u3092GPU\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u51fa\u3059\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0 PostgreSQL Global Development Group\u306e\u914d\u5e03\u3059\u308bPostgreSQL\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u9069\u5408\u3059\u308b\u3088\u3046\u3001RPM\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3092\u884c\u3044\u307e\u3057\u305f\u3002 \u5168\u3066\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7269\u4ef6\u306fHeteroDB SWDC(Software Distribution Center)\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 PG-Strom\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092markdown\u3068mkdocs\u3092\u7528\u3044\u3066\u5168\u9762\u7684\u306b\u66f8\u304d\u76f4\u3057\u307e\u3057\u305f\u3002\u5f93\u6765\u306eHTML\u3092\u7528\u3044\u305f\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u6bd4\u3079\u3001\u3088\u308a\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u5bb9\u6613\u3067\u65b0\u6a5f\u80fd\u306e\u958b\u767a\u306b\u5408\u308f\u305b\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u62e1\u5145\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002 \u30c6\u30b9\u30c8 PostgreSQL\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3057\u3066\u3001PG-Strom\u306e\u30ea\u30b0\u30ec\u30c3\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002","title":"\u65b0\u6a5f\u80fd"},{"location":"release_note/#_14","text":"PostgreSQL v9.5\u30b5\u30dd\u30fc\u30c8 PostgreSQL v9.6\u3067\u306fCPU\u4e26\u5217\u30af\u30a8\u30ea\u306e\u63d0\u4f9b\u306b\u4f34\u3044\u3001\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6/\u30a8\u30b0\u30bc\u30ad\u30e5\u30fc\u30bf\u5171\u306b\u5927\u304d\u306a\u4fee\u6b63\u304c\u52a0\u3048\u3089\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u3068\u5bc6\u63a5\u306b\u9023\u643a\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3068\u3063\u3066\u6700\u3082\u30a4\u30f3\u30d1\u30af\u30c8\u306e\u5927\u304d\u306a\u5909\u66f4\u306f\u300eupper planner path-ification\u300f\u3068\u547c\u3070\u308c\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5f37\u5316\u3067\u3001\u96c6\u7d04\u6f14\u7b97\u3084\u30bd\u30fc\u30c8\u306a\u3069\u306e\u5b9f\u884c\u8a08\u753b\u3082\u30b3\u30b9\u30c8\u30d9\u30fc\u30b9\u3067\u8907\u6570\u306e\u7570\u306a\u308b\u65b9\u6cd5\u3092\u6bd4\u8f03\u3057\u3066\u6700\u9069\u306a\u3082\u306e\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u3053\u308c\u306fGpuPreAgg\u3092\u5b9f\u88c5\u3059\u308b\u305f\u3081\u306b\u30d5\u30c3\u30af\u3092\u5229\u7528\u3057\u3066\u5b9f\u884c\u8a08\u753b\u3092\u66f8\u304d\u63db\u3048\u3066\u3044\u305f\u5f93\u6765\u306e\u65b9\u6cd5\u3068\u306f\u6839\u672c\u7684\u306b\u7570\u306a\u308a\u3001\u3088\u308a\u5408\u7406\u7684\u304b\u3064\u4fe1\u983c\u3067\u304d\u308b\u65b9\u6cd5\u3067GPU\u3092\u7528\u3044\u305f\u96c6\u7d04\u6f14\u7b97\u3092\u633f\u5165\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3068\u306a\u308a\u3001\u30d0\u30b0\u306e\u6e29\u5e8a\u3067\u3042\u3063\u305f\u5b9f\u884c\u8a08\u753b\u306e\u66f8\u304d\u63db\u3048\u30ed\u30b8\u30c3\u30af\u3092\u6368\u3066\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u540c\u6642\u306b\u3001CustomScan\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3082CPU\u4e26\u5217\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306eAPI\u304c\u62e1\u5f35\u3055\u308c\u3001\u3053\u308c\u3089\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306bPostgreSQL v9.5\u30b5\u30dd\u30fc\u30c8\u306f\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002 GpuSort\u6a5f\u80fd GpuSort\u6a5f\u80fd\u306f\u6027\u80fd\u4e0a\u306e\u30e1\u30ea\u30c3\u30c8\u304c\u5f97\u3089\u308c\u306a\u3044\u305f\u3081\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002 \u30bd\u30fc\u30c8\u306fGPU\u306e\u5f97\u610f\u3068\u3059\u308b\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u4e00\u3064\u3067\u3059\u3002\u3057\u304b\u3057\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u306e\u5927\u304d\u3055\u3092\u8d8a\u3048\u308b\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u30bd\u30fc\u30c8\u3059\u308b\u5834\u5408\u3001\u8907\u6570\u306e\u30c1\u30e3\u30f3\u30af\u306b\u5206\u5272\u3057\u3066\u90e8\u5206\u30bd\u30fc\u30c8\u3092\u884c\u3044\u3001\u5f8c\u3067CPU\u5074\u3067\u3053\u308c\u3092\u7d50\u5408\u3057\u3066\u6700\u7d42\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u7d50\u5408\u30d5\u30a7\u30fc\u30ba\u306e\u51e6\u7406\u3092\u8efd\u304f\u3059\u308b\u306b\u306f\u3001GPU\u3067\u30bd\u30fc\u30c8\u3059\u3079\u304d\u30c1\u30e3\u30f3\u30af\u306e\u30b5\u30a4\u30ba\u3092\u5927\u304d\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4e00\u65b9\u3067\u30c1\u30e3\u30f3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u30bd\u30fc\u30c8\u51e6\u7406\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306e\u30ea\u30fc\u30c9\u30bf\u30a4\u30e0\u304c\u9577\u304f\u306a\u308a\u3001PG-Strom\u306e\u7279\u9577\u306e\u4e00\u3064\u3067\u3042\u308b\u975e\u540c\u671f\u51e6\u7406\u306b\u3088\u308b\u30c7\u30fc\u30bf\u8ee2\u9001\u30ec\u30a4\u30c6\u30f3\u30b7\u306e\u96a0\u307a\u3044\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u3042\u308a\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u554f\u984c\u306b\u5bfe\u51e6\u3059\u308b\u306e\u306f\u56f0\u96e3\u3001\u5c11\u306a\u304f\u3068\u3082\u6642\u671f\u5c1a\u65e9\u3067\u3042\u308b\u3068\u5224\u65ad\u3057\u3001GpuSort\u6a5f\u80fd\u306f\u5ec3\u6b62\u3055\u308c\u307e\u3057\u305f\u3002","title":"\u5ec3\u6b62\u3055\u308c\u305f\u6a5f\u80fd"},{"location":"ssd2gpu/","text":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c \u6982\u8981 SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u51e6\u7406\u3059\u308b\u306b\u306f\u3001\u30d7\u30ed\u30bb\u30c3\u30b5\u304c\u52b9\u7387\u3088\u304f\u51e6\u7406\u3092\u884c\u3046\u306e\u3068\u540c\u69d8\u306b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3084\u30e1\u30e2\u30ea\u304b\u3089\u30d7\u30ed\u30bb\u30c3\u30b5\u3078\u9ad8\u901f\u306b\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u4e8b\u304c\u91cd\u8981\u3067\u3059\u3002\u51e6\u7406\u3059\u3079\u304d\u30c7\u30fc\u30bf\u304c\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u5c4a\u3044\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u30d7\u30ed\u30bb\u30c3\u30b5\u306f\u624b\u6301\u3061\u7121\u6c99\u6c70\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u6a5f\u80fd\u306f\u3001PCIe\u30d0\u30b9\u306b\u76f4\u7d50\u3059\u308b\u4e8b\u3067\u9ad8\u901f\u306aI/O\u51e6\u7406\u3092\u5b9f\u73fe\u3059\u308bNVMe-SSD\u3068\u3001\u540c\u3058PCIe\u30d0\u30b9\u4e0a\u306b\u63a5\u7d9a\u3055\u308c\u305fGPU\u3092\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u63a5\u7d9a\u3057\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9650\u754c\u306b\u8fd1\u3044\u901f\u5ea6\u3067\u30c7\u30fc\u30bf\u3092\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u4f9b\u7d66\u3059\u308b\u4e8b\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002 \u901a\u5e38\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306b\u683c\u7d0d\u3055\u308c\u305fPostgreSQL\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306f\u3001PCIe\u30d0\u30b9\u3092\u901a\u3057\u3066\u3044\u3063\u305f\u3093CPU/RAM\u3078\u3068\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u306b\u3057\u305f\u304c\u3063\u3066WHERE\u53e5\u306b\u3088\u308b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3084JOIN/GROUP BY\u3068\u3044\u3063\u305f\u51e6\u7406\u3092\u884c\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u96c6\u8a08\u7cfb\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u7279\u6027\u4e0a\u3001\u5165\u529b\u3059\u308b\u30c7\u30fc\u30bf\u4ef6\u6570\u3088\u308a\u51fa\u529b\u3059\u308b\u30c7\u30fc\u30bf\u4ef6\u6570\u306e\u65b9\u304c\u306f\u308b\u304b\u306b\u5c11\u306a\u3044\u4ef6\u6570\u3068\u306a\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u6570\u5341\u5104\u884c\u3092\u8aad\u307f\u51fa\u3057\u305f\u7d50\u679c\u3092GROUP BY\u3067\u96c6\u7d04\u3057\u305f\u7d50\u679c\u304c\u9ad8\u3005\u6570\u767e\u884c\u3068\u3044\u3046\u4e8b\u3082\u73cd\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u8a00\u3044\u63db\u3048\u308c\u3070\u3001\u6211\u3005\u306f\u30b4\u30df\u30c7\u30fc\u30bf\u3092\u904b\u3076\u305f\u3081\u306bPCIe\u30d0\u30b9\u4e0a\u306e\u5e2f\u57df\u3092\u6d88\u8cbb\u3057\u3066\u3044\u308b\u3068\u3082\u8a00\u3048\u307e\u3059\u304c\u3001CPU\u304c\u30ec\u30b3\u30fc\u30c9\u306e\u4e2d\u8eab\u3092\u8abf\u3079\u308b\u307e\u3067\u306f\u3001\u305d\u306e\u8981\u4e0d\u8981\u3092\u5224\u65ad\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u4e00\u822c\u7684\u306a\u5b9f\u88c5\u3067\u306f\u3053\u308c\u306f\u4e0d\u53ef\u907f\u3068\u8a00\u3048\u307e\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3092\u5909\u3048\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092PCIe\u30d0\u30b9\u4e0a\u306eP2P DMA\u3092\u7528\u3044\u3066GPU\u306b\u76f4\u63a5\u8ee2\u9001\u3057\u3001GPU\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u4e8b\u3067CPU\u304c\u51e6\u7406\u3059\u3079\u304d\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u6e1b\u3089\u3059\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002\u3044\u308f\u3070\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068CPU/RAM\u306e\u9593\u306b\u4f4d\u7f6e\u3057\u3066SQL\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u3068\u3057\u3066GPU\u3092\u6d3b\u7528\u3057\u3001\u7d50\u679c\u3068\u3057\u3066I/O\u51e6\u7406\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u672c\u6a5f\u80fd\u306f\u5185\u90e8\u7684\u306bNVIDIA\u306eGPUDirect RDMA\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30ab\u30b9\u30bf\u30e0Linux kernel module\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3068\u4ed6\u306ePCIe\u30c7\u30d0\u30a4\u30b9\u306e\u9593\u3067P2P\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u53ef\u80fd\u306b\u3059\u308b\u57fa\u76e4\u6280\u8853\u3067\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u672c\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001PostgreSQL\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bPG-Strom\u3060\u3051\u3067\u306f\u306a\u304f\u3001Linux kernel\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bNVMe-Strom\u30c9\u30e9\u30a4\u30d0\u304c\u5fc5\u8981\u3067\u3059\u3002 \u307e\u305f\u3001\u672c\u6a5f\u80fd\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u306fNVMe\u4ed5\u69d8\u306eSSD\u306e\u307f\u3067\u3059\u3002SAS\u3084SATA\u3068\u3044\u3063\u305f\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u63a5\u7d9a\u3055\u308c\u305fSSD\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4eca\u307e\u3067\u306b\u52d5\u4f5c\u5b9f\u7e3e\u306e\u3042\u308bNVMe-SSD\u306b\u3064\u3044\u3066\u306f 002: HW Validation List \u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002 \u521d\u671f\u8a2d\u5b9a \u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f nvme_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306fNVMe-SSD\u3068GPU\u9593\u306eP2P DMA\u3092\u4ef2\u4ecb\u3059\u308bLinux kernel module\u3092\u542b\u3093\u3067\u304a\u308a\u3001 HeteroDB Software Distribution Center \u304b\u3089\u5165\u624b\u53ef\u80fd\u3067\u3059\u3002 \u65e2\u306b heterodb-swdc \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u5834\u5408\u3001 yum \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u53ef\u80fd\u3067\u3059\u3002 $ sudo yum install nvme_strom : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: nvme_strom x86_64 0.8-1.el7 heterodb 178 k Transaction Summary ================================================================================ Install 1 Package : DKMS: install completed. Verifying : nvme_strom-0.8-1.el7.x86_64 1/1 Installed: nvme_strom.x86_64 0:0.8-1.el7 Complete! nvme_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b lsmod \u30b3\u30de\u30f3\u30c9\u3067 nvme_strom \u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002 $ lsmod | grep nvme nvme_strom 12625 0 nvme 27722 4 nvme_core 52964 9 nvme \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306e\u8a2d\u8a08 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u4ee5\u4e0b\u306e\u6761\u4ef6\u3067\u767a\u52d5\u3057\u307e\u3059\u3002 \u30b9\u30ad\u30e3\u30f3\u5bfe\u8c61\u306e\u30c6\u30fc\u30d6\u30eb\u304cNVMe-SSD\u3067\u69cb\u6210\u3055\u308c\u305f\u533a\u753b\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3002 /dev/nvmeXXXX \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3001\u307e\u305f\u306f /dev/nvmeXXXX \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u306e\u307f\u304b\u3089\u69cb\u6210\u3055\u308c\u305fmd-raid0\u533a\u753b\u304c\u5bfe\u8c61\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u304c pg_strom.nvme_strom_threshold \u3088\u308a\u3082\u5927\u304d\u3044\u4e8b\u3002 \u3053\u306e\u8a2d\u5b9a\u5024\u306f\u4efb\u610f\u306b\u5909\u66f4\u53ef\u80fd\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u672c\u4f53\u642d\u8f09\u7269\u7406\u30e1\u30e2\u30ea\u306b shared_buffers \u306e\u8a2d\u5b9a\u5024\u306e1/3\u3092\u52a0\u3048\u305f\u5927\u304d\u3055\u3067\u3059\u3002 Note md-raid0\u3092\u7528\u3044\u3066\u8907\u6570\u306eNVMe-SSD\u533a\u753b\u304b\u3089\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u8aad\u51fa\u3057\u3092\u884c\u3046\u306b\u306f\u3001HeteroDB\u793e\u306e\u63d0\u4f9b\u3059\u308b\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u9069\u7528\u304c\u5fc5\u8981\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u3092NVMe-SSD\u3067\u69cb\u6210\u3055\u308c\u305f\u533a\u753b\u306b\u914d\u7f6e\u3059\u308b\u306b\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092NVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u683c\u7d0d\u3059\u308b\u4ee5\u5916\u306b\u3082\u3001PostgreSQL\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u6a5f\u80fd\u3092\u7528\u3044\u3066\u7279\u5b9a\u306e\u30c6\u30fc\u30d6\u30eb\u3084\u7279\u5b9a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u307f\u3092NVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u914d\u7f6e\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4f8b\u3048\u3070 /opt/nvme \u306bNVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 PostgreSQL\u306e\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u6a29\u9650\u3067\u5f53\u8a72\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 CREATE TABLESPACE my_nvme LOCATION '/opt/nvme'; \u3053\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u4e0a\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001 CREATE TABLE \u69cb\u6587\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002 CREATE TABLE my_table (...) TABLESPACE my_nvme; \u3042\u308b\u3044\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3092\u5909\u66f4\u3059\u308b\u306b\u306f\u3001 ALTER DATABASE \u69cb\u6587\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002 \u3053\u306e\u5834\u5408\u3001\u65e2\u5b58\u30c6\u30fc\u30d6\u30eb\u306e\u914d\u7f6e\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 ALTER DATABASE my_database SET TABLESPACE my_nvme; GPU\u3068NVME-SSD\u9593\u306e\u8ddd\u96e2 \u30b5\u30fc\u30d0\u306e\u9078\u5b9a\u3068GPU\u304a\u3088\u3073NVME-SSD\u306e\u642d\u8f09\u306b\u3042\u305f\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306e\u6301\u3064\u6027\u80fd\u3092\u6700\u5927\u9650\u306b\u5f15\u304d\u51fa\u3059\u306b\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u9593\u306e\u8ddd\u96e2\u3092\u610f\u8b58\u3057\u305f\u30b3\u30f3\u30d5\u30a3\u30b0\u304c\u5fc5\u8981\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u304c\u305d\u306e\u57fa\u76e4\u3068\u3057\u3066\u4f7f\u7528\u3057\u3066\u3044\u308b NVIDIA GPUDirect RDMA \u306f\u3001P2P DMA\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u4e92\u3044\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u540c\u3058PCIe root complex\u306e\u914d\u4e0b\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u8981\u6c42\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u30c7\u30e5\u30a2\u30ebCPU\u30b7\u30b9\u30c6\u30e0\u3067NVME-SSD\u304cCPU1\u306b\u3001GPU\u304cCPU2\u306b\u63a5\u7d9a\u3055\u308c\u3066\u304a\u308a\u3001P2P DMA\u304cCPU\u9593\u306eQPI\u3092\u6a2a\u5207\u308b\u3088\u3046\u69cb\u6210\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u307e\u305f\u3001\u6027\u80fd\u306e\u89b3\u70b9\u304b\u3089\u306fCPU\u5185\u8535\u306ePCIe\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3088\u308a\u3082\u3001\u5c02\u7528\u306ePCIe\u30b9\u30a4\u30c3\u30c1\u3092\u4ecb\u3057\u3066\u4e92\u3044\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u63a5\u7d9a\u3059\u308b\u65b9\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u5199\u771f\u306fHPC\u5411\u3051\u30b5\u30fc\u30d0\u306e\u30de\u30b6\u30fc\u30dc\u30fc\u30c9\u3067\u30018\u672c\u306ePCIe x16\u30b9\u30ed\u30c3\u30c8\u304cPCIe\u30b9\u30a4\u30c3\u30c1\u3092\u4ecb\u3057\u3066\u4e92\u3044\u306b\u5bfe\u3068\u306a\u308b\u30b9\u30ed\u30c3\u30c8\u3068\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u5199\u771f\u306e\u5de6\u5074\u306e\u30b9\u30ed\u30c3\u30c8\u306fCPU1\u306b\u3001\u53f3\u5074\u306e\u30b9\u30ed\u30c3\u30c8\u306fCPU2\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4f8b\u3048\u3070\u3001SSD-2\u4e0a\u306b\u69cb\u7bc9\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u7528\u3044\u3066\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5834\u5408\u3001\u6700\u9069\u306aGPU\u306e\u9078\u629e\u306fGPU-2\u3067\u3057\u3087\u3046\u3002\u307e\u305fGPU-1\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001GPUDirect RDMA\u306e\u5236\u7d04\u304b\u3089\u3001GPU-3\u3068GPU-4\u306e\u4f7f\u7528\u306f\u907f\u3051\u306d\u3070\u306a\u308a\u307e\u305b\u3093\u3002 PG-Strom\u306f\u8d77\u52d5\u6642\u306b\u30b7\u30b9\u30c6\u30e0\u306ePCIe\u30d0\u30b9\u30c8\u30dd\u30ed\u30b8\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3001GPU\u3068NVME-SSD\u9593\u306e\u8ad6\u7406\u7684\u306a\u8ddd\u96e2\u3092\u7b97\u51fa\u3057\u307e\u3059\u3002 \u3053\u308c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8d77\u52d5\u6642\u306e\u30ed\u30b0\u306b\u8a18\u9332\u3055\u308c\u3066\u304a\u308a\u3001\u4f8b\u3048\u3070 /dev/nvme2 \u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u6642\u306fGPU1\u3068\u3044\u3063\u305f\u5177\u5408\u306b\u3001\u5404NVME-SSD\u3054\u3068\u306b\u6700\u3082\u8ddd\u96e2\u306e\u8fd1\u3044GPU\u3092\u512a\u5148\u3057\u3066\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 $ pg_ctl restart : LOG: GPU<->SSD Distance Matrix LOG: GPU0 GPU1 GPU2 LOG: nvme0 ( 3) 7 7 LOG: nvme5 7 7 ( 3) LOG: nvme4 7 7 ( 3) LOG: nvme2 7 ( 3) 7 LOG: nvme1 ( 3) 7 7 LOG: nvme3 7 ( 3) 7 : \u901a\u5e38\u306f\u81ea\u52d5\u8a2d\u5b9a\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002 \u305f\u3060\u3001NVME-over-Fabric(RDMA)\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306fPCIe\u30d0\u30b9\u4e0a\u306envme\u30c7\u30d0\u30a4\u30b9\u306e\u4f4d\u7f6e\u3092\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u624b\u52d5\u3067NVME-SSD\u3068GPU\u306e\u4f4d\u7f6e\u95a2\u4fc2\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4f8b\u3048\u3070 nvme1 \u306b\u306f gpu2 \u3092\u3001 nvme2 \u3068 nvme3 \u306b\u306f gpu1 \u3092\u5272\u308a\u5f53\u3066\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092 postgresql.conf \u3078\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u306e\u624b\u52d5\u8a2d\u5b9a\u306f\u3001\u81ea\u52d5\u8a2d\u5b9a\u3088\u308a\u3082\u512a\u5148\u3059\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 pg_strom.nvme_distance_map = nvme1:gpu2, nvme2:gpu1, nvme3:gpu1 \u904b\u7528 GUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308b\u5236\u5fa1 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u95a2\u9023\u3059\u308bGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306f2\u3064\u3042\u308a\u307e\u3059\u3002 \u4e00\u3064\u306f pg_strom.nvme_strom_enabled \u3067\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u6a5f\u80fd\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5358\u7d14\u306bon/off\u3057\u307e\u3059\u3002 \u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u304c off \u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b5\u30a4\u30ba\u3084\u7269\u7406\u914d\u7f6e\u3068\u306f\u7121\u95a2\u4fc2\u306bSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u4f7f\u7528\u3055\u308c\u307e\u305b\u3093\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f on \u3067\u3059\u3002 \u3082\u3046\u4e00\u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306f pg_strom.nvme_strom_threshold \u3067\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u4f7f\u308f\u308c\u308b\u3079\u304d\u6700\u5c0f\u306e\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u306e\u7269\u7406\u914d\u7f6e\u304cNVMe-SSD\u533a\u753b\uff08\u307e\u305f\u306f\u3001NVMe-SSD\u306e\u307f\u3067\u69cb\u6210\u3055\u308c\u305fmd-raid0\u533a\u753b\uff09\u4e0a\u306b\u5b58\u5728\u3057\u3001\u304b\u3064\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b5\u30a4\u30ba\u304c\u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\u5024\u3088\u308a\u3082\u5927\u304d\u306a\u5834\u5408\u3001PG-Strom\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u7269\u7406\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u3068 shared_buffers \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\u5024\u306e1/3\u3067\u3059\u3002\u3064\u307e\u308a\u3001\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u9593\u9055\u3044\u306a\u304f\u30aa\u30f3\u30e1\u30e2\u30ea\u3067\u51e6\u7406\u3057\u304d\u308c\u306a\u3044\u30b5\u30a4\u30ba\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3060\u3051SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u884c\u3046\u3088\u3046\u8abf\u6574\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306f\u3001\u4e00\u56de\u306e\u8aad\u307f\u51fa\u3057\u3067\u3042\u308c\u3070SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u512a\u4f4d\u6027\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u30aa\u30f3\u30e1\u30e2\u30ea\u51e6\u7406\u304c\u3067\u304d\u308b\u7a0b\u5ea6\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306f\u3001\u4e8c\u56de\u76ee\u4ee5\u964d\u306e\u30c7\u30a3\u30b9\u30af\u30ad\u30e3\u30c3\u30b7\u30e5\u5229\u7528\u3092\u8003\u616e\u3059\u308b\u3068\u3001\u5fc5\u305a\u3057\u3082\u512a\u4f4d\u3068\u306f\u8a00\u3048\u306a\u3044\u3068\u3044\u3046\u4eee\u5b9a\u306b\u7acb\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002 \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u7279\u6027\u306b\u3088\u3063\u3066\u306f\u5fc5\u305a\u3057\u3082\u3053\u306e\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u3068\u306f\u9650\u308a\u307e\u305b\u3093\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5229\u7528\u3092\u78ba\u8a8d\u3059\u308b EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5f53\u8a72\u30af\u30a8\u30ea\u3067SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u5229\u7528\u3055\u308c\u308b\u306e\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30af\u30a8\u30ea\u306e\u4f8b\u3067\u306f\u3001 Custom Scan (GpuJoin) \u306b\u3088\u308b lineorder \u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u30b9\u30ad\u30e3\u30f3\u306b NVMe-Strom: enabled \u3068\u306e\u8868\u793a\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001 lineorder \u30c6\u30fc\u30d6\u30eb\u304b\u3089\u306e\u8aad\u51fa\u3057\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u5229\u7528\u3055\u308c\u307e\u3059\u3002 # explain (costs off) select sum(lo_revenue), d_year, p_brand1 from lineorder, date1, part, supplier where lo_orderdate = d_datekey and lo_partkey = p_partkey and lo_suppkey = s_suppkey and p_category = 'MFGR#12' and s_region = 'AMERICA' group by d_year, p_brand1 order by d_year, p_brand1; QUERY PLAN ---------------------------------------------------------------------------------------------- GroupAggregate Group Key: date1.d_year, part.p_brand1 -> Sort Sort Key: date1.d_year, part.p_brand1 -> Custom Scan (GpuPreAgg) Reduction: Local GPU Projection: pgstrom.psum((lo_revenue)::double precision), d_year, p_brand1 Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on lineorder GPU Projection: date1.d_year, part.p_brand1, lineorder.lo_revenue Outer Scan: lineorder Depth 1: GpuHashJoin (nrows 2406009600...97764190) HashKeys: lineorder.lo_partkey JoinQuals: (lineorder.lo_partkey = part.p_partkey) KDS-Hash (size: 10.67MB) Depth 2: GpuHashJoin (nrows 97764190...18544060) HashKeys: lineorder.lo_suppkey JoinQuals: (lineorder.lo_suppkey = supplier.s_suppkey) KDS-Hash (size: 131.59MB) Depth 3: GpuHashJoin (nrows 18544060...18544060) HashKeys: lineorder.lo_orderdate JoinQuals: (lineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 461.89KB) NVMe-Strom: enabled -> Custom Scan (GpuScan) on part GPU Projection: p_brand1, p_partkey GPU Filter: (p_category = 'MFGR#12'::bpchar) -> Custom Scan (GpuScan) on supplier GPU Projection: s_suppkey GPU Filter: (s_region = 'AMERICA'::bpchar) -> Seq Scan on date1 (31 rows) Visibility Map\u306b\u95a2\u3059\u308b\u6ce8\u610f\u4e8b\u9805 \u73fe\u5728\u306e\u3068\u3053\u308d\u3001PG-Strom\u306eGPU\u5074\u51e6\u7406\u3067\u306f\u884c\u5358\u4f4d\u306eMVCC\u53ef\u8996\u6027\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001\u53ef\u8996\u6027\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u305f\u3081\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u30db\u30b9\u30c8\u5074\u3060\u3051\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3067\u3059\u304c\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30d6\u30ed\u30c3\u30af\u3092\u76f4\u63a5GPU\u306b\u8ee2\u9001\u3059\u308b\u5834\u5408\u3001\u5c11\u3005\u5384\u4ecb\u306a\u554f\u984c\u304c\u751f\u3058\u307e\u3059\u3002 NVMe-SSD\u306bP2P DMA\u3092\u8981\u6c42\u3059\u308b\u6642\u70b9\u3067\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u30d6\u30ed\u30c3\u30af\u306e\u5185\u5bb9\u306f\u307e\u3060CPU/RAM\u3078\u3068\u8aad\u307f\u51fa\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5177\u4f53\u7684\u306b\u3069\u306e\u884c\u304c\u53ef\u8996\u3067\u3042\u308b\u306e\u304b\u3001\u3069\u306e\u884c\u304c\u4e0d\u53ef\u8996\u3067\u3042\u308b\u306e\u304b\u3092\u5224\u5225\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001PostgreSQL\u304c\u30ec\u30b3\u30fc\u30c9\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u66f8\u304d\u51fa\u3059\u969b\u306bMVCC\u95a2\u9023\u306e\u5c5e\u6027\u3068\u5171\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3044\u308b\u305f\u3081\u3067\u3001\u4f3c\u305f\u3088\u3046\u306a\u554f\u984c\u304cIndexOnlyScan\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306b\u8868\u9762\u5316\u3057\u307e\u3057\u305f\u3002 \u3053\u308c\u306b\u5bfe\u51e6\u3059\u308b\u305f\u3081\u3001PostgreSQL\u306fVisibility Map\u3068\u547c\u3070\u308c\u308b\u30a4\u30f3\u30d5\u30e9\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u3042\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u4e2d\u306b\u5b58\u5728\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u304c\u5168\u3066\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089\u53ef\u8996\u3067\u3042\u308b\u4e8b\u304c\u660e\u3089\u304b\u3067\u3042\u308c\u3070\u3001\u8a72\u5f53\u3059\u308b\u30d3\u30c3\u30c8\u3092\u7acb\u3066\u308b\u4e8b\u3067\u3001\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u8aad\u3080\u3053\u3068\u306a\u304f\u5f53\u8a72\u30d6\u30ed\u30c3\u30af\u306bMVCC\u4e0d\u53ef\u8996\u306a\u30ec\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3059\u308b\u304b\u5426\u304b\u3092\u5224\u5b9a\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u3068\u3059\u308b\u3082\u306e\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u3053\u306e\u30a4\u30f3\u30d5\u30e9\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001Visibility Map\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u304a\u308a\u3001\"all-visible\"\u3067\u3042\u308b\u30d6\u30ed\u30c3\u30af\u3060\u3051\u304cSSD-to-GPU P2P DMA\u3067\u8aad\u307f\u51fa\u3059\u3088\u3046\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u9001\u51fa\u3055\u308c\u307e\u3059\u3002 Visibility Map\u306fVACUUM\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u4f5c\u6210\u3055\u308c\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u660e\u793a\u7684\u306bVACUUM\u3092\u5b9f\u884c\u3059\u308b\u4e8b\u3067\u5f37\u5236\u7684\u306bVisibility Map\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 VACUUM ANALYZE linerorder;","title":"SSDtoGPU\u30c0\u30a4\u30ec\u30af\u30c8SQL"},{"location":"ssd2gpu/#_1","text":"SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u51e6\u7406\u3059\u308b\u306b\u306f\u3001\u30d7\u30ed\u30bb\u30c3\u30b5\u304c\u52b9\u7387\u3088\u304f\u51e6\u7406\u3092\u884c\u3046\u306e\u3068\u540c\u69d8\u306b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3084\u30e1\u30e2\u30ea\u304b\u3089\u30d7\u30ed\u30bb\u30c3\u30b5\u3078\u9ad8\u901f\u306b\u30c7\u30fc\u30bf\u3092\u4f9b\u7d66\u3059\u308b\u4e8b\u304c\u91cd\u8981\u3067\u3059\u3002\u51e6\u7406\u3059\u3079\u304d\u30c7\u30fc\u30bf\u304c\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u5c4a\u3044\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u30d7\u30ed\u30bb\u30c3\u30b5\u306f\u624b\u6301\u3061\u7121\u6c99\u6c70\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u6a5f\u80fd\u306f\u3001PCIe\u30d0\u30b9\u306b\u76f4\u7d50\u3059\u308b\u4e8b\u3067\u9ad8\u901f\u306aI/O\u51e6\u7406\u3092\u5b9f\u73fe\u3059\u308bNVMe-SSD\u3068\u3001\u540c\u3058PCIe\u30d0\u30b9\u4e0a\u306b\u63a5\u7d9a\u3055\u308c\u305fGPU\u3092\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u63a5\u7d9a\u3057\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u9650\u754c\u306b\u8fd1\u3044\u901f\u5ea6\u3067\u30c7\u30fc\u30bf\u3092\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u4f9b\u7d66\u3059\u308b\u4e8b\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u9ad8\u901f\u306b\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002 \u901a\u5e38\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306b\u683c\u7d0d\u3055\u308c\u305fPostgreSQL\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u306f\u3001PCIe\u30d0\u30b9\u3092\u901a\u3057\u3066\u3044\u3063\u305f\u3093CPU/RAM\u3078\u3068\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30af\u30a8\u30ea\u5b9f\u884c\u8a08\u753b\u306b\u3057\u305f\u304c\u3063\u3066WHERE\u53e5\u306b\u3088\u308b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3084JOIN/GROUP BY\u3068\u3044\u3063\u305f\u51e6\u7406\u3092\u884c\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u96c6\u8a08\u7cfb\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u7279\u6027\u4e0a\u3001\u5165\u529b\u3059\u308b\u30c7\u30fc\u30bf\u4ef6\u6570\u3088\u308a\u51fa\u529b\u3059\u308b\u30c7\u30fc\u30bf\u4ef6\u6570\u306e\u65b9\u304c\u306f\u308b\u304b\u306b\u5c11\u306a\u3044\u4ef6\u6570\u3068\u306a\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u6570\u5341\u5104\u884c\u3092\u8aad\u307f\u51fa\u3057\u305f\u7d50\u679c\u3092GROUP BY\u3067\u96c6\u7d04\u3057\u305f\u7d50\u679c\u304c\u9ad8\u3005\u6570\u767e\u884c\u3068\u3044\u3046\u4e8b\u3082\u73cd\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u8a00\u3044\u63db\u3048\u308c\u3070\u3001\u6211\u3005\u306f\u30b4\u30df\u30c7\u30fc\u30bf\u3092\u904b\u3076\u305f\u3081\u306bPCIe\u30d0\u30b9\u4e0a\u306e\u5e2f\u57df\u3092\u6d88\u8cbb\u3057\u3066\u3044\u308b\u3068\u3082\u8a00\u3048\u307e\u3059\u304c\u3001CPU\u304c\u30ec\u30b3\u30fc\u30c9\u306e\u4e2d\u8eab\u3092\u8abf\u3079\u308b\u307e\u3067\u306f\u3001\u305d\u306e\u8981\u4e0d\u8981\u3092\u5224\u65ad\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u4e00\u822c\u7684\u306a\u5b9f\u88c5\u3067\u306f\u3053\u308c\u306f\u4e0d\u53ef\u907f\u3068\u8a00\u3048\u307e\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3092\u5909\u3048\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092PCIe\u30d0\u30b9\u4e0a\u306eP2P DMA\u3092\u7528\u3044\u3066GPU\u306b\u76f4\u63a5\u8ee2\u9001\u3057\u3001GPU\u3067SQL\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u4e8b\u3067CPU\u304c\u51e6\u7406\u3059\u3079\u304d\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u6e1b\u3089\u3059\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002\u3044\u308f\u3070\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068CPU/RAM\u306e\u9593\u306b\u4f4d\u7f6e\u3057\u3066SQL\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u3068\u3057\u3066GPU\u3092\u6d3b\u7528\u3057\u3001\u7d50\u679c\u3068\u3057\u3066I/O\u51e6\u7406\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u672c\u6a5f\u80fd\u306f\u5185\u90e8\u7684\u306bNVIDIA\u306eGPUDirect RDMA\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30ab\u30b9\u30bf\u30e0Linux kernel module\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067\u3001GPU\u30c7\u30d0\u30a4\u30b9\u30e1\u30e2\u30ea\u3068\u4ed6\u306ePCIe\u30c7\u30d0\u30a4\u30b9\u306e\u9593\u3067P2P\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u3092\u53ef\u80fd\u306b\u3059\u308b\u57fa\u76e4\u6280\u8853\u3067\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u672c\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001PostgreSQL\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bPG-Strom\u3060\u3051\u3067\u306f\u306a\u304f\u3001Linux kernel\u306e\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bNVMe-Strom\u30c9\u30e9\u30a4\u30d0\u304c\u5fc5\u8981\u3067\u3059\u3002 \u307e\u305f\u3001\u672c\u6a5f\u80fd\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u306fNVMe\u4ed5\u69d8\u306eSSD\u306e\u307f\u3067\u3059\u3002SAS\u3084SATA\u3068\u3044\u3063\u305f\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u63a5\u7d9a\u3055\u308c\u305fSSD\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4eca\u307e\u3067\u306b\u52d5\u4f5c\u5b9f\u7e3e\u306e\u3042\u308bNVMe-SSD\u306b\u3064\u3044\u3066\u306f 002: HW Validation List \u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002","title":"\u6982\u8981"},{"location":"ssd2gpu/#_2","text":"","title":"\u521d\u671f\u8a2d\u5b9a"},{"location":"ssd2gpu/#_3","text":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u306b\u306f nvme_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306fNVMe-SSD\u3068GPU\u9593\u306eP2P DMA\u3092\u4ef2\u4ecb\u3059\u308bLinux kernel module\u3092\u542b\u3093\u3067\u304a\u308a\u3001 HeteroDB Software Distribution Center \u304b\u3089\u5165\u624b\u53ef\u80fd\u3067\u3059\u3002 \u65e2\u306b heterodb-swdc \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u5834\u5408\u3001 yum \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u53ef\u80fd\u3067\u3059\u3002 $ sudo yum install nvme_strom : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: nvme_strom x86_64 0.8-1.el7 heterodb 178 k Transaction Summary ================================================================================ Install 1 Package : DKMS: install completed. Verifying : nvme_strom-0.8-1.el7.x86_64 1/1 Installed: nvme_strom.x86_64 0:0.8-1.el7 Complete! nvme_strom \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b lsmod \u30b3\u30de\u30f3\u30c9\u3067 nvme_strom \u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002 $ lsmod | grep nvme nvme_strom 12625 0 nvme 27722 4 nvme_core 52964 9 nvme","title":"\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"ssd2gpu/#_4","text":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u4ee5\u4e0b\u306e\u6761\u4ef6\u3067\u767a\u52d5\u3057\u307e\u3059\u3002 \u30b9\u30ad\u30e3\u30f3\u5bfe\u8c61\u306e\u30c6\u30fc\u30d6\u30eb\u304cNVMe-SSD\u3067\u69cb\u6210\u3055\u308c\u305f\u533a\u753b\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3002 /dev/nvmeXXXX \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3001\u307e\u305f\u306f /dev/nvmeXXXX \u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u306e\u307f\u304b\u3089\u69cb\u6210\u3055\u308c\u305fmd-raid0\u533a\u753b\u304c\u5bfe\u8c61\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u304c pg_strom.nvme_strom_threshold \u3088\u308a\u3082\u5927\u304d\u3044\u4e8b\u3002 \u3053\u306e\u8a2d\u5b9a\u5024\u306f\u4efb\u610f\u306b\u5909\u66f4\u53ef\u80fd\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u672c\u4f53\u642d\u8f09\u7269\u7406\u30e1\u30e2\u30ea\u306b shared_buffers \u306e\u8a2d\u5b9a\u5024\u306e1/3\u3092\u52a0\u3048\u305f\u5927\u304d\u3055\u3067\u3059\u3002 Note md-raid0\u3092\u7528\u3044\u3066\u8907\u6570\u306eNVMe-SSD\u533a\u753b\u304b\u3089\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u8aad\u51fa\u3057\u3092\u884c\u3046\u306b\u306f\u3001HeteroDB\u793e\u306e\u63d0\u4f9b\u3059\u308b\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u9069\u7528\u304c\u5fc5\u8981\u3067\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u3092NVMe-SSD\u3067\u69cb\u6210\u3055\u308c\u305f\u533a\u753b\u306b\u914d\u7f6e\u3059\u308b\u306b\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092NVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u683c\u7d0d\u3059\u308b\u4ee5\u5916\u306b\u3082\u3001PostgreSQL\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u6a5f\u80fd\u3092\u7528\u3044\u3066\u7279\u5b9a\u306e\u30c6\u30fc\u30d6\u30eb\u3084\u7279\u5b9a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u307f\u3092NVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u914d\u7f6e\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4f8b\u3048\u3070 /opt/nvme \u306bNVMe-SSD\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 PostgreSQL\u306e\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u6a29\u9650\u3067\u5f53\u8a72\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 CREATE TABLESPACE my_nvme LOCATION '/opt/nvme'; \u3053\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u4e0a\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001 CREATE TABLE \u69cb\u6587\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002 CREATE TABLE my_table (...) TABLESPACE my_nvme; \u3042\u308b\u3044\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3092\u5909\u66f4\u3059\u308b\u306b\u306f\u3001 ALTER DATABASE \u69cb\u6587\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002 \u3053\u306e\u5834\u5408\u3001\u65e2\u5b58\u30c6\u30fc\u30d6\u30eb\u306e\u914d\u7f6e\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 ALTER DATABASE my_database SET TABLESPACE my_nvme;","title":"\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306e\u8a2d\u8a08"},{"location":"ssd2gpu/#gpunvme-ssd","text":"\u30b5\u30fc\u30d0\u306e\u9078\u5b9a\u3068GPU\u304a\u3088\u3073NVME-SSD\u306e\u642d\u8f09\u306b\u3042\u305f\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306e\u6301\u3064\u6027\u80fd\u3092\u6700\u5927\u9650\u306b\u5f15\u304d\u51fa\u3059\u306b\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u9593\u306e\u8ddd\u96e2\u3092\u610f\u8b58\u3057\u305f\u30b3\u30f3\u30d5\u30a3\u30b0\u304c\u5fc5\u8981\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u6a5f\u80fd\u304c\u305d\u306e\u57fa\u76e4\u3068\u3057\u3066\u4f7f\u7528\u3057\u3066\u3044\u308b NVIDIA GPUDirect RDMA \u306f\u3001P2P DMA\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u4e92\u3044\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u540c\u3058PCIe root complex\u306e\u914d\u4e0b\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u8981\u6c42\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u30c7\u30e5\u30a2\u30ebCPU\u30b7\u30b9\u30c6\u30e0\u3067NVME-SSD\u304cCPU1\u306b\u3001GPU\u304cCPU2\u306b\u63a5\u7d9a\u3055\u308c\u3066\u304a\u308a\u3001P2P DMA\u304cCPU\u9593\u306eQPI\u3092\u6a2a\u5207\u308b\u3088\u3046\u69cb\u6210\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u307e\u305f\u3001\u6027\u80fd\u306e\u89b3\u70b9\u304b\u3089\u306fCPU\u5185\u8535\u306ePCIe\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3088\u308a\u3082\u3001\u5c02\u7528\u306ePCIe\u30b9\u30a4\u30c3\u30c1\u3092\u4ecb\u3057\u3066\u4e92\u3044\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u63a5\u7d9a\u3059\u308b\u65b9\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u5199\u771f\u306fHPC\u5411\u3051\u30b5\u30fc\u30d0\u306e\u30de\u30b6\u30fc\u30dc\u30fc\u30c9\u3067\u30018\u672c\u306ePCIe x16\u30b9\u30ed\u30c3\u30c8\u304cPCIe\u30b9\u30a4\u30c3\u30c1\u3092\u4ecb\u3057\u3066\u4e92\u3044\u306b\u5bfe\u3068\u306a\u308b\u30b9\u30ed\u30c3\u30c8\u3068\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u5199\u771f\u306e\u5de6\u5074\u306e\u30b9\u30ed\u30c3\u30c8\u306fCPU1\u306b\u3001\u53f3\u5074\u306e\u30b9\u30ed\u30c3\u30c8\u306fCPU2\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4f8b\u3048\u3070\u3001SSD-2\u4e0a\u306b\u69cb\u7bc9\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u3092\u7528\u3044\u3066\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5834\u5408\u3001\u6700\u9069\u306aGPU\u306e\u9078\u629e\u306fGPU-2\u3067\u3057\u3087\u3046\u3002\u307e\u305fGPU-1\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001GPUDirect RDMA\u306e\u5236\u7d04\u304b\u3089\u3001GPU-3\u3068GPU-4\u306e\u4f7f\u7528\u306f\u907f\u3051\u306d\u3070\u306a\u308a\u307e\u305b\u3093\u3002 PG-Strom\u306f\u8d77\u52d5\u6642\u306b\u30b7\u30b9\u30c6\u30e0\u306ePCIe\u30d0\u30b9\u30c8\u30dd\u30ed\u30b8\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3001GPU\u3068NVME-SSD\u9593\u306e\u8ad6\u7406\u7684\u306a\u8ddd\u96e2\u3092\u7b97\u51fa\u3057\u307e\u3059\u3002 \u3053\u308c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8d77\u52d5\u6642\u306e\u30ed\u30b0\u306b\u8a18\u9332\u3055\u308c\u3066\u304a\u308a\u3001\u4f8b\u3048\u3070 /dev/nvme2 \u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u6642\u306fGPU1\u3068\u3044\u3063\u305f\u5177\u5408\u306b\u3001\u5404NVME-SSD\u3054\u3068\u306b\u6700\u3082\u8ddd\u96e2\u306e\u8fd1\u3044GPU\u3092\u512a\u5148\u3057\u3066\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 $ pg_ctl restart : LOG: GPU<->SSD Distance Matrix LOG: GPU0 GPU1 GPU2 LOG: nvme0 ( 3) 7 7 LOG: nvme5 7 7 ( 3) LOG: nvme4 7 7 ( 3) LOG: nvme2 7 ( 3) 7 LOG: nvme1 ( 3) 7 7 LOG: nvme3 7 ( 3) 7 : \u901a\u5e38\u306f\u81ea\u52d5\u8a2d\u5b9a\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002 \u305f\u3060\u3001NVME-over-Fabric(RDMA)\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306fPCIe\u30d0\u30b9\u4e0a\u306envme\u30c7\u30d0\u30a4\u30b9\u306e\u4f4d\u7f6e\u3092\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u624b\u52d5\u3067NVME-SSD\u3068GPU\u306e\u4f4d\u7f6e\u95a2\u4fc2\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u4f8b\u3048\u3070 nvme1 \u306b\u306f gpu2 \u3092\u3001 nvme2 \u3068 nvme3 \u306b\u306f gpu1 \u3092\u5272\u308a\u5f53\u3066\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092 postgresql.conf \u3078\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u306e\u624b\u52d5\u8a2d\u5b9a\u306f\u3001\u81ea\u52d5\u8a2d\u5b9a\u3088\u308a\u3082\u512a\u5148\u3059\u308b\u4e8b\u306b\u7559\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 pg_strom.nvme_distance_map = nvme1:gpu2, nvme2:gpu1, nvme3:gpu1","title":"GPU\u3068NVME-SSD\u9593\u306e\u8ddd\u96e2"},{"location":"ssd2gpu/#_5","text":"","title":"\u904b\u7528"},{"location":"ssd2gpu/#guc","text":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u95a2\u9023\u3059\u308bGUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306f2\u3064\u3042\u308a\u307e\u3059\u3002 \u4e00\u3064\u306f pg_strom.nvme_strom_enabled \u3067\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8\u6a5f\u80fd\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5358\u7d14\u306bon/off\u3057\u307e\u3059\u3002 \u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u304c off \u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b5\u30a4\u30ba\u3084\u7269\u7406\u914d\u7f6e\u3068\u306f\u7121\u95a2\u4fc2\u306bSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u4f7f\u7528\u3055\u308c\u307e\u305b\u3093\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f on \u3067\u3059\u3002 \u3082\u3046\u4e00\u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306f pg_strom.nvme_strom_threshold \u3067\u3001SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u4f7f\u308f\u308c\u308b\u3079\u304d\u6700\u5c0f\u306e\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u306e\u7269\u7406\u914d\u7f6e\u304cNVMe-SSD\u533a\u753b\uff08\u307e\u305f\u306f\u3001NVMe-SSD\u306e\u307f\u3067\u69cb\u6210\u3055\u308c\u305fmd-raid0\u533a\u753b\uff09\u4e0a\u306b\u5b58\u5728\u3057\u3001\u304b\u3064\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u30b5\u30a4\u30ba\u304c\u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\u5024\u3088\u308a\u3082\u5927\u304d\u306a\u5834\u5408\u3001PG-Strom\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u672c\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u7269\u7406\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u3068 shared_buffers \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\u5024\u306e1/3\u3067\u3059\u3002\u3064\u307e\u308a\u3001\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u9593\u9055\u3044\u306a\u304f\u30aa\u30f3\u30e1\u30e2\u30ea\u3067\u51e6\u7406\u3057\u304d\u308c\u306a\u3044\u30b5\u30a4\u30ba\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3060\u3051SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u3092\u884c\u3046\u3088\u3046\u8abf\u6574\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u306f\u3001\u4e00\u56de\u306e\u8aad\u307f\u51fa\u3057\u3067\u3042\u308c\u3070SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306b\u512a\u4f4d\u6027\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u30aa\u30f3\u30e1\u30e2\u30ea\u51e6\u7406\u304c\u3067\u304d\u308b\u7a0b\u5ea6\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306f\u3001\u4e8c\u56de\u76ee\u4ee5\u964d\u306e\u30c7\u30a3\u30b9\u30af\u30ad\u30e3\u30c3\u30b7\u30e5\u5229\u7528\u3092\u8003\u616e\u3059\u308b\u3068\u3001\u5fc5\u305a\u3057\u3082\u512a\u4f4d\u3068\u306f\u8a00\u3048\u306a\u3044\u3068\u3044\u3046\u4eee\u5b9a\u306b\u7acb\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002 \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306e\u7279\u6027\u306b\u3088\u3063\u3066\u306f\u5fc5\u305a\u3057\u3082\u3053\u306e\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u3068\u306f\u9650\u308a\u307e\u305b\u3093\u3002","title":"GUC\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u308b\u5236\u5fa1"},{"location":"ssd2gpu/#ssd-to-gpusql","text":"EXPLAIN \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5f53\u8a72\u30af\u30a8\u30ea\u3067SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u5229\u7528\u3055\u308c\u308b\u306e\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30af\u30a8\u30ea\u306e\u4f8b\u3067\u306f\u3001 Custom Scan (GpuJoin) \u306b\u3088\u308b lineorder \u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u30b9\u30ad\u30e3\u30f3\u306b NVMe-Strom: enabled \u3068\u306e\u8868\u793a\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001 lineorder \u30c6\u30fc\u30d6\u30eb\u304b\u3089\u306e\u8aad\u51fa\u3057\u306b\u306fSSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u304c\u5229\u7528\u3055\u308c\u307e\u3059\u3002 # explain (costs off) select sum(lo_revenue), d_year, p_brand1 from lineorder, date1, part, supplier where lo_orderdate = d_datekey and lo_partkey = p_partkey and lo_suppkey = s_suppkey and p_category = 'MFGR#12' and s_region = 'AMERICA' group by d_year, p_brand1 order by d_year, p_brand1; QUERY PLAN ---------------------------------------------------------------------------------------------- GroupAggregate Group Key: date1.d_year, part.p_brand1 -> Sort Sort Key: date1.d_year, part.p_brand1 -> Custom Scan (GpuPreAgg) Reduction: Local GPU Projection: pgstrom.psum((lo_revenue)::double precision), d_year, p_brand1 Combined GpuJoin: enabled -> Custom Scan (GpuJoin) on lineorder GPU Projection: date1.d_year, part.p_brand1, lineorder.lo_revenue Outer Scan: lineorder Depth 1: GpuHashJoin (nrows 2406009600...97764190) HashKeys: lineorder.lo_partkey JoinQuals: (lineorder.lo_partkey = part.p_partkey) KDS-Hash (size: 10.67MB) Depth 2: GpuHashJoin (nrows 97764190...18544060) HashKeys: lineorder.lo_suppkey JoinQuals: (lineorder.lo_suppkey = supplier.s_suppkey) KDS-Hash (size: 131.59MB) Depth 3: GpuHashJoin (nrows 18544060...18544060) HashKeys: lineorder.lo_orderdate JoinQuals: (lineorder.lo_orderdate = date1.d_datekey) KDS-Hash (size: 461.89KB) NVMe-Strom: enabled -> Custom Scan (GpuScan) on part GPU Projection: p_brand1, p_partkey GPU Filter: (p_category = 'MFGR#12'::bpchar) -> Custom Scan (GpuScan) on supplier GPU Projection: s_suppkey GPU Filter: (s_region = 'AMERICA'::bpchar) -> Seq Scan on date1 (31 rows)","title":"SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306e\u5229\u7528\u3092\u78ba\u8a8d\u3059\u308b"},{"location":"ssd2gpu/#visibility-map","text":"\u73fe\u5728\u306e\u3068\u3053\u308d\u3001PG-Strom\u306eGPU\u5074\u51e6\u7406\u3067\u306f\u884c\u5358\u4f4d\u306eMVCC\u53ef\u8996\u6027\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001\u53ef\u8996\u6027\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u305f\u3081\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u30db\u30b9\u30c8\u5074\u3060\u3051\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3067\u3059\u304c\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30d6\u30ed\u30c3\u30af\u3092\u76f4\u63a5GPU\u306b\u8ee2\u9001\u3059\u308b\u5834\u5408\u3001\u5c11\u3005\u5384\u4ecb\u306a\u554f\u984c\u304c\u751f\u3058\u307e\u3059\u3002 NVMe-SSD\u306bP2P DMA\u3092\u8981\u6c42\u3059\u308b\u6642\u70b9\u3067\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u30d6\u30ed\u30c3\u30af\u306e\u5185\u5bb9\u306f\u307e\u3060CPU/RAM\u3078\u3068\u8aad\u307f\u51fa\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5177\u4f53\u7684\u306b\u3069\u306e\u884c\u304c\u53ef\u8996\u3067\u3042\u308b\u306e\u304b\u3001\u3069\u306e\u884c\u304c\u4e0d\u53ef\u8996\u3067\u3042\u308b\u306e\u304b\u3092\u5224\u5225\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001PostgreSQL\u304c\u30ec\u30b3\u30fc\u30c9\u3092\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u66f8\u304d\u51fa\u3059\u969b\u306bMVCC\u95a2\u9023\u306e\u5c5e\u6027\u3068\u5171\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3044\u308b\u305f\u3081\u3067\u3001\u4f3c\u305f\u3088\u3046\u306a\u554f\u984c\u304cIndexOnlyScan\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306b\u8868\u9762\u5316\u3057\u307e\u3057\u305f\u3002 \u3053\u308c\u306b\u5bfe\u51e6\u3059\u308b\u305f\u3081\u3001PostgreSQL\u306fVisibility Map\u3068\u547c\u3070\u308c\u308b\u30a4\u30f3\u30d5\u30e9\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u3042\u308b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u4e2d\u306b\u5b58\u5728\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u304c\u5168\u3066\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304b\u3089\u53ef\u8996\u3067\u3042\u308b\u4e8b\u304c\u660e\u3089\u304b\u3067\u3042\u308c\u3070\u3001\u8a72\u5f53\u3059\u308b\u30d3\u30c3\u30c8\u3092\u7acb\u3066\u308b\u4e8b\u3067\u3001\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u8aad\u3080\u3053\u3068\u306a\u304f\u5f53\u8a72\u30d6\u30ed\u30c3\u30af\u306bMVCC\u4e0d\u53ef\u8996\u306a\u30ec\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3059\u308b\u304b\u5426\u304b\u3092\u5224\u5b9a\u3059\u308b\u4e8b\u3092\u53ef\u80fd\u3068\u3059\u308b\u3082\u306e\u3067\u3059\u3002 SSD-to-GPU\u30c0\u30a4\u30ec\u30af\u30c8SQL\u5b9f\u884c\u306f\u3053\u306e\u30a4\u30f3\u30d5\u30e9\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001Visibility Map\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u304a\u308a\u3001\"all-visible\"\u3067\u3042\u308b\u30d6\u30ed\u30c3\u30af\u3060\u3051\u304cSSD-to-GPU P2P DMA\u3067\u8aad\u307f\u51fa\u3059\u3088\u3046\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u9001\u51fa\u3055\u308c\u307e\u3059\u3002 Visibility Map\u306fVACUUM\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u4f5c\u6210\u3055\u308c\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u660e\u793a\u7684\u306bVACUUM\u3092\u5b9f\u884c\u3059\u308b\u4e8b\u3067\u5f37\u5236\u7684\u306bVisibility Map\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 VACUUM ANALYZE linerorder;","title":"Visibility Map\u306b\u95a2\u3059\u308b\u6ce8\u610f\u4e8b\u9805"},{"location":"sys_admin/","text":"\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406 MPS\u30c7\u30fc\u30e2\u30f3\u306e\u5229\u7528 PostgreSQL\u306e\u3088\u3046\u306b\u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30b9\u74b0\u5883\u3067GPU\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001GPU\u5074\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30b9\u30a4\u30c3\u30c1\u306e\u4f4e\u6e1b\u3084\u30c7\u30d0\u30a4\u30b9\u7ba1\u7406\u306b\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u4f4e\u6e1b\u3092\u76ee\u7684\u3068\u3057\u3066\u3001MPS(Multi-Process Service)\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u4e00\u822c\u7684\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002 https://docs.nvidia.com/deploy/mps/index.html PG-Strom\u306b\u304a\u3044\u3066\u3082MPS\u306e\u5229\u7528\u3092\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4e0b\u8a18\u306e\u5236\u9650\u4e8b\u9805\u306b\u5bfe\u3057\u3066\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002 1\u500b\u306eMPS\u30c7\u30fc\u30e2\u30f3\u304c\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u53ef\u80fd\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u6570\u306f\u6700\u592748\u500b\uff08Pascal\u4e16\u4ee3\u4ee5\u524d\u306f16\u500b\uff09\u306b\u5236\u9650\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001GPU\u3092\u4f7f\u7528\u3059\u308bPostgreSQL\u30d7\u30ed\u30bb\u30b9\uff08CPU\u4e26\u5217\u51e6\u7406\u306b\u304a\u3051\u308b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u3092\u542b\u3080\uff09\u306e\u6570\u304c\u5e38\u306b48\u500b\u4ee5\u4e0b\uff08Pascal\u4e16\u4ee3\u4ee5\u524d\u306f16\u500b\u4ee5\u4e0b\uff09\u3067\u3042\u308b\u4e8b\u3092\u3001\u904b\u7528\u4e0a\u62c5\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MPS\u306fDynamic Parallelism\u3092\u5229\u7528\u3059\u308bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002 SQL\u304b\u3089\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u5f53\u8a72\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u4e8b\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001PL/CUDA\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u304cCUDA\u30c7\u30d0\u30a4\u30b9\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u30ea\u30f3\u30af\u3057\u3001\u30b5\u30d6\u30ab\u30fc\u30cd\u30eb\u3092\u547c\u3073\u51fa\u3059\u306a\u3069Dynamic Parallelism\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306b\u306f\u5f53\u8a72\u5236\u9650\u306b\u62b5\u89e6\u3057\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001PL/CUDA\u95a2\u6570\u306e\u547c\u3073\u51fa\u3057\u306b\u304a\u3044\u3066\u306fMPS\u3092\u5229\u7528\u3057\u307e\u305b\u3093\u3002 MPS\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306fGPU\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u3092 EXCLUSIVE_PROCESS \u306b\u5909\u66f4\u3059\u308b\u4e8b\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001PG-Strom\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f DEFAULT \u52d5\u4f5c\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002 \u4e0a\u8a18\u306ePL/CUDA\u3092\u542b\u3080\u3001\u3044\u304f\u3064\u304b\u306e\u51e6\u7406\u3067\u306f\u660e\u793a\u7684\u306bMPS\u306e\u5229\u7528\u3092\u7121\u52b9\u5316\u3057\u3066CUDA API\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u305f\u3081\u3001MPS\u30c7\u30fc\u30e2\u30f3\u4ee5\u5916\u306e\u30d7\u30ed\u30bb\u30b9\u304cGPU\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u53ef\u80fd\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MPS\u30c7\u30fc\u30e2\u30f3\u3092\u8d77\u52d5\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 <UID> \u306fPostgreSQL\u30d7\u30ed\u30bb\u30b9\u306e\u30e6\u30fc\u30b6ID\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002 $ nvidia-cuda-mps-control -d $ echo start_server -uid <UID> | nvidia-cuda-mps-control nvidia-smi \u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u3001MPS\u30c7\u30fc\u30e2\u30f3\u304cGPU\u30c7\u30d0\u30a4\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 $ nvidia-smi Sat Nov 3 12:22:26 2018 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 410.48 Driver Version: 410.48 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 Tesla V100-PCIE... Off | 00000000:02:00.0 Off | 0 | | N/A 45C P0 38W / 250W | 40MiB / 16130MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 0 11080 C nvidia-cuda-mps-server 29MiB | +-----------------------------------------------------------------------------+ \u30ca\u30ec\u30c3\u30b8\u30d9\u30fc\u30b9 PG-Strom\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306ewiki\u30b5\u30a4\u30c8\u306b\u306f\u3001\u30ce\u30fc\u30c8\u3068\u547c\u3070\u308c\u308b\u8a73\u7d30\u306a\u6280\u8853\u60c5\u5831\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002 https://github.com/heterodb/pg-strom/wiki","title":"\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406"},{"location":"sys_admin/#_1","text":"","title":"\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406"},{"location":"sys_admin/#mps","text":"PostgreSQL\u306e\u3088\u3046\u306b\u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30b9\u74b0\u5883\u3067GPU\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001GPU\u5074\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30b9\u30a4\u30c3\u30c1\u306e\u4f4e\u6e1b\u3084\u30c7\u30d0\u30a4\u30b9\u7ba1\u7406\u306b\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u4f4e\u6e1b\u3092\u76ee\u7684\u3068\u3057\u3066\u3001MPS(Multi-Process Service)\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u4e00\u822c\u7684\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002 https://docs.nvidia.com/deploy/mps/index.html PG-Strom\u306b\u304a\u3044\u3066\u3082MPS\u306e\u5229\u7528\u3092\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4e0b\u8a18\u306e\u5236\u9650\u4e8b\u9805\u306b\u5bfe\u3057\u3066\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002 1\u500b\u306eMPS\u30c7\u30fc\u30e2\u30f3\u304c\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u53ef\u80fd\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u6570\u306f\u6700\u592748\u500b\uff08Pascal\u4e16\u4ee3\u4ee5\u524d\u306f16\u500b\uff09\u306b\u5236\u9650\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001GPU\u3092\u4f7f\u7528\u3059\u308bPostgreSQL\u30d7\u30ed\u30bb\u30b9\uff08CPU\u4e26\u5217\u51e6\u7406\u306b\u304a\u3051\u308b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u3092\u542b\u3080\uff09\u306e\u6570\u304c\u5e38\u306b48\u500b\u4ee5\u4e0b\uff08Pascal\u4e16\u4ee3\u4ee5\u524d\u306f16\u500b\u4ee5\u4e0b\uff09\u3067\u3042\u308b\u4e8b\u3092\u3001\u904b\u7528\u4e0a\u62c5\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MPS\u306fDynamic Parallelism\u3092\u5229\u7528\u3059\u308bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002 SQL\u304b\u3089\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u5f53\u8a72\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u4e8b\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001PL/CUDA\u30e6\u30fc\u30b6\u5b9a\u7fa9\u95a2\u6570\u304cCUDA\u30c7\u30d0\u30a4\u30b9\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u30ea\u30f3\u30af\u3057\u3001\u30b5\u30d6\u30ab\u30fc\u30cd\u30eb\u3092\u547c\u3073\u51fa\u3059\u306a\u3069Dynamic Parallelism\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306b\u306f\u5f53\u8a72\u5236\u9650\u306b\u62b5\u89e6\u3057\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001PL/CUDA\u95a2\u6570\u306e\u547c\u3073\u51fa\u3057\u306b\u304a\u3044\u3066\u306fMPS\u3092\u5229\u7528\u3057\u307e\u305b\u3093\u3002 MPS\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306fGPU\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u3092 EXCLUSIVE_PROCESS \u306b\u5909\u66f4\u3059\u308b\u4e8b\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001PG-Strom\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f DEFAULT \u52d5\u4f5c\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002 \u4e0a\u8a18\u306ePL/CUDA\u3092\u542b\u3080\u3001\u3044\u304f\u3064\u304b\u306e\u51e6\u7406\u3067\u306f\u660e\u793a\u7684\u306bMPS\u306e\u5229\u7528\u3092\u7121\u52b9\u5316\u3057\u3066CUDA API\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u305f\u3081\u3001MPS\u30c7\u30fc\u30e2\u30f3\u4ee5\u5916\u306e\u30d7\u30ed\u30bb\u30b9\u304cGPU\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u53ef\u80fd\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MPS\u30c7\u30fc\u30e2\u30f3\u3092\u8d77\u52d5\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 <UID> \u306fPostgreSQL\u30d7\u30ed\u30bb\u30b9\u306e\u30e6\u30fc\u30b6ID\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002 $ nvidia-cuda-mps-control -d $ echo start_server -uid <UID> | nvidia-cuda-mps-control nvidia-smi \u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u3001MPS\u30c7\u30fc\u30e2\u30f3\u304cGPU\u30c7\u30d0\u30a4\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002 $ nvidia-smi Sat Nov 3 12:22:26 2018 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 410.48 Driver Version: 410.48 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 Tesla V100-PCIE... Off | 00000000:02:00.0 Off | 0 | | N/A 45C P0 38W / 250W | 40MiB / 16130MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 0 11080 C nvidia-cuda-mps-server 29MiB | +-----------------------------------------------------------------------------+","title":"MPS\u30c7\u30fc\u30e2\u30f3\u306e\u5229\u7528"},{"location":"sys_admin/#_2","text":"PG-Strom\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306ewiki\u30b5\u30a4\u30c8\u306b\u306f\u3001\u30ce\u30fc\u30c8\u3068\u547c\u3070\u308c\u308b\u8a73\u7d30\u306a\u6280\u8853\u60c5\u5831\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002 https://github.com/heterodb/pg-strom/wiki","title":"\u30ca\u30ec\u30c3\u30b8\u30d9\u30fc\u30b9"},{"location":"troubles/","text":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u554f\u984c\u306e\u5207\u308a\u5206\u3051 \u7279\u5b9a\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u305f\u969b\u306b\u4f55\u304c\u3057\u304b\u306e\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u305d\u308c\u304c\u4f55\u306b\u8d77\u56e0\u3059\u308b\u3082\u306e\u3067\u3042\u308b\u306e\u304b\u3092\u7279\u5b9a\u3059\u308b\u306e\u306f\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u7b2c\u4e00\u6b69\u3067\u3059\u3002 \u6b8b\u5ff5\u306a\u304c\u3089\u3001PostgreSQL\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u6bd4\u3079PG-Strom\u306e\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u6570\u306e\u958b\u767a\u8005\u306b\u3088\u3063\u3066\u652f\u3048\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u54c1\u8cea\u3084\u5b9f\u7e3e\u3068\u3044\u3063\u305f\u89b3\u70b9\u304b\u3089\u3001\u307e\u305aPG-Strom\u304c\u60aa\u3055\u3092\u3057\u3066\u3044\u306a\u3044\u304b\u7591\u3046\u306e\u306f\u59a5\u5f53\u306a\u5224\u65ad\u3067\u3059\u3002 PG-Strom\u306e\u5168\u6a5f\u80fd\u3092\u4e00\u5ea6\u306b\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u306b\u306f pg_strom.enabled \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u4e8b\u3067PG-Strom\u306f\u7121\u52b9\u5316\u3055\u308c\u3001\u6a19\u6e96\u306ePostgreSQL\u3068\u5168\u304f\u540c\u4e00\u306e\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002 \u305d\u308c\u3067\u3082\u306a\u304a\u554f\u984c\u304c\u518d\u73fe\u3059\u308b\u304b\u3069\u3046\u304b\u306f\u4e00\u3064\u306e\u5224\u65ad\u6750\u6599\u3068\u306a\u308b\u3067\u3057\u3087\u3046\u3002 # SET pg_strom.enabled = off; \u3053\u306e\u4ed6\u306b\u3082\u3001GpuScan\u3001GpuJoin\u3001GpuPreAgg\u3068\u3044\u3063\u305f\u7279\u5b9a\u306e\u5b9f\u884c\u8a08\u753b\u306e\u307f\u3092\u7121\u52b9\u5316\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u8a73\u7d30\u306f \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9/GPU\u30d1\u30e9\u30e1\u30fc\u30bf \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u63a1\u53d6 \u30b7\u30b9\u30c6\u30e0\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u3088\u3046\u306a\u91cd\u5927\u306a\u30c8\u30e9\u30d6\u30eb\u306e\u89e3\u6790\u306b\u306f\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u63a1\u53d6\u304c\u6b20\u304b\u305b\u307e\u305b\u3093\u3002 \u672c\u7bc0\u3067\u306f\u3001PostgreSQL\u3068PG-Strom\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(CPU\u5074)\u3001\u304a\u3088\u3073PG-Strom\u306eGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(GPU\u5074)\u3092\u53d6\u5f97\u3057\u3001\u969c\u5bb3\u767a\u751f\u6642\u306e\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u63a1\u53d6\u3059\u308b\u305f\u3081\u306e\u624b\u6bb5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002 PostgreSQL\u8d77\u52d5\u6642\u8a2d\u5b9a\u306e\u8ffd\u52a0 \u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u6642\u306b\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(CPU\u5074)\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u6210\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b core \u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u3092\u7121\u5236\u9650\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306fPostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u30b7\u30a7\u30eb\u4e0a\u3067 ulimit -c \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u5909\u66f4\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30a8\u30e9\u30fc\u6642\u306b\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(GPU\u5074)\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u304c\u74b0\u5883\u5909\u6570 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u306b 1 \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001 /etc/systemd/system/postgresql-<version>.service.d/ \u4ee5\u4e0b\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e pg_strom.conf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 [Service] LimitNOFILE=65536 LimitCORE=infinity #Environment=CUDA_ENABLE_COREDUMP_ON_EXCEPTION=1 CUDA9.1\u306b\u304a\u3044\u3066\u306f\u3001\u901a\u5e38\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u751f\u6210\u306b\u306f\u6570\u5206\u4ee5\u4e0a\u306e\u6642\u9593\u3092\u8981\u3057\u3001\u305d\u306e\u9593\u3001\u30a8\u30e9\u30fc\u3092\u767a\u751f\u3057\u305fPostgreSQL\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u5fdc\u7b54\u306f\u5b8c\u5168\u306b\u505c\u6b62\u3057\u3066\u3057\u307e\u3057\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u306f\u7279\u5b9a\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u306b\u304a\u3044\u3066\u767a\u751f\u3059\u308bGPU\u30ab\u30fc\u30cd\u30eb\u306b\u8d77\u56e0\u3059\u308b\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u8abf\u67fb\u3092\u884c\u3046\u5834\u5408\u306b\u3060\u3051\u3001 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u304a\u3051\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306f\u3001 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u74b0\u5883\u5909\u6570\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u3044\u307e\u3059\u3002 PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001 Max core file size \u304cunlimited\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 # cat /proc/<PID of postmaster>/limits Limit Soft Limit Hard Limit Units : : : : Max core file size unlimited unlimited bytes : : : : debuginfo\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u304b\u3089\u610f\u5473\u306e\u3042\u308b\u60c5\u5831\u3092\u8aad\u307f\u53d6\u308b\u306b\u306f\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\u304c\u5fc5\u8981\u3067\u3059\u3002 \u3053\u308c\u3089\u306f -debuginfo \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u683c\u7d0d\u3055\u308c\u3066\u304a\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bPostgreSQL\u304a\u3088\u3073PG-Strom\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5fdc\u3058\u3066\u305d\u308c\u305e\u308c\u8ffd\u52a0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002 # yum install postgresql10-debuginfo pg_strom-PG10-debuginfo : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: pg_strom-PG10-debuginfo x86_64 1.9-180301.el7 heterodb-debuginfo 766 k postgresql10-debuginfo x86_64 10.3-1PGDG.rhel7 pgdg10 9.7 M Transaction Summary ================================================================================ Install 2 Packages : Installed: pg_strom-PG10-debuginfo.x86_64 0:1.9-180301.el7 postgresql10-debuginfo.x86_64 0:10.3-1PGDG.rhel7 Complete! CPU\u5074\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u306e\u78ba\u8a8d \u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u4f5c\u6210\u3055\u308c\u308b\u30d1\u30b9\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf kernel.core_pattern \u304a\u3088\u3073 kernel.core_uses_pid \u306e\u5024\u306b\u3088\u3063\u3066\u6c7a\u307e\u308a\u307e\u3059\u3002 \u901a\u5e38\u306f\u30d7\u30ed\u30bb\u30b9\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u306e\u3067\u3001systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3055\u308c\u308b /var/lib/pgdata \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 core.<PID> \u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001 gdb \u3092\u7528\u3044\u3066\u30af\u30e9\u30c3\u30b7\u30e5\u306b\u81f3\u308b\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 gdb \u306e -c \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b3\u30a2\u30d5\u30a1\u30a4\u30eb\u3092\u3001 -f \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 # gdb -c /var/lib/pgdata/core.134680 -f /usr/pgsql-10/bin/postgres GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-100.el7_4.1 : (gdb) bt #0 0x00007fb942af3903 in __epoll_wait_nocancel () from /lib64/libc.so.6 #1 0x00000000006f71ae in WaitEventSetWaitBlock (nevents=1, occurred_events=0x7ffee51e1d70, cur_timeout=-1, set=0x2833298) at latch.c:1048 #2 WaitEventSetWait (set=0x2833298, timeout=timeout@entry-1, occurred_events=occurred_events@entry0x7ffee51e1d70, nevents=nevents@entry1, wait_event_info=wait_event_info@entry100663296) at latch.c:1000 #3 0x00000000006210fb in secure_read (port=0x2876120, ptr=0xcaa7e0 <PqRecvBuffer>, len=8192) at be-secure.c:166 #4 0x000000000062b6e8 in pq_recvbuf () at pqcomm.c:963 #5 0x000000000062c345 in pq_getbyte () at pqcomm.c:1006 #6 0x0000000000718682 in SocketBackend (inBuf=0x7ffee51e1ef0) at postgres.c:328 #7 ReadCommand (inBuf=0x7ffee51e1ef0) at postgres.c:501 #8 PostgresMain (argc=<optimized out>, argv=argv@entry0x287bb68, dbname=0x28333f8 \"postgres\", username=<optimized out>) at postgres.c:4030 #9 0x000000000047adbc in BackendRun (port=0x2876120) at postmaster.c:4405 #10 BackendStartup (port=0x2876120) at postmaster.c:4077 #11 ServerLoop () at postmaster.c:1755 #12 0x00000000006afb7f in PostmasterMain (argc=argc@entry3, argv=argv@entry0x2831280) at postmaster.c:1363 #13 0x000000000047bbef in main (argc=3, argv=0x2831280) at main.c:228 gdb\u306e bt \u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 \u3053\u306e\u30b1\u30fc\u30b9\u3067\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u30af\u30a8\u30ea\u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u306ePostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b SIGSEGV \u30b7\u30b0\u30ca\u30eb\u3092\u9001\u51fa\u3057\u3066\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3057\u305f\u305f\u3081\u3001 WaitEventSetWait \u5ef6\u9577\u4e0a\u306e __epoll_wait_nocancel \u3067\u30d7\u30ed\u30bb\u30b9\u304c\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 GPU\u5074\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u306e\u78ba\u8a8d GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306f\u3001\uff08 CUDA_COREDUMP_FILE \u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u3066\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\uff09PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002 systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3055\u308c\u308b /var/lib/pgdata \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b\u306e\u540d\u524d\u3067GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 core_<timestamp>_<hostname>_<PID>.nvcudmp \u306a\u304a\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306b\u306f\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\u306a\u3069\u306e\u30c7\u30d0\u30c3\u30b0\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3053\u306e\u72b6\u614b\u3067\u306f\u969c\u5bb3\u89e3\u6790\u3092\u884c\u3046\u4e8b\u306f\u307b\u3068\u3093\u3069\u4e0d\u53ef\u80fd\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066PG-Strom\u304c\u751f\u6210\u3059\u308bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u30c7\u30d0\u30c3\u30b0\u60c5\u5831\u3092\u542b\u3081\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u305f\u3060\u3057\u3001\u3053\u306e\u8a2d\u5b9a\u306f\u5b9f\u884c\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u4f4e\u4e0b\u3055\u305b\u308b\u305f\u3081\u3001\u6052\u5e38\u7684\u306a\u4f7f\u7528\u306f\u975e\u63a8\u5968\u3067\u3059\u3002 \u30c8\u30e9\u30d6\u30eb\u89e3\u6790\u6642\u306b\u3060\u3051\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 nvme=# set pg_strom.debug_jit_compile_options = on; SET \u751f\u6210\u3055\u308c\u305fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f cuda-gdb \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 # /usr/local/cuda/bin/cuda-gdb NVIDIA (R) CUDA Debugger 9.1 release Portions Copyright (C) 2007-2017 NVIDIA Corporation : For help, type \"help\". Type \"apropos word\" to search for commands related to \"word\". (cuda-gdb) \u5f15\u6570\u306a\u3057\u3067 cuda-gdb \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u4e0a\u3067 target \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5148\u307b\u3069\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002 (cuda-gdb) target cudacore /var/lib/pgdata/core_1521131828_magro.heterodb.com_216238.nvcudmp Opening GPU coredump: /var/lib/pgdata/core_1521131828_magro.heterodb.com_216238.nvcudmp [New Thread 216240] CUDA Exception: Warp Illegal Address The exception was triggered at PC 0x7ff4dc82f930 (cuda_gpujoin.h:1159) [Current focus set to CUDA kernel 0, grid 1, block (0,0,0), thread (0,0,0), device 0, sm 0, warp 0, lane 0] #0 0x00007ff4dc82f938 in _INTERNAL_8_pg_strom_0124cb94::gpujoin_exec_hashjoin (kcxt=0x7ff4f7fffbf8, kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, depth=3, rd_stack=0x7fe9f4806118, wr_stack=0x7fe9f480c118, l_state=0x7ff4f7fffc48, matched=0x7ff4f7fffc7c \"\") at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1159 1159 while (khitem && khitem->hash != hash_value) \u3053\u306e\u72b6\u614b\u3067 bt \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3001\u554f\u984c\u767a\u751f\u500b\u6240\u3078\u306e\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u63a1\u53d6\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 (cuda-gdb) bt #0 0x00007ff4dc82f938 in _INTERNAL_8_pg_strom_0124cb94::gpujoin_exec_hashjoin (kcxt=0x7ff4f7fffbf8, kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, depth=3, rd_stack=0x7fe9f4806118, wr_stack=0x7fe9f480c118, l_state=0x7ff4f7fffc48, matched=0x7ff4f7fffc7c \"\") at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1159 #1 0x00007ff4dc9428f0 in gpujoin_main<<<(30,1,1),(256,1,1)>>> (kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, kds_dst=0x7fe9e8800030, kparams_gpreagg=0x0) at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1347 \u3088\u308a\u8a73\u7d30\u306a cuda-gdb \u30b3\u30de\u30f3\u30c9\u306e\u5229\u7528\u6cd5\u306f CUDA Toolkit Documentation - CUDA-GDB \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"},{"location":"troubles/#_1","text":"\u7279\u5b9a\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u305f\u969b\u306b\u4f55\u304c\u3057\u304b\u306e\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u305d\u308c\u304c\u4f55\u306b\u8d77\u56e0\u3059\u308b\u3082\u306e\u3067\u3042\u308b\u306e\u304b\u3092\u7279\u5b9a\u3059\u308b\u306e\u306f\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u7b2c\u4e00\u6b69\u3067\u3059\u3002 \u6b8b\u5ff5\u306a\u304c\u3089\u3001PostgreSQL\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u6bd4\u3079PG-Strom\u306e\u958b\u767a\u8005\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u6570\u306e\u958b\u767a\u8005\u306b\u3088\u3063\u3066\u652f\u3048\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u54c1\u8cea\u3084\u5b9f\u7e3e\u3068\u3044\u3063\u305f\u89b3\u70b9\u304b\u3089\u3001\u307e\u305aPG-Strom\u304c\u60aa\u3055\u3092\u3057\u3066\u3044\u306a\u3044\u304b\u7591\u3046\u306e\u306f\u59a5\u5f53\u306a\u5224\u65ad\u3067\u3059\u3002 PG-Strom\u306e\u5168\u6a5f\u80fd\u3092\u4e00\u5ea6\u306b\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u306b\u306f pg_strom.enabled \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u4e8b\u3067PG-Strom\u306f\u7121\u52b9\u5316\u3055\u308c\u3001\u6a19\u6e96\u306ePostgreSQL\u3068\u5168\u304f\u540c\u4e00\u306e\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002 \u305d\u308c\u3067\u3082\u306a\u304a\u554f\u984c\u304c\u518d\u73fe\u3059\u308b\u304b\u3069\u3046\u304b\u306f\u4e00\u3064\u306e\u5224\u65ad\u6750\u6599\u3068\u306a\u308b\u3067\u3057\u3087\u3046\u3002 # SET pg_strom.enabled = off; \u3053\u306e\u4ed6\u306b\u3082\u3001GpuScan\u3001GpuJoin\u3001GpuPreAgg\u3068\u3044\u3063\u305f\u7279\u5b9a\u306e\u5b9f\u884c\u8a08\u753b\u306e\u307f\u3092\u7121\u52b9\u5316\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3089\u306e\u8a73\u7d30\u306f \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9/GPU\u30d1\u30e9\u30e1\u30fc\u30bf \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"\u554f\u984c\u306e\u5207\u308a\u5206\u3051"},{"location":"troubles/#_2","text":"\u30b7\u30b9\u30c6\u30e0\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3059\u3088\u3046\u306a\u91cd\u5927\u306a\u30c8\u30e9\u30d6\u30eb\u306e\u89e3\u6790\u306b\u306f\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u63a1\u53d6\u304c\u6b20\u304b\u305b\u307e\u305b\u3093\u3002 \u672c\u7bc0\u3067\u306f\u3001PostgreSQL\u3068PG-Strom\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(CPU\u5074)\u3001\u304a\u3088\u3073PG-Strom\u306eGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(GPU\u5074)\u3092\u53d6\u5f97\u3057\u3001\u969c\u5bb3\u767a\u751f\u6642\u306e\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u63a1\u53d6\u3059\u308b\u305f\u3081\u306e\u624b\u6bb5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002","title":"\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u63a1\u53d6"},{"location":"troubles/#postgresql","text":"\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u6642\u306b\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(CPU\u5074)\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u6210\u3059\u308b\u4e8b\u306e\u3067\u304d\u308b core \u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u3092\u7121\u5236\u9650\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306fPostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u30b7\u30a7\u30eb\u4e0a\u3067 ulimit -c \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u5909\u66f4\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30a8\u30e9\u30fc\u6642\u306b\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7(GPU\u5074)\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u304c\u74b0\u5883\u5909\u6570 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u306b 1 \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001 /etc/systemd/system/postgresql-<version>.service.d/ \u4ee5\u4e0b\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e pg_strom.conf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 [Service] LimitNOFILE=65536 LimitCORE=infinity #Environment=CUDA_ENABLE_COREDUMP_ON_EXCEPTION=1 CUDA9.1\u306b\u304a\u3044\u3066\u306f\u3001\u901a\u5e38\u3001GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u751f\u6210\u306b\u306f\u6570\u5206\u4ee5\u4e0a\u306e\u6642\u9593\u3092\u8981\u3057\u3001\u305d\u306e\u9593\u3001\u30a8\u30e9\u30fc\u3092\u767a\u751f\u3057\u305fPostgreSQL\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u5fdc\u7b54\u306f\u5b8c\u5168\u306b\u505c\u6b62\u3057\u3066\u3057\u307e\u3057\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u306f\u7279\u5b9a\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u306b\u304a\u3044\u3066\u767a\u751f\u3059\u308bGPU\u30ab\u30fc\u30cd\u30eb\u306b\u8d77\u56e0\u3059\u308b\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u8abf\u67fb\u3092\u884c\u3046\u5834\u5408\u306b\u3060\u3051\u3001 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u304a\u3051\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306f\u3001 CUDA_ENABLE_COREDUMP_ON_EXCEPTION \u74b0\u5883\u5909\u6570\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u3044\u307e\u3059\u3002 PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001 Max core file size \u304cunlimited\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002 \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 # cat /proc/<PID of postmaster>/limits Limit Soft Limit Hard Limit Units : : : : Max core file size unlimited unlimited bytes : : : :","title":"PostgreSQL\u8d77\u52d5\u6642\u8a2d\u5b9a\u306e\u8ffd\u52a0"},{"location":"troubles/#debuginfo","text":"\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u304b\u3089\u610f\u5473\u306e\u3042\u308b\u60c5\u5831\u3092\u8aad\u307f\u53d6\u308b\u306b\u306f\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\u304c\u5fc5\u8981\u3067\u3059\u3002 \u3053\u308c\u3089\u306f -debuginfo \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u683c\u7d0d\u3055\u308c\u3066\u304a\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bPostgreSQL\u304a\u3088\u3073PG-Strom\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5fdc\u3058\u3066\u305d\u308c\u305e\u308c\u8ffd\u52a0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002 # yum install postgresql10-debuginfo pg_strom-PG10-debuginfo : ================================================================================ Package Arch Version Repository Size ================================================================================ Installing: pg_strom-PG10-debuginfo x86_64 1.9-180301.el7 heterodb-debuginfo 766 k postgresql10-debuginfo x86_64 10.3-1PGDG.rhel7 pgdg10 9.7 M Transaction Summary ================================================================================ Install 2 Packages : Installed: pg_strom-PG10-debuginfo.x86_64 0:1.9-180301.el7 postgresql10-debuginfo.x86_64 0:10.3-1PGDG.rhel7 Complete!","title":"debuginfo\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"troubles/#cpu","text":"\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306e\u4f5c\u6210\u3055\u308c\u308b\u30d1\u30b9\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf kernel.core_pattern \u304a\u3088\u3073 kernel.core_uses_pid \u306e\u5024\u306b\u3088\u3063\u3066\u6c7a\u307e\u308a\u307e\u3059\u3002 \u901a\u5e38\u306f\u30d7\u30ed\u30bb\u30b9\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u306e\u3067\u3001systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3055\u308c\u308b /var/lib/pgdata \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 core.<PID> \u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001 gdb \u3092\u7528\u3044\u3066\u30af\u30e9\u30c3\u30b7\u30e5\u306b\u81f3\u308b\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 gdb \u306e -c \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b3\u30a2\u30d5\u30a1\u30a4\u30eb\u3092\u3001 -f \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 # gdb -c /var/lib/pgdata/core.134680 -f /usr/pgsql-10/bin/postgres GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-100.el7_4.1 : (gdb) bt #0 0x00007fb942af3903 in __epoll_wait_nocancel () from /lib64/libc.so.6 #1 0x00000000006f71ae in WaitEventSetWaitBlock (nevents=1, occurred_events=0x7ffee51e1d70, cur_timeout=-1, set=0x2833298) at latch.c:1048 #2 WaitEventSetWait (set=0x2833298, timeout=timeout@entry-1, occurred_events=occurred_events@entry0x7ffee51e1d70, nevents=nevents@entry1, wait_event_info=wait_event_info@entry100663296) at latch.c:1000 #3 0x00000000006210fb in secure_read (port=0x2876120, ptr=0xcaa7e0 <PqRecvBuffer>, len=8192) at be-secure.c:166 #4 0x000000000062b6e8 in pq_recvbuf () at pqcomm.c:963 #5 0x000000000062c345 in pq_getbyte () at pqcomm.c:1006 #6 0x0000000000718682 in SocketBackend (inBuf=0x7ffee51e1ef0) at postgres.c:328 #7 ReadCommand (inBuf=0x7ffee51e1ef0) at postgres.c:501 #8 PostgresMain (argc=<optimized out>, argv=argv@entry0x287bb68, dbname=0x28333f8 \"postgres\", username=<optimized out>) at postgres.c:4030 #9 0x000000000047adbc in BackendRun (port=0x2876120) at postmaster.c:4405 #10 BackendStartup (port=0x2876120) at postmaster.c:4077 #11 ServerLoop () at postmaster.c:1755 #12 0x00000000006afb7f in PostmasterMain (argc=argc@entry3, argv=argv@entry0x2831280) at postmaster.c:1363 #13 0x000000000047bbef in main (argc=3, argv=0x2831280) at main.c:228 gdb\u306e bt \u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 \u3053\u306e\u30b1\u30fc\u30b9\u3067\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u30af\u30a8\u30ea\u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u306ePostgreSQL\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b SIGSEGV \u30b7\u30b0\u30ca\u30eb\u3092\u9001\u51fa\u3057\u3066\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u5f15\u304d\u8d77\u3053\u3057\u305f\u305f\u3081\u3001 WaitEventSetWait \u5ef6\u9577\u4e0a\u306e __epoll_wait_nocancel \u3067\u30d7\u30ed\u30bb\u30b9\u304c\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002","title":"CPU\u5074\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u306e\u78ba\u8a8d"},{"location":"troubles/#gpu","text":"GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306f\u3001\uff08 CUDA_COREDUMP_FILE \u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u3066\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\uff09PostgreSQL\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002 systemd\u304b\u3089PostgreSQL\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3055\u308c\u308b /var/lib/pgdata \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b\u306e\u540d\u524d\u3067GPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 core_<timestamp>_<hostname>_<PID>.nvcudmp \u306a\u304a\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u306b\u306f\u30b7\u30f3\u30dc\u30eb\u60c5\u5831\u306a\u3069\u306e\u30c7\u30d0\u30c3\u30b0\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3053\u306e\u72b6\u614b\u3067\u306f\u969c\u5bb3\u89e3\u6790\u3092\u884c\u3046\u4e8b\u306f\u307b\u3068\u3093\u3069\u4e0d\u53ef\u80fd\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066PG-Strom\u304c\u751f\u6210\u3059\u308bGPU\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u30c7\u30d0\u30c3\u30b0\u60c5\u5831\u3092\u542b\u3081\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u305f\u3060\u3057\u3001\u3053\u306e\u8a2d\u5b9a\u306f\u5b9f\u884c\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u4f4e\u4e0b\u3055\u305b\u308b\u305f\u3081\u3001\u6052\u5e38\u7684\u306a\u4f7f\u7528\u306f\u975e\u63a8\u5968\u3067\u3059\u3002 \u30c8\u30e9\u30d6\u30eb\u89e3\u6790\u6642\u306b\u3060\u3051\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 nvme=# set pg_strom.debug_jit_compile_options = on; SET \u751f\u6210\u3055\u308c\u305fGPU\u30ab\u30fc\u30cd\u30eb\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f cuda-gdb \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 # /usr/local/cuda/bin/cuda-gdb NVIDIA (R) CUDA Debugger 9.1 release Portions Copyright (C) 2007-2017 NVIDIA Corporation : For help, type \"help\". Type \"apropos word\" to search for commands related to \"word\". (cuda-gdb) \u5f15\u6570\u306a\u3057\u3067 cuda-gdb \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u4e0a\u3067 target \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5148\u307b\u3069\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u30c0\u30f3\u30d7\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002 (cuda-gdb) target cudacore /var/lib/pgdata/core_1521131828_magro.heterodb.com_216238.nvcudmp Opening GPU coredump: /var/lib/pgdata/core_1521131828_magro.heterodb.com_216238.nvcudmp [New Thread 216240] CUDA Exception: Warp Illegal Address The exception was triggered at PC 0x7ff4dc82f930 (cuda_gpujoin.h:1159) [Current focus set to CUDA kernel 0, grid 1, block (0,0,0), thread (0,0,0), device 0, sm 0, warp 0, lane 0] #0 0x00007ff4dc82f938 in _INTERNAL_8_pg_strom_0124cb94::gpujoin_exec_hashjoin (kcxt=0x7ff4f7fffbf8, kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, depth=3, rd_stack=0x7fe9f4806118, wr_stack=0x7fe9f480c118, l_state=0x7ff4f7fffc48, matched=0x7ff4f7fffc7c \"\") at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1159 1159 while (khitem && khitem->hash != hash_value) \u3053\u306e\u72b6\u614b\u3067 bt \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3001\u554f\u984c\u767a\u751f\u500b\u6240\u3078\u306e\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u63a1\u53d6\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002 (cuda-gdb) bt #0 0x00007ff4dc82f938 in _INTERNAL_8_pg_strom_0124cb94::gpujoin_exec_hashjoin (kcxt=0x7ff4f7fffbf8, kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, depth=3, rd_stack=0x7fe9f4806118, wr_stack=0x7fe9f480c118, l_state=0x7ff4f7fffc48, matched=0x7ff4f7fffc7c \"\") at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1159 #1 0x00007ff4dc9428f0 in gpujoin_main<<<(30,1,1),(256,1,1)>>> (kgjoin=0x7fe9f4800078, kmrels=0x7fe9f8800000, kds_src=0x7fe9f0800030, kds_dst=0x7fe9e8800030, kparams_gpreagg=0x0) at /usr/pgsql-10/share/extension/cuda_gpujoin.h:1347 \u3088\u308a\u8a73\u7d30\u306a cuda-gdb \u30b3\u30de\u30f3\u30c9\u306e\u5229\u7528\u6cd5\u306f CUDA Toolkit Documentation - CUDA-GDB \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002","title":"GPU\u5074\u30d0\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u306e\u78ba\u8a8d"}]}